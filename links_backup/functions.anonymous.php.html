<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>PHP: Анонимные функции - Manual </title>

 <link rel="shortcut icon" href="https://www.php.net/favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="functions.anonymous.php.html">
 <link rel="shorturl" href="functions.anonymous.php.html">
 <link rel="alternate" href="functions.anonymous.php.html" hreflang="x-default">

 <link rel="contents" href="https://www.php.net/manual/ru/index.php">
 <link rel="index" href="https://www.php.net/manual/ru/language.functions.php">
 <link rel="prev" href="https://www.php.net/manual/ru/functions.internal.php">
 <link rel="next" href="https://www.php.net/manual/ru/functions.arrow.php">

 <link rel="alternate" href="https://www.php.net/manual/en/functions.anonymous.php" hreflang="en">
 <link rel="alternate" href="https://www.php.net/manual/pt_BR/functions.anonymous.php" hreflang="pt_BR">
 <link rel="alternate" href="https://www.php.net/manual/zh/functions.anonymous.php" hreflang="zh">
 <link rel="alternate" href="https://www.php.net/manual/fr/functions.anonymous.php" hreflang="fr">
 <link rel="alternate" href="https://www.php.net/manual/de/functions.anonymous.php" hreflang="de">
 <link rel="alternate" href="https://www.php.net/manual/ja/functions.anonymous.php" hreflang="ja">
 <link rel="alternate" href="functions.anonymous.php.html" hreflang="ru">
 <link rel="alternate" href="https://www.php.net/manual/es/functions.anonymous.php" hreflang="es">
 <link rel="alternate" href="https://www.php.net/manual/tr/functions.anonymous.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="https://www.php.net/cached.php?t=1639034403&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="https://www.php.net/cached.php?t=1539765004&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="https://www.php.net/cached.php?t=1606338002&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="https://www.php.net/cached.php?t=1627831203&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="https://www.php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script>
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="https://www.php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script src="https://www.php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base href="">


</head>
<body class="docs ">

<nav id="head-nav" class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <a href="https://www.php.net/" class="brand"><img src="https://www.php.net/images/logos/php-logo.svg" width="48" height="24" alt="php"></a>
    <div id="mainmenu-toggle-overlay"></div>
    <input type="checkbox" id="mainmenu-toggle">
    <ul class="nav">
      <li class=""><a href="https://www.php.net/downloads">Downloads</a></li>
      <li class="active"><a href="https://www.php.net/docs.php">Documentation</a></li>
      <li class=""><a href="https://www.php.net/get-involved" >Get Involved</a></li>
      <li class=""><a href="https://www.php.net/support">Help</a></li>
      <li class="">
        <a href="https://www.php.net/releases/8.1/index.php">
          <img src="https://www.php.net/images/php8/logo_php8_1.svg" alt="php8.1" height="22" width="60">
        </a>
      </li>
    </ul>
    <form class="navbar-search" id="topsearch" action="https://www.php.net/search.php">
      <input type="hidden" name="show" value="quickref">
      <input type="search" name="pattern" class="search-query" placeholder="Search" accesskey="s">
    </form>
  </div>
  <div id="flash-message"></div>
</nav>
<nav id="trick"><div><dl>
<dt><a href='https://www.php.net/manual/en/getting-started.php'>Getting Started</a></dt>
	<dd><a href='https://www.php.net/manual/en/introduction.php'>Introduction</a></dd>
	<dd><a href='https://www.php.net/manual/en/tutorial.php'>A simple tutorial</a></dd>
<dt><a href='https://www.php.net/manual/en/langref.php'>Language Reference</a></dt>
	<dd><a href='https://www.php.net/manual/en/language.basic-syntax.php'>Basic syntax</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.types.php'>Types</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.variables.php'>Variables</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.constants.php'>Constants</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.expressions.php'>Expressions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.operators.php'>Operators</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.control-structures.php'>Control Structures</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.functions.php'>Functions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.oop5.php'>Classes and Objects</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.namespaces.php'>Namespaces</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.enumerations.php'>Enumerations</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.errors.php'>Errors</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.exceptions.php'>Exceptions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.fibers.php'>Fibers</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.generators.php'>Generators</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.attributes.php'>Attributes</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.references.php'>References Explained</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.variables.php'>Predefined Variables</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.exceptions.php'>Predefined Exceptions</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.interfaces.php'>Predefined Interfaces and Classes</a></dd>
	<dd><a href='https://www.php.net/manual/en/context.php'>Context options and parameters</a></dd>
	<dd><a href='https://www.php.net/manual/en/wrappers.php'>Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href='https://www.php.net/manual/en/security.php'>Security</a></dt>
	<dd><a href='https://www.php.net/manual/en/security.intro.php'>Introduction</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.general.php'>General considerations</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.cgi-bin.php'>Installed as CGI binary</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.apache.php'>Installed as an Apache module</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.sessions.php'>Session Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.filesystem.php'>Filesystem Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.database.php'>Database Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.errors.php'>Error Reporting</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.variables.php'>User Submitted Data</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.hiding.php'>Hiding PHP</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.current.php'>Keeping Current</a></dd>
<dt><a href='https://www.php.net/manual/en/features.php'>Features</a></dt>
	<dd><a href='https://www.php.net/manual/en/features.http-auth.php'>HTTP authentication with PHP</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.cookies.php'>Cookies</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.sessions.php'>Sessions</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.xforms.php'>Dealing with XForms</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.file-upload.php'>Handling file uploads</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.remote-files.php'>Using remote files</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.connection-handling.php'>Connection handling</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.persistent-connections.php'>Persistent Database Connections</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.commandline.php'>Command line usage</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.gc.php'>Garbage Collection</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.dtrace.php'>DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href='https://www.php.net/manual/en/funcref.php'>Function Reference</a></dt>
	<dd><a href='https://www.php.net/manual/en/refs.basic.php.php'>Affecting PHP's Behaviour</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.audio.php'>Audio Formats Manipulation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.auth.php'>Authentication Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.cmdline.php'>Command Line Specific Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.compression.php'>Compression and Archive Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.crypto.php'>Cryptography Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.database.php'>Database Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.calendar.php'>Date and Time Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.fileprocess.file.php'>File System Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.international.php'>Human Language and Character Encoding Support</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.image.php'>Image Processing and Generation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.mail.php'>Mail Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.math.php'>Mathematical Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.nontext.php'>Non-Text MIME Output</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.fileprocess.process.php'>Process Control Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.other.php'>Other Basic Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.other.php'>Other Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.search.php'>Search Engine Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.server.php'>Server Specific Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.session.php'>Session Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.text.php'>Text Processing</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.vartype.php'>Variable and Type Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.webservice.php'>Web Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.windows.php'>Windows Only Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.xml.php'>XML Manipulation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.ui.php'>GUI Extensions</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="clearfix">
    <div id="breadcrumbs-inner">
          <div class="next">
        <a href="https://www.php.net/manual/ru/functions.arrow.php">
          Стрелочные функции &raquo;
        </a>
      </div>
              <div class="prev">
        <a href="https://www.php.net/manual/ru/functions.internal.php">
          &laquo; Встроенные функции        </a>
      </div>
          <ul>
            <li><a href='https://www.php.net/manual/ru/index.php'>Руководство по PHP</a></li>      <li><a href='https://www.php.net/manual/ru/langref.php'>Справочник языка</a></li>      <li><a href='https://www.php.net/manual/ru/language.functions.php'>Функции</a></li>      </ul>
    </div>
  </div>




<div id="layout" class="clearfix">
  <section id="layout-content">
  <div class="page-tools">
    <div class="change-language">
      <form action="https://www.php.net/manual/change.php" method="get" id="changelang" name="changelang">
        <fieldset>
          <label for="changelang-langs">Change language:</label>
          <select onchange="document.changelang.submit()" name="page" id="changelang-langs">
            <option value='en/functions.anonymous.php'>English</option>
            <option value='pt_BR/functions.anonymous.php'>Brazilian Portuguese</option>
            <option value='zh/functions.anonymous.php'>Chinese (Simplified)</option>
            <option value='fr/functions.anonymous.php'>French</option>
            <option value='de/functions.anonymous.php'>German</option>
            <option value='ja/functions.anonymous.php'>Japanese</option>
            <option value='ru/functions.anonymous.php' selected="selected">Russian</option>
            <option value='es/functions.anonymous.php'>Spanish</option>
            <option value='tr/functions.anonymous.php'>Turkish</option>
            <option value="help-translate.php">Other</option>
          </select>
        </fieldset>
      </form>
    </div>
    <div class="edit-bug">
      <a href="https://github.com/php/doc-ru/blob/master/language/functions.xml">Submit a Pull Request</a>
      <a href="https://github.com/php/doc-ru/issues/new?body=From%20manual%20page:%20https:%2F%2Fphp.net%2Ffunctions.anonymous%0A%0A---">Report a Bug</a>
    </div>
  </div><div id="functions.anonymous" class="sect1">
  <h2 class="title">Анонимные функции</h2>

  <p class="simpara">
   Анонимные функции, также известные как замыкания (<code class="literal">closures</code>),
   позволяют создавать функции, не имеющие определённых имён.
   Они наиболее полезны в качестве значений
   <span class="type"><a href="https://www.php.net/manual/ru/language.types.callable.php" class="type callable">callable</a></span>-параметров,
   но также могут иметь и множество других применений.
  </p>
  <p class="simpara">
   Анонимные функции реализуются с использованием класса <a href="https://www.php.net/manual/ru/class.closure.php" class="link">
   <span class="classname"><a href="https://www.php.net/manual/ru/class.closure.php" class="classname">Closure</a></span></a>.
  </p>
  <div class="example" id="example-179">
   <p><strong>Пример #1 Пример анонимной функции</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">preg_replace_callback</span><span style="color: #007700">(</span><span style="color: #DD0000">'~-([a-z])~'</span><span style="color: #007700">,&nbsp;function&nbsp;(</span><span style="color: #0000BB">$match</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">strtoupper</span><span style="color: #007700">(</span><span style="color: #0000BB">$match</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">]);<br />},&nbsp;</span><span style="color: #DD0000">'hello-world'</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">//&nbsp;выведет&nbsp;helloWorld<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>

  <p class="simpara">
   Замыкания также могут быть использованы в качестве значений
   переменных; PHP автоматически преобразует такие выражения
   в экземпляры внутреннего класса <span class="classname"><a href="https://www.php.net/manual/ru/class.closure.php" class="classname">Closure</a></span>.
   Присвоение замыкания переменной использует тот же синтаксис,
   что и для любого другого присвоения, включая завершающую
   точку с запятой:
  </p>

  <div class="example" id="example-180">
   <p><strong>Пример #2 Пример присвоения анонимной функции переменной</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$greet&nbsp;</span><span style="color: #007700">=&nbsp;function(</span><span style="color: #0000BB">$name</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"Привет,&nbsp;%s\r\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">);<br />};<br /><br /></span><span style="color: #0000BB">$greet</span><span style="color: #007700">(</span><span style="color: #DD0000">'Мир'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$greet</span><span style="color: #007700">(</span><span style="color: #DD0000">'PHP'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>

  <p class="simpara">
   Замыкания могут также наследовать переменные из родительской
   области видимости. Любая подобная переменная должна быть
   объявлена в конструкции <code class="literal">use</code>. Начиная с
   PHP 7.1, эти переменные не должны включать <a href="https://www.php.net/manual/ru/language.variables.predefined.php" class="link">superglobals</a>,
   <var class="varname">$this</var> и переменные с теми же именами, что и
   параметры функции.
   Объявление типа возвращаемого значения функции должно быть помещено
    <em class="emphasis">после</em> конструкции <code class="literal">use</code>.
  </p>

  <div class="example" id="example-181">
   <p><strong>Пример #3 Наследование переменных из родительской области видимости</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$message&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'привет'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;Без&nbsp;"use"<br /></span><span style="color: #0000BB">$example&nbsp;</span><span style="color: #007700">=&nbsp;function&nbsp;()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$message</span><span style="color: #007700">);<br />};<br /></span><span style="color: #0000BB">$example</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;Наследуем&nbsp;$message<br /></span><span style="color: #0000BB">$example&nbsp;</span><span style="color: #007700">=&nbsp;function&nbsp;()&nbsp;use&nbsp;(</span><span style="color: #0000BB">$message</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$message</span><span style="color: #007700">);<br />};<br /></span><span style="color: #0000BB">$example</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;Значение&nbsp;унаследованной&nbsp;переменной&nbsp;задано&nbsp;там,&nbsp;где&nbsp;функция&nbsp;определена,<br />//&nbsp;но&nbsp;не&nbsp;там,&nbsp;где&nbsp;вызвана<br /></span><span style="color: #0000BB">$message&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'мир'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$example</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;Сбросим&nbsp;message<br /></span><span style="color: #0000BB">$message&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'привет'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;Наследование&nbsp;по&nbsp;ссылке<br /></span><span style="color: #0000BB">$example&nbsp;</span><span style="color: #007700">=&nbsp;function&nbsp;()&nbsp;use&nbsp;(&amp;</span><span style="color: #0000BB">$message</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$message</span><span style="color: #007700">);<br />};<br /></span><span style="color: #0000BB">$example</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;Изменённое&nbsp;в&nbsp;родительской&nbsp;области&nbsp;видимости&nbsp;значение<br />//&nbsp;остаётся&nbsp;тем&nbsp;же&nbsp;внутри&nbsp;вызова&nbsp;функции<br /></span><span style="color: #0000BB">$message&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'мир'</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #0000BB">$example</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;Замыкания&nbsp;могут&nbsp;принимать&nbsp;обычные&nbsp;аргументы<br /></span><span style="color: #0000BB">$example&nbsp;</span><span style="color: #007700">=&nbsp;function&nbsp;(</span><span style="color: #0000BB">$arg</span><span style="color: #007700">)&nbsp;use&nbsp;(</span><span style="color: #0000BB">$message</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$arg&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">',&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$message</span><span style="color: #007700">);<br />};<br /></span><span style="color: #0000BB">$example</span><span style="color: #007700">(</span><span style="color: #DD0000">"привет"</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;Объявление&nbsp;типа&nbsp;возвращаемого&nbsp;значения&nbsp;идет&nbsp;после&nbsp;конструкции&nbsp;use<br /></span><span style="color: #0000BB">$example&nbsp;</span><span style="color: #007700">=&nbsp;function&nbsp;()&nbsp;use&nbsp;(</span><span style="color: #0000BB">$message</span><span style="color: #007700">):&nbsp;</span><span style="color: #0000BB">string&nbsp;</span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #DD0000">"привет&nbsp;</span><span style="color: #0000BB">$message</span><span style="color: #DD0000">"</span><span style="color: #007700">;<br />};<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$example</span><span style="color: #007700">());<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>Результатом выполнения данного примера
будет что-то подобное:</p></div>
   <div class="example-contents screen">
<div class="cdata"><pre>
Notice: Undefined variable: message in /example.php on line 6
NULL
string(5) &quot;привет&quot;
string(5) &quot;привет&quot;
string(5) &quot;привет&quot;
string(5) &quot;мир&quot;
string(11) &quot;привет мир&quot;
string(11) &quot;привет мир&quot;
</pre></div>
   </div>
  </div>
  <p class="para">
   Начиная с PHP 8.0.0, список наследуемых переменных может завершаться запятой,
   которая будет проигнорирована.
  </p>
  <p class="simpara">
   Наследование переменных из
   родительской области видимости <em class="emphasis">не</em> то же
   самое, что использование глобальных переменных.
   Глобальные переменные существуют в глобальной области видимости,
   которая не меняется, вне зависимости от того, какая функция
   выполняется в данный момент. Родительская область видимости
   - это функция, в которой было объявлено замыкание (не обязательно
   та же самая, из которой оно было вызвано). Смотрите следующий
   пример:
  </p>

  <div class="example" id="example-182">
   <p><strong>Пример #4 Замыкания и область видимости</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;Базовая&nbsp;корзина&nbsp;покупок,&nbsp;содержащая&nbsp;список&nbsp;добавленных<br />//&nbsp;продуктов&nbsp;и&nbsp;количество&nbsp;каждого&nbsp;продукта.&nbsp;Включает&nbsp;метод,<br />//&nbsp;вычисляющий&nbsp;общую&nbsp;цену&nbsp;элементов&nbsp;корзины&nbsp;с&nbsp;помощью<br />//&nbsp;callback-замыкания.<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Cart<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;</span><span style="color: #0000BB">PRICE_BUTTER&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">1.00</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;</span><span style="color: #0000BB">PRICE_MILK&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">3.00</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;</span><span style="color: #0000BB">PRICE_EGGS&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">6.95</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;</span><span style="color: #0000BB">$products&nbsp;</span><span style="color: #007700">=&nbsp;array();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">add</span><span style="color: #007700">(</span><span style="color: #0000BB">$product</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$quantity</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">products</span><span style="color: #007700">[</span><span style="color: #0000BB">$product</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$quantity</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getQuantity</span><span style="color: #007700">(</span><span style="color: #0000BB">$product</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;isset(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">products</span><span style="color: #007700">[</span><span style="color: #0000BB">$product</span><span style="color: #007700">])&nbsp;?&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">products</span><span style="color: #007700">[</span><span style="color: #0000BB">$product</span><span style="color: #007700">]&nbsp;:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">FALSE</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getTotal</span><span style="color: #007700">(</span><span style="color: #0000BB">$tax</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$total&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0.00</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$callback&nbsp;</span><span style="color: #007700">=<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;(</span><span style="color: #0000BB">$quantity</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$product</span><span style="color: #007700">)&nbsp;use&nbsp;(</span><span style="color: #0000BB">$tax</span><span style="color: #007700">,&nbsp;&amp;</span><span style="color: #0000BB">$total</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$pricePerItem&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">constant</span><span style="color: #007700">(</span><span style="color: #0000BB">__CLASS__&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"::PRICE_"&nbsp;</span><span style="color: #007700">.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">strtoupper</span><span style="color: #007700">(</span><span style="color: #0000BB">$product</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$total&nbsp;</span><span style="color: #007700">+=&nbsp;(</span><span style="color: #0000BB">$pricePerItem&nbsp;</span><span style="color: #007700">*&nbsp;</span><span style="color: #0000BB">$quantity</span><span style="color: #007700">)&nbsp;*&nbsp;(</span><span style="color: #0000BB">$tax&nbsp;</span><span style="color: #007700">+&nbsp;</span><span style="color: #0000BB">1.0</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">array_walk</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">products</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$callback</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">round</span><span style="color: #007700">(</span><span style="color: #0000BB">$total</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br /></span><span style="color: #0000BB">$my_cart&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Cart</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;Добавляем&nbsp;несколько&nbsp;элементов&nbsp;в&nbsp;корзину<br /></span><span style="color: #0000BB">$my_cart</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">add</span><span style="color: #007700">(</span><span style="color: #DD0000">'butter'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$my_cart</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">add</span><span style="color: #007700">(</span><span style="color: #DD0000">'milk'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">3</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$my_cart</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">add</span><span style="color: #007700">(</span><span style="color: #DD0000">'eggs'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">6</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;Выводим&nbsp;общую&nbsp;сумму&nbsp;с&nbsp;5%&nbsp;налогом&nbsp;на&nbsp;продажу.<br /></span><span style="color: #007700">print&nbsp;</span><span style="color: #0000BB">$my_cart</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getTotal</span><span style="color: #007700">(</span><span style="color: #0000BB">0.05</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /></span><span style="color: #FF8000">//&nbsp;Результатом&nbsp;будет&nbsp;54.29<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>

  <div class="example" id="example-183">
   <p><strong>Пример #5 Автоматическое связывание <code class="literal">$this</code></strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Test<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">testing</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;function()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br /></span><span style="color: #0000BB">$object&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Test</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$function&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$object</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">testing</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$function</span><span style="color: #007700">();<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>Результат выполнения данного примера:</p></div>
   <div class="example-contents screen">
<div class="cdata"><pre>
object(Test)#1 (0) {
}
</pre></div>
   </div>
  </div>
  <p class="para">
   При объявлении в контексте класса, текущий
   класс будет автоматически связан с ним, делая <code class="literal">$this</code>
   доступным внутри функций класса. Если вы не хотите автоматического
   связывания с текущим классом, используйте <a href="functions.anonymous.php.html#functions.anonymous-functions.static" class="link">статические анонимные функции</a>.
  </p>

  <div class="sect2" id="functions.anonymous-functions.static">
   <h3 class="title">Статические анонимные функции</h3>
   <p class="para">
    Анонимные функции могут быть объявлены статически.
    Это предотвратит их автоматическое связывание с текущим классом.
    Объекты также не будут с ними связаны во время выполнения.
   </p>
   <p class="para">
    <div class="example" id="example-184">
     <p><strong>Пример #6 Попытка использовать <code class="literal">$this</code> в статической анонимной функции</strong></p>
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Foo<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$func&nbsp;</span><span style="color: #007700">=&nbsp;static&nbsp;function()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$func</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />};<br />new&nbsp;</span><span style="color: #0000BB">Foo</span><span style="color: #007700">();<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

     <div class="example-contents"><p>Результат выполнения данного примера:</p></div>
     <div class="example-contents screen">
<div class="cdata"><pre>
Notice: Undefined variable: this in %s on line %d
NULL
</pre></div>
     </div>
    </div>
   </p>

   <p class="para">
    <div class="example" id="example-185">
     <p><strong>Пример #7 Попытка связать объект со статической анонимной функцией</strong></p>
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$func&nbsp;</span><span style="color: #007700">=&nbsp;static&nbsp;function()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;тело&nbsp;функции<br /></span><span style="color: #007700">};<br /></span><span style="color: #0000BB">$func&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$func</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bindTo</span><span style="color: #007700">(new&nbsp;</span><span style="color: #0000BB">StdClass</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$func</span><span style="color: #007700">();<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

     <div class="example-contents"><p>Результат выполнения данного примера:</p></div>
     <div class="example-contents screen">
<div class="cdata"><pre>
Warning: Cannot bind an instance to a static closure in %s on line %d
</pre></div>
     </div>
    </div>
   </p>
  </div>
  <div class="sect2">
   <h3 class="title">Список изменений</h3>
   <p class="para">
    <table class="doctable informaltable">
     
      <thead>
       <tr>
        <th>Версия</th>
        <th>Описание</th>
       </tr>

      </thead>

      <tbody class="tbody">
       <tr>
        <td>7.1.0</td>
        <td>
         Анонимные функции не могут замыкаться вокруг <a href="https://www.php.net/manual/ru/language.variables.predefined.php" class="link">superglobals</a>,
         <var class="varname">$this</var> или любой переменной с тем же именем, что
         и параметр.
        </td>
       </tr>

      </tbody>
     
    </table>

   </p>
  </div>

  <div class="sect2">
   <h3 class="title">Примечания</h3>
   <blockquote class="note"><p><strong class="note">Замечание</strong>: 
    <span class="simpara">
     Совместно с замыканиями можно использовать функции
     <span class="function"><a href="https://www.php.net/manual/ru/function.func-num-args.php" class="function">func_num_args()</a></span>,
     <span class="function"><a href="https://www.php.net/manual/ru/function.func-get-arg.php" class="function">func_get_arg()</a></span> и <span class="function"><a href="https://www.php.net/manual/ru/function.func-get-args.php" class="function">func_get_args()</a></span>.
    </span>
   </p></blockquote>
  </div>

 </div>
<section id="usernotes">
 <div class="head">
  <span class="action"><a href="https://www.php.net/manual/add-note.php?sect=functions.anonymous&amp;redirect=https://www.php.net/manual/ru/functions.anonymous.php"><img src='https://www.php.net/images/notes-add@2x.png' alt='add a note' width='12' height='12'> <small>add a note</small></a></span>
  <h3 class="title">User Contributed Notes <span class="count">17 notes</span></h3>
 </div><div id="allnotes">
  <div class="note" id="99287">  <div class="votes">
    <div id="Vu99287">
    <a href="https://www.php.net/manual/vote-note.php?id=99287&amp;page=functions.anonymous&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd99287">
    <a href="https://www.php.net/manual/vote-note.php?id=99287&amp;page=functions.anonymous&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V99287" title="82% like this...">
    293
    </div>
  </div>
  <a href="functions.anonymous.php.html#99287" class="name">
  <strong class="user"><em>orls</em></strong></a><a class="genanchor" href="functions.anonymous.php.html#99287"> &para;</a><div class="date" title="2010-08-08 06:53"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom99287">
<div class="phpcode"><code><span class="html">
Watch out when 'importing' variables to a closure's scope&nbsp; -- it's easy to miss / forget that they are actually being *copied* into the closure's scope, rather than just being made available.<br /><br />So you will need to explicitly pass them in by reference if your closure cares about their contents over time:<br /><br /><span class="default">&lt;?php<br />$result </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br /><br /></span><span class="default">$one </span><span class="keyword">= function()<br />{ </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">); };<br /><br /></span><span class="default">$two </span><span class="keyword">= function() use (</span><span class="default">$result</span><span class="keyword">)<br />{ </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">); };<br /><br /></span><span class="default">$three </span><span class="keyword">= function() use (&amp;</span><span class="default">$result</span><span class="keyword">)<br />{ </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">); };<br /><br /></span><span class="default">$result</span><span class="keyword">++;<br /><br /></span><span class="default">$one</span><span class="keyword">();&nbsp; &nbsp; </span><span class="comment">// outputs NULL: $result is not in scope<br /></span><span class="default">$two</span><span class="keyword">();&nbsp; &nbsp; </span><span class="comment">// outputs int(0): $result was copied<br /></span><span class="default">$three</span><span class="keyword">();&nbsp; &nbsp; </span><span class="comment">// outputs int(1)<br /></span><span class="default">?&gt;<br /></span><br />Another less trivial example with objects (what I actually tripped up on):<br /><br /><span class="default">&lt;?php<br /></span><span class="comment">//set up variable in advance<br /></span><span class="default">$myInstance </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br /><br /></span><span class="default">$broken </span><span class="keyword">= function() </span><span class="default">uses </span><span class="keyword">(</span><span class="default">$myInstance</span><span class="keyword">)<br />{<br />&nbsp; &nbsp; if(!empty(</span><span class="default">$myInstance</span><span class="keyword">)) </span><span class="default">$myInstance</span><span class="keyword">-&gt;</span><span class="default">doSomething</span><span class="keyword">();<br />};<br /><br /></span><span class="default">$working </span><span class="keyword">= function() </span><span class="default">uses </span><span class="keyword">(&amp;</span><span class="default">$myInstance</span><span class="keyword">)<br />{<br />&nbsp; &nbsp; if(!empty(</span><span class="default">$myInstance</span><span class="keyword">)) </span><span class="default">$myInstance</span><span class="keyword">-&gt;</span><span class="default">doSomething</span><span class="keyword">();<br />}<br /><br /></span><span class="comment">//$myInstance might be instantiated, might not be<br /></span><span class="keyword">if(</span><span class="default">SomeBusinessLogic</span><span class="keyword">::</span><span class="default">worked</span><span class="keyword">() == </span><span class="default">true</span><span class="keyword">)<br />{<br />&nbsp; &nbsp; </span><span class="default">$myInstance </span><span class="keyword">= new </span><span class="default">myClass</span><span class="keyword">();<br />}<br /><br /></span><span class="default">$broken</span><span class="keyword">();&nbsp; &nbsp; </span><span class="comment">// will never do anything: $myInstance will ALWAYS be null inside this closure.<br /></span><span class="default">$working</span><span class="keyword">();&nbsp; &nbsp; </span><span class="comment">// will call doSomething if $myInstance is instantiated<br /><br /></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="122809">  <div class="votes">
    <div id="Vu122809">
    <a href="https://www.php.net/manual/vote-note.php?id=122809&amp;page=functions.anonymous&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd122809">
    <a href="https://www.php.net/manual/vote-note.php?id=122809&amp;page=functions.anonymous&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V122809" title="84% like this...">
    13
    </div>
  </div>
  <a href="functions.anonymous.php.html#122809" class="name">
  <strong class="user"><em>dexen dot devries at gmail dot com</em></strong></a><a class="genanchor" href="functions.anonymous.php.html#122809"> &para;</a><div class="date" title="2018-06-07 09:54"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom122809">
<div class="phpcode"><code><span class="html">
Every instance of a lambda has own instance of static variables. This provides for great event handlers, accumulators, etc., etc.<br /><br />Creating new lambda with function() { ... }; expression creates new instance of its static variables. Assigning a lambda to a variable does not create a new instance. A lambda is object of class Closure, and assigning lambdas to variables has the same semantics as assigning object instance to variables.<br /><br />Example script: $a and $b have separate instances of static variables, thus produce different output. However $b and $c share their instance of static variables - because $c is refers to the same object of class Closure as $b - thus produce the same output.<br /><br />#!/usr/bin/env php<br /><span class="default">&lt;?php<br /><br /></span><span class="keyword">function </span><span class="default">generate_lambda</span><span class="keyword">() : </span><span class="default">Closure<br /></span><span class="keyword">{<br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment"># creates new instance of lambda<br />&nbsp; &nbsp; </span><span class="keyword">return function(</span><span class="default">$v </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">) {<br />&nbsp; &nbsp; &nbsp; &nbsp; static </span><span class="default">$stored</span><span class="keyword">;<br />&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$v </span><span class="keyword">!== </span><span class="default">null</span><span class="keyword">)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$stored </span><span class="keyword">= </span><span class="default">$v</span><span class="keyword">;<br />&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$stored</span><span class="keyword">;<br />&nbsp; &nbsp; };<br />}<br /><br /></span><span class="default">$a </span><span class="keyword">= </span><span class="default">generate_lambda</span><span class="keyword">();&nbsp; </span><span class="comment"># creates new instance of statics<br /></span><span class="default">$b </span><span class="keyword">= </span><span class="default">generate_lambda</span><span class="keyword">();&nbsp; </span><span class="comment"># creates new instance of statics<br /></span><span class="default">$c </span><span class="keyword">= </span><span class="default">$b</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># uses the same instance of statics as $b<br /><br /></span><span class="default">$a</span><span class="keyword">(</span><span class="string">'test AAA'</span><span class="keyword">);<br /></span><span class="default">$b</span><span class="keyword">(</span><span class="string">'test BBB'</span><span class="keyword">);<br /></span><span class="default">$c</span><span class="keyword">(</span><span class="string">'test CCC'</span><span class="keyword">);&nbsp; </span><span class="comment"># this overwrites content held by $b, because it refers to the same object<br /><br /></span><span class="default">var_dump</span><span class="keyword">([ </span><span class="default">$a</span><span class="keyword">(), </span><span class="default">$b</span><span class="keyword">(), </span><span class="default">$c</span><span class="keyword">() ]);<br /></span><span class="default">?&gt;<br /></span><br />This test script outputs:<br />array(3) {<br />&nbsp; [0]=&gt;<br />&nbsp; string(8) "test AAA"<br />&nbsp; [1]=&gt;<br />&nbsp; string(8) "test CCC"<br />&nbsp; [2]=&gt;<br />&nbsp; string(8) "test CCC"<br />}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="113896">  <div class="votes">
    <div id="Vu113896">
    <a href="https://www.php.net/manual/vote-note.php?id=113896&amp;page=functions.anonymous&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd113896">
    <a href="https://www.php.net/manual/vote-note.php?id=113896&amp;page=functions.anonymous&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V113896" title="79% like this...">
    29
    </div>
  </div>
  <a href="functions.anonymous.php.html#113896" class="name">
  <strong class="user"><em>cHao</em></strong></a><a class="genanchor" href="functions.anonymous.php.html#113896"> &para;</a><div class="date" title="2013-12-13 11:42"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom113896">
<div class="phpcode"><code><span class="html">
In case you were wondering (cause i was), anonymous functions can return references just like named functions can.&nbsp; Simply use the &amp; the same way you would for a named function...right after the `function` keyword (and right before the nonexistent name).<br /><br /><span class="default">&lt;?php<br />&nbsp; &nbsp; $value </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />&nbsp; &nbsp; </span><span class="default">$fn </span><span class="keyword">= function &amp;() use (&amp;</span><span class="default">$value</span><span class="keyword">) { return </span><span class="default">$value</span><span class="keyword">; };<br /><br />&nbsp; &nbsp; </span><span class="default">$x </span><span class="keyword">=&amp; </span><span class="default">$fn</span><span class="keyword">();<br />&nbsp; &nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// 'int(0)', 'int(0)'<br />&nbsp; &nbsp; </span><span class="keyword">++</span><span class="default">$x</span><span class="keyword">;<br />&nbsp; &nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// 'int(1)', 'int(1)'</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="117504">  <div class="votes">
    <div id="Vu117504">
    <a href="https://www.php.net/manual/vote-note.php?id=117504&amp;page=functions.anonymous&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd117504">
    <a href="https://www.php.net/manual/vote-note.php?id=117504&amp;page=functions.anonymous&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V117504" title="78% like this...">
    26
    </div>
  </div>
  <a href="functions.anonymous.php.html#117504" class="name">
  <strong class="user"><em>erolmon dot kskn at gmail dot com</em></strong></a><a class="genanchor" href="functions.anonymous.php.html#117504"> &para;</a><div class="date" title="2015-06-19 09:48"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom117504">
<div class="phpcode"><code><span class="html">
<span class="default">&lt;?php<br />&nbsp; &nbsp; </span><span class="comment">/*<br />&nbsp; &nbsp; (string) $name Name of the function that you will add to class.<br />&nbsp; &nbsp; Usage : $Foo-&gt;add(function(){},$name);<br />&nbsp; &nbsp; This will add a public function in Foo Class.<br />&nbsp; &nbsp; */<br />&nbsp; &nbsp; </span><span class="keyword">class </span><span class="default">Foo<br />&nbsp; &nbsp; </span><span class="keyword">{<br />&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">add</span><span class="keyword">(</span><span class="default">$func</span><span class="keyword">,</span><span class="default">$name</span><span class="keyword">)<br />&nbsp; &nbsp; &nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;{</span><span class="default">$name</span><span class="keyword">} = </span><span class="default">$func</span><span class="keyword">;<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">__call</span><span class="keyword">(</span><span class="default">$func</span><span class="keyword">,</span><span class="default">$arguments</span><span class="keyword">){<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">call_user_func_array</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;{</span><span class="default">$func</span><span class="keyword">}, </span><span class="default">$arguments</span><span class="keyword">); <br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; </span><span class="default">$Foo </span><span class="keyword">= new </span><span class="default">Foo</span><span class="keyword">();<br />&nbsp; &nbsp; </span><span class="default">$Foo</span><span class="keyword">-&gt;</span><span class="default">add</span><span class="keyword">(function(){<br />&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"Hello World"</span><span class="keyword">;<br />&nbsp; &nbsp; },</span><span class="string">"helloWorldFunction"</span><span class="keyword">);<br />&nbsp; &nbsp; </span><span class="default">$Foo</span><span class="keyword">-&gt;</span><span class="default">add</span><span class="keyword">(function(</span><span class="default">$parameterone</span><span class="keyword">){<br />&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="default">$parameterone</span><span class="keyword">;<br />&nbsp; &nbsp; },</span><span class="string">"exampleFunction"</span><span class="keyword">);<br />&nbsp; &nbsp; </span><span class="default">$Foo</span><span class="keyword">-&gt;</span><span class="default">helloWorldFunction</span><span class="keyword">(); </span><span class="comment">/*Output : Hello World*/<br />&nbsp; &nbsp; </span><span class="default">$Foo</span><span class="keyword">-&gt;</span><span class="default">exampleFunction</span><span class="keyword">(</span><span class="string">"Hello PHP"</span><span class="keyword">); </span><span class="comment">/*Output : Hello PHP*/<br /></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="122182">  <div class="votes">
    <div id="Vu122182">
    <a href="https://www.php.net/manual/vote-note.php?id=122182&amp;page=functions.anonymous&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd122182">
    <a href="https://www.php.net/manual/vote-note.php?id=122182&amp;page=functions.anonymous&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V122182" title="70% like this...">
    11
    </div>
  </div>
  <a href="functions.anonymous.php.html#122182" class="name">
  <strong class="user"><em>toonitw at gmail dot com</em></strong></a><a class="genanchor" href="functions.anonymous.php.html#122182"> &para;</a><div class="date" title="2017-12-27 05:40"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom122182">
<div class="phpcode"><code><span class="html">
As of PHP 7.0, you can use IIFE(Immediately-invoked function expression) by wrapping your anonymous function with ().<br /><br /><span class="default">&lt;?php<br />$type </span><span class="keyword">= </span><span class="string">'number'</span><span class="keyword">;<br /></span><span class="default">var_dump</span><span class="keyword">( ...( function() use (</span><span class="default">$type</span><span class="keyword">) { <br />&nbsp; &nbsp; if (</span><span class="default">$type</span><span class="keyword">==</span><span class="string">'number'</span><span class="keyword">) return [</span><span class="default">1</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">]; <br />&nbsp; &nbsp; else if (</span><span class="default">$type</span><span class="keyword">==</span><span class="string">'alphabet'</span><span class="keyword">) return [</span><span class="string">'a'</span><span class="keyword">,</span><span class="string">'b'</span><span class="keyword">,</span><span class="string">'c'</span><span class="keyword">];<br />} )() );<br /></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="123498">  <div class="votes">
    <div id="Vu123498">
    <a href="https://www.php.net/manual/vote-note.php?id=123498&amp;page=functions.anonymous&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd123498">
    <a href="https://www.php.net/manual/vote-note.php?id=123498&amp;page=functions.anonymous&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V123498" title="70% like this...">
    4
    </div>
  </div>
  <a href="functions.anonymous.php.html#123498" class="name">
  <strong class="user"><em>jake dot tunaley at berkeleyit dot com</em></strong></a><a class="genanchor" href="functions.anonymous.php.html#123498"> &para;</a><div class="date" title="2019-01-07 05:04"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom123498">
<div class="phpcode"><code><span class="html">
Beware of using $this in anonymous functions assigned to a static variable.<br /><br /><span class="default">&lt;?php<br /></span><span class="keyword">class </span><span class="default">Foo </span><span class="keyword">{<br />&nbsp; &nbsp; public function </span><span class="default">bar</span><span class="keyword">() {<br />&nbsp; &nbsp; &nbsp; &nbsp; static </span><span class="default">$anonymous </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$anonymous </span><span class="keyword">=== </span><span class="default">null</span><span class="keyword">) {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Expression is not allowed as static initializer workaround<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$anonymous </span><span class="keyword">= function () {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; };<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$anonymous</span><span class="keyword">();<br />&nbsp; &nbsp; }<br />}<br /><br /></span><span class="default">$a </span><span class="keyword">= new </span><span class="default">Foo</span><span class="keyword">();<br /></span><span class="default">$b </span><span class="keyword">= new </span><span class="default">Foo</span><span class="keyword">();<br /></span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">bar</span><span class="keyword">() === </span><span class="default">$a</span><span class="keyword">); </span><span class="comment">// True<br /></span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$b</span><span class="keyword">-&gt;</span><span class="default">bar</span><span class="keyword">() === </span><span class="default">$a</span><span class="keyword">); </span><span class="comment">// Also true<br /></span><span class="default">?&gt;<br /></span><br />In a static anonymous function, $this will be the value of whatever object instance that method was called on first.<br /><br />To get the behaviour you're probably expecting, you need to pass the $this context into the function.<br /><br /><span class="default">&lt;?php<br /></span><span class="keyword">class </span><span class="default">Foo </span><span class="keyword">{<br />&nbsp; &nbsp; public function </span><span class="default">bar</span><span class="keyword">() {<br />&nbsp; &nbsp; &nbsp; &nbsp; static </span><span class="default">$anonymous </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$anonymous </span><span class="keyword">=== </span><span class="default">null</span><span class="keyword">) {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Expression is not allowed as static initializer workaround<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$anonymous </span><span class="keyword">= function (</span><span class="default">self $thisObj</span><span class="keyword">) {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$thisObj</span><span class="keyword">;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; };<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$anonymous</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">);<br />&nbsp; &nbsp; }<br />}<br /><br /></span><span class="default">$a </span><span class="keyword">= new </span><span class="default">Foo</span><span class="keyword">();<br /></span><span class="default">$b </span><span class="keyword">= new </span><span class="default">Foo</span><span class="keyword">();<br /></span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">bar</span><span class="keyword">() === </span><span class="default">$a</span><span class="keyword">); </span><span class="comment">// True<br /></span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$b</span><span class="keyword">-&gt;</span><span class="default">bar</span><span class="keyword">() === </span><span class="default">$a</span><span class="keyword">); </span><span class="comment">// False<br /></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="94804">  <div class="votes">
    <div id="Vu94804">
    <a href="https://www.php.net/manual/vote-note.php?id=94804&amp;page=functions.anonymous&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd94804">
    <a href="https://www.php.net/manual/vote-note.php?id=94804&amp;page=functions.anonymous&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V94804" title="71% like this...">
    6
    </div>
  </div>
  <a href="functions.anonymous.php.html#94804" class="name">
  <strong class="user"><em>rob at ubrio dot us</em></strong></a><a class="genanchor" href="functions.anonymous.php.html#94804"> &para;</a><div class="date" title="2009-11-25 10:20"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom94804">
<div class="phpcode"><code><span class="html">
You can always call protected members using the __call() method - similar to how you hack around this in Ruby using send.<br /><br /><span class="default">&lt;?php<br /><br /></span><span class="keyword">class </span><span class="default">Fun<br /></span><span class="keyword">{<br /> protected function </span><span class="default">debug</span><span class="keyword">(</span><span class="default">$message</span><span class="keyword">)<br /> {<br />&nbsp;&nbsp; echo </span><span class="string">"DEBUG: </span><span class="default">$message</span><span class="string">\n"</span><span class="keyword">;<br /> }<br /><br /> public function </span><span class="default">yield_something</span><span class="keyword">(</span><span class="default">$callback</span><span class="keyword">)<br /> {<br />&nbsp;&nbsp; return </span><span class="default">$callback</span><span class="keyword">(</span><span class="string">"Soemthing!!"</span><span class="keyword">);<br /> }<br /><br /> public function </span><span class="default">having_fun</span><span class="keyword">()<br /> {<br />&nbsp;&nbsp; </span><span class="default">$self </span><span class="keyword">=&amp; </span><span class="default">$this</span><span class="keyword">;<br />&nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">yield_something</span><span class="keyword">(function(</span><span class="default">$data</span><span class="keyword">) use (&amp;</span><span class="default">$self</span><span class="keyword">)<br />&nbsp;&nbsp; {<br />&nbsp; &nbsp;&nbsp; </span><span class="default">$self</span><span class="keyword">-&gt;</span><span class="default">debug</span><span class="keyword">(</span><span class="string">"Doing stuff to the data"</span><span class="keyword">);<br />&nbsp; &nbsp;&nbsp; </span><span class="comment">// do something with $data<br />&nbsp; &nbsp;&nbsp; </span><span class="default">$self</span><span class="keyword">-&gt;</span><span class="default">debug</span><span class="keyword">(</span><span class="string">"Finished doing stuff with the data."</span><span class="keyword">);<br />&nbsp;&nbsp; });<br /> }<br /><br /> </span><span class="comment">// Ah-Ha!<br /> </span><span class="keyword">public function </span><span class="default">__call</span><span class="keyword">(</span><span class="default">$method</span><span class="keyword">, </span><span class="default">$args </span><span class="keyword">= array())<br /> {<br />&nbsp;&nbsp; if(</span><span class="default">is_callable</span><span class="keyword">(array(</span><span class="default">$this</span><span class="keyword">, </span><span class="default">$method</span><span class="keyword">)))<br />&nbsp; &nbsp;&nbsp; return </span><span class="default">call_user_func_array</span><span class="keyword">(array(</span><span class="default">$this</span><span class="keyword">, </span><span class="default">$method</span><span class="keyword">), </span><span class="default">$args</span><span class="keyword">);<br /> }<br />}<br /><br /></span><span class="default">$fun </span><span class="keyword">= new </span><span class="default">Fun</span><span class="keyword">();<br />echo </span><span class="default">$fun</span><span class="keyword">-&gt;</span><span class="default">having_fun</span><span class="keyword">();<br /><br /></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="91610">  <div class="votes">
    <div id="Vu91610">
    <a href="https://www.php.net/manual/vote-note.php?id=91610&amp;page=functions.anonymous&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd91610">
    <a href="https://www.php.net/manual/vote-note.php?id=91610&amp;page=functions.anonymous&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V91610" title="68% like this...">
    11
    </div>
  </div>
  <a href="functions.anonymous.php.html#91610" class="name">
  <strong class="user"><em>a dot schaffhirt at sedna-soft dot de</em></strong></a><a class="genanchor" href="functions.anonymous.php.html#91610"> &para;</a><div class="date" title="2009-06-19 02:55"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom91610">
<div class="phpcode"><code><span class="html">
When using anonymous functions as properties in Classes, note that there are three name scopes: one for constants, one for properties and one for methods. That means, you can use the same name for a constant, for a property and for a method at a time.<br /><br />Since a property can be also an anonymous function as of PHP 5.3.0, an oddity arises when they share the same name, not meaning that there would be any conflict.<br /><br />Consider the following example:<br /><br /><span class="default">&lt;?php<br />&nbsp; &nbsp; </span><span class="keyword">class </span><span class="default">MyClass </span><span class="keyword">{<br />&nbsp; &nbsp; &nbsp; &nbsp; const </span><span class="default">member </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; public </span><span class="default">$member</span><span class="keyword">;<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">member </span><span class="keyword">() {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="string">"method 'member'"</span><span class="keyword">;<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">__construct </span><span class="keyword">() {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">member </span><span class="keyword">= function () {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="string">"anonymous function 'member'"</span><span class="keyword">;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; };<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Type: text/plain"</span><span class="keyword">);<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; </span><span class="default">$myObj </span><span class="keyword">= new </span><span class="default">MyClass</span><span class="keyword">();<br /><br />&nbsp; &nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">MyClass</span><span class="keyword">::</span><span class="default">member</span><span class="keyword">);&nbsp; </span><span class="comment">// int(1)<br />&nbsp; &nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$myObj</span><span class="keyword">-&gt;</span><span class="default">member</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">// object(Closure)#2 (0) {}<br />&nbsp; &nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$myObj</span><span class="keyword">-&gt;</span><span class="default">member</span><span class="keyword">()); </span><span class="comment">// string(15) "method 'member'"<br />&nbsp; &nbsp; </span><span class="default">$myMember </span><span class="keyword">= </span><span class="default">$myObj</span><span class="keyword">-&gt;</span><span class="default">member</span><span class="keyword">;<br />&nbsp; &nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$myMember</span><span class="keyword">());&nbsp; &nbsp; &nbsp; </span><span class="comment">// string(27) "anonymous function 'member'"<br /></span><span class="default">?&gt;<br /></span><br />That means, regular method invocations work like expected and like before. The anonymous function instead, must be retrieved into a variable first (just like a property) and can only then be invoked.<br /><br />Best regards,</span>
</code></div>
  </div>
 </div>
  <div class="note" id="120611">  <div class="votes">
    <div id="Vu120611">
    <a href="https://www.php.net/manual/vote-note.php?id=120611&amp;page=functions.anonymous&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd120611">
    <a href="https://www.php.net/manual/vote-note.php?id=120611&amp;page=functions.anonymous&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V120611" title="65% like this...">
    13
    </div>
  </div>
  <a href="functions.anonymous.php.html#120611" class="name">
  <strong class="user"><em>john at binkmail dot com</em></strong></a><a class="genanchor" href="functions.anonymous.php.html#120611"> &para;</a><div class="date" title="2017-02-07 07:36"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom120611">
<div class="phpcode"><code><span class="html">
PERFORMANCE BENCHMARK 2017!<br /><br />I decided to compare a single, saved closure against constantly creating the same anonymous closure on every loop iteration. And I tried 10 million loop iterations, in PHP 7.0.14 from Dec 2016. Result:<br /><br />a single saved closure kept in a variable and re-used (10000000 iterations): 1.3874590396881 seconds<br /><br />new anonymous closure created each time (10000000 iterations): 2.8460240364075 seconds<br /><br />In other words, over the course of 10 million iterations, creating the closure again during every iteration only added a total of "1.459 seconds" to the runtime. So that means that every creation of a new anonymous closure takes about 146 nanoseconds on my 7 years old dual-core laptop. I guess PHP keeps a cached "template" for the anonymous function and therefore doesn't need much time to create a new instance of the closure!<br /><br />So you do NOT have to worry about constantly re-creating your anonymous closures over and over again in tight loops! At least not as of PHP 7! There is absolutely NO need to save an instance in a variable and re-use it. And not being restricted by that is a great thing, because it means you can feel free to use anonymous functions exactly where they matter, as opposed to defining them somewhere else in the code. :-)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="114079">  <div class="votes">
    <div id="Vu114079">
    <a href="https://www.php.net/manual/vote-note.php?id=114079&amp;page=functions.anonymous&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd114079">
    <a href="https://www.php.net/manual/vote-note.php?id=114079&amp;page=functions.anonymous&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V114079" title="66% like this...">
    6
    </div>
  </div>
  <a href="functions.anonymous.php.html#114079" class="name">
  <strong class="user"><em>derkontrollfreak+9hy5l at gmail dot com</em></strong></a><a class="genanchor" href="functions.anonymous.php.html#114079"> &para;</a><div class="date" title="2014-01-09 04:41"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom114079">
<div class="phpcode"><code><span class="html">
Beware that since PHP 5.4 registering a Closure as an object property that has been instantiated in the same object scope will create a circular reference which prevents immediate object destruction:<br /><span class="default">&lt;?php<br /><br /></span><span class="keyword">class </span><span class="default">Test<br /></span><span class="keyword">{<br />&nbsp; &nbsp; private </span><span class="default">$closure</span><span class="keyword">;<br /><br />&nbsp; &nbsp; public function </span><span class="default">__construct</span><span class="keyword">()<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">closure </span><span class="keyword">= function () {<br />&nbsp; &nbsp; &nbsp; &nbsp; };<br />&nbsp; &nbsp; }<br /><br />&nbsp; &nbsp; public function </span><span class="default">__destruct</span><span class="keyword">()<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"destructed\n"</span><span class="keyword">;<br />&nbsp; &nbsp; }<br />}<br /><br />new </span><span class="default">Test</span><span class="keyword">;<br />echo </span><span class="string">"finished\n"</span><span class="keyword">;<br /><br /></span><span class="comment">/*<br /> * Result in PHP 5.3:<br /> * ------------------<br /> * destructed<br /> * finished<br /> *<br /> * Result since PHP 5.4:<br /> * ---------------------<br /> * finished<br /> * destructed<br /> */<br /><br /></span><span class="default">?&gt;<br /></span><br />To circumvent this, you can instantiate the Closure in a static method:<br /><span class="default">&lt;?php<br /><br /></span><span class="keyword">public function </span><span class="default">__construct</span><span class="keyword">()<br />{<br />&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">closure </span><span class="keyword">= </span><span class="default">self</span><span class="keyword">::</span><span class="default">createClosure</span><span class="keyword">();<br />}<br /><br />public static function </span><span class="default">createClosure</span><span class="keyword">()<br />{<br />&nbsp; &nbsp; return function () {<br />&nbsp; &nbsp; };<br />}<br /><br /></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="105261">  <div class="votes">
    <div id="Vu105261">
    <a href="https://www.php.net/manual/vote-note.php?id=105261&amp;page=functions.anonymous&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd105261">
    <a href="https://www.php.net/manual/vote-note.php?id=105261&amp;page=functions.anonymous&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V105261" title="66% like this...">
    8
    </div>
  </div>
  <a href="functions.anonymous.php.html#105261" class="name">
  <strong class="user"><em>simon at generalflows dot com</em></strong></a><a class="genanchor" href="functions.anonymous.php.html#105261"> &para;</a><div class="date" title="2011-08-05 08:23"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom105261">
<div class="phpcode"><code><span class="html">
<span class="default">&lt;?php<br /><br /></span><span class="comment">/* <br /> * An example showing how to use closures to implement a Python-like decorator <br /> * pattern.<br /> *<br /> * My goal was that you should be able to decorate a function with any<br /> * other function, then call the decorated function directly: <br /> *<br /> * Define function:&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $foo = function($a, $b, $c, ...) {...}<br /> * Define decorator:&nbsp; &nbsp; &nbsp; &nbsp; $decorator = function($func) {...}<br /> * Decorate it:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $foo = $decorator($foo)<br /> * Call it:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $foo($a, $b, $c, ...)<br /> *<br /> * This example show an authentication decorator for a service, using a simple<br /> * mock session and mock service. <br /> */<br /> <br /></span><span class="default">session_start</span><span class="keyword">();<br /><br /></span><span class="comment">/* <br /> * Define an example decorator. A decorator function should take the form:<br /> * $decorator = function($func) {<br /> *&nbsp; &nbsp;&nbsp; return function() use $func) {<br /> *&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // Do something, then call the decorated function when needed:<br /> *&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $args = func_get_args($func);<br /> *&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; call_user_func_array($func, $args);<br /> *&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // Do something else.<br /> *&nbsp; &nbsp;&nbsp; };<br /> * };<br /> */<br /></span><span class="default">$authorise </span><span class="keyword">= function(</span><span class="default">$func</span><span class="keyword">) {<br />&nbsp; &nbsp; return function() use (</span><span class="default">$func</span><span class="keyword">) {<br />&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'is_authorised'</span><span class="keyword">] == </span><span class="default">true</span><span class="keyword">) {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$args </span><span class="keyword">= </span><span class="default">func_get_args</span><span class="keyword">(</span><span class="default">$func</span><span class="keyword">);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">call_user_func_array</span><span class="keyword">(</span><span class="default">$func</span><span class="keyword">, </span><span class="default">$args</span><span class="keyword">);<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; else {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"Access Denied"</span><span class="keyword">;<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; };<br />};<br /><br /></span><span class="comment">/* <br /> * Define a function to be decorated, in this example a mock service that<br /> * need to be authorised. <br /> */ <br /></span><span class="default">$service </span><span class="keyword">= function(</span><span class="default">$foo</span><span class="keyword">) {<br />&nbsp; &nbsp; echo </span><span class="string">"Service returns: </span><span class="default">$foo</span><span class="string">"</span><span class="keyword">;<br />};<br /><br /></span><span class="comment">/* <br /> * Decorate it. Ensure you replace the origin function reference with the<br /> * decorated function; ie just $authorise($service) won't work, so do<br /> * $service = $authorise($service)<br /> */<br /></span><span class="default">$service </span><span class="keyword">= </span><span class="default">$authorise</span><span class="keyword">(</span><span class="default">$service</span><span class="keyword">);<br /><br /></span><span class="comment">/* <br /> * Establish mock authorisation, call the service; should get <br /> * 'Service returns: test 1'. <br /> */<br /></span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'is_authorised'</span><span class="keyword">] = </span><span class="default">true</span><span class="keyword">;<br /></span><span class="default">$service</span><span class="keyword">(</span><span class="string">'test 1'</span><span class="keyword">);<br /><br /></span><span class="comment">/* <br /> * Remove mock authorisation, call the service; should get 'Access Denied'. <br /> */<br /></span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'is_authorised'</span><span class="keyword">] = </span><span class="default">false</span><span class="keyword">;<br /></span><span class="default">$service</span><span class="keyword">(</span><span class="string">'test 2'</span><span class="keyword">);<br /><br /></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="114433">  <div class="votes">
    <div id="Vu114433">
    <a href="https://www.php.net/manual/vote-note.php?id=114433&amp;page=functions.anonymous&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd114433">
    <a href="https://www.php.net/manual/vote-note.php?id=114433&amp;page=functions.anonymous&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V114433" title="64% like this...">
    7
    </div>
  </div>
  <a href="functions.anonymous.php.html#114433" class="name">
  <strong class="user"><em>mail at mkharitonov dot net</em></strong></a><a class="genanchor" href="functions.anonymous.php.html#114433"> &para;</a><div class="date" title="2014-02-20 11:20"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom114433">
<div class="phpcode"><code><span class="html">
Some comparisons of PHP and JavaScript closures.<br /><br />=== Example 1 (passing by value) ===<br />PHP code:<br /><span class="default">&lt;?php<br />$aaa </span><span class="keyword">= </span><span class="default">111</span><span class="keyword">;<br /></span><span class="default">$func </span><span class="keyword">= function() use(</span><span class="default">$aaa</span><span class="keyword">){ print </span><span class="default">$aaa</span><span class="keyword">; };<br /></span><span class="default">$aaa </span><span class="keyword">= </span><span class="default">222</span><span class="keyword">;<br /></span><span class="default">$func</span><span class="keyword">(); </span><span class="comment">// Outputs "111"<br /></span><span class="default">?&gt;<br /></span><br />Similar JavaScript code:<br />&lt;script type="text/javascript"&gt;<br />var aaa = 111;<br />var func = (function(aaa){ return function(){ alert(aaa); } })(aaa);<br />aaa = 222;<br />func(); // Outputs "111"<br />&lt;/script&gt;<br /><br />Be careful, following code is not similar to previous code:<br />&lt;script type="text/javascript"&gt;<br />var aaa = 111;<br />var bbb = aaa;<br />var func = function(){ alert(bbb); };<br />aaa = 222;<br />func(); // Outputs "111", but only while "bbb" is not changed after function declaration<br /><br />// And this technique is not working in loops:<br />var functions = [];<br />for (var i = 0; i &lt; 2; i++)<br />{<br />&nbsp; &nbsp; var i2 = i;<br />&nbsp; &nbsp; functions.push(function(){ alert(i2); });<br />}<br />functions[0](); // Outputs "1", wrong!<br />functions[1](); // Outputs "1", ok<br />&lt;/script&gt;<br /><br />=== Example 2 (passing by reference) ===<br />PHP code:<br /><span class="default">&lt;?php<br />$aaa </span><span class="keyword">= </span><span class="default">111</span><span class="keyword">;<br /></span><span class="default">$func </span><span class="keyword">= function() use(&amp;</span><span class="default">$aaa</span><span class="keyword">){ print </span><span class="default">$aaa</span><span class="keyword">; };<br /></span><span class="default">$aaa </span><span class="keyword">= </span><span class="default">222</span><span class="keyword">;<br /></span><span class="default">$func</span><span class="keyword">(); </span><span class="comment">// Outputs "222"<br /></span><span class="default">?&gt;<br /></span><br />Similar JavaScript code:<br />&lt;script type="text/javascript"&gt;<br />var aaa = 111;<br />var func = function(){ alert(aaa); };<br />aaa = 222; // Outputs "222"<br />func();<br />&lt;/script&gt;</span>
</code></div>
  </div>
 </div>
  <div class="note" id="121034">  <div class="votes">
    <div id="Vu121034">
    <a href="https://www.php.net/manual/vote-note.php?id=121034&amp;page=functions.anonymous&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd121034">
    <a href="https://www.php.net/manual/vote-note.php?id=121034&amp;page=functions.anonymous&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V121034" title="60% like this...">
    3
    </div>
  </div>
  <a href="functions.anonymous.php.html#121034" class="name">
  <strong class="user"><em>ayon at hyurl dot com</em></strong></a><a class="genanchor" href="functions.anonymous.php.html#121034"> &para;</a><div class="date" title="2017-04-29 05:35"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom121034">
<div class="phpcode"><code><span class="html">
One way to call a anonymous function recursively is to use the USE keyword and pass a reference to the function itself:<br /><br /><span class="default">&lt;?php<br />$count </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br /></span><span class="default">$add </span><span class="keyword">= function(</span><span class="default">$count</span><span class="keyword">) use (&amp;</span><span class="default">$add</span><span class="keyword">){<br />&nbsp; &nbsp; </span><span class="default">$count </span><span class="keyword">+= </span><span class="default">1</span><span class="keyword">;<br />&nbsp; &nbsp; if(</span><span class="default">$count </span><span class="keyword">&lt; </span><span class="default">10</span><span class="keyword">) </span><span class="default">$count </span><span class="keyword">= </span><span class="default">$add</span><span class="keyword">(</span><span class="default">$count</span><span class="keyword">); </span><span class="comment">//recursive calling<br />&nbsp; &nbsp; </span><span class="keyword">return </span><span class="default">$count</span><span class="keyword">;<br />};<br />echo </span><span class="default">$add</span><span class="keyword">(</span><span class="default">$count</span><span class="keyword">); </span><span class="comment">//Will output 10 as expected<br /></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="97906">  <div class="votes">
    <div id="Vu97906">
    <a href="https://www.php.net/manual/vote-note.php?id=97906&amp;page=functions.anonymous&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd97906">
    <a href="https://www.php.net/manual/vote-note.php?id=97906&amp;page=functions.anonymous&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V97906" title="59% like this...">
    8
    </div>
  </div>
  <a href="functions.anonymous.php.html#97906" class="name">
  <strong class="user"><em>kdelux at gmail dot com</em></strong></a><a class="genanchor" href="functions.anonymous.php.html#97906"> &para;</a><div class="date" title="2010-05-14 08:55"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom97906">
<div class="phpcode"><code><span class="html">
Here is an example of one way to define, then use the variable ( $this ) in Closure functions.&nbsp; The code below explores all uses, and shows restrictions.<br /><br />The most useful tool in this snippet is the requesting_class() function that will tell you which class is responsible for executing the current Closure().&nbsp; <br /><br />Overview:<br />-----------------------<br />Successfully find calling object reference.<br />Successfully call $this(__invoke);<br />Successfully reference $$this-&gt;name;<br />Successfully call call_user_func(array($this, 'method'))<br /><br />Failure: reference anything through $this-&gt;<br />Failure: $this-&gt;name = ''; <br />Failure: $this-&gt;delfect(); <br /><br /><span class="default">&lt;?php<br /> <br />&nbsp; &nbsp; <br />&nbsp; &nbsp; <br />&nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">requesting_class</span><span class="keyword">()<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; foreach(</span><span class="default">debug_backtrace</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">) as </span><span class="default">$stack</span><span class="keyword">){<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(isset(</span><span class="default">$stack</span><span class="keyword">[</span><span class="string">'object'</span><span class="keyword">])){<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$stack</span><span class="keyword">[</span><span class="string">'object'</span><span class="keyword">];<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; <br />&nbsp; &nbsp; <br />&nbsp; &nbsp; <br />&nbsp; &nbsp; <br />&nbsp; &nbsp; class </span><span class="default">Person<br />&nbsp; &nbsp; </span><span class="keyword">{<br />&nbsp; &nbsp; &nbsp; &nbsp; public </span><span class="default">$name </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />&nbsp; &nbsp; &nbsp; &nbsp; public </span><span class="default">$head </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />&nbsp; &nbsp; &nbsp; &nbsp; public </span><span class="default">$feet </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />&nbsp; &nbsp; &nbsp; &nbsp; public </span><span class="default">$deflected </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; function </span><span class="default">__invoke</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">){ return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$p</span><span class="keyword">; }<br />&nbsp; &nbsp; &nbsp; &nbsp; function </span><span class="default">__toString</span><span class="keyword">(){ return </span><span class="string">'this'</span><span class="keyword">; } </span><span class="comment">// test for reference<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">){ </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name </span><span class="keyword">= </span><span class="default">$name</span><span class="keyword">; }<br />&nbsp; &nbsp; &nbsp; &nbsp; function </span><span class="default">deflect</span><span class="keyword">(){ </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">deflected </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">; }<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">shoot</span><span class="keyword">()<br />&nbsp; &nbsp; &nbsp; &nbsp; { </span><span class="comment">// If customAttack is defined, use that as the shoot resut.&nbsp; Otherwise shoot feet<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">is_callable</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">customAttack</span><span class="keyword">)){<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">call_user_func</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">customAttack</span><span class="keyword">);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">feet </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; }<br /><br />&nbsp; &nbsp; </span><span class="default">$p </span><span class="keyword">= new </span><span class="default">Person</span><span class="keyword">(</span><span class="string">'Bob'</span><span class="keyword">);<br /><br />&nbsp; &nbsp; <br />&nbsp; &nbsp; </span><span class="default">$p</span><span class="keyword">-&gt;</span><span class="default">customAttack </span><span class="keyword">= <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; function(){<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="default">$this</span><span class="keyword">; </span><span class="comment">// Notice: Undefined variable: this<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #$this = new Class() // FATAL ERROR<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Trick to assign the variable '$this'<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">extract</span><span class="keyword">(array(</span><span class="string">'this' </span><span class="keyword">=&gt; </span><span class="default">requesting_class</span><span class="keyword">())); </span><span class="comment">// Determine what class is responsible for making the call to Closure<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">var_dump</span><span class="keyword">( </span><span class="default">$this&nbsp; </span><span class="keyword">);&nbsp; </span><span class="comment">// Passive reference works<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">var_dump</span><span class="keyword">( $</span><span class="default">$this </span><span class="keyword">); </span><span class="comment">// Added to class:&nbsp; function __toString(){ return 'this'; }<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$name </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">(</span><span class="string">'name'</span><span class="keyword">); </span><span class="comment">// Success<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">echo </span><span class="default">$name</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Outputs: Bob<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">echo </span><span class="string">'&lt;br /&gt;'</span><span class="keyword">;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo $</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">call_user_func_array</span><span class="keyword">(array(</span><span class="default">$this</span><span class="keyword">, </span><span class="string">'deflect'</span><span class="keyword">), array()); </span><span class="comment">// SUCCESSFULLY CALLED<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #$this-&gt;head = 0; //** FATAL ERROR: Using $this when not in object context<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">$</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">head </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;&nbsp; </span><span class="comment">// Successfully sets value<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">};<br /> <br />&nbsp; &nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">);<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; </span><span class="default">$p</span><span class="keyword">-&gt;</span><span class="default">shoot</span><span class="keyword">();<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">);<br /><br />&nbsp; &nbsp; <br />&nbsp; &nbsp; die();<br /><br /></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="98978">  <div class="votes">
    <div id="Vu98978">
    <a href="https://www.php.net/manual/vote-note.php?id=98978&amp;page=functions.anonymous&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd98978">
    <a href="https://www.php.net/manual/vote-note.php?id=98978&amp;page=functions.anonymous&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V98978" title="60% like this...">
    4
    </div>
  </div>
  <a href="functions.anonymous.php.html#98978" class="name">
  <strong class="user"><em>gabriel dot totoliciu at ddsec dot net</em></strong></a><a class="genanchor" href="functions.anonymous.php.html#98978"> &para;</a><div class="date" title="2010-07-19 10:56"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom98978">
<div class="phpcode"><code><span class="html">
If you want to make a recursive closure, you will need to write this:<br /><br />$some_var1="1";<br />$some_var2="2";<br /><br />function($param1, $param2) use ($some_var1, $some_var2)<br />{<br /><br />//some code here<br /><br />call_user_func(__FUNCTION__, $other_param1, $other_param2);<br /><br />//some code here<br /><br />}<br /><br />If you need to pass values by reference you should check out<br /><br /><a href="http://www.php.net/manual/en/function.call-user-func.php" rel="nofollow" target="_blank">http://www.php.net/manual/en/function.call-user-func.php</a><br /><a href="http://www.php.net/manual/en/function.call-user-func-array.php" rel="nofollow" target="_blank">http://www.php.net/manual/en/function.call-user-func-array.php</a><br /><br />If you're wondering if $some_var1 and $some_var2 are still visible by using the call_user_func, yes, they are available.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="92664">  <div class="votes">
    <div id="Vu92664">
    <a href="https://www.php.net/manual/vote-note.php?id=92664&amp;page=functions.anonymous&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd92664">
    <a href="https://www.php.net/manual/vote-note.php?id=92664&amp;page=functions.anonymous&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V92664" title="60% like this...">
    4
    </div>
  </div>
  <a href="functions.anonymous.php.html#92664" class="name">
  <strong class="user"><em>Anonymous</em></strong></a><a class="genanchor" href="functions.anonymous.php.html#92664"> &para;</a><div class="date" title="2009-08-03 02:50"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom92664">
<div class="phpcode"><code><span class="html">
If you want to check whether you're dealing with a closure specifically and not a string or array callback you can do this:<br /><br /><span class="default">&lt;?php<br />$isAClosure </span><span class="keyword">= </span><span class="default">is_callable</span><span class="keyword">(</span><span class="default">$thing</span><span class="keyword">) &amp;&amp; </span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$thing</span><span class="keyword">);<br /></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="107245">  <div class="votes">
    <div id="Vu107245">
    <a href="https://www.php.net/manual/vote-note.php?id=107245&amp;page=functions.anonymous&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd107245">
    <a href="https://www.php.net/manual/vote-note.php?id=107245&amp;page=functions.anonymous&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V107245" title="52% like this...">
    1
    </div>
  </div>
  <a href="functions.anonymous.php.html#107245" class="name">
  <strong class="user"><em>mike at borft dot student dot utwente dot nl</em></strong></a><a class="genanchor" href="functions.anonymous.php.html#107245"> &para;</a><div class="date" title="2012-01-24 02:46"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom107245">
<div class="phpcode"><code><span class="html">
Since it is possible to assign closures to class variables, it is a shame it is not possible to call them directly. ie. the following does not work:<br /><span class="default">&lt;?php<br /></span><span class="keyword">class </span><span class="default">foo </span><span class="keyword">{<br /><br />&nbsp; public </span><span class="default">test</span><span class="keyword">;<br /><br />&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(){<br />&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">test </span><span class="keyword">= function(</span><span class="default">$a</span><span class="keyword">) {<br />&nbsp; &nbsp; &nbsp; print </span><span class="string">"</span><span class="default">$a</span><span class="string">\n"</span><span class="keyword">;<br />&nbsp; &nbsp; };<br />&nbsp; }<br />}<br /><br /></span><span class="default">$f </span><span class="keyword">= new </span><span class="default">foo</span><span class="keyword">();<br /><br /></span><span class="default">$f</span><span class="keyword">-&gt;</span><span class="default">test</span><span class="keyword">();<br /></span><span class="default">?&gt;<br /></span><br />However, it is possible using the magic __call function:<br /><span class="default">&lt;?php<br /></span><span class="keyword">class </span><span class="default">foo </span><span class="keyword">{<br /><br />&nbsp; public </span><span class="default">test</span><span class="keyword">;<br /><br />&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(){<br />&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">test </span><span class="keyword">= function(</span><span class="default">$a</span><span class="keyword">) {<br />&nbsp; &nbsp; &nbsp; print </span><span class="string">"</span><span class="default">$a</span><span class="string">\n"</span><span class="keyword">;<br />&nbsp; &nbsp; };<br />&nbsp; }<br /><br />&nbsp; public function </span><span class="default">__call</span><span class="keyword">(</span><span class="default">$method</span><span class="keyword">, </span><span class="default">$args</span><span class="keyword">){<br />&nbsp; &nbsp; if ( </span><span class="default">$this</span><span class="keyword">-&gt;{</span><span class="default">$method</span><span class="keyword">} instanceof </span><span class="default">Closure </span><span class="keyword">) {<br />&nbsp; &nbsp; &nbsp; return </span><span class="default">call_user_func_array</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;{</span><span class="default">$method</span><span class="keyword">},</span><span class="default">$args</span><span class="keyword">);<br />&nbsp; &nbsp; } else {<br />&nbsp; &nbsp; &nbsp; return </span><span class="default">parent</span><span class="keyword">::</span><span class="default">__call</span><span class="keyword">(</span><span class="default">$method</span><span class="keyword">, </span><span class="default">$args</span><span class="keyword">);<br />&nbsp; &nbsp; }<br />&nbsp; }<br />}<br /></span><span class="default">$f </span><span class="keyword">= new </span><span class="default">foo</span><span class="keyword">();<br /></span><span class="default">$f</span><span class="keyword">-&gt;</span><span class="default">test</span><span class="keyword">();<br /></span><span class="default">?&gt;<br /></span>it <br />Hope it helps someone ;)</span>
</code></div>
  </div>
 </div></div>

 <div class="foot"><a href="https://www.php.net/manual/add-note.php?sect=functions.anonymous&amp;redirect=https://www.php.net/manual/ru/functions.anonymous.php"><img src='https://www.php.net/images/notes-add@2x.png' alt='add a note' width='12' height='12'> <small>add a note</small></a></div>
</section>    </section><!-- layout-content -->
        <aside class='layout-menu'>

        <ul class='parent-menu-list'>
                                    <li>
                <a href="https://www.php.net/manual/ru/language.functions.php">Функции</a>

                                    <ul class='child-menu-list'>

                                                <li class="">
                            <a href="https://www.php.net/manual/ru/functions.user-defined.php" title="Функции, определяемые пользователем">Функции, определяемые пользователем</a>
                        </li>
                                                <li class="">
                            <a href="https://www.php.net/manual/ru/functions.arguments.php" title="Аргументы функции">Аргументы функции</a>
                        </li>
                                                <li class="">
                            <a href="https://www.php.net/manual/ru/functions.returning-values.php" title="Возврат значений">Возврат значений</a>
                        </li>
                                                <li class="">
                            <a href="https://www.php.net/manual/ru/functions.variable-functions.php" title="Обращение к функциям через переменные">Обращение к функциям через переменные</a>
                        </li>
                                                <li class="">
                            <a href="https://www.php.net/manual/ru/functions.internal.php" title="Встроенные функции">Встроенные функции</a>
                        </li>
                                                <li class="current">
                            <a href="functions.anonymous.php.html" title="Анонимные функции">Анонимные функции</a>
                        </li>
                                                <li class="">
                            <a href="https://www.php.net/manual/ru/functions.arrow.php" title="Стрелочные функции">Стрелочные функции</a>
                        </li>
                                                <li class="">
                            <a href="https://www.php.net/manual/ru/functions.first_class_callable_syntax.php" title="Callback-&#8203;функции как объекты первого класса">Callback-&#8203;функции как объекты первого класса</a>
                        </li>
                        
                    </ul>
                
            </li>
                        
                    </ul>
    </aside>


  </div><!-- layout -->

  <footer>
    <div class="container footer-content">
      <div class="row-fluid">
      <ul class="footmenu">
        <li><a href="https://www.php.net/copyright.php">Copyright &copy; 2001-2022 The PHP Group</a></li>
        <li><a href="https://www.php.net/my.php">My PHP.net</a></li>
        <li><a href="https://www.php.net/contact.php">Contact</a></li>
        <li><a href="https://www.php.net/sites.php">Other PHP.net sites</a></li>
        <li><a href="https://www.php.net/privacy.php">Privacy policy</a></li>
        <li><a href="https://github.com/php/web-php/blob/master/manual%2Fru%2Ffunctions.anonymous.php">View Source</a></li>
      </ul>
      </div>
    </div>
  </footer>

    
 <!-- External and third party libraries. -->
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" integrity="sha384-aBL3Lzi6c9LNDGvpHkZrrm3ZVsIwohDD7CDozL0pk8FwCrfmV7H9w8j3L7ikEv6h" crossorigin="anonymous"></script>
<script src="https://www.php.net/cached.php?t=1421837618&amp;f=/js/ext/modernizr.js"></script>
<script src="https://www.php.net/cached.php?t=1421837618&amp;f=/js/ext/hogan-2.0.0.min.js"></script>
<script src="https://www.php.net/cached.php?t=1421837618&amp;f=/js/ext/typeahead.min.js"></script>
<script src="https://www.php.net/cached.php?t=1421837618&amp;f=/js/ext/mousetrap.min.js"></script>
<script src="https://www.php.net/cached.php?t=1421837618&amp;f=/js/search.js"></script>
<script src="https://www.php.net/cached.php?t=1637324403&amp;f=/js/common.js"></script>

<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="https://www.php.net/images/to-top@2x.png"></a>

</body>
</html>
