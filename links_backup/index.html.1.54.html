<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <meta name="referrer" content="unsafe-url">
  <title>Чистые тесты на PHP и PHPUnit / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }

    /* non-breaking hyphen */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/l/font?kit=KFOlCnqEu92Fr1MmEU9vBh0_IsHAlmrO6g&skey=ee881451c540fdec&v=v29) format('woff2');
      unicode-range: U+02011;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.da6c6b36.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.4de4e95a.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.92df6f6d.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.4de4e95a.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.2822d469ec31a56409ac330bbcf7fcbf.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/company\/vk\/blog\/485124\/"},"headline":"Чистые тесты на PHP и PHPUnit","datePublished":"2020-01-23T12:55:24+03:00","dateModified":"2020-02-26T12:19:55+03:00","author":{"@type":"Person","name":"Макс"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"В экосистеме PHP существует много инструментов, обеспечивающих удобное тестирование на PHP. Одним из самых известных является PHPUnit, это почти синоним тестиро...","url":"https:\/\/habr.com\/ru\/company\/vk\/blog\/485124\/#post-content-body","about":["c_vk","h_it_testing","h_php","h_complete_code","h_web_testing","f_develop"],"image":["https:\/\/habr.com\/share\/publication\/485124\/e4b7608d22fd88d38bca54f44f0569a7\/","https:\/\/habrastorage.org\/webt\/jx\/3y\/zg\/jx3yzg2jnznn0kwnk6oe6ikvlzw.jpeg"]}</script>
  <script src="https://www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.64.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_com"><meta data-vue-meta="ssr" property="og:site_name" content="Хабр" data-vmid="og:site_name"><meta data-vue-meta="ssr" property="og:title" content="Чистые тесты на PHP и PHPUnit" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Чистые тесты на PHP и PHPUnit" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Чистые тесты на PHP и PHPUnit" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="В экосистеме PHP существует много инструментов, обеспечивающих удобное тестирование на PHP. Одним из самых известных является PHPUnit, это почти синоним тестирования на этом языке. Однако о хороших..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="В экосистеме PHP существует много инструментов, обеспечивающих удобное тестирование на PHP. Одним из самых известных является PHPUnit, это почти синоним тестирования на этом языке. Однако о хороших..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="В экосистеме PHP существует много инструментов, обеспечивающих удобное тестирование на PHP. Одним из самых известных является PHPUnit, это почти синоним тестирования на этом языке. Однако о хороших..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="В экосистеме PHP существует много инструментов, обеспечивающих удобное тестирование на PHP. Одним из самых известных является PHPUnit, это почти синоним тестирования на этом языке. Однако о хороших..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="В экосистеме PHP существует много инструментов, обеспечивающих удобное тестирование на PHP. Одним из самых известных является PHPUnit, это почти синоним тестирования на этом языке. Однако о хороших..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habrastorage.org/webt/jx/3y/zg/jx3yzg2jnznn0kwnk6oe6ikvlzw.jpeg" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habrastorage.org/webt/jx/3y/zg/jx3yzg2jnznn0kwnk6oe6ikvlzw.jpeg" data-vmid="og:image"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habrastorage.org/webt/jx/3y/zg/jx3yzg2jnznn0kwnk6oe6ikvlzw.jpeg" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habrastorage.org/webt/jx/3y/zg/jx3yzg2jnznn0kwnk6oe6ikvlzw.jpeg" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habrastorage.org/webt/jx/3y/zg/jx3yzg2jnznn0kwnk6oe6ikvlzw.jpeg?format=vk" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="485124" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2020-01-23T09:55:24.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" content="https://habr.com/ru/company/vk/blog/485124/" property="og:url" data-vmid="og:url"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" name="keywords" content="php, tdd, phpunit, никто не читает теги">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/485124/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="index.html.1.54.html" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habrastorage.org/webt/jx/3y/zg/jx3yzg2jnznn0kwnk6oe6ikvlzw.jpeg" data-vmid="image:href">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="https://habr.com/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="https://habr.com/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v25.4b679db1.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="https://habr.com/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><a href="https://effect.habr.com/a/3d5-RjU3SQomUbNVM4Wag5CATNYzkT1oFmatDJeOfmothd-6EryRuNw9Zkxp9L7CvdFw6eaT7nm744CkEeUjuuRqgkLb-Oebd-nff-D7p8uwvnKB1vGuNj8HyxIznSRSQUkOiA8V" rel="noopener" target="_blank" class="tm-feature__link"><img alt height="20" src="https://effect.habr.com/a/74-21PvljXozmZ5-5WkAQcAgcStiFNZQWw3rjqBsFcCevYZl1V8vPq9aU9cwkedUnKys7TmIZtQbS67zTt3V6Av2PsM1E4qalITrCuRSmzj-OH2qd5A5NvFclZMOVGngfrw9SXDYec5zmWpeFsuyTnGi8TWfosQQJ5l-as_zGtNJjV3xJSz9SYu1Wr2lTBuwXJsBtQlS9u0T_BPEyzFHgDenXiVgBcbV" width="20" class="tm-feature__icon">
    Питчи недели фронтендеров
  </a></div> <a href="https://effect.habr.com/a/DQoLcry_TqYbBzMYKPRELpAT2x_mifL-5pVlHqUlPzq76OWSVU9_LxzlllNUuo3SkwqHlYutnV7vPyG_fC8eiNnn0uAV31hCxu8ARcovxZq6V3R7dVX88nM" target="_blank" class="tm-top-link" style="color:#99ffa7;">
  Как меняется оплата проезда
</a> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="https://habr.com/ru/flows/all" class="tm-main-menu__item">
        Все потоки
      </a> <a href="https://habr.com/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="https://habr.com/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="https://habr.com/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="https://habr.com/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="https://habr.com/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="https://habr.com/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="https://habr.com/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v25.4b679db1.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v25.4b679db1.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" companyName="vk" data-async-called="true" class="tm-page"><div class="tm-page-width"><div class="tm-page__header"><div class="tm-company-card__branding tm-company-article__branding tm-company-card__branding_loading"><div class="tm-company-card__branding-placeholder"><!----></div> <a href="https://vk.com/vkteam"><img src="https://habrastorage.org/getpro/habr/branding/174/2c4/3a5/1742c43a5b504987a0fadf577a0bd4de.png" width="100%" class="tm-company-card__branding-image"></a></div></div> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v25.4b679db1.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"><div class="tm-company-profile-card tm-company-article__profile-card"><div class="tm-company-card tm-company-profile-card__info"><div class="tm-company-card__header"><a href="https://habr.com/ru/company/vk/profile/" class="tm-company-card__avatar"><div class="tm-entity-image"><img alt="" height="48" src="https://habrastorage.org/getpro/habr/company/9ed/c74/6b4/9edc746b484c805ecad1f941b5f7068a.png" width="48" class="tm-entity-image__pic"></div></a> <a href="https://career.habr.com/companies/vk" rel="noopener" target="_blank" class="tm-grade tm-company-card__rating"><div class="tm-rating"><div class="tm-rating__header"><svg height="24" width="24" class="tm-svg-img tm-svg-grade__icon"><title>Оценка компании на Хабр Карьере</title> <use xlink:href="/img/megazord-v25.4b679db1.svg#grade"></use></svg> <div class="tm-rating__counter tm-rating__counter_variant-grade">4.35</div></div> <div class="tm-rating__text tm-rating__text_variant-grade">
    Оценка
  </div></div></a> <div class="tm-rating tm-company-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">266.34</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div> <!----></div> <div class="tm-company-card__info"><a href="https://habr.com/ru/company/vk/profile/" class="tm-company-card__name">
      VK
    </a> <div class="tm-company-card__description">Технологии, которые объединяют</div></div></div> <!----></div> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="https://habr.com/ru/users/AloneCoder/" title="AloneCoder" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="" height="24" src="https://habrastorage.org/r/w32/getpro/habr/avatars/741/45e/bea/74145ebeab7f222cce402aed2683f9d7.png" width="24" class="tm-entity-image__pic"></div></a> <span class="tm-user-info__user"><a href="https://habr.com/ru/users/AloneCoder/" class="tm-user-info__username">
      AloneCoder
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2020-01-23T09:55:24.000Z" title="2020-01-23, 12:55">23  января  2020 в 12:55</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Чистые тесты на PHP и PHPUnit</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="https://habr.com/ru/company/vk/blog/" class="tm-article-snippet__hubs-item-link router-link-active"><span>Блог компании VK</span> <!----></a></span><span class="tm-article-snippet__hubs-item"><a href="https://habr.com/ru/hub/it_testing/" class="tm-article-snippet__hubs-item-link"><span>Тестирование IT-систем</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="https://habr.com/ru/hub/php/" class="tm-article-snippet__hubs-item-link"><span>PHP</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="https://habr.com/ru/hub/complete_code/" class="tm-article-snippet__hubs-item-link"><span>Совершенный код</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="https://habr.com/ru/hub/web_testing/" class="tm-article-snippet__hubs-item-link"><span>Тестирование веб-сервисов</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <div class="tm-article-snippet__labels"><div class="tm-article-snippet__label tm-article-snippet__label_variant-translation"><span>
        Перевод
      </span></div><div class="tm-article-snippet__label tm-article-snippet__label_variant-tutorial"><span>
        Tutorial
      </span></div></div> <!----> <!----></div></div> <div class="tm-article-presenter__origin"><a href="https://thephp.website/en/issue/clean-tests-with-php-and-phpunit/" target="_blank" class="tm-article-presenter__origin-link">
                Автор оригинала:
                <span>
                  Níckolas Da Silva
                </span></a></div> <div data-gallery-root="" lang="ru" class="tm-article-body"><div></div> <div id="post-content-body"><div><div class="article-formatted-body article-formatted-body_version-1"><div xmlns="http://www.w3.org/1999/xhtml"><div style="text-align:center;"><img src="https://habrastorage.org/r/w780q1/webt/jx/3y/zg/jx3yzg2jnznn0kwnk6oe6ikvlzw.jpeg" width="400" data-src="https://habrastorage.org/webt/jx/3y/zg/jx3yzg2jnznn0kwnk6oe6ikvlzw.jpeg" data-blurred="true"/></div><br/>
В экосистеме PHP существует много инструментов, обеспечивающих удобное тестирование на PHP. Одним из самых известных является <a href="https://github.com/sebastianbergmann/phpunit">PHPUnit</a>, это почти синоним тестирования на этом языке. Однако о хороших методиках тестирования пишут не так много. Есть много вариантов, для чего и когда писать тесты, какого рода тесты, и так далее. Но, честно говоря, <b>не имеет смысла писать тест, если позднее вы не сможете его прочесть</b>.<br/>
<br/>
Тесты — это особая разновидность документации. Как <a href="https://thephp.website/en/issue/real-life-tdd-php/">я ранее писал о TDD на PHP</a>, тест всегда будет (или хотя бы должен) ясно говорить о том, в чём заключается задача конкретной части кода.<br/>
<br/>
Если один тест не может выразить эту идею, то тест плохой.<br/>
<br/>
Я подготовил набор методик, которые станут подспорьем для PHP-разработчиков в написании хороших, удобочитаемых и полезных тестов.<br/>
<a name="habracut"></a><br/>
<h2>Начнём с основ</h2><br/>
Есть набор стандартных методик, которым многие следуют без каких-либо вопросов. Многие из них я упомяну и попытаюсь объяснить, для чего они нужны.<br/>
<br/>
<h3>1. Тесты не должны содержать операций ввода-вывода</h3><br/>
<b>Основная причина</b>: операции ввода-вывода медленные и ненадёжные.<br/>
<br/>
<b>Медленные</b>: даже если у вас самое лучшее в мире железо, операции ввода-вывода всё равно будут медленнее обращений к памяти. Тесты всегда должны работать быстро, иначе люди будут слишком редко их запускать.<br/>
<br/>
<b>Ненадёжные</b>: некоторые файлы, бинарники, сокеты, папки и DNS-записи могут быть недоступны на некоторых машинах, на которых вы проводите тестирование. Чем больше вы полагаетесь при тестировании на операции ввода-вывода, тем больше ваши тесты привязаны к инфраструктуре.<br/>
<br/>
Какие операции относятся к вводу-выводу:<br/>
<br/>
<ul>
<li>Чтение и запись файлов.<br/>
</li>
<li>Сетевые вызовы.<br/>
</li>
<li>Вызовы внешних процессов (с помощью <code>exec</code>, <code>proc_open</code> и т.д.).<br/>
</li>
</ul><br/>
Бывают ситуации, когда наличие операций ввода-вывода позволяет писать тесты быстрее. Но будьте осторожны: проверьте, что такие операции работают одинаково на ваших машинах для разработки, сборки и развёртывания, иначе у вас могут возникнуть серьёзные проблемы.<br/>
<br/>
Изолируйте тесты так, чтобы им не нужны были операции ввода-вывода: ниже я привёл архитектурное решение, которое предотвращает выполнение тестами операций ввода-вывода за счёт разделения ответственности между интерфейсами.<br/>
<br/>
Пример:<br/>
<br/>
<pre><code class="php">public function getPeople(): array
{
  $rawPeople = file_get_contents(
    'people.json'
  ) ?? '[]';

  return json_decode(
    $rawPeople,
    true
  );
}
</code></pre><br/>
При начале тестирования с помощью этого метода будет создан локальный файл, и время от времени будут создаваться его снимки:<br/>
<br/>
<pre><code class="php">public function testGetPeopleReturnsPeopleList(): void
{
  $people = $this->peopleService
    ->getPeople();

  // assert it contains people
}</code></pre><br/>
Для этого нам нужно настроить предварительные условия запуска тестов. На первый взгляд всё выглядит разумно, но на самом деле это ужасно.<br/>
<br/>
Пропуск теста из-за того, что не выполнены предварительные условия, не обеспечивает качество нашего ПО. Это лишь скроет баги!<br/>
<br/>
<b>Исправляем ситуацию</b>: изолируем операции ввода-вывода, переложив ответственность на интерфейс.<br/>
<br/>
<pre><code class="php">// extract the fetching
// logic to a specialized
// interface
interface PeopleProvider
{
  public function getPeople(): array;
}

// create a concrete implementation
class JsonFilePeopleProvider
  implements PeopleProvider
{
  private const PEOPLE_JSON =
    'people.json';

  public function getPeople(): array
  {
    $rawPeople = file_get_contents(
      self::PEOPLE_JSON
    ) ?? '[]';

    return json_decode(
      $rawPeople,
      true
    );
  }
}

class PeopleService
{
  // inject via __construct()
  private PeopleProvider $peopleProvider;

  public function getPeople(): array
  {
    return $this->peopleProvider
      ->getPeople();
  }
}</code></pre><br/>
Теперь я знаю, что <code>JsonFilePeopleProvider</code> в любом случае будет использовать ввод-вывод.<br/>
<br/>
Вместо <code>file_get_contents()</code> можно использовать слой абстракции вроде<a href="https://flysystem.thephpleague.com/docs/adapter/local/"> файловой системы Flysystem</a>, для которой легко сделать заглушки.<br/>
<br/>
А тогда зачем нам <code>PeopleService</code>? Хороший вопрос. Для этого и нужны тесты: поставить архитектуру под сомнение и убрать бесполезный код.<br/>
<br/>
<h3>2. Тесты должны быть осознанными и осмысленными</h3><br/>
<b>Основная причина</b>: тесты — это разновидность документации. Поддерживайте их понятность, краткость и удобочитаемость.<br/>
<br/>
<b>Понятность и краткость</b>: ни беспорядка, ни тысяч строк заглушек, ни последовательностей утверждений.<br/>
<br/>
<b>Удобочитаемость</b>: тесты должны рассказывать историю. Для этого отлично подходит структура «дано, когда, тогда».<br/>
<br/>
Характеристики хорошего и удобочитаемого теста:<br/>
<br/>
<ul>
<li>Содержит только необходимые вызовы метода <code>assert</code> (желательно один).<br/>
</li>
<li>Он очень понятно объясняет, что должно произойти при заданных условиях.<br/>
</li>
<li>Он тестирует только одну ветку исполнения метода.<br/>
</li>
<li>Он не делает заглушку для целой вселенной ради какого-то утверждения.<br/>
</li>
</ul><br/>
Важно отметить, что если ваша реализация содержит условные выражения, операторы перехода или циклы, то все они должны быть явно покрыты тестами. Например, чтобы ранние ответы всегда содержали тест.<br/>
<br/>
Повторюсь: дело не в покрытии, а в документировании.<br/>
<br/>
Вот пример сбивающего с толку теста:<br/>
<br/>
<pre><code class="php">public function testCanFly(): void
{
  $noWings = new Person(0);
  $this->assertEquals(
    false,
    $noWings->canFly()
  );

  $singleWing = new Person(1);
  $this->assertTrue(
    !$singleWing->canFly()
  );

  $twoWings = new Person(2);
  $this->assertTrue(
    $twoWings->canFly()
  );
}</code></pre><br/>
Давайте адаптируем формат «дано, когда, тогда» и посмотрим, что получится:<br/>
<br/>
<pre><code class="php">public function testCanFly(): void
{
  // Given
  $person = $this->givenAPersonHasNoWings();

  // Then
  $this->assertEquals(
    false,
    $person->canFly()
  );

  // Further cases...
}

private function givenAPersonHasNoWings(): Person
{
  return new Person(0);
}</code></pre><br/>
Как и раздел «дано» (Given), «когда» и «тогда» можно перенести в приватные методы. Это сделает ваш тест более удобочитаемым.<br/>
<br/>
Теперь в <code>assertEquals</code> бессмысленный беспорядок. Читающий это человек должен проследить утверждение, чтобы понять, что оно означает.<br/>
<br/>
Использование конкретных утверждений сделает ваш тест гораздо удобочитаемее. <code>assertTrue()</code> должен получать булеву переменную, а не выражение вроде <code>canFly() !== true</code>.<br/>
<br/>
В предыдущем примере мы заменяем <code>assertEquals</code> между <code>false</code> и <code>$person->canFly()</code> на простое <code>assertFalse</code>:<br/>
<br/>
<pre><code class="php">// ...
$person = $this->givenAPersonHasNoWings();

$this->assertFalse(
  $person->canFly()
);

// Further cases...</code></pre><br/>
Теперь всё предельно понятно! Если человек не имеет крыльев, он не должен уметь летать! Читается как стихотворение <br/>
<br/>
Теперь раздел «Further cases», который дважды появляется в нашем тексте, является ярким свидетельством того, что тест делает слишком много утверждений. При этом метод <code>testCanFly()</code> совершенно бесполезен.<br/>
<br/>
Давайте снова улучшим тест:<br/>
<br/>
<pre><code class="php">public function testCanFlyIsFalsyWhenPersonHasNoWings(): void
{
  $person = $this->givenAPersonHasNoWings();
  $this->assertFalse(
    $person->canFly()
  );
}

public function testCanFlyIsTruthyWhenPersonHasTwoWings(): void
{
  $person = $this->givenAPersonHasTwoWings();
  $this->assertTrue(
    $person->canFly()
  );
}

// ...</code></pre><br/>
Можем даже переименовать тестирующий метод, чтобы он соответствовал реальному сценарию, например, в <code>testPersonCantFlyWithoutWings</code>, но меня и так всё устраивает.<br/>
<br/>
<h3>3. Тест не должен зависеть от других тестов</h3><br/>
<b>Основная причина</b>: тесты должны запускаться и успешно выполняться в любом порядке.<br/>
<br/>
Я не вижу достаточных причин для создания взаимосвязей между тестами. Недавно меня попросили сделать тест функции входа в систему, приведу его здесь в качестве хорошего примера.<br/>
<br/>
Тест должен:<br/>
<br/>
<ul>
<li>Сгенерировать JWT-токен для входа в систему.<br/>
</li>
<li>Выполнить функцию входа.<br/>
</li>
<li>Утвердить изменение состояния.<br/>
</li>
</ul><br/>
Было так:<br/>
<br/>
<pre><code class="php">public function testGenerateJWTToken(): void
{
  // ... $token
  $this->token = $token;
}

// @depends  testGenerateJWTToken
public function testExecuteAnAmazingFeature(): void
{
  // Execute using $this->token
}

// @depends  testExecuteAnAmazingFeature
public function testStateIsBlah(): void
{
  // Poll for state changes on
  // Logged-in interface
}</code></pre><br/>
Это плохо по нескольким причинам:<br/>
<br/>
<ul>
<li>PHPUnit не может гарантировать такой порядок исполнения.<br/>
</li>
<li>Тесты должны уметь исполняться независимо.<br/>
</li>
<li>Параллельные тесты могут сбоить случайным образом.<br/>
</li>
</ul><br/>
Простейший способ обойти это — использовать схему «дано, когда, тогда». Так тесты будут более продуманными, они будут рассказывать историю, явно демонстрируя свои зависимости, объясняя саму проверяемую функцию.<br/>
<br/>
<pre><code class="php">public function testAmazingFeatureChangesState(): void
{
  // Given
  $token = $this->givenImAuthenticated();

  // When
  $this->whenIExecuteMyAmazingFeature(
    $token
  );
  $newState = $this->pollStateFromInterface(
    $token
  );

  // Then
  $this->assertEquals(
    'my-state',
    $newState
  );
}</code></pre><br/>
Также нам понадобится добавить тесты для аутентификации и т. д. Эта структура так хороша, что в <a href="https://behat.org/en/latest/quick_start.html">Behat используется по умолчанию</a>.<br/>
<br/>
<h3>4. Всегда внедряйте зависимости</h3><br/>
<b>Основная причина</b>: очень дурной тон — создавать заглушку для глобального состояния. Отсутствие возможности создавать заглушки для зависимостей не позволяет тестировать функцию.<br/>
<br/>
Полезный совет: <b>забудьте o статичных stateful-классах и экземплярах синглтонов</b>. Если ваш класс от чего-то зависит, то сделайте так, чтобы его можно было внедрять.<br/>
<br/>
Вот грустный пример:<br/>
<br/>
<pre><code class="php">class FeatureToggle
{
  public function isActive(
    Id $feature
  ): bool {
    $cookieName = $feature->getCookieName();

    // Early return if cookie
    // override is present
    if (Cookies::exists(
      $cookieName
    )) {
      return Cookies::get(
        $cookieName
      );
    }

    // Evaluate feature toggle...
  }
}</code></pre><br/>
Как можно протестировать этот ранний ответ?<br/>
<br/>
Всё верно. Никак.<br/>
<br/>
Для его тестирования нам нужно понимать поведение класса <code>Cookies</code> и быть уверенными в том, что можем воспроизвести всё связанное с этим окружение, в результате получив определённые ответы.<br/>
<br/>
Не делайте этого.<br/>
<br/>
Ситуацию можно исправить, если внедрить экземпляр <code>Cookies</code> в качестве зависимости. Тест будет выглядеть так:<br/>
<br/>
<pre><code class="php">// Test class...
private Cookies $cookieMock;

private FeatureToggle $service;

// Preparing our service and dependencies
public function setUp(): void
{
  $this->cookieMock = $this->prophesize(
    Cookies::class
  );

  $this->service = new FeatureToggle(
    $this->cookieMock->reveal()
  );
}

public function testIsActiveIsOverriddenByCookies(): void
{
  // Given
  $feature = $this->givenFeatureXExists();

  // When
  $this->whenCookieOverridesFeatureWithTrue(
    $feature
  );

  // Then
  $this->assertTrue(
    $this->service->isActive($feature)
  );
  // additionally we can assert
  // no other methods were called
}

private function givenFeatureXExists(): Id
{
  // ...
  return $feature;
}

private function whenCookieOverridesFeatureWithTrue(
  Id $feature
): void {
  $cookieName = $feature->getCookieName();
  $this->cookieMock->exists($cookieName)
    ->shouldBeCalledOnce()
    ->willReturn(true);

  $this->cookieMock->get($cookieName)
    ->shouldBeCalledOnce()
    ->willReturn(true);
}</code></pre><br/>
То же самое и с синглтонами. Так что если вы хотите сделать объект уникальным, то корректно сконфигурируйте ваш инъектор зависимостей, а не используйте (анти)паттерн «синглтон». Иначе будете писать методы, которые полезны лишь для случаев вроде <code>reset()</code> или <code>setInstance()</code>. На мой взгляд, это безумие.<br/>
<br/>
Совершенно нормально менять архитектуру, чтобы облегчить тестирование! А создавать методы для облегчения тестирования — не нормально.<br/>
<br/>
<h3>5. Никогда не тестируйте защищённые/приватные методы</h3><br/>
<b>Основная причина</b>: они влияют на то, как мы тестируем функции, определяя сигнатуру поведения: при таком-то условии, когда я ввожу А, то ожидаю получить Б. <b>Приватные/защищённые методы не являются частью сигнатур функций</b>.<br/>
<br/>
Я даже не хочу показывать способ «тестирования» приватных методов, но дам подсказку: вы можете это сделать только с помощью API <a href="https://www.php.net/manual/en/book.reflection.php">reflection</a>.<br/>
<br/>
Всегда как-нибудь наказывайте себя, когда задумываетесь об использовании reflection для тестирования приватных методов! Плохой, плохоооой разработчик!<br/>
<br/>
По своему определению, приватные методы вызываются только изнутри. То есть они не доступны публично. Это означает, что вызывать подобные методы могут только публичные методы из того же класса.<br/>
<br/>
<b>Если вы протестировали все свои публичные методы, то вы также протестировали все приватные/защищённые методы</b>. Если это не так, то свободно удаляйте приватные/защищённые методы, их всё-равно никто не использует.<br/>
<br/>
<h2>Продвинутые советы</h2><br/>
Надеюсь, вы ещё не заскучали. Всё-таки про основы нужно было рассказать. Теперь поделюсь своим мнением о написании чистых тестов и решениях, влияющих на мой процесс разработки.<br/>
<br/>
Самое важное, о чём я не забываю при написании тестов:<br/>
<br/>
<ul>
<li>Учёба.<br/>
</li>
<li>Быстрое получение обратной связи.<br/>
</li>
<li>Документирование.<br/>
</li>
<li>Рефакторинг.<br/>
</li>
<li>Проектирование в ходе тестирования.<br/>
</li>
</ul><br/>
<h3>1. Тесты в начале, а не в конце</h3><br/>
<b>Ценности</b>: учёба, быстрое получение обратной связи, документирование, рефакторинг, проектирование в ходе тестирования.<br/>
<br/>
Это основа всего. Важнейший аспект, включающий в себя все перечисленные ценности. Когда вы заранее пишете тесты, это помогает вам сначала понять, как должна быть структурирована схема «дано, когда, тогда». При этом вы сначала документируете, и, что ещё важнее, запоминаете и задаёте свои требования как самые важные аспекты.<br/>
<br/>
Странно слышать о том, чтобы писать тесты до реализации? А представьте, насколько странно реализовать что-то, а при тестировании выяснить, все ваши выражения «дано, когда, тогда» не имеют смысла.<br/>
<br/>
Также этот подход позволит проверять ваши ожидания каждые две секунды. Вы получаете обратную связь максимально быстро. Вне зависимости от того, насколько большой или маленькой выглядит фича.<br/>
<br/>
Зелёные тесты — идеальная область для рефакторинга. Главная мысль: нет тестов — нет рефакторинга. Рефакторинг без тестов просто опасен.<br/>
<br/>
Наконец, задав структуру «дано, когда, тогда», вам станет очевидно, какие интерфейсы должны быть у ваших методов и как они должны себя вести. Соблюдение чистоты теста также заставит вас постоянно принимать разные архитектурные решения. Это заставит вас создавать фабрики, интерфейсы, нарушать наследования и т. д. И да, тестировать станет легче!<br/>
<br/>
Если ваши тесты — это живые документы, объясняющие работу приложения, то крайне важно, чтобы они делали это понятно.<br/>
<br/>
<h3>2. Лучше без тестов, чем с плохими тестами</h3><br/>
<b>Ценности</b>: учёба, документирование, рефакторинг.<br/>
<br/>
Многие разработчики думают о тестах так: напишу фичу, буду гонять фреймворк для тестирования до тех пор, пока тесты не покроют определённое количество новых строк, и отправлю в эксплуатацию.<br/>
<br/>
Мне кажется, нужно уделять больше внимания ситуации, когда новый разработчик начинает работать с этой фичей. <b>О чём расскажут тесты этому человеку?</b><br/>
<br/>
Тесты часто сбивают с толку, если наименования недостаточно подробны. Что понятнее: <code>testCanFly </code>или <code>testCanFlyReturnsFalseWhenPersonHasNoWings</code>?<br/>
<br/>
Если ваши тесты представляют собой всего лишь беспорядочный код, который заставляет фреймворк покрывать больше строк, с примерами, которые не имеют смысла, то пришло время остановиться и подумать, стоит ли вообще писать эти тесты.<br/>
<br/>
Даже такие глупости, как присвоение переменным имён <code>$a</code> и <code>$b</code>, или присвоение имён, никак не связанных с конкретным использованием.<br/>
<br/>
<b>Помните</b>: ваши тесты — живые документы, пытающиеся объяснить, как должно вести себя ваше приложение. <code>assertFalse($a->canFly())</code> мало что документирует. А <code>assertFalse($personWithNoWings->canFly())</code> — уже достаточно много.<br/>
<br/>
<h3>3. Навязчиво прогоняйте тесты</h3><br/>
<b>Ценности</b>: учёба, быстрое получение обратной связи, рефакторинг.<br/>
<br/>
Прежде чем начать работу над фичей, запустите тесты. Если они сбоят до того, как вы принялись за дело, то вы узнаете об этом <i>до того</i>, как напишете код, и вам не придётся тратить драгоценные минуты на отладку сломанных тестов, о которых вы даже не беспокоились.<br/>
<br/>
После сохранения файла запустите тесты. Чем раньше вы узнаете о том, что что-то поломалось, тем быстрее исправите и двинетесь дальше. Если прерывание рабочего процесса для решения проблемы вам кажется непродуктивным, то представьте, что позднее вам придётся вернуться на много шагов назад, если вы не будете знать о возникшей проблеме.<br/>
<br/>
Поболтав пять минут с коллегами или проверив уведомления с Github, запустите тесты. Если они покраснели, то вы знаете, на чём остановились. Если тесты зелёные, можно работать дальше.<br/>
После любого рефакторинга, даже имён переменных, запустите тесты.<br/>
<br/>
Серьёзно, запускайте чёртовы тесты. Так же часто, как вы нажимаете кнопку «сохранить».<br/>
<a href="https://github.com/spatie/phpunit-watcher">PHPUnit Watcher</a> может делать это за вас, и даже отправлять уведомления!<br/>
<br/>
<h3>4. Большие тесты — большая ответственность</h3><br/>
<b>Ценности</b>: учёба, рефакторинг, проектирование в ходе тестирования.<br/>
<br/>
В идеале, каждый класс должен иметь один тест. Этот тест должен покрывать все публичные методы в этом классе, а также каждое условное выражение или оператор перехода…<br/>
<br/>
Можно считать примерно так:<br/>
<br/>
<ul>
<li>Один класс = один тестовый случай.<br/>
</li>
<li>Один метод = один или несколько тестов.<br/>
</li>
<li>Одна альтернативная ветка (if/switch/try-catch/exception) = один тест.<br/>
</li>
</ul><br/>
Так что для этого простого кода понадобится четыре теста:<br/>
<br/>
<pre><code class="php">// class Person
public function eatSlice(Pizza $pizza): void
{
  // test exception
  if ([] === $pizza->slices()) {
    throw new LogicException('...');
  }

  // test exception
  if (true === $this->isFull()) {
    throw new LogicException('...');
  }

  // test default path (slices = 1)
  $slices = 1;
  // test alternative path (slices = 2)
  if (true === $this->isVeryHungry()) {
    $slices = 2;
  }

  $pizza->removeSlices($slices);
}</code></pre><br/>
Чем больше у вас будет публичных методов, тем больше понадобится тестов.<br/>
<br/>
Никто не любит читать длинную документацию. Поскольку ваши тесты тоже документы, то маленький размер и осмысленность будут только увеличивать их качество и полезность.<br/>
<br/>
Также это важный сигнал о том, что ваш класс накапливает ответственности и пришло время отрефакторить его, перенеся ряд функций в другие классы, или перепроектировав систему.<br/>
<br/>
<h3>5. Поддерживайте набор тестов для решения проблем с регрессией</h3><br/>
<b>Ценности</b>: учёба, документирование, быстрое получение обратной связи.<br/>
<br/>
Рассмотрим функцию:<br/>
<br/>
<pre><code class="php">function findById(string $id): object
{
  return fromDb((int) $id);
}</code></pre><br/>
Вы думаете, что кто-то передаёт «10», но на самом деле передаётся «10 bananas». То есть приходят два значения, но одно лишнее. У вас баг.<br/>
<br/>
Что вы сделаете в первую очередь? Напишете тест, который обозначит такое поведение ошибочным!!!<br/>
<br/>
<pre><code class="php">public function testFindByIdAcceptsOnlyNumericIds(): void
{
  $this->expectException(InvalidArgumentException::class);
  $this->expectExceptionMessage(
    'Only numeric IDs are allowed.'
  );

  findById("10 bananas");
}</code></pre><br/>
Конечно, тесты ничего не передают. Но теперь вы знаете, что нужно сделать, чтобы они передавали. Исправьте ошибку, сделайте тесты зелёными, разверните приложение и будьте счастливы.<br/>
<br/>
Сохраните у себя этот тест. По возможности, в наборе тестов, предназначенных для решения проблем с регрессией.<br/>
<br/>
Вот и всё! Быстрое получение обратной связи, исправление багов, документирование, устойчивый к регрессии код и счастье.<br/>
<br/>
<h2>Заключительное слово</h2><br/>
Многое сказанное выше — лишь моё личное мнение, выработанное в течение карьеры. Это не значит, что советы верные или ошибочные, это просто мнение.</div></div></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="https://habr.com/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bphp%5D" class="tm-tags-list__link">php</a></li><li class="tm-separated-list__item"><a href="https://habr.com/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Btdd%5D" class="tm-tags-list__link">tdd</a></li><li class="tm-separated-list__item"><a href="https://habr.com/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bphpunit%5D" class="tm-tags-list__link">phpunit</a></li><li class="tm-separated-list__item"><a href="https://habr.com/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%BD%D0%B8%D0%BA%D1%82%D0%BE%20%D0%BD%D0%B5%20%D1%87%D0%B8%D1%82%D0%B0%D0%B5%D1%82%20%D1%82%D0%B5%D0%B3%D0%B8%5D" class="tm-tags-list__link">никто не читает теги</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="https://habr.com/ru/company/vk/blog/" class="tm-hubs-list__link router-link-active">
    Блог компании VK
  </a></li><li class="tm-separated-list__item"><a href="https://habr.com/ru/hub/it_testing/" class="tm-hubs-list__link">
    Тестирование IT-систем
  </a></li><li class="tm-separated-list__item"><a href="https://habr.com/ru/hub/php/" class="tm-hubs-list__link">
    PHP
  </a></li><li class="tm-separated-list__item"><a href="https://habr.com/ru/hub/complete_code/" class="tm-hubs-list__link">
    Совершенный код
  </a></li><li class="tm-separated-list__item"><a href="https://habr.com/ru/hub/web_testing/" class="tm-hubs-list__link">
    Тестирование веб-сервисов
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="24" width="24" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_appearance-article"><title>Всего голосов 35: ↑35 и ↓0</title> <use xlink:href="/img/megazord-v25.4b679db1.svg#counter-rating"></use></svg> <span title="Всего голосов 35: ↑35 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_appearance-article tm-votes-meter__value_rating">+35</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="24" width="24" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v25.4b679db1.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">21K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="24" width="24" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v25.4b679db1.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    148
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="tm-sharing__icon"><path fill="currentColor" d="M13.8 13.8V18l7.2-6.6L13.8 5v3.9C5 8.9 3 18.6 3 18.6c2.5-4.4 6-4.8 10.8-4.8z"></path></svg></button> <DIV class="v-portal" style="display:none;"></DIV></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <DIV class="v-portal" style="display:none;"></DIV> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"><div class="tm-article-author__company"><div class="tm-article-author__company-card"><div class="tm-company-snippet"><a href="https://habr.com/ru/company/vk/profile/" class="tm-company-snippet__logo-link"><div class="tm-entity-image"><img alt="" height="40" src="https://habrastorage.org/getpro/habr/company/9ed/c74/6b4/9edc746b484c805ecad1f941b5f7068a.png" width="40" class="tm-entity-image__pic"></div></a> <div class="tm-company-snippet__info"><a href="https://habr.com/ru/company/vk/profile/" class="tm-company-snippet__title">VK</a> <div class="tm-company-snippet__description">Технологии, которые объединяют</div></div></div> <div class="tm-article-author__buttons"><!----> <!----></div></div> <div class="tm-article-author__company-contacts"><a href="https://facebook.com/insidevk" rel="noopener" target="_blank" class="tm-article-author__contact">
      Facebook
    </a><a href="https://twitter.com/inside_vk" rel="noopener" target="_blank" class="tm-article-author__contact">
      Twitter
    </a><a href="https://vk.com/insidevk" rel="noopener" target="_blank" class="tm-article-author__contact">
      ВКонтакте
    </a><a href="https://instagram.com/inside.vk" rel="noopener" target="_blank" class="tm-article-author__contact">
      Instagram
    </a><a href="https://telegram.me/inside_vk" rel="noopener" target="_blank" class="tm-article-author__contact">
      Telegram
    </a></div> <div class="tm-article-author__separator"></div></div> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="https://habr.com/ru/users/AloneCoder/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><img alt="" src="https://habrastorage.org/getpro/habr/avatars/741/45e/bea/74145ebeab7f222cce402aed2683f9d7.png" class="tm-entity-image__pic"></div></a> <div class="tm-user-card__meta"><div title=" 575 голосов " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    359
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">0</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><span class="tm-user-card__name tm-user-card__name_variant-article">Макс</span> <a href="https://habr.com/ru/users/AloneCoder/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @AloneCoder
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">¯\_(ツ)_/¯</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <!----> <!----> <!----></div></div> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="https://habr.com/ru/company/vk/blog/485124/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="24" width="24" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v25.4b679db1.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 22 
    </span></a> <!----></div></div></div>  <!----> <!----> <!----> </div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__placeholder_initial"></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <section class="tm-block tm-block_spacing-bottom"><header class="tm-block__header"><h2 class="tm-block__title">Информация</h2> <!----></header> <div class="tm-block__body"><div class="tm-company-basic-info"><dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Дата основания</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap"><time datetime="1998-10-14T20:00:00.000Z" title="1998-10-15, 00:00">15  октября  1998</time></dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Местоположение</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap">
    Россия
  </dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Сайт</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap"><a href="https://vk.com/vkteam" target="_blank" class="tm-company-basic-info__link">
      vk.com
    </a></dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Численность</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap">
    5 001–10 000 человек
  </dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Дата регистрации</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap"><time datetime="2008-08-09T07:42:32.000Z" title="2008-08-09, 11:42">9  августа  2008</time></dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Представитель</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap"><a href="https://habr.com/ru/users/AnastasiaGutor/" class="tm-company-basic-info__link">
      Анастасия Гутор
    </a></dd></dl></div></div> <!----></section> <div class="tm-company-widgets"></div> <!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://habr.com/kek/v1/auth/habrahabr/?back=/ru/company/vk/blog/485124/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habr.com/kek/v1/auth/habrahabr-register/?back=/ru/company/vk/blog/485124/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://habr.com/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habr.com/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habr.com/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habr.com/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habr.com/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habr.com/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://habr.com/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habr.com/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habr.com/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habr.com/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habr.com/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="https://habr.com/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="https://habr.com/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="https://habr.com/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2022 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"485124":{"id":"485124","timePublished":"2020-01-23T09:55:24+00:00","isCorporative":true,"lang":"ru","titleHtml":"Чистые тесты на PHP и PHPUnit","leadData":{"textHtml":"\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fjx\u002F3y\u002Fzg\u002Fjx3yzg2jnznn0kwnk6oe6ikvlzw.jpeg\" width=\"400\"\u003E\u003C\u002Fdiv\u003E\u003Cbr\u003E\r\nВ экосистеме PHP существует много инструментов, обеспечивающих удобное тестирование на PHP. Одним из самых известных является \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fsebastianbergmann\u002Fphpunit\"\u003EPHPUnit\u003C\u002Fa\u003E, это почти синоним тестирования на этом языке. Однако о хороших методиках тестирования пишут не так много. Есть много вариантов, для чего и когда писать тесты, какого рода тесты, и так далее. Но, честно говоря, \u003Cb\u003Eне имеет смысла писать тест, если позднее вы не сможете его прочесть\u003C\u002Fb\u003E.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nТесты — это особая разновидность документации. Как \u003Ca href=\"https:\u002F\u002Fthephp.website\u002Fen\u002Fissue\u002Freal-life-tdd-php\u002F\"\u003Eя ранее писал о TDD на PHP\u003C\u002Fa\u003E, тест всегда будет (или хотя бы должен) ясно говорить о том, в чём заключается задача конкретной части кода.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nЕсли один тест не может выразить эту идею, то тест плохой.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nЯ подготовил набор методик, которые станут подспорьем для PHP-разработчиков в написании хороших, удобочитаемых и полезных тестов.\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"editorVersion":"1.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"Níckolas Da Silva","originalUrl":"https:\u002F\u002Fthephp.website\u002Fen\u002Fissue\u002Fclean-tests-with-php-and-phpunit\u002F"}},{"type":"tutorial","data":null}],"author":{"scoreStats":{"score":359,"votesCount":575},"rating":0,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"63394","alias":"AloneCoder","fullname":"Макс","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F741\u002F45e\u002Fbea\u002F74145ebeab7f222cce402aed2683f9d7.png","speciality":"¯\\_(ツ)_\u002F¯"},"statistics":{"commentsCount":22,"favoritesCount":148,"readingCount":21173,"score":35,"votesCount":35},"hubs":[{"relatedData":null,"id":"4992","alias":"vk","type":"corporative","title":"Блог компании VK","titleHtml":"Блог компании VK","isProfiled":false},{"relatedData":null,"id":"210","alias":"it_testing","type":"collective","title":"Тестирование IT-систем","titleHtml":"Тестирование IT-систем","isProfiled":true},{"relatedData":null,"id":"260","alias":"php","type":"collective","title":"PHP","titleHtml":"PHP","isProfiled":true},{"relatedData":null,"id":"524","alias":"complete_code","type":"collective","title":"Совершенный код","titleHtml":"Совершенный код","isProfiled":true},{"relatedData":null,"id":"19279","alias":"web_testing","type":"collective","title":"Тестирование веб-сервисов","titleHtml":"Тестирование веб-сервисов","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fjx\u002F3y\u002Fzg\u002Fjx3yzg2jnznn0kwnk6oe6ikvlzw.jpeg\" width=\"400\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fjx\u002F3y\u002Fzg\u002Fjx3yzg2jnznn0kwnk6oe6ikvlzw.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nВ экосистеме PHP существует много инструментов, обеспечивающих удобное тестирование на PHP. Одним из самых известных является \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fsebastianbergmann\u002Fphpunit\"\u003EPHPUnit\u003C\u002Fa\u003E, это почти синоним тестирования на этом языке. Однако о хороших методиках тестирования пишут не так много. Есть много вариантов, для чего и когда писать тесты, какого рода тесты, и так далее. Но, честно говоря, \u003Cb\u003Eне имеет смысла писать тест, если позднее вы не сможете его прочесть\u003C\u002Fb\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТесты — это особая разновидность документации. Как \u003Ca href=\"https:\u002F\u002Fthephp.website\u002Fen\u002Fissue\u002Freal-life-tdd-php\u002F\"\u003Eя ранее писал о TDD на PHP\u003C\u002Fa\u003E, тест всегда будет (или хотя бы должен) ясно говорить о том, в чём заключается задача конкретной части кода.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЕсли один тест не может выразить эту идею, то тест плохой.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЯ подготовил набор методик, которые станут подспорьем для PHP-разработчиков в написании хороших, удобочитаемых и полезных тестов.\u003Cbr\u002F\u003E\r\n\u003Ca name=\"habracut\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EНачнём с основ\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nЕсть набор стандартных методик, которым многие следуют без каких-либо вопросов. Многие из них я упомяну и попытаюсь объяснить, для чего они нужны.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003E1. Тесты не должны содержать операций ввода-вывода\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cb\u003EОсновная причина\u003C\u002Fb\u003E: операции ввода-вывода медленные и ненадёжные.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003EМедленные\u003C\u002Fb\u003E: даже если у вас самое лучшее в мире железо, операции ввода-вывода всё равно будут медленнее обращений к памяти. Тесты всегда должны работать быстро, иначе люди будут слишком редко их запускать.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003EНенадёжные\u003C\u002Fb\u003E: некоторые файлы, бинарники, сокеты, папки и DNS-записи могут быть недоступны на некоторых машинах, на которых вы проводите тестирование. Чем больше вы полагаетесь при тестировании на операции ввода-вывода, тем больше ваши тесты привязаны к инфраструктуре.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКакие операции относятся к вводу-выводу:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EЧтение и запись файлов.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003EСетевые вызовы.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003EВызовы внешних процессов (с помощью \u003Ccode\u003Eexec\u003C\u002Fcode\u003E, \u003Ccode\u003Eproc_open\u003C\u002Fcode\u003E и т.д.).\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\nБывают ситуации, когда наличие операций ввода-вывода позволяет писать тесты быстрее. Но будьте осторожны: проверьте, что такие операции работают одинаково на ваших машинах для разработки, сборки и развёртывания, иначе у вас могут возникнуть серьёзные проблемы.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИзолируйте тесты так, чтобы им не нужны были операции ввода-вывода: ниже я привёл архитектурное решение, которое предотвращает выполнение тестами операций ввода-вывода за счёт разделения ответственности между интерфейсами.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПример:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"php\"\u003Epublic function getPeople(): array\n{\n  $rawPeople = file_get_contents(\n    'people.json'\n  ) ?? '[]';\n\n  return json_decode(\n    $rawPeople,\n    true\n  );\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nПри начале тестирования с помощью этого метода будет создан локальный файл, и время от времени будут создаваться его снимки:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"php\"\u003Epublic function testGetPeopleReturnsPeopleList(): void\n{\n  $people = $this-\u003EpeopleService\n    -\u003EgetPeople();\n\n  \u002F\u002F assert it contains people\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nДля этого нам нужно настроить предварительные условия запуска тестов. На первый взгляд всё выглядит разумно, но на самом деле это ужасно.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПропуск теста из-за того, что не выполнены предварительные условия, не обеспечивает качество нашего ПО. Это лишь скроет баги!\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003EИсправляем ситуацию\u003C\u002Fb\u003E: изолируем операции ввода-вывода, переложив ответственность на интерфейс.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"php\"\u003E\u002F\u002F extract the fetching\n\u002F\u002F logic to a specialized\n\u002F\u002F interface\ninterface PeopleProvider\n{\n  public function getPeople(): array;\n}\n\n\u002F\u002F create a concrete implementation\nclass JsonFilePeopleProvider\n  implements PeopleProvider\n{\n  private const PEOPLE_JSON =\n    'people.json';\n\n  public function getPeople(): array\n  {\n    $rawPeople = file_get_contents(\n      self::PEOPLE_JSON\n    ) ?? '[]';\n\n    return json_decode(\n      $rawPeople,\n      true\n    );\n  }\n}\n\nclass PeopleService\n{\n  \u002F\u002F inject via __construct()\n  private PeopleProvider $peopleProvider;\n\n  public function getPeople(): array\n  {\n    return $this-\u003EpeopleProvider\n      -\u003EgetPeople();\n  }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nТеперь я знаю, что \u003Ccode\u003EJsonFilePeopleProvider\u003C\u002Fcode\u003E в любом случае будет использовать ввод-вывод.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВместо \u003Ccode\u003Efile_get_contents()\u003C\u002Fcode\u003E можно использовать слой абстракции вроде\u003Ca href=\"https:\u002F\u002Fflysystem.thephpleague.com\u002Fdocs\u002Fadapter\u002Flocal\u002F\"\u003E файловой системы Flysystem\u003C\u002Fa\u003E, для которой легко сделать заглушки.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nА тогда зачем нам \u003Ccode\u003EPeopleService\u003C\u002Fcode\u003E? Хороший вопрос. Для этого и нужны тесты: поставить архитектуру под сомнение и убрать бесполезный код.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003E2. Тесты должны быть осознанными и осмысленными\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cb\u003EОсновная причина\u003C\u002Fb\u003E: тесты — это разновидность документации. Поддерживайте их понятность, краткость и удобочитаемость.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003EПонятность и краткость\u003C\u002Fb\u003E: ни беспорядка, ни тысяч строк заглушек, ни последовательностей утверждений.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003EУдобочитаемость\u003C\u002Fb\u003E: тесты должны рассказывать историю. Для этого отлично подходит структура «дано, когда, тогда».\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nХарактеристики хорошего и удобочитаемого теста:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EСодержит только необходимые вызовы метода \u003Ccode\u003Eassert\u003C\u002Fcode\u003E (желательно один).\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003EОн очень понятно объясняет, что должно произойти при заданных условиях.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003EОн тестирует только одну ветку исполнения метода.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003EОн не делает заглушку для целой вселенной ради какого-то утверждения.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\nВажно отметить, что если ваша реализация содержит условные выражения, операторы перехода или циклы, то все они должны быть явно покрыты тестами. Например, чтобы ранние ответы всегда содержали тест.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПовторюсь: дело не в покрытии, а в документировании.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВот пример сбивающего с толку теста:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"php\"\u003Epublic function testCanFly(): void\n{\n  $noWings = new Person(0);\n  $this-\u003EassertEquals(\n    false,\n    $noWings-\u003EcanFly()\n  );\n\n  $singleWing = new Person(1);\n  $this-\u003EassertTrue(\n    !$singleWing-\u003EcanFly()\n  );\n\n  $twoWings = new Person(2);\n  $this-\u003EassertTrue(\n    $twoWings-\u003EcanFly()\n  );\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nДавайте адаптируем формат «дано, когда, тогда» и посмотрим, что получится:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"php\"\u003Epublic function testCanFly(): void\n{\n  \u002F\u002F Given\n  $person = $this-\u003EgivenAPersonHasNoWings();\n\n  \u002F\u002F Then\n  $this-\u003EassertEquals(\n    false,\n    $person-\u003EcanFly()\n  );\n\n  \u002F\u002F Further cases...\n}\n\nprivate function givenAPersonHasNoWings(): Person\n{\n  return new Person(0);\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nКак и раздел «дано» (Given), «когда» и «тогда» можно перенести в приватные методы. Это сделает ваш тест более удобочитаемым.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТеперь в \u003Ccode\u003EassertEquals\u003C\u002Fcode\u003E бессмысленный беспорядок. Читающий это человек должен проследить утверждение, чтобы понять, что оно означает.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИспользование конкретных утверждений сделает ваш тест гораздо удобочитаемее. \u003Ccode\u003EassertTrue()\u003C\u002Fcode\u003E должен получать булеву переменную, а не выражение вроде \u003Ccode\u003EcanFly() !== true\u003C\u002Fcode\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ предыдущем примере мы заменяем \u003Ccode\u003EassertEquals\u003C\u002Fcode\u003E между \u003Ccode\u003Efalse\u003C\u002Fcode\u003E и \u003Ccode\u003E$person-\u003EcanFly()\u003C\u002Fcode\u003E на простое \u003Ccode\u003EassertFalse\u003C\u002Fcode\u003E:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"php\"\u003E\u002F\u002F ...\n$person = $this-\u003EgivenAPersonHasNoWings();\n\n$this-\u003EassertFalse(\n  $person-\u003EcanFly()\n);\n\n\u002F\u002F Further cases...\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nТеперь всё предельно понятно! Если человек не имеет крыльев, он не должен уметь летать! Читается как стихотворение \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТеперь раздел «Further cases», который дважды появляется в нашем тексте, является ярким свидетельством того, что тест делает слишком много утверждений. При этом метод \u003Ccode\u003EtestCanFly()\u003C\u002Fcode\u003E совершенно бесполезен.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДавайте снова улучшим тест:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"php\"\u003Epublic function testCanFlyIsFalsyWhenPersonHasNoWings(): void\n{\n  $person = $this-\u003EgivenAPersonHasNoWings();\n  $this-\u003EassertFalse(\n    $person-\u003EcanFly()\n  );\n}\n\npublic function testCanFlyIsTruthyWhenPersonHasTwoWings(): void\n{\n  $person = $this-\u003EgivenAPersonHasTwoWings();\n  $this-\u003EassertTrue(\n    $person-\u003EcanFly()\n  );\n}\n\n\u002F\u002F ...\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nМожем даже переименовать тестирующий метод, чтобы он соответствовал реальному сценарию, например, в \u003Ccode\u003EtestPersonCantFlyWithoutWings\u003C\u002Fcode\u003E, но меня и так всё устраивает.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003E3. Тест не должен зависеть от других тестов\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cb\u003EОсновная причина\u003C\u002Fb\u003E: тесты должны запускаться и успешно выполняться в любом порядке.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЯ не вижу достаточных причин для создания взаимосвязей между тестами. Недавно меня попросили сделать тест функции входа в систему, приведу его здесь в качестве хорошего примера.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТест должен:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EСгенерировать JWT-токен для входа в систему.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003EВыполнить функцию входа.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003EУтвердить изменение состояния.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\nБыло так:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"php\"\u003Epublic function testGenerateJWTToken(): void\n{\n  \u002F\u002F ... $token\n  $this-\u003Etoken = $token;\n}\n\n\u002F\u002F @depends  testGenerateJWTToken\npublic function testExecuteAnAmazingFeature(): void\n{\n  \u002F\u002F Execute using $this-\u003Etoken\n}\n\n\u002F\u002F @depends  testExecuteAnAmazingFeature\npublic function testStateIsBlah(): void\n{\n  \u002F\u002F Poll for state changes on\n  \u002F\u002F Logged-in interface\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nЭто плохо по нескольким причинам:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EPHPUnit не может гарантировать такой порядок исполнения.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003EТесты должны уметь исполняться независимо.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003EПараллельные тесты могут сбоить случайным образом.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\nПростейший способ обойти это — использовать схему «дано, когда, тогда». Так тесты будут более продуманными, они будут рассказывать историю, явно демонстрируя свои зависимости, объясняя саму проверяемую функцию.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"php\"\u003Epublic function testAmazingFeatureChangesState(): void\n{\n  \u002F\u002F Given\n  $token = $this-\u003EgivenImAuthenticated();\n\n  \u002F\u002F When\n  $this-\u003EwhenIExecuteMyAmazingFeature(\n    $token\n  );\n  $newState = $this-\u003EpollStateFromInterface(\n    $token\n  );\n\n  \u002F\u002F Then\n  $this-\u003EassertEquals(\n    'my-state',\n    $newState\n  );\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nТакже нам понадобится добавить тесты для аутентификации и т. д. Эта структура так хороша, что в \u003Ca href=\"https:\u002F\u002Fbehat.org\u002Fen\u002Flatest\u002Fquick_start.html\"\u003EBehat используется по умолчанию\u003C\u002Fa\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003E4. Всегда внедряйте зависимости\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cb\u003EОсновная причина\u003C\u002Fb\u003E: очень дурной тон — создавать заглушку для глобального состояния. Отсутствие возможности создавать заглушки для зависимостей не позволяет тестировать функцию.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПолезный совет: \u003Cb\u003Eзабудьте o статичных stateful-классах и экземплярах синглтонов\u003C\u002Fb\u003E. Если ваш класс от чего-то зависит, то сделайте так, чтобы его можно было внедрять.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВот грустный пример:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"php\"\u003Eclass FeatureToggle\n{\n  public function isActive(\n    Id $feature\n  ): bool {\n    $cookieName = $feature-\u003EgetCookieName();\n\n    \u002F\u002F Early return if cookie\n    \u002F\u002F override is present\n    if (Cookies::exists(\n      $cookieName\n    )) {\n      return Cookies::get(\n        $cookieName\n      );\n    }\n\n    \u002F\u002F Evaluate feature toggle...\n  }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nКак можно протестировать этот ранний ответ?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВсё верно. Никак.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДля его тестирования нам нужно понимать поведение класса \u003Ccode\u003ECookies\u003C\u002Fcode\u003E и быть уверенными в том, что можем воспроизвести всё связанное с этим окружение, в результате получив определённые ответы.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНе делайте этого.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСитуацию можно исправить, если внедрить экземпляр \u003Ccode\u003ECookies\u003C\u002Fcode\u003E в качестве зависимости. Тест будет выглядеть так:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"php\"\u003E\u002F\u002F Test class...\nprivate Cookies $cookieMock;\n\nprivate FeatureToggle $service;\n\n\u002F\u002F Preparing our service and dependencies\npublic function setUp(): void\n{\n  $this-\u003EcookieMock = $this-\u003Eprophesize(\n    Cookies::class\n  );\n\n  $this-\u003Eservice = new FeatureToggle(\n    $this-\u003EcookieMock-\u003Ereveal()\n  );\n}\n\npublic function testIsActiveIsOverriddenByCookies(): void\n{\n  \u002F\u002F Given\n  $feature = $this-\u003EgivenFeatureXExists();\n\n  \u002F\u002F When\n  $this-\u003EwhenCookieOverridesFeatureWithTrue(\n    $feature\n  );\n\n  \u002F\u002F Then\n  $this-\u003EassertTrue(\n    $this-\u003Eservice-\u003EisActive($feature)\n  );\n  \u002F\u002F additionally we can assert\n  \u002F\u002F no other methods were called\n}\n\nprivate function givenFeatureXExists(): Id\n{\n  \u002F\u002F ...\n  return $feature;\n}\n\nprivate function whenCookieOverridesFeatureWithTrue(\n  Id $feature\n): void {\n  $cookieName = $feature-\u003EgetCookieName();\n  $this-\u003EcookieMock-\u003Eexists($cookieName)\n    -\u003EshouldBeCalledOnce()\n    -\u003EwillReturn(true);\n\n  $this-\u003EcookieMock-\u003Eget($cookieName)\n    -\u003EshouldBeCalledOnce()\n    -\u003EwillReturn(true);\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nТо же самое и с синглтонами. Так что если вы хотите сделать объект уникальным, то корректно сконфигурируйте ваш инъектор зависимостей, а не используйте (анти)паттерн «синглтон». Иначе будете писать методы, которые полезны лишь для случаев вроде \u003Ccode\u003Ereset()\u003C\u002Fcode\u003E или \u003Ccode\u003EsetInstance()\u003C\u002Fcode\u003E. На мой взгляд, это безумие.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСовершенно нормально менять архитектуру, чтобы облегчить тестирование! А создавать методы для облегчения тестирования — не нормально.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003E5. Никогда не тестируйте защищённые\u002Fприватные методы\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cb\u003EОсновная причина\u003C\u002Fb\u003E: они влияют на то, как мы тестируем функции, определяя сигнатуру поведения: при таком-то условии, когда я ввожу А, то ожидаю получить Б. \u003Cb\u003EПриватные\u002Fзащищённые методы не являются частью сигнатур функций\u003C\u002Fb\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЯ даже не хочу показывать способ «тестирования» приватных методов, но дам подсказку: вы можете это сделать только с помощью API \u003Ca href=\"https:\u002F\u002Fwww.php.net\u002Fmanual\u002Fen\u002Fbook.reflection.php\"\u003Ereflection\u003C\u002Fa\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВсегда как-нибудь наказывайте себя, когда задумываетесь об использовании reflection для тестирования приватных методов! Плохой, плохоооой разработчик!\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПо своему определению, приватные методы вызываются только изнутри. То есть они не доступны публично. Это означает, что вызывать подобные методы могут только публичные методы из того же класса.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003EЕсли вы протестировали все свои публичные методы, то вы также протестировали все приватные\u002Fзащищённые методы\u003C\u002Fb\u003E. Если это не так, то свободно удаляйте приватные\u002Fзащищённые методы, их всё-равно никто не использует.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EПродвинутые советы\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nНадеюсь, вы ещё не заскучали. Всё-таки про основы нужно было рассказать. Теперь поделюсь своим мнением о написании чистых тестов и решениях, влияющих на мой процесс разработки.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСамое важное, о чём я не забываю при написании тестов:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EУчёба.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003EБыстрое получение обратной связи.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003EДокументирование.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003EРефакторинг.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003EПроектирование в ходе тестирования.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Ch3\u003E1. Тесты в начале, а не в конце\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cb\u003EЦенности\u003C\u002Fb\u003E: учёба, быстрое получение обратной связи, документирование, рефакторинг, проектирование в ходе тестирования.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЭто основа всего. Важнейший аспект, включающий в себя все перечисленные ценности. Когда вы заранее пишете тесты, это помогает вам сначала понять, как должна быть структурирована схема «дано, когда, тогда». При этом вы сначала документируете, и, что ещё важнее, запоминаете и задаёте свои требования как самые важные аспекты.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСтранно слышать о том, чтобы писать тесты до реализации? А представьте, насколько странно реализовать что-то, а при тестировании выяснить, все ваши выражения «дано, когда, тогда» не имеют смысла.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТакже этот подход позволит проверять ваши ожидания каждые две секунды. Вы получаете обратную связь максимально быстро. Вне зависимости от того, насколько большой или маленькой выглядит фича.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗелёные тесты — идеальная область для рефакторинга. Главная мысль: нет тестов — нет рефакторинга. Рефакторинг без тестов просто опасен.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНаконец, задав структуру «дано, когда, тогда», вам станет очевидно, какие интерфейсы должны быть у ваших методов и как они должны себя вести. Соблюдение чистоты теста также заставит вас постоянно принимать разные архитектурные решения. Это заставит вас создавать фабрики, интерфейсы, нарушать наследования и т. д. И да, тестировать станет легче!\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЕсли ваши тесты — это живые документы, объясняющие работу приложения, то крайне важно, чтобы они делали это понятно.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003E2. Лучше без тестов, чем с плохими тестами\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cb\u003EЦенности\u003C\u002Fb\u003E: учёба, документирование, рефакторинг.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nМногие разработчики думают о тестах так: напишу фичу, буду гонять фреймворк для тестирования до тех пор, пока тесты не покроют определённое количество новых строк, и отправлю в эксплуатацию.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nМне кажется, нужно уделять больше внимания ситуации, когда новый разработчик начинает работать с этой фичей. \u003Cb\u003EО чём расскажут тесты этому человеку?\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТесты часто сбивают с толку, если наименования недостаточно подробны. Что понятнее: \u003Ccode\u003EtestCanFly \u003C\u002Fcode\u003Eили \u003Ccode\u003EtestCanFlyReturnsFalseWhenPersonHasNoWings\u003C\u002Fcode\u003E?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЕсли ваши тесты представляют собой всего лишь беспорядочный код, который заставляет фреймворк покрывать больше строк, с примерами, которые не имеют смысла, то пришло время остановиться и подумать, стоит ли вообще писать эти тесты.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДаже такие глупости, как присвоение переменным имён \u003Ccode\u003E$a\u003C\u002Fcode\u003E и \u003Ccode\u003E$b\u003C\u002Fcode\u003E, или присвоение имён, никак не связанных с конкретным использованием.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003EПомните\u003C\u002Fb\u003E: ваши тесты — живые документы, пытающиеся объяснить, как должно вести себя ваше приложение. \u003Ccode\u003EassertFalse($a-\u003EcanFly())\u003C\u002Fcode\u003E мало что документирует. А \u003Ccode\u003EassertFalse($personWithNoWings-\u003EcanFly())\u003C\u002Fcode\u003E — уже достаточно много.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003E3. Навязчиво прогоняйте тесты\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cb\u003EЦенности\u003C\u002Fb\u003E: учёба, быстрое получение обратной связи, рефакторинг.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПрежде чем начать работу над фичей, запустите тесты. Если они сбоят до того, как вы принялись за дело, то вы узнаете об этом \u003Ci\u003Eдо того\u003C\u002Fi\u003E, как напишете код, и вам не придётся тратить драгоценные минуты на отладку сломанных тестов, о которых вы даже не беспокоились.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПосле сохранения файла запустите тесты. Чем раньше вы узнаете о том, что что-то поломалось, тем быстрее исправите и двинетесь дальше. Если прерывание рабочего процесса для решения проблемы вам кажется непродуктивным, то представьте, что позднее вам придётся вернуться на много шагов назад, если вы не будете знать о возникшей проблеме.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПоболтав пять минут с коллегами или проверив уведомления с Github, запустите тесты. Если они покраснели, то вы знаете, на чём остановились. Если тесты зелёные, можно работать дальше.\u003Cbr\u002F\u003E\r\nПосле любого рефакторинга, даже имён переменных, запустите тесты.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСерьёзно, запускайте чёртовы тесты. Так же часто, как вы нажимаете кнопку «сохранить».\u003Cbr\u002F\u003E\r\n\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fspatie\u002Fphpunit-watcher\"\u003EPHPUnit Watcher\u003C\u002Fa\u003E может делать это за вас, и даже отправлять уведомления!\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003E4. Большие тесты — большая ответственность\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cb\u003EЦенности\u003C\u002Fb\u003E: учёба, рефакторинг, проектирование в ходе тестирования.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ идеале, каждый класс должен иметь один тест. Этот тест должен покрывать все публичные методы в этом классе, а также каждое условное выражение или оператор перехода…\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nМожно считать примерно так:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EОдин класс = один тестовый случай.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003EОдин метод = один или несколько тестов.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003EОдна альтернативная ветка (if\u002Fswitch\u002Ftry-catch\u002Fexception) = один тест.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\nТак что для этого простого кода понадобится четыре теста:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"php\"\u003E\u002F\u002F class Person\npublic function eatSlice(Pizza $pizza): void\n{\n  \u002F\u002F test exception\n  if ([] === $pizza-\u003Eslices()) {\n    throw new LogicException('...');\n  }\n\n  \u002F\u002F test exception\n  if (true === $this-\u003EisFull()) {\n    throw new LogicException('...');\n  }\n\n  \u002F\u002F test default path (slices = 1)\n  $slices = 1;\n  \u002F\u002F test alternative path (slices = 2)\n  if (true === $this-\u003EisVeryHungry()) {\n    $slices = 2;\n  }\n\n  $pizza-\u003EremoveSlices($slices);\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nЧем больше у вас будет публичных методов, тем больше понадобится тестов.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНикто не любит читать длинную документацию. Поскольку ваши тесты тоже документы, то маленький размер и осмысленность будут только увеличивать их качество и полезность.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТакже это важный сигнал о том, что ваш класс накапливает ответственности и пришло время отрефакторить его, перенеся ряд функций в другие классы, или перепроектировав систему.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003E5. Поддерживайте набор тестов для решения проблем с регрессией\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cb\u003EЦенности\u003C\u002Fb\u003E: учёба, документирование, быстрое получение обратной связи.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nРассмотрим функцию:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"php\"\u003Efunction findById(string $id): object\n{\n  return fromDb((int) $id);\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nВы думаете, что кто-то передаёт «10», но на самом деле передаётся «10 bananas». То есть приходят два значения, но одно лишнее. У вас баг.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЧто вы сделаете в первую очередь? Напишете тест, который обозначит такое поведение ошибочным!!!\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"php\"\u003Epublic function testFindByIdAcceptsOnlyNumericIds(): void\n{\n  $this-\u003EexpectException(InvalidArgumentException::class);\n  $this-\u003EexpectExceptionMessage(\n    'Only numeric IDs are allowed.'\n  );\n\n  findById(\"10 bananas\");\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nКонечно, тесты ничего не передают. Но теперь вы знаете, что нужно сделать, чтобы они передавали. Исправьте ошибку, сделайте тесты зелёными, разверните приложение и будьте счастливы.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСохраните у себя этот тест. По возможности, в наборе тестов, предназначенных для решения проблем с регрессией.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВот и всё! Быстрое получение обратной связи, исправление багов, документирование, устойчивый к регрессии код и счастье.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EЗаключительное слово\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nМногое сказанное выше — лишь моё личное мнение, выработанное в течение карьеры. Это не значит, что советы верные или ошибочные, это просто мнение.\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"php"},{"titleHtml":"tdd"},{"titleHtml":"phpunit"},{"titleHtml":"никто не читает теги"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fjx\u002F3y\u002Fzg\u002Fjx3yzg2jnznn0kwnk6oe6ikvlzw.jpeg","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fjx\u002F3y\u002Fzg\u002Fjx3yzg2jnznn0kwnk6oe6ikvlzw.jpeg","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fcompany\\\u002Fvk\\\u002Fblog\\\u002F485124\\\u002F\"},\"headline\":\"Чистые тесты на PHP и PHPUnit\",\"datePublished\":\"2020-01-23T12:55:24+03:00\",\"dateModified\":\"2020-02-26T12:19:55+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Макс\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"В экосистеме PHP существует много инструментов, обеспечивающих удобное тестирование на PHP. Одним из самых известных является PHPUnit, это почти синоним тестиро...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fcompany\\\u002Fvk\\\u002Fblog\\\u002F485124\\\u002F#post-content-body\",\"about\":[\"c_vk\",\"h_it_testing\",\"h_php\",\"h_complete_code\",\"h_web_testing\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F485124\\\u002Fe4b7608d22fd88d38bca54f44f0569a7\\\u002F\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fjx\\\u002F3y\\\u002Fzg\\\u002Fjx3yzg2jnznn0kwnk6oe6ikvlzw.jpeg\"]}","metaDescription":"В экосистеме PHP существует много инструментов, обеспечивающих удобное тестирование на PHP. Одним из самых известных является PHPUnit, это почти синоним тестирования на этом языке. Однако о хороших...","mainImageUrl":null,"amp":false,"customTrackerLinks":[]},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":""},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{"vk":{"alias":"vk","imageUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fcompany\u002F9ed\u002Fc74\u002F6b4\u002F9edc746b484c805ecad1f941b5f7068a.png","titleHtml":"VK","descriptionHtml":"Технологии, которые объединяют","relatedData":null,"statistics":{"postsCount":2278,"newsCount":165,"vacanciesCount":122,"employeesCount":700,"careerRating":4.35,"subscribersCount":134521,"rating":266.34,"invest":null},"foundationDate":{"year":"1998","month":"10","day":"15"},"location":{"city":{"id":"447159","title":"Москва"},"region":{"id":"1885","title":"Москва и Московская обл."},"country":{"id":"168","title":"Россия"}},"siteUrl":"https:\u002F\u002Fvk.com\u002Fvkteam","staffNumber":"5 001–10 000 человек","registrationDate":"2008-08-09T07:42:32+00:00","representativeUser":{"alias":"AnastasiaGutor","fullname":"Анастасия Гутор"},"contacts":[{"title":"Facebook","url":"https:\u002F\u002Ffacebook.com\u002Finsidevk"},{"title":"Twitter","url":"https:\u002F\u002Ftwitter.com\u002Finside_vk"},{"title":"ВКонтакте","url":"https:\u002F\u002Fvk.com\u002Finsidevk"},{"title":"Instagram","url":"https:\u002F\u002Finstagram.com\u002Finside.vk"},{"title":"Telegram","url":"https:\u002F\u002Ftelegram.me\u002Finside_vk"}],"settings":{"analyticsSettings":[{"type":"ga","trackingId":"UA-16546458-6"}],"branding":{"imageUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fbranding\u002F174\u002F2c4\u002F3a5\u002F1742c43a5b504987a0fadf577a0bd4de.png","linkUrl":"https:\u002F\u002Fvk.com\u002Fvkteam","pixelUrl":null},"status":"active","isStartup":false},"metadata":{"titleHtml":"VK, Москва - Технологии, которые объединяют с 15 октября 1998 г.","title":"VK, Москва - Технологии, которые объединяют с 15 октября 1998 г.","keywords":["DevOps","Облачные вычисления","Облачные сервисы","Kubernetes","Программирование","mail.ru","никто не читает теги","mail.ru cloud solutions","tarantool","mail.ru group","python","kubernetes","geekbrains","php","продуктовый дизайн","разработка","пользовательские интерфейсы","javascript","вконтакте","meetup","machine learning","машинное обучение","go","devops","android"],"descriptionHtml":"2 278 статей от авторов компании VK","description":"2 278 статей от авторов компании VK"},"aDeskSettings":null,"careerAlias":"vk"}},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{},"workplaceInfo":null},"companyAdmin":{"companyInfo":null,"companyInfoLoading":false,"faqArticles":null,"brandingPreviewImageUrl":null},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"promoData":{"isLoading":false,"hasLoaded":true,"featurer":[{"title":"Питчи недели фронтендеров","gal":"pitch_ft_2022_1","image":{"url":"https:\u002F\u002Feffect.habr.com\u002Fa\u002F74-21PvljXozmZ5-5WkAQcAgcStiFNZQWw3rjqBsFcCevYZl1V8vPq9aU9cwkedUnKys7TmIZtQbS67zTt3V6Av2PsM1E4qalITrCuRSmzj-OH2qd5A5NvFclZMOVGngfrw9SXDYec5zmWpeFsuyTnGi8TWfosQQJ5l-as_zGtNJjV3xJSz9SYu1Wr2lTBuwXJsBtQlS9u0T_BPEyzFHgDenXiVgBcbV"},"link":{"url":"https:\u002F\u002Feffect.habr.com\u002Fa\u002F3d5-RjU3SQomUbNVM4Wag5CATNYzkT1oFmatDJeOfmothd-6EryRuNw9Zkxp9L7CvdFw6eaT7nm744CkEeUjuuRqgkLb-Oebd-nff-D7p8uwvnKB1vGuNj8HyxIznSRSQUkOiA8V"}}],"megaposts":[{"title":"Как меняется оплата проезда","color":"#99ffa7","link":{"url":"https:\u002F\u002Feffect.habr.com\u002Fa\u002FDQoLcry_TqYbBzMYKPRELpAT2x_mifL-5pVlHqUlPzq76OWSVU9_LxzlllNUuo3SkwqHlYutnV7vPyG_fC8eiNnn0uAV31hCxu8ARcovxZq6V3R7dVX88nM"},"events":{"view":"2BzmGMCb--OE-C9XjHpER6NDtFNAy8diHXJYV-5PBO6C7__CEawKFnuktwbAVyehV6A4XXbdj9R-nw"}}],"promoLinks":[{"title":"А как прошел ваш 2021? Исследуем рынок труда в IT, строим тренды и ищем аномалии","label":"Промо","external":true,"link":{"url":"https:\u002F\u002Feffect.habr.com\u002Fa\u002F5BcTZ1MQsjRjB846NgeOYzKBSsb-1AARgnA-PcnwEw5Wn1qcsVa9Z7INHFjMAgXKVjKwkxPJblo7N7Mpg3oeCSLYDukDOmtH2nJezxYJE7VOxNgBECQfJ9ZABT7pk_dtkbBIYVy7AoDfQFk8MJjfc2EMcYvHJJc"},"events":{"view":"3oGDaxYmM6xojkNxsO4aqr47mE3HMoj5FgzaPCGEsyuHVsRkAbM5NVIN96dWJjUs_Io5hOIt-4mlbQ"}},{"title":"Как НСПК меняет систему оплаты на городском транспорте в РФ","label":"Мегапост","external":false,"link":{"url":"https:\u002F\u002Feffect.habr.com\u002Fa\u002Fw9Q_bk4rlKvhBndv_fQ1iTV9YFB6ZQ6g-AFl8TJlgB5NrTfl8vzBiKiU5SVRKU2PnMqcBrqXXTaGoG652IVNjuxuh1no4YCSnM_DixGej3-SfYPZpoDaY-w"},"events":{"view":"MPAHYogLGlbDnEyWYG4rnRANpvwsUO3x_FhCh3DoecgFgH92n5SmtkL3ZIgewCcn7BnwptjN0lOh6g"}}],"promoPosts":[{"title":"Фронтенд-неделя на Хабр Карьере","label":"Событие","external":false,"image":{"url":"https:\u002F\u002Feffect.habr.com\u002Fa\u002FlL-3H5M0LNIG6yUvMFjNA4K6uD9PjU-3QtGg6hEx2NCqdWrc9Wk7CqAPJbxUYWlxPKIRVrfgu1HuEMtIwLj861WPIlibGLlJlB-mP1yRugWNVENVOG5CL1EMEsb7Zcfwy49TaOvK8vcXAMq3j0EcvGYST-JdE0fsKXNXVTN8i5-QYvJ4_rQRvGbtBuJWJkEo3le1sqPH0HfCJeAf8xBG"},"link":{"url":"https:\u002F\u002Feffect.habr.com\u002Fa\u002FAoBXZkKcVyXYMDZRN4VW4aH52R9d-1vj3pF_oDCSyJXlIpmh2N0qQi4hyxAVIW-Qe1kU0I2sP7sLda-S1skrJsO6wjBUGJxnMrbZX6VlBlhTpWlJjQomm68C86sK-MELf7XNKE4XTCQieQ"}},{"title":"Хотите рассказать о себе в наших социальных сетях?","label":"Опрос","external":true,"image":{"url":"https:\u002F\u002Feffect.habr.com\u002Fa\u002Fuhm7Xj82N-gn9g0DVxGmbyM8WP2Zd0Al4cIYehzor_yQIsJLz2ncIuePZKjVi574d44Ho98Yk6bxByJAV0rL3Ti9FAd4oI8MFaIUhCfoH5BXMt0vH0A4Fs4a5zKQUxGjW8FDvhO3D9GNmtqn9s0P9DgznRN4Psah_kALg-sbDz9-gJuNVyMCvE4KsZqXxHzSDHbAbA"},"link":{"url":"https:\u002F\u002Feffect.habr.com\u002Fa\u002F2K8GuvEMJle35ZAxB1ti6tn_jL_z6iuUvGL7DNvoIl7dwD0ETbgmyjcOEVvUqReWU4W3l7jRbgdZry5HZqb7Dkaa3D_dMN0lddsg3ZpQQy1e8klT8j21JmAsCPlY_zoOIZ1Pm0eaeCAElZbHdk4u"}},{"title":"Карта «Мир» как проездной: разбор","label":"Мегапост","external":false,"image":{"url":"https:\u002F\u002Feffect.habr.com\u002Fa\u002FTICpfkkR8ILzBEMaxqq1jTG2pshQ-BjlUBnf8QJY6A7JX3ihklRaLMVJlDpT5YiXAhZV3q8xbzs29_xeG7Z9Mb7Se3ojRPvtePv4JwJKtrO6yR2IKS66WVnsUQsIg-Uf0o9UTvKmq93aCwNm0qav3tkx2ulNordABiJRfBccFVJyh5FKo9xUDtlAHJtQpM2pzqAGJZAxAAb_JuUF"},"link":{"url":"https:\u002F\u002Feffect.habr.com\u002Fa\u002FwCpc-USVFEHpB75dH286CKa4DPpQLf8AgaixbiDOLiatkGWzRZmQyc1RNzSKYtkbL6mquxCr1pGE7MIyR2o_WKolbMU1ms1eAYvhBAWxa2jHT7hTQTqnFWXI1w"}}]},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"search":{"searchQueryError":null},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"technotext":{"nominationsList":[]},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"userSpecialization":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.da6c6b36.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.92df6f6d.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
<script src="https://habr.com/js/ads.js" onload="window['zhY4i4nJ9K'] = true"></script>
</body>
</html>
