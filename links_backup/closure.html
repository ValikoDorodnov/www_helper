<!DOCTYPE html><html lang="ru" data-theme-enabled="1"><head><script>window.currentUser = null;</script><script>window.rateUsdToNative = 98.8745;</script><title itemprop="name">Замыкание</title><link href="https://learn.javascript.ru/pack/styles.151c2ad2b575d09af8f5.css" rel="stylesheet"><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes, minimum-scale=1.0"><meta name="apple-mobile-web-app-capable" content="yes"><!-- chrome autotranslate is enabled only for "en" main version--><meta name="google" content="notranslate"><script>if (window.devicePixelRatio > 1) document.cookie = 'pixelRatio=' + window.devicePixelRatio + ';path=/;expires=Tue, 19 Jan 2038 03:14:07 GMT';</script><link href="https://fonts.googleapis.com/css?family=Open+Sans:bold,italic,bolditalic" rel="stylesheet"><link rel="apple-touch-icon-precomposed" href="https://learn.javascript.ru/img/favicon/apple-touch-icon-precomposed.png"><link rel="canonical" href="closure.html"><meta name="msapplication-TileColor" content="#222A2C"><meta name="msapplication-TileImage" content="/img/favicon/tileicon.png"><link rel="icon" href="https://learn.javascript.ru/img/favicon/favicon.png"><meta itemprop="image" content="https://learn.javascript.ru/img/site_preview_ru_512x512.png"><meta property="og:title" content="Замыкание"><meta property="og:image" content="https://learn.javascript.ru/img/site_preview_ru_1200x630.png"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="fb:admins" content="100001562528165"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Замыкание"><meta name="twitter:site" content="@iliakan"><meta name="twitter:creator" content="@iliakan"><meta name="twitter:image" content="https://learn.javascript.ru/img/site_preview_ru_512x512.png"><link rel="prev" href="https://learn.javascript.ru/rest-parameters-spread-operator"><link rel="next" href="https://learn.javascript.ru/var"><script>window.GA_ID = "UA-2056213-16";</script><script>window.GTM_ID = 'GTM-WD2DZPG'</script><script>window.YANDEX_METRIKA_ID = 17649010;</script><script>window.GoogleAnalyticsObject="ga",window.ga=function(){window.ga.q.push(arguments)},window.ga.q=[],window.ga.l=Date.now(),ga("create",GA_ID,"auto"),window.GTM_ID&&ga("require",GTM_ID),window.currentUser?ga("set","&uid",currentUser.id):ga("set","anonymizeIp",!0),window.addEventListener("error",function(e){var r=(e.filename||e.errorUrl)+": "+(e.lineno||e.errorLine),n=e.stack||e.error&&e.error.stack;ga("send","exception",{exDescription:e.message+" "+r+" "+n,exFatal:!0})});</script><script src="https://www.google-analytics.com/analytics.js" async></script><script>ga('send', 'pageview');</script><script>window.metrika={reachGoal:function(){}},window.yandex_metrika_callbacks=[function(){try{window.metrika=new Ya.Metrika({id:YANDEX_METRIKA_ID,webvisor:!0,clickmap:!0,params:{user:window.currentUser&&window.currentUser.id}}),metrika.trackLinks({delay:150}),window.addEventListener("error",function(r){window.metrika.reachGoal("JSERROR",{src:(r.filename||r.errorUrl)+": "+(r.lineno||r.errorLine),stack:r.stack||r.error&&r.error.stack,message:r.message})})}catch(r){}}];</script><script src="https://mc.yandex.ru/metrika/watch.js" async></script><script>window.RECAPTCHA_ID = "6LfmLAEVAAAAAJMykMnf7aY8nkyTRmYi2ynx51R1";</script><script src="https://learn.javascript.ru/pack/init.f43ee4b37d6f76e4f838.js"></script><script src="https://learn.javascript.ru/pack/head.9546f64faccf13e736f6.js" defer></script><meta property="og:title" content="Замыкание"><meta property="og:type" content="article"><script src="https://learn.javascript.ru/pack/tutorial.f792acb067a354bc7904.js" defer></script><script src="https://learn.javascript.ru/pack/footer.440ca4f81c63a09affe0.js" defer></script></head><body class="no-icons"><script>window.fontTest();</script><div class="page-wrapper page-wrapper_sidebar_on"><!--[if IE]><div style="color:red;text-align:center">Извините, Internet Explorer не поддерживается, пожалуйста используйте более новый браузер.</div><![endif]--><div class="sitetoolbar sitetoolbar_tutorial"><script>window.langs = [{"code":"ar","name":"Arabic"},{"code":"az","name":"Azerbaijani"},{"code":"bg","name":"Bulgarian"},{"code":"bn","name":"Bengali"},{"code":"bs","name":"Bosnian"},{"code":"ca","name":"Catalan"},{"code":"cs","name":"Czech"},{"code":"da","name":"Danish"},{"code":"de","name":"German"},{"code":"el","name":"Greek"},{"code":"en","name":"English"},{"code":"es","name":"Spanish"},{"code":"fa","name":"Persian (Farsi)"},{"code":"fi","name":"Finnish"},{"code":"fr","name":"French"},{"code":"he","name":"Hebrew"},{"code":"hi","name":"Hindi"},{"code":"hr","name":"Croatian"},{"code":"hu","name":"Hungarian"},{"code":"hy","name":"Armenian"},{"code":"id","name":"Indonesian"},{"code":"it","name":"Italian"},{"code":"ja","name":"Japanese"},{"code":"ka","name":"Georgian"},{"code":"kk","name":"Kazakh"},{"code":"km","name":"Central Khmer"},{"code":"ko","name":"Korean"},{"code":"lt","name":"Lithuanian"},{"code":"me","name":"Montenegrin"},{"code":"ml","name":"Malayalam"},{"code":"my","name":"Burmese"},{"code":"nl","name":"Dutch"},{"code":"no","name":"Norvegian"},{"code":"pa","name":"Punjabi"},{"code":"pl","name":"Polish"},{"code":"pt","name":"Portuguese"},{"code":"ro","name":"Romanian"},{"code":"ru","name":"Russian"},{"code":"si","name":"Sinhala"},{"code":"sk","name":"Slovak"},{"code":"sl","name":"Slovenian"},{"code":"sq","name":"Albanian"},{"code":"sr","name":"Serbian"},{"code":"ta","name":"Tamil"},{"code":"te","name":"Telugu"},{"code":"test","name":"Test"},{"code":"th","name":"Thai"},{"code":"tk","name":"Turkmen"},{"code":"tr","name":"Turkish"},{"code":"uk","name":"Ukrainian"},{"code":"ur","name":"Urdu"},{"code":"uz","name":"Uzbek"},{"code":"v2","name":"v2"},{"code":"vi","name":"Vietnamese"},{"code":"zh-hant","name":"Chinese Traditional"},{"code":"zh","name":"Chinese"}];</script><script>window.lang = "ru";</script><script>{let t=navigator.languages||[];t=t.map(t=>t.toLowerCase());let o,i,n=[];for(let o of window.langs)for(let i of t)if(i===o.code||i.startsWith(o.code+"-")){n.push(o);break}if(!o&&"ru"!=lang&&"en"!=lang){n.find(t=>"en"==t.code)&&(o=`\n            According to your browser headers, you know English. Please help to <a href="https://github.com/javascript-tutorial/${lang}.javascript.info#readme">translate the tutorial</a>.\n            Thank you!\n          `,i="notify-translate-tutorial-local")}if(o){let t=`<div class="notification notification_top notification_info sitetoolbar__notification" style="display:none" id="${i}">\n          <div class="notification__content">${o}</div>\n          <button class="notification__close" title="Close"></button>\n        </div>`;document.write(t),showTopNotification()}}</script><div class="sitetoolbar__content"><div class="sitetoolbar__lang-switcher"><button class="sitetoolbar__dropdown-button" data-dropdown-toggler>RU</button><div class="sitetoolbar__dropdown-wrap"><div class="sitetoolbar__dropdown-body"><div class="sitetoolbar__lang-switcher-body"><div class="supported-langs supported-langs_toolbar"><div class="supported-langs__container"><ul class="supported-langs__list" style="height:200px"><li class="supported-langs__item"><a class="supported-langs__link" href="https://ar.javascript.info/closure"><span class="supported-langs__brief">AR</span><span class="supported-langs__title">عربي</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://javascript.info/closure"><span class="supported-langs__brief">EN</span><span class="supported-langs__title">English</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://es.javascript.info/closure"><span class="supported-langs__brief">ES</span><span class="supported-langs__title">Español</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://fr.javascript.info/closure"><span class="supported-langs__brief">FR</span><span class="supported-langs__title">Français</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://id.javascript.info/closure"><span class="supported-langs__brief">ID</span><span class="supported-langs__title">Indonesia</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://it.javascript.info/closure"><span class="supported-langs__brief">IT</span><span class="supported-langs__title">Italiano</span></a></li></ul><ul class="supported-langs__list" style="height:200px"><li class="supported-langs__item"><a class="supported-langs__link" href="https://ja.javascript.info/closure"><span class="supported-langs__brief">JA</span><span class="supported-langs__title">日本語</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://ko.javascript.info/closure"><span class="supported-langs__brief">KO</span><span class="supported-langs__title">한국어</span></a></li><li class="supported-langs__item supported-langs__item_current"><a class="supported-langs__link" href="closure.html"><span class="supported-langs__brief">RU</span><span class="supported-langs__title">Русский</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://tr.javascript.info/closure"><span class="supported-langs__brief">TR</span><span class="supported-langs__title">Türkçe</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://uk.javascript.info/closure"><span class="supported-langs__brief">UK</span><span class="supported-langs__title">Українська</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://zh.javascript.info/closure"><span class="supported-langs__brief">ZH</span><span class="supported-langs__title">简体中文</span></a></li></ul></div><div class="supported-langs__text">Мы хотим сделать этот проект с открытым исходным кодом доступным для людей во всем мире. Пожалуйста, <a href="https://github.com/javascript-tutorial/translate" rel="noopener noreferrer" target="_blank">помогите нам перевести</a> это руководство на свой язык</div></div></div></div></div></div><div class="sitetoolbar__logo-wrap"><a class="sitetoolbar__link sitetoolbar__link_logo" href="https://learn.javascript.ru/"><img class="sitetoolbar__logo sitetoolbar__logo_normal" src="https://learn.javascript.ru/img/sitetoolbar__logo_ru.svg" width="171" alt="" role="presentation"/><img class="sitetoolbar__logo sitetoolbar__logo_normal sitetoolbar__logo_dark" src="https://learn.javascript.ru/img/sitetoolbar__logo_ru-white.svg" width="171" alt="" role="presentation"/><img class="sitetoolbar__logo sitetoolbar__logo_small" src="https://learn.javascript.ru/img/sitetoolbar__logo_small_ru.svg" width="80" alt="" role="presentation"/><img class="sitetoolbar__logo sitetoolbar__logo_small sitetoolbar__logo_dark" src="https://learn.javascript.ru/img/sitetoolbar__logo_small_ru-white.svg" width="80" alt="" role="presentation"/><script>Array.prototype.forEach.call(document.querySelectorAll("img.sitetoolbar__logo"),function(e){let t=document.createElement("object");t.type="image/svg+xml",t.className=e.className,t.style.cssText="left:0;top:0;position:absolute",t.onload=function(){t.onload=null,e.style.visibility="hidden"},t.data=e.src,e.parentNode.insertBefore(t,e)});</script></a></div><div class="sitetoolbar__nav-toggle-wrap"><button class="sitetoolbar__nav-toggle" type="button"></button></div><nav class="sitetoolbar__sections"><ul class="sitetoolbar__sections-list"><li class="sitetoolbar__section sitetoolbar__section_current"><a class="sitetoolbar__link" href="https://learn.javascript.ru/">Учебник</a></li><li class="sitetoolbar__section"><a class="sitetoolbar__link" href="https://learn.javascript.ru/courses">Курсы</a></li><li class="sitetoolbar__section"><a class="sitetoolbar__link" href="https://javascript.ru/forum/">Форум</a></li><li class="sitetoolbar__section"><a class="sitetoolbar__link" href="https://learn.javascript.ru/quiz">Тесты знаний</a></li><li class="sitetoolbar__section sitetoolbar__section_dropdown"><button class="sitetoolbar__dropdown-button" data-dropdown-toggler>Скринкасты</button><div class="sitetoolbar__dropdown-wrap"><div class="sitetoolbar__dropdown-body"><ul class="sitetoolbar__dropdown-items"><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="https://learn.javascript.ru/screencast/nodejs">Node.js</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="https://learn.javascript.ru/screencast/webpack">Webpack</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="https://learn.javascript.ru/screencast/gulp">Gulp</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="https://learn.javascript.ru/screencast/react">React.js</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="https://learn.javascript.ru/screencast/angular">Angular</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="https://youtu.be/W4hoc24K93E?list=PLDyvV36pndZFHXjXuwA_NywNrVQO0aQqb">Git: курс</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="https://youtu.be/lHacJuru1bc?list=PLDyvV36pndZEB7kWWocU4QSn-G78LoaEE">Git: разное</a></li></ul></div></div></li></ul></nav><div class="sitetoolbar__book-wrap"><a class="buy-book-button" href="https://learn.javascript.ru/ebook"><span class="buy-book-button__extra-text">Купить</span>EPUB/PDF</a></div><div class="sitetoolbar__login-wrap"><button class="sitetoolbar__login sitetoolbar__login_unready" data-action-login></button></div><div class="sitetoolbar__theme-switcher"><div class="theme-changer"><label class="theme-changer__label" for="theme-changer-input" data-tooltip="Сменить тему оформления"><input class="theme-changer__input" type="checkbox" id="theme-changer-input" data-theme-changer="data-theme-changer"/><span class="theme-changer__icon theme-changer__icon_light-theme"></span><span class="theme-changer__icon theme-changer__icon_dark-theme"></span></label></div></div><div class="sitetoolbar__search-wrap"><div class="sitetoolbar__search-content"><button class="sitetoolbar__search-toggle" type="button"></button><form class="sitetoolbar__search" method="GET" action="https://learn.javascript.ru/search"><div class="sitetoolbar__search-input"><div class="text-input"><input class="text-input__control" name="query" placeholder="Искать на Javascript.ru" required="required" type="text"/></div><button class="sitetoolbar__find" type="submit">Найти</button></div></form></div></div></div><div class="tablet-menu"><div class="tablet-menu__line"><div class="tablet-menu__content"><select class="tablet-menu__nav input-select input-select input-select_small" onchange="if(this.value) window.location.href=this.value"><option value="/" selected>Учебник</option><option value="/courses">Курсы</option><option value="https://javascript.ru/forum/">Форум</option><option value="/quiz">Тесты знаний</option></select></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><form class="tablet-menu-search" action="https://learn.javascript.ru/search/"><input class="tablet-menu-search__input" type="search" name="query" placeholder="Поиск в учебнике" required="required"/><button class="tablet-menu-search__button" type="submit" name="type" value="articles">Поиск</button></form></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><a class="map" href="https://learn.javascript.ru/tutorial/map" data-action="tutorial-map"><span class="map__text">Карта учебника</span></a></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><div class="theme-changer theme-changer_tablet-menu theme-changer_has-label"><label class="theme-changer__label" for="theme-changer-input-tablet" data-tooltip="Сменить тему оформления"><input class="theme-changer__input" type="checkbox" id="theme-changer-input-tablet" data-theme-changer="data-theme-changer"/><span class="theme-changer__icon theme-changer__icon_light-theme"></span><span class="theme-changer__icon theme-changer__icon_dark-theme"></span><span class="theme-changer__label-text theme-changer__label-text_light-theme">Светлая тема</span><span class="theme-changer__label-text theme-changer__label-text_dark-theme">Тёмная тема</span></label></div></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><div class="share-icons"><span class="share-icons__title">Поделиться</span><a class="share share_tw" href="https://twitter.com/share?url=https%3A%2F%2Flearn.javascript.ru%2Fclosure" rel="nofollow"></a><a class="share share_fb" href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=https%3A%2F%2Flearn.javascript.ru%2Fclosure" rel="nofollow"></a><a class="share share_vk" href="https://vkontakte.ru/share.php?url=https%3A%2F%2Flearn.javascript.ru%2Fclosure" rel="nofollow"></a></div></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><select class="tablet-menu__nav input-select input-select input-select_small" onchange="if(this.value) window.location.href=this.value"><option value="https://ar.javascript.info/closure">عربي</option><option value="https://javascript.info/closure">English</option><option value="https://es.javascript.info/closure">Español</option><option value="https://fr.javascript.info/closure">Français</option><option value="https://id.javascript.info/closure">Indonesia</option><option value="https://it.javascript.info/closure">Italiano</option><option value="https://ja.javascript.info/closure">日本語</option><option value="https://ko.javascript.info/closure">한국어</option><option value="https://learn.javascript.ru/closure" selected>Русский</option><option value="https://tr.javascript.info/closure">Türkçe</option><option value="https://uk.javascript.info/closure">Українська</option><option value="https://zh.javascript.info/closure">简体中文</option></select></div></div></div><progress class="tutorial-progress" data-sticky value="51" max="93" data-tooltip="Урок 51 из 93"></progress></div><div class="page page_sidebar_on page_inner_padding"><script>if(localStorage.noSidebar){document.querySelector(".page").classList.remove("page_sidebar_on");let e=document.querySelector(".page-wrapper");e&&e.classList.remove("page-wrapper_sidebar_on")}setTimeout(function(){document.querySelector(".page").classList.add("page_sidebar-animation-on")});</script><div class="page__inner"><main class="main main_width-limit"><header class="main__header"><div class="main__header-inner"><div class="main__header-group"><ol class="breadcrumbs"><li class="breadcrumbs__item breadcrumbs__item_home"><a class="breadcrumbs__link" href="https://learn.javascript.ru/"><span class="breadcrumbs__hidden-text">Учебник</span></a></li><li class="breadcrumbs__item" id="breadcrumb-1"><a class="breadcrumbs__link" href="https://learn.javascript.ru/js"><span>Язык JavaScript</span></a></li><li class="breadcrumbs__item" id="breadcrumb-2"><a class="breadcrumbs__link" href="https://learn.javascript.ru/advanced-functions"><span>Продвинутая работа с функциями</span></a></li><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Учебник","item":"https://learn.javascript.ru/"},{"@type":"ListItem","position":2,"name":"Язык JavaScript","item":"https://learn.javascript.ru/js"},{"@type":"ListItem","position":3,"name":"Продвинутая работа с функциями","item":"https://learn.javascript.ru/advanced-functions"}]}</script></ol><div class="updated-at" data-tooltip="Последнее обновление: 12-го февраля 2022"><div class="updated-at__content">12-го февраля 2022</div></div></div><h1 class="main__header-title">Замыкание</h1></div></header><div class="content"><article class="formatted" itemscope itemtype="http://schema.org/TechArticle"><meta itemprop="name" content="Замыкание"><div itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="email" content="iliakan@gmail.com"><meta itemprop="name" content="Ilya Kantor"></div><div itemprop="articleBody"><p>JavaScript – язык с сильным функционально-ориентированным уклоном. Он даёт нам много свободы. Функция может быть динамически создана, скопирована в другую переменную или передана как аргумент другой функции и позже вызвана из совершенно другого места.</p>
<p>Мы знаем, что функция может получить доступ к переменным из внешнего окружения, эта возможность используется очень часто.</p>
<p>Но что произойдёт, когда внешние переменные изменятся? Функция получит последнее значение или то, которое существовало на момент создания функции?</p>
<p>И что произойдёт, когда функция переместится в другое место в коде и будет вызвана оттуда – получит ли она доступ к внешним переменным своего нового местоположения?</p>
<p>Разные языки ведут себя по-разному в таких случаях, и в этой главе мы рассмотрим поведение JavaScript.</p>
<h2><a class="main__anchor" name="para-voprosov" href="closure.html#para-voprosov">Пара вопросов</a></h2><p>Для начала давайте рассмотрим две ситуации, а затем изучим внутренние механизмы шаг за шагом, чтобы вы смогли ответить на эти и более сложные вопросы в будущем.</p>
<ol>
<li>
<p>Функция <code>sayHi</code> использует внешнюю переменную <code>name</code>. Какое значение будет использовать функция при выполнении?</p>
<div id="ssc7ijdnb2" data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:8,&quot;end&quot;:8}]">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>let name = &quot;John&quot;;

function sayHi() {
  alert(&quot;Hi, &quot; + name);
}

name = &quot;Pete&quot;;

sayHi(); // что будет показано: &quot;John&quot; или &quot;Pete&quot;?</code></pre>
        </div>
      </div>
      
      </div><p>Такие ситуации распространены и в браузерной и в серверной разработке. Выполнение функции может быть запланировано позже, чем она была создана, например, после какого-нибудь пользовательского действия или сетевого запроса.</p>
<p>Итак, вопрос в том, получит ли она доступ к последним изменениям?</p>
</li>
<li>
<p>Функция <code>makeWorker</code> создаёт другую функцию и возвращает её. Новая функция может быть вызвана откуда-то ещё. Получит ли она доступ к внешним переменным из места своего создания или места выполнения или из обоих?</p>
<div id="pkvbpcyhon" data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:14,&quot;end&quot;:14}]">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>function makeWorker() {
  let name = &quot;Pete&quot;;

  return function() {
    alert(name);
  };
}

let name = &quot;John&quot;;

// create a function
let work = makeWorker();

// call it
work(); // что будет показано? &quot;Pete&quot; (из места создания) или &quot;John&quot; (из места выполнения)</code></pre>
        </div>
      </div>
      
      </div></li>
</ol>
<h2><a class="main__anchor" name="leksicheskoe-okruzhenie" href="closure.html#leksicheskoe-okruzhenie">Лексическое Окружение</a></h2><p>Чтобы понять, что происходит, давайте для начала обсудим, что такое «переменная» на самом деле.</p>
<p>В JavaScript у каждой выполняемой функции, блока кода и скрипта есть связанный с ними внутренний (скрытый) объект, называемый <em>лексическим окружением</em> <code>LexicalEnvironment</code>.</p>
<p>Объект лексического окружения состоит из двух частей:</p>
<ol>
<li>
<p><em>Environment Record</em> – объект, в котором как свойства хранятся все локальные переменные (а также некоторая другая информация, такая как значение <code>this</code>).</p>
</li>
<li>
<p>Ссылка на <em>внешнее лексическое окружение</em> – то есть то, которое соответствует коду снаружи (снаружи от текущих фигурных скобок).</p>
</li>
</ol>
<p><strong>&quot;Переменная&quot; – это просто свойство специального внутреннего объекта: Environment Record. «Получить или изменить переменную», означает, «получить или изменить свойство этого объекта».</strong></p>
<p>Например, в этом простом коде только одно лексическое окружение:</p>
<figure><div class="image" style="width:492px">
      <div class="image__ratio" style="padding-top:21.951219512195124%"></div>
      <object type="image/svg+xml" data="https://learn.javascript.ru/article/closure/lexical-environment-global.svg" width="492" height="108" class="image__image" data-use-theme>
        <img src="https://learn.javascript.ru/article/closure/lexical-environment-global.svg" alt="" width="492" height="108">
      </object>
      </div></figure><p>Это, так называемое, глобальное лексическое окружение, связанное со всем скриптом.</p>
<p>На картинке выше прямоугольник означает Environment Record (хранилище переменных), а стрелка означает ссылку на внешнее окружение. У глобального лексического окружения нет внешнего окружения, так что она указывает на <code>null</code>.</p>
<p>А вот как оно изменяется при объявлении и присваивании переменной:</p>
<figure><div class="image" style="width:516px">
      <div class="image__ratio" style="padding-top:29.069767441860467%"></div>
      <object type="image/svg+xml" data="https://learn.javascript.ru/article/closure/lexical-environment-global-2.svg" width="516" height="150" class="image__image" data-use-theme>
        <img src="https://learn.javascript.ru/article/closure/lexical-environment-global-2.svg" alt="" width="516" height="150">
      </object>
      </div></figure><p>Прямоугольники с правой стороны демонстрируют, как глобальное лексическое окружение изменяется в процессе выполнения кода:</p>
<ol>
<li>В начале скрипта лексическое окружение пустое.</li>
<li>Появляется определение переменной <code>let phrase</code>. У неё нет присвоенного значения, поэтому присваивается <code>undefined</code>.</li>
<li>Переменной <code>phrase</code> присваивается значение.</li>
<li>Переменная <code>phrase</code> меняет значение.</li>
</ol>
<p>Пока что всё выглядит просто, правда?</p>
<p>Итого:</p>
<ul>
<li>Переменная – это свойство специального внутреннего объекта, связанного с текущим выполняющимся блоком/функцией/скриптом.</li>
<li>Работа с переменными – это на самом деле работа со свойствами этого объекта.</li>
</ul>
<h3><a class="main__anchor" name="function-declaration" href="closure.html#function-declaration">Function Declaration</a></h3><p>До сих пор мы рассматривали только переменные. Теперь рассмотрим Function Declaration.</p>
<p><strong>В отличие от переменных, объявленных с помощью <code>let</code>, они полностью инициализируются не тогда, когда выполнение доходит до них, а раньше, когда создаётся лексическое окружение.</strong></p>
<p>Для верхнеуровневых функций это означает момент, когда скрипт начинает выполнение.</p>
<p>Вот почему мы можем вызвать функцию, объявленную через Function Declaration, до того, как она определена.</p>
<p>Следующий код демонстрирует, что уже с самого начала в лексическом окружении что-то есть. Там есть <code>say</code>, потому что это Function Declaration. И позже там появится <code>phrase</code>, объявленное через <code>let</code>:</p>
<figure><div class="image" style="width:550px">
      <div class="image__ratio" style="padding-top:31.454545454545457%"></div>
      <object type="image/svg+xml" data="https://learn.javascript.ru/article/closure/lexical-environment-global-3.svg" width="550" height="173" class="image__image" data-use-theme>
        <img src="https://learn.javascript.ru/article/closure/lexical-environment-global-3.svg" alt="" width="550" height="173">
      </object>
      </div></figure><h3><a class="main__anchor" name="vnutrennee-i-vneshnee-leksicheskoe-okruzhenie" href="closure.html#vnutrennee-i-vneshnee-leksicheskoe-okruzhenie">Внутреннее и внешнее лексическое окружение</a></h3><p>Теперь давайте продолжим и посмотрим, что происходит, когда функция получает доступ к внешней переменной.</p>
<p>В течение вызова <code>say()</code> использует внешнюю переменную <code>phrase</code>. Давайте разберёмся подробно, что происходит.</p>
<p>При запуске функции для неё автоматически создаётся новое лексическое окружение, для хранения локальных переменных и параметров вызова.</p>
<p>Например, для <code>say(&quot;John&quot;)</code> это выглядит так (выполнение находится на строке, отмеченной стрелкой):</p>
<!--
    ```js
    let phrase = "Hello";

    function say(name) {
     alert( `${phrase}, ${name}` );
    }

    say("John"); // Hello, John
    ```-->
<figure><div class="image" style="width:723px">
      <div class="image__ratio" style="padding-top:20.74688796680498%"></div>
      <object type="image/svg+xml" data="https://learn.javascript.ru/article/closure/lexical-environment-simple.svg" width="723" height="150" class="image__image" data-use-theme>
        <img src="https://learn.javascript.ru/article/closure/lexical-environment-simple.svg" alt="" width="723" height="150">
      </object>
      </div></figure><p>Итак, в процессе вызова функции у нас есть два лексических окружения: внутреннее (для вызываемой функции) и внешнее (глобальное):</p>
<ul>
<li>
<p>Внутреннее лексическое окружение соответствует текущему выполнению <code>say</code>.</p>
<p>В нём находится одна переменная <code>name</code>, аргумент функции. Мы вызываем <code>say(&quot;John&quot;)</code>, так что значение переменной <code>name</code> равно <code>&quot;John&quot;</code>.</p>
</li>
<li>
<p>Внешнее лексическое окружение – это глобальное лексическое окружение.</p>
<p>В нём находятся переменная <code>phrase</code> и сама функция.</p>
</li>
</ul>
<p>У внутреннего лексического окружения есть ссылка <code>outer</code> на внешнее.</p>
<p><strong>Когда код хочет получить доступ к переменной – сначала происходит поиск во внутреннем лексическом окружении, затем во внешнем, затем в следующем и так далее, до глобального.</strong></p>
<p>Если переменная не была найдена, это будет ошибкой в <code>strict mode</code>. Без <code>strict mode</code>, для обратной совместимости, присваивание несуществующей переменной создаёт новую глобальную переменную с таким именем.</p>
<p>Давайте посмотрим, как происходит поиск в нашем примере:</p>
<ul>
<li>Когда <code>alert</code> внутри <code>say</code> хочет получить доступ к <code>name</code>, он немедленно находит переменную в лексическом окружении функции.</li>
<li>Когда он хочет получить доступ к <code>phrase</code>, которой нет локально, он следует дальше по ссылке к внешнему лексическому окружению и находит переменную там.</li>
</ul>
<figure><div class="image" style="width:711px">
      <div class="image__ratio" style="padding-top:21.09704641350211%"></div>
      <object type="image/svg+xml" data="https://learn.javascript.ru/article/closure/lexical-environment-simple-lookup.svg" width="711" height="150" class="image__image" data-use-theme>
        <img src="https://learn.javascript.ru/article/closure/lexical-environment-simple-lookup.svg" alt="" width="711" height="150">
      </object>
      </div></figure><p>Теперь у нас есть ответ на первый вопрос из начала главы.</p>
<p><strong>Функция получает текущее значение внешних переменных, то есть, их последнее значение</strong></p>
<p>Старые значения переменных нигде не сохраняются. Когда функция хочет получить доступ к переменной, она берёт её текущее значение из своего или внешнего лексического окружения.</p>
<p>Так что, ответ на первый вопрос: <code>Pete</code>:</p>
<div id="os9hejs6z2" data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:8,&quot;end&quot;:8}]">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="closure.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="closure.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>let name = &quot;John&quot;;

function sayHi() {
  alert(&quot;Hi, &quot; + name);
}

name = &quot;Pete&quot;; // (*)

sayHi(); // Pete</code></pre>
        </div>
      </div>
      
      </div><p>Порядок выполнения кода, приведённого выше:</p>
<ol>
<li>В глобальном лексическом окружении есть <code>name: &quot;John&quot;</code>.</li>
<li>На строке <code>(*)</code> глобальная переменная изменяется, теперь <code>name: &quot;Pete&quot;</code>.</li>
<li>Момент, когда выполняется функция <code>sayHi()</code> и берёт переменную <code>name</code> извне. Теперь из глобального лексического окружения, где переменная уже равна <code>&quot;Pete&quot;</code>.</li>
</ol>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Один вызов – одно лексическое окружение</span></div>
            <div class="important__content"><p>Пожалуйста, обратите внимание, что новое лексическое окружение функции создаётся каждый раз, когда функция выполняется.</p>
<p>И, если функция вызывается несколько раз, то для каждого вызова будет своё лексическое окружение, со своими, специфичными для этого вызова, локальными переменными и параметрами.</p>
</div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Лексическое окружение – это специальный внутренний объект</span></div>
            <div class="important__content"><p>«Лексическое окружение» – это специальный внутренний объект. Мы не можем получить его в нашем коде и изменять напрямую. Сам движок JavaScript может оптимизировать его, уничтожать неиспользуемые переменные для освобождения памяти и выполнять другие внутренние уловки, но видимое поведение объекта должно оставаться таким, как было описано.</p>
</div></div>
<h2><a class="main__anchor" name="vlozhennye-funktsii" href="closure.html#vlozhennye-funktsii">Вложенные функции</a></h2><p>Функция называется «вложенной», когда она создаётся внутри другой функции.</p>
<p>Это очень легко сделать в JavaScript.</p>
<p>Мы можем использовать это для упорядочивания нашего кода, например, как здесь:</p>
<div id="veg46ezai9" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>function sayHiBye(firstName, lastName) {

  // функция-помощник, которую мы используем ниже
  function getFullName() {
    return firstName + &quot; &quot; + lastName;
  }

  alert( &quot;Hello, &quot; + getFullName() );
  alert( &quot;Bye, &quot; + getFullName() );

}</code></pre>
        </div>
      </div>
      
      </div><p>Здесь <em>вложенная</em> функция <code>getFullName()</code> создана для удобства. Она может получить доступ к внешним переменным и, значит, вывести полное имя. В JavaScript вложенные функции используются очень часто.</p>
<p>Что ещё интереснее, вложенная функция может быть возвращена: либо в качестве свойства нового объекта (если внешняя функция создаёт объект с методами), либо сама по себе. И затем может быть использована в любом месте. Не важно где, она всё так же будет иметь доступ к тем же внешним переменным.</p>
<p>Например, здесь, вложенная функция присваивается новому объекту в <a href="https://learn.javascript.ru/constructor-new">конструкторе</a>:</p>
<div id="y7fe4unedz" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="closure.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="closure.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>// функция-конструктор возвращает новый объект
function User(name) {

  // методом объекта становится вложенная функция
  this.sayHi = function() {
    alert(name);
  };
}

let user = new User(&quot;John&quot;);
user.sayHi(); // у кода метода &quot;sayHi&quot; есть доступ к внешней переменной &quot;name&quot;</code></pre>
        </div>
      </div>
      
      </div><p>А здесь мы просто создаём и возвращаем функцию «счётчик»:</p>
<div id="7p09xif6di" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="closure.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="closure.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>function makeCounter() {
  let count = 0;

  return function() {
    return count++; // есть доступ к внешней переменной &quot;count&quot;
  };
}

let counter = makeCounter();

alert( counter() ); // 0
alert( counter() ); // 1
alert( counter() ); // 2</code></pre>
        </div>
      </div>
      
      </div><p>Давайте продолжим с примером <code>makeCounter</code>. Он создаёт функцию «counter», которая возвращает следующее число при каждом вызове. Несмотря на простоту, немного модифицированные варианты этого кода применяются на практике, например, в <a href="https://ru.wikipedia.org/wiki/%D0%93%D0%B5%D0%BD%D0%B5%D1%80%D0%B0%D1%82%D0%BE%D1%80_%D0%BF%D1%81%D0%B5%D0%B2%D0%B4%D0%BE%D1%81%D0%BB%D1%83%D1%87%D0%B0%D0%B9%D0%BD%D1%8B%D1%85_%D1%87%D0%B8%D1%81%D0%B5%D0%BB">генераторе псевдослучайных чисел</a> и во многих других случаях.</p>
<p>Как же это работает изнутри?</p>
<p>Когда внутренняя функция начинает выполняться, начинается поиск переменной <code>count++</code> изнутри-наружу. Для примера выше порядок будет такой:</p>
<figure><div class="image" style="width:353px">
      <div class="image__ratio" style="padding-top:42.492917847025495%"></div>
      <object type="image/svg+xml" data="https://learn.javascript.ru/article/closure/lexical-search-order.svg" width="353" height="150" class="image__image" data-use-theme>
        <img src="https://learn.javascript.ru/article/closure/lexical-search-order.svg" alt="" width="353" height="150">
      </object>
      </div></figure><ol>
<li>Локальные переменные вложенной функции…</li>
<li>Переменные внешней функции…</li>
<li>И так далее, пока не будут достигнуты глобальные переменные.</li>
</ol>
<p>В этом примере <code>count</code> будет найден на шаге <code>2</code>. Когда внешняя переменная модифицируется, она изменится там, где была найдена. Значит, <code>count++</code> найдёт внешнюю переменную и увеличит её значение в лексическом окружении, которому она принадлежит. Как если бы у нас было <code>let count = 1</code>.</p>
<p>Теперь рассмотрим два вопроса:</p>
<ol>
<li>Можем ли мы каким-нибудь образом сбросить счётчик <code>count</code> из кода, который не принадлежит <code>makeCounter</code>? Например, после вызова <code>alert</code> в коде выше.</li>
<li>Если мы вызываем <code>makeCounter</code> несколько раз – нам возвращается много функций <code>counter</code>. Они независимы или разделяют одну и ту же переменную <code>count</code>?</li>
</ol>
<p>Попробуйте ответить на эти вопросы перед тем, как продолжить чтение.</p>
<p>…</p>
<p>Готовы?</p>
<p>Хорошо, давайте ответим на вопросы.</p>
<ol>
<li>Такой возможности нет: <code>count</code> – локальная переменная функции, мы не можем получить к ней доступ извне.</li>
<li>Для каждого вызова <code>makeCounter()</code> создаётся новое лексическое окружение функции, со своим собственным <code>count</code>. Так что, получившиеся функции <code>counter</code> – независимы.</li>
</ol>
<p>Вот демо:</p>
<div id="kpt016tp1f" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="closure.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="closure.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>function makeCounter() {
  let count = 0;
  return function() {
    return count++;
  };
}

let counter1 = makeCounter();
let counter2 = makeCounter();

alert( counter1() ); // 0
alert( counter1() ); // 1

alert( counter2() ); // 0 (независимо)</code></pre>
        </div>
      </div>
      
      </div><p>Надеюсь, ситуация с внешними переменными теперь ясна. Для большинства ситуаций такого понимания вполне достаточно, но в спецификации есть ряд деталей, которые мы, для простоты, опустили. Далее мы разберём происходящее ещё более подробно.</p>
<h2><a class="main__anchor" name="okruzhenie-v-detalyah" href="closure.html#okruzhenie-v-detalyah">Окружение в деталях</a></h2><p>Вот что происходит в примере с <code>makeCounter</code> шаг за шагом. Пройдите их, чтобы убедиться, что вы разобрались с каждой деталью.</p>
<p>Пожалуйста, обратите внимание на дополнительное свойство <code>[[Environment]]</code>, про которое здесь рассказано. Мы не упоминали о нём раньше для простоты.</p>
<ol>
<li>
<p>Когда скрипт только начинает выполняться, есть только глобальное лексическое окружение:</p>
<figure><div class="image" style="width:689px">
      <div class="image__ratio" style="padding-top:21.77068214804064%"></div>
      <object type="image/svg+xml" data="https://learn.javascript.ru/article/closure/lexenv-nested-makecounter-1.svg" width="689" height="150" class="image__image" data-use-theme>
        <img src="https://learn.javascript.ru/article/closure/lexenv-nested-makecounter-1.svg" alt="" width="689" height="150">
      </object>
      </div></figure><p>В этот начальный момент есть только функция <code>makeCounter</code>, потому что это Function Declaration. Она ещё не выполняется.</p>
<p><strong>Все функции «при рождении» получают скрытое свойство <code>[[Environment]]</code>, которое ссылается на лексическое окружение места, где они были созданы.</strong></p>
<p>Мы ещё не говорили об этом, это то, каким образом функции знают, где они были созданы.</p>
<p>В данном случае, <code>makeCounter</code> создан в глобальном лексическом окружении, так что <code>[[Environment]]</code> содержит ссылку на него.</p>
<p>Другими словами, функция навсегда запоминает ссылку на лексическое окружение, где она была создана. И <code>[[Environment]]</code> – скрытое свойство функции, которое содержит эту ссылку.</p>
</li>
<li>
<p>Код продолжает выполняться, объявляется новая глобальная переменная <code>counter</code>, которой присваивается результат вызова <code>makeCounter</code>. Вот снимок момента, когда интерпретатор находится на первой строке внутри <code>makeCounter()</code>:</p>
<figure><div class="image" style="width:711px">
      <div class="image__ratio" style="padding-top:24.331926863572434%"></div>
      <object type="image/svg+xml" data="https://learn.javascript.ru/article/closure/lexenv-nested-makecounter-2.svg" width="711" height="173" class="image__image" data-use-theme>
        <img src="https://learn.javascript.ru/article/closure/lexenv-nested-makecounter-2.svg" alt="" width="711" height="173">
      </object>
      </div></figure><p>В момент вызова <code>makeCounter()</code> создаётся лексическое окружение, для хранения его переменных и аргументов.</p>
<p>Как и все лексические окружения, оно содержит две вещи:</p>
<ol>
<li>Environment Record с локальными переменными. В нашем случае <code>count</code> – единственная локальная переменная (появляющаяся, когда выполняется строчка с <code>let count</code>).</li>
<li>Ссылка на внешнее окружение, которая устанавливается в значение <code>[[Environment]]</code> функции. В данном случае, <code>[[Environment]]</code> функции <code>makeCounter</code> ссылается на глобальное лексическое окружение.</li>
</ol>
<p>Итак, теперь у нас есть два лексических окружения: первое – глобальное, второе – для текущего вызова <code>makeCounter</code>, с внешней ссылкой на глобальный объект.</p>
</li>
<li>
<p>В процессе выполнения <code>makeCounter()</code> создаётся небольшая вложенная функция.</p>
<p>Не имеет значения, какой способ объявления функции используется: Function Declaration или Function Expression. Все функции получают свойство <code>[[Environment]]</code>, которое ссылается на лексическое окружение, в котором они были созданы. То же самое происходит и с нашей новой маленькой функцией.</p>
<p>Для нашей новой вложенной функции значением <code>[[Environment]]</code> будет текущее лексическое окружение <code>makeCounter()</code> (где она была создана):</p>
<figure><div class="image" style="width:764px">
      <div class="image__ratio" style="padding-top:22.5130890052356%"></div>
      <object type="image/svg+xml" data="https://learn.javascript.ru/article/closure/lexenv-nested-makecounter-3.svg" width="764" height="172" class="image__image" data-use-theme>
        <img src="https://learn.javascript.ru/article/closure/lexenv-nested-makecounter-3.svg" alt="" width="764" height="172">
      </object>
      </div></figure><p>Пожалуйста, обратите внимание, что на этом шаге внутренняя функция была создана, но ещё не вызвана. Код внутри <code>function() { return count++ }</code> не выполняется.</p>
</li>
<li>
<p>Выполнение продолжается, вызов <code>makeCounter()</code> завершается, и результат (небольшая вложенная функция) присваивается глобальной переменной <code>counter</code>:</p>
<figure><div class="image" style="width:782px">
      <div class="image__ratio" style="padding-top:26.854219948849106%"></div>
      <object type="image/svg+xml" data="https://learn.javascript.ru/article/closure/lexenv-nested-makecounter-4.svg" width="782" height="210" class="image__image" data-use-theme>
        <img src="https://learn.javascript.ru/article/closure/lexenv-nested-makecounter-4.svg" alt="" width="782" height="210">
      </object>
      </div></figure><p>В этой функции есть только одна строчка: <code>return count++</code>, которая будет выполнена, когда мы вызовем функцию.</p>
</li>
<li>
<p>При вызове <code>counter()</code> для этого вызова создаётся новое лексическое окружение. Оно пустое, так как в самом <code>counter</code> локальных переменных нет. Но <code>[[Environment]]</code> <code>counter</code> используется, как ссылка на внешнее лексическое окружение <code>outer</code>, которое даёт доступ к переменным предшествующего вызова <code>makeCounter</code>, где <code>counter</code> был создан.</p>
<figure><div class="image" style="width:774px">
      <div class="image__ratio" style="padding-top:27.131782945736433%"></div>
      <object type="image/svg+xml" data="https://learn.javascript.ru/article/closure/lexenv-nested-makecounter-5.svg" width="774" height="210" class="image__image" data-use-theme>
        <img src="https://learn.javascript.ru/article/closure/lexenv-nested-makecounter-5.svg" alt="" width="774" height="210">
      </object>
      </div></figure><p>Теперь, когда вызов ищет переменную <code>count</code>, он сначала ищет в собственном лексическом окружении (пустое), а затем в лексическом окружении предшествующего вызова <code>makeCounter()</code>, где и находит её.</p>
<p>Пожалуйста, обратите внимание, как здесь работает управление памятью. Хотя <code>makeCounter()</code> закончил выполнение некоторое время назад, его лексическое окружение остаётся в памяти, потому что есть вложенная функция с <code>[[Environment]]</code>, который ссылается на него.</p>
<p>В большинстве случаев, объект лексического окружения существует до того момента, пока есть функция, которая может его использовать. И только тогда, когда таких не остаётся, окружение уничтожается.</p>
</li>
<li>
<p>Вызов <code>counter()</code> не только возвращает значение <code>count</code>, но также увеличивает его. Обратите внимание, что модификация происходит «на месте». Значение <code>count</code> изменяется конкретно в том окружении, где оно было найдено.</p>
<figure><div class="image" style="width:782px">
      <div class="image__ratio" style="padding-top:28.77237851662404%"></div>
      <object type="image/svg+xml" data="https://learn.javascript.ru/article/closure/lexenv-nested-makecounter-6.svg" width="782" height="225" class="image__image" data-use-theme>
        <img src="https://learn.javascript.ru/article/closure/lexenv-nested-makecounter-6.svg" alt="" width="782" height="225">
      </object>
      </div></figure></li>
<li>
<p>Следующие вызовы <code>counter()</code> сделают то же самое.</p>
</li>
</ol>
<p>Теперь ответ на второй вопрос из начала главы должен быть очевиден.</p>
<p>Функция <code>work()</code> в коде ниже получает <code>name</code> из того места, где была создана, через ссылку на внешнее лексическое окружение:</p>
<figure><div class="image" style="width:762px">
      <div class="image__ratio" style="padding-top:29.527559055118108%"></div>
      <object type="image/svg+xml" data="https://learn.javascript.ru/article/closure/lexenv-nested-work.svg" width="762" height="225" class="image__image" data-use-theme>
        <img src="https://learn.javascript.ru/article/closure/lexenv-nested-work.svg" alt="" width="762" height="225">
      </object>
      </div></figure><p>Так что, результатом будет <code>&quot;Pete&quot;</code>.</p>
<p>Но, если бы в <code>makeWorker()</code> не было <code>let name</code>, тогда бы поиск продолжился дальше и была бы взята глобальная переменная, как мы видим из приведённой выше цепочки. В таком случае, результатом было бы <code>&quot;John&quot;</code>.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Замыкания</span></div>
            <div class="important__content"><p>В программировании есть общий термин: «замыкание», – которое должен знать каждый разработчик.</p>
<p><a href="https://ru.wikipedia.org/wiki/%D0%97%D0%B0%D0%BC%D1%8B%D0%BA%D0%B0%D0%BD%D0%B8%D0%B5_(%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5)">Замыкание</a> – это функция, которая запоминает свои внешние переменные и может получить к ним доступ. В некоторых языках это невозможно, или функция должна быть написана специальным образом, чтобы получилось замыкание. Но, как было описано выше, в JavaScript, все функции изначально являются замыканиями (есть только одно исключение, про которое будет рассказано в <a href="https://learn.javascript.ru/new-function">Синтаксис &quot;new Function&quot;</a>).</p>
<p>То есть, они автоматически запоминают, где были созданы, с помощью скрытого свойства <code>[[Environment]]</code> и все они могут получить доступ к внешним переменным.</p>
<p>Когда на собеседовании фронтенд-разработчик получает вопрос: «что такое замыкание?», – правильным ответом будет определение замыкания и объяснения того факта, что все функции в JavaScript являются замыканиями, и, может быть, несколько слов о технических деталях: свойстве <code>[[Environment]]</code> и о том, как работает лексическое окружение.</p>
</div></div>
<h2><a class="main__anchor" name="bloki-koda-i-tsikly-iife" href="closure.html#bloki-koda-i-tsikly-iife">Блоки кода и циклы, IIFE</a></h2><p>Предыдущие примеры сосредоточены на функциях. Но лексическое окружение существует для любых блоков кода <code>{...}</code>.</p>
<p>Лексическое окружение создаётся при выполнении блока кода и содержит локальные переменные для этого блока. Вот пара примеров.</p>
<h3><a class="main__anchor" name="if" href="closure.html#if">If</a></h3><p>В следующем примере переменная <code>user</code> существует только в блоке <code>if</code>:</p>
<!--
    ```js run
    let phrase = "Hello";

    if (true) {
        let user = "John";

        alert(`${phrase}, ${user}`); // Hello, John
    }

    alert(user); // Ошибка, этой переменной не видно
    ```-->
<figure><div class="image" style="width:701px">
      <div class="image__ratio" style="padding-top:26.105563480741793%"></div>
      <object type="image/svg+xml" data="https://learn.javascript.ru/article/closure/lexenv-if.svg" width="701" height="183" class="image__image" data-use-theme>
        <img src="https://learn.javascript.ru/article/closure/lexenv-if.svg" alt="" width="701" height="183">
      </object>
      </div></figure><p>Когда выполнение попадает в блок <code>if</code>, для этого блока создаётся новое лексическое окружение.</p>
<p>У него есть ссылка на внешнее окружение, так что <code>phrase</code> может быть найдена. Но все переменные, Function Expression, а так же <a href="https://learn.javascript.ru/function-expressions#function-expression-v-sravnenii-s-function-declaration">Function Declaration</a> в строгом режиме, объявленные внутри <code>if</code>, остаются в его лексическом окружении и не видны снаружи.</p>
<p>Например, после завершения <code>if</code> следующий <code>alert</code> не увидит <code>user</code>, что вызовет ошибку.</p>
<h3><a class="main__anchor" name="for-while" href="closure.html#for-while">For, while</a></h3><p>Для цикла у каждой итерации своё отдельное лексическое окружение. Если переменная объявлена в <code>for(let ...)</code>, то она также в нём:</p>
<div id="qfwynufldt" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="closure.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="closure.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>for (let i = 0; i &lt; 10; i++) {
  // У каждой итерации цикла своё собственное лексическое окружение
  // {i: value}
}

alert(i); // Ошибка, нет такой переменной</code></pre>
        </div>
      </div>
      
      </div><p>Обратите внимание: <code>let i</code> визуально находится снаружи <code>{...}</code>. Но конструкция <code>for</code> – особенная в этом смысле, у каждой итерации цикла своё собственное лексическое окружение с текущим <code>i</code> в нём.</p>
<p>И так же, как и в <code>if</code>, ниже цикла <code>i</code> невидима.</p>
<h3><a class="main__anchor" name="bloki-koda" href="closure.html#bloki-koda">Блоки кода</a></h3><p>Мы также можем использовать «простые» блоки кода <code>{...}</code>, чтобы изолировать переменные в «локальной области видимости».</p>
<p>Например, в браузере все скрипты (кроме <code>type=&quot;module&quot;</code>) разделяют одну общую глобальную область. Так что, если мы создадим глобальную переменную в одном скрипте, она станет доступна и в других. Но это становится источником конфликтов, если два скрипта используют одно и то же имя переменной и перезаписывают друг друга.</p>
<p>Это может произойти, если название переменной – широко распространённое слово, а авторы скрипта не знают друг о друге.</p>
<p>Если мы хотим этого избежать, мы можем использовать блок кода для изоляции всего скрипта или какой-то его части:</p>
<div id="mh9ovb2i44" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="closure.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="closure.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>{
  // сделать какую-нибудь работу с локальными переменными, которые не должны быть видны снаружи

  let message = &quot;Hello&quot;;

  alert(message); // Hello
}

alert(message); // Ошибка: переменная message не определена</code></pre>
        </div>
      </div>
      
      </div><p>Из-за того, что у блока есть собственное лексическое окружение, код снаружи него (или в другом скрипте) не видит переменные этого блока.</p>
<h3><a class="main__anchor" name="iife" href="closure.html#iife">IIFE</a></h3><p>В прошлом в JavaScript не было лексического окружения на уровне блоков кода.</p>
<p>Так что программистам пришлось что-то придумать. И то, что они сделали, называется «immediately-invoked function expressions» (аббревиатура IIFE), что означает функцию, запускаемую сразу после объявления.</p>
<p>Это не то, что мы должны использовать сегодня, но, так как вы можете встретить это в старых скриптах, полезно понимать принцип работы.</p>
<p>IIFE выглядит так:</p>
<div id="acczkn5z53" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="closure.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="closure.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>(function() {

  let message = &quot;Hello&quot;;

  alert(message); // Hello

})();</code></pre>
        </div>
      </div>
      
      </div><p>Здесь создаётся и немедленно вызывается Function Expression. Так что код выполняется сразу же и у него есть свои локальные переменные.</p>
<p>Function Expression обёрнуто в скобки <code>(function {...})</code>, потому что, когда JavaScript встречает <code>&quot;function&quot;</code> в основном потоке кода, он воспринимает это как начало Function Declaration. Но у Function Declaration должно быть имя, так что такой код вызовет ошибку:</p>
<div id="2leavhlkvs" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="closure.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="closure.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>// Попробуйте объявить и сразу же вызвать функцию
function() { // &lt;-- Error: Unexpected token (

  let message = &quot;Hello&quot;;

  alert(message); // Hello

}();</code></pre>
        </div>
      </div>
      
      </div><p>Даже если мы скажем: «хорошо, давайте добавим имя», – это не сработает, потому что JavaScript не позволяет вызывать Function Declaration немедленно.</p>
<div id="6ocflzgtoz" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="closure.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="closure.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>// ошибка синтаксиса из-за скобок ниже
function go() {

}(); // &lt;-- не можете вызывать Function Declaration немедленно</code></pre>
        </div>
      </div>
      
      </div><p>Так что, скобки вокруг функции – это трюк, который позволяет показать JavaScript, что функция была создана в контексте другого выражения, и, таким образом, это функциональное выражение: ей не нужно имя и её можно вызвать немедленно.</p>
<p>Кроме скобок, существуют и другие пути показать JavaScript, что мы имеем в виду Function Expression:</p>
<div id="mre4uo6lek" data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:14,&quot;cols&quot;:[{&quot;start&quot;:0,&quot;end&quot;:1}]},{&quot;start&quot;:10,&quot;cols&quot;:[{&quot;start&quot;:0,&quot;end&quot;:1}]},{&quot;start&quot;:8,&quot;cols&quot;:[{&quot;start&quot;:3,&quot;end&quot;:4}]},{&quot;start&quot;:4,&quot;cols&quot;:[{&quot;start&quot;:1,&quot;end&quot;:2}]}]">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="closure.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="closure.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>// Пути создания IIFE

(function() {
  alert(&quot;Скобки вокруг функции&quot;);
})();

(function() {
  alert(&quot;Скобки вокруг всего&quot;);
}());

!function() {
  alert(&quot;Выражение начинается с логического оператора NOT&quot;);
}();

+function() {
  alert(&quot;Выражение начинается с унарного плюса&quot;);
}();</code></pre>
        </div>
      </div>
      
      </div><p>Во всех перечисленных случаях мы объявляем Function Expression и немедленно выполняем его. Ещё раз заметим, что в настоящий момент нет необходимости писать подобный код.</p>
<h2><a class="main__anchor" name="sborka-musora" href="closure.html#sborka-musora">Сборка мусора</a></h2><p>Обычно лексическое окружение очищается и удаляется после того, как функция выполнилась. Например:</p>
<div id="sckafxek11" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>function f() {
  let value1 = 123;
  let value2 = 456;
}

f();</code></pre>
        </div>
      </div>
      
      </div><p>Здесь два значения, которые технически являются свойствами лексического окружения. Но после того, как <code>f()</code> завершится, это лексическое окружение станет недоступно, поэтому оно удалится из памяти.</p>
<p>…Но, если есть вложенная функция, которая всё ещё доступна после выполнения <code>f</code>, то у неё есть свойство <code>[[Environment]]</code>, которое ссылается на внешнее лексическое окружение, тем самым оставляя его достижимым, «живым»:</p>
<div id="jp3rhvod6p" data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:5,&quot;end&quot;:5}]">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>function f() {
  let value = 123;

  function g() { alert(value); }

  return g;
}

let g = f(); // g доступно и продолжает держать внешнее лексическое окружение в памяти</code></pre>
        </div>
      </div>
      
      </div><p>Обратите внимание, если <code>f()</code> вызывается несколько раз и возвращаемые функции сохраняются, тогда все соответствующие объекты лексического окружения продолжат держаться в памяти. Вот три такие функции в коде ниже:</p>
<div id="pngmfvccc6" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>function f() {
  let value = Math.random();

  return function() { alert(value); };
}

// три функции в массиве, каждая из них ссылается на лексическое окружение
// из соответствующего вызова f()
let arr = [f(), f(), f()];</code></pre>
        </div>
      </div>
      
      </div><p>Объект лексического окружения умирает, когда становится недоступным (как и любой другой объект). Другими словами, он существует только до того момента, пока есть хотя бы одна вложенная функция, которая ссылается на него.</p>
<p>В следующем коде, после того как <code>g</code> станет недоступным, лексическое окружение функции (и, соответственно, <code>value</code>) будет удалено из памяти;</p>
<div id="7q2vvy73bm" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>function f() {
  let value = 123;

  function g() { alert(value); }

  return g;
}

let g = f(); // пока g существует,
// соответствующее лексическое окружение существует

g = null; // ...а теперь память очищается</code></pre>
        </div>
      </div>
      
      </div><h3><a class="main__anchor" name="optimizatsiya-na-praktike" href="closure.html#optimizatsiya-na-praktike">Оптимизация на практике</a></h3><p>Как мы видели, в теории, пока функция жива, все внешние переменные тоже сохраняются.</p>
<p>Но на практике движки JavaScript пытаются это оптимизировать. Они анализируют использование переменных и, если легко по коду понять, что внешняя переменная не используется – она удаляется.</p>
<p><strong>Одним из важных побочных эффектов в V8 (Chrome, Opera) является то, что такая переменная становится недоступной при отладке.</strong></p>
<p>Попробуйте запустить следующий пример в Chrome с открытой Developer Tools.</p>
<p>Когда код будет поставлен на паузу, напишите в консоли <code>alert(value)</code>.</p>
<div id="4q4w0nmkkq" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="closure.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="closure.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>function f() {
  let value = Math.random();

  function g() {
    debugger; // в консоли: напишите alert(value); Такой переменной нет!
  }

  return g;
}

let g = f();
g();</code></pre>
        </div>
      </div>
      
      </div><p>Как вы можете видеть – такой переменной не существует! В теории, она должна быть доступна, но попала под оптимизацию движка.</p>
<p>Это может приводить к забавным (если удаётся решить быстро) проблемам при отладке. Одна из них – мы можем увидеть не ту внешнюю переменную при совпадающих названиях:</p>
<div id="3w0w36c088" data-trusted="1" data-global="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="closure.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="closure.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>let value = &quot;Сюрприз!&quot;;

function f() {
  let value = &quot;ближайшее значение&quot;;

  function g() {
    debugger; // в консоли: напишите alert(value); Сюрприз!
  }

  return g;
}

let g = f();
g();</code></pre>
        </div>
      </div>
      
      </div><div class="important important_warn">
            <div class="important__header"><span class="important__type">До встречи!</span></div>
            <div class="important__content"><p>Эту особенность V8 полезно знать. Если вы занимаетесь отладкой в Chrome/Opera, рано или поздно вы с ней встретитесь.</p>
<p>Это не баг в отладчике, а скорее особенность V8. Возможно со временем это изменится.
Вы всегда можете проверить это, запустив пример на этой странице.</p>
</div></div>
</div></article><div class="tasks formatted"><h2 class="tasks__title" id="tasks"><a class="tasks__title-anchor main__anchor main__anchor main__anchor_noicon" href="closure.html#tasks">Задачи</a></h2><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap"><h3 class="task__title"><a class="main__anchor" href="closure.html#nezavisimy-li-schyotchiki" name="nezavisimy-li-schyotchiki">Независимы ли счётчики?</a></h3><a class="task__open-link" href="https://learn.javascript.ru/task/counter-independent" target="_blank"></a></div><div class="task__header-note"><span class="task__importance" title="Насколько эта задача важна для освоения материала, от 1 до 5">важность: 5</span></div><div class="task__content"><div class="task__formatted"><p>Здесь мы делаем два счётчика: <code>counter</code> и <code>counter2</code>, используя одну и ту же функцию <code>makeCounter</code>.</p>
<p>Они независимы? Что покажет второй счётчик? <code>0,1</code> или <code>2,3</code> или что-то ещё?</p>
<div id="olfk6ebmta" data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:14,&quot;end&quot;:15}]">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>function makeCounter() {
  let count = 0;

  return function() {
    return count++;
  };
}

let counter = makeCounter();
let counter2 = makeCounter();

alert( counter() ); // 0
alert( counter() ); // 1

alert( counter2() ); // ?
alert( counter2() ); // ?</code></pre>
        </div>
      </div>
      
      </div></div><button class="task__solution" type="button">решение</button><div class="task__answer"><div class="task__answer-content"><div class="formatted"><p>Ответ: <strong>0,1.</strong></p>
<p>Функции <code>counter</code> и <code>counter2</code> созданы разными вызовами <code>makeCounter</code>.</p>
<p>Так что у них независимые внешние лексические окружения, у каждого из которых свой собственный <code>count</code>.</p>
</div></div><button class="close-button task__answer-close" type="button" title="закрыть"></button></div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap"><h3 class="task__title"><a class="main__anchor" href="closure.html#obekt-schyotchika" name="obekt-schyotchika">Объект счётчика</a></h3><a class="task__open-link" href="https://learn.javascript.ru/task/counter-object-independent" target="_blank"></a></div><div class="task__header-note"><span class="task__importance" title="Насколько эта задача важна для освоения материала, от 1 до 5">важность: 5</span></div><div class="task__content"><div class="task__formatted"><p>Здесь объект счётчика создан с помощью функции-конструктора.</p>
<p>Будет ли он работать? Что покажет?</p>
<div id="1rtvuicoqo" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>function Counter() {
  let count = 0;

  this.up = function() {
    return ++count;
  };
  this.down = function() {
    return --count;
  };
}

let counter = new Counter();

alert( counter.up() ); // ?
alert( counter.up() ); // ?
alert( counter.down() ); // ?</code></pre>
        </div>
      </div>
      
      </div></div><button class="task__solution" type="button">решение</button><div class="task__answer"><div class="task__answer-content"><div class="formatted"><p>Несомненно, он отлично будет работать.</p>
<p>Обе вложенные функции были созданы с одним и тем же внешним лексическим окружением, так что они имеют доступ к одной и той же переменной <code>count</code>:</p>
<div id="6day3bgiv0" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="closure.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="closure.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>function Counter() {
  let count = 0;

  this.up = function() {
    return ++count;
  };

  this.down = function() {
    return --count;
  };
}

let counter = new Counter();

alert( counter.up() ); // 1
alert( counter.up() ); // 2
alert( counter.down() ); // 1</code></pre>
        </div>
      </div>
      
      </div></div></div><button class="close-button task__answer-close" type="button" title="закрыть"></button></div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap"><h3 class="task__title"><a class="main__anchor" href="closure.html#funktsiya-v-if" name="funktsiya-v-if">Функция в if</a></h3><a class="task__open-link" href="https://learn.javascript.ru/task/function-in-if" target="_blank"></a></div><div class="task__header-note"></div><div class="task__content"><div class="task__formatted"><p>Посмотрите на код. Какой будет результат у вызова на последней строке?</p>
<div id="7htlf7tup3" data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:10,&quot;end&quot;:10}]">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="closure.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="closure.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>let phrase = &quot;Hello&quot;;

if (true) {
  let user = &quot;John&quot;;

  function sayHi() {
    alert(`${phrase}, ${user}`);
  }
}

sayHi();</code></pre>
        </div>
      </div>
      
      </div></div><button class="task__solution" type="button">решение</button><div class="task__answer"><div class="task__answer-content"><div class="formatted"><p>Результатом будет <strong>ошибка</strong>.</p>
<p>Функция <code>sayHi</code> объявлена внутри <code>if</code>, так что она живёт только внутри этого блока. Снаружи нет <code>sayHi</code>.</p>
</div></div><button class="close-button task__answer-close" type="button" title="закрыть"></button></div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap"><h3 class="task__title"><a class="main__anchor" href="closure.html#summa-s-pomoschyu-zamykaniy" name="summa-s-pomoschyu-zamykaniy">Сумма с помощью замыканий</a></h3><a class="task__open-link" href="https://learn.javascript.ru/task/closure-sum" target="_blank"></a></div><div class="task__header-note"><span class="task__importance" title="Насколько эта задача важна для освоения материала, от 1 до 5">важность: 4</span></div><div class="task__content"><div class="task__formatted"><p>Напишите функцию <code>sum</code>, которая работает таким образом: <code>sum(a)(b) = a+b</code>.</p>
<p>Да, именно таким образом, используя двойные круглые скобки (не опечатка).</p>
<p>Например:</p>
<div id="qahvg4q4wp" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>sum(1)(2) = 3
sum(5)(-1) = 4</code></pre>
        </div>
      </div>
      
      </div></div><button class="task__solution" type="button">решение</button><div class="task__answer"><div class="task__answer-content"><div class="formatted"><p>Чтобы вторые скобки заработали, первые – должны вернуть функцию.</p>
<p>Вот так:</p>
<div id="6x6x77k2yk" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="closure.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="closure.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>function sum(a) {

  return function(b) {
    return a + b; // берёт &quot;a&quot; из внешнего лексического окружения
  };

}

alert( sum(1)(2) ); // 3
alert( sum(5)(-1) ); // 4</code></pre>
        </div>
      </div>
      
      </div></div></div><button class="close-button task__answer-close" type="button" title="закрыть"></button></div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap"><h3 class="task__title"><a class="main__anchor" href="closure.html#filtratsiya-s-pomoschyu-funktsii" name="filtratsiya-s-pomoschyu-funktsii">Фильтрация с помощью функции</a></h3><a class="task__open-link" href="https://learn.javascript.ru/task/filter-through-function" target="_blank"></a></div><div class="task__header-note"><span class="task__importance" title="Насколько эта задача важна для освоения материала, от 1 до 5">важность: 5</span></div><div class="task__content"><div class="task__formatted"><p>У нас есть встроенный метод <code>arr.filter(f)</code> для массивов. Он фильтрует все элементы с помощью функции <code>f</code>. Если она возвращает <code>true</code>, то элемент добавится в возвращаемый массив.</p>
<p>Сделайте набор «готовых к употреблению» фильтров:</p>
<ul>
<li><code>inBetween(a, b)</code> – между <code>a</code> и <code>b</code> (включительно).</li>
<li><code>inArray([...])</code> – находится в данном массиве.</li>
</ul>
<p>Они должны использоваться таким образом:</p>
<ul>
<li><code>arr.filter(inBetween(3,6))</code> – выбирает только значения между 3 и 6 (включительно).</li>
<li><code>arr.filter(inArray([1,2,3]))</code> – выбирает только элементы, совпадающие с одним из элементов массива</li>
</ul>
<p>Например:</p>
<div id="v2g6jcjage" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>/* .. ваш код для inBetween и inArray */
let arr = [1, 2, 3, 4, 5, 6, 7];

alert( arr.filter(inBetween(3, 6)) ); // 3,4,5,6

alert( arr.filter(inArray([1, 2, 10])) ); // 1,2</code></pre>
        </div>
      </div>
      
      </div><p><a href="https://plnkr.co/edit/dA4fYxP60caacyqz?p=preview" target="_blank" data-plunk-id="dA4fYxP60caacyqz">Открыть песочницу с тестами для задачи.</a></p></div><button class="task__solution" type="button">решение</button><div class="task__answer"><div class="task__step task__step_open"><button class="task__step-show" type="button" onclick="showStep(this)">Фильтр inBetween</button><div class="task__answer-content"><h4 class="task__step-title">Фильтр inBetween</h4><div class="formatted"><div id="ooouobryox" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="closure.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="closure.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>function inBetween(a, b) {
  return function(x) {
    return x &gt;= a &amp;&amp; x &lt;= b;
  };
}

let arr = [1, 2, 3, 4, 5, 6, 7];
alert( arr.filter(inBetween(3, 6)) ); // 3,4,5,6</code></pre>
        </div>
      </div>
      
      </div></div></div></div><div class="task__step task__step_open"><button class="task__step-show" type="button" onclick="showStep(this)">Фильтр inArray</button><div class="task__answer-content"><h4 class="task__step-title">Фильтр inArray</h4><div class="formatted"><div id="tben1mr9xc" data-trusted="1" class="code-example" data-demo="1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="closure.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="closure.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>function inArray(arr) {
  return function(x) {
    return arr.includes(x);
  };
}

let arr = [1, 2, 3, 4, 5, 6, 7];
alert( arr.filter(inArray([1, 2, 10])) ); // 1,2</code></pre>
        </div>
      </div>
      
      </div><p><a href="https://plnkr.co/edit/xkaYaqlf1hmRyrBR?p=preview" target="_blank" data-plunk-id="xkaYaqlf1hmRyrBR">Открыть решение с тестами в песочнице.</a></p></div></div></div><button class="close-button task__answer-close" type="button" title="закрыть"></button></div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap"><h3 class="task__title"><a class="main__anchor" href="closure.html#sortirovat-po-polyu" name="sortirovat-po-polyu">Сортировать по полю</a></h3><a class="task__open-link" href="https://learn.javascript.ru/task/sort-by-field" target="_blank"></a></div><div class="task__header-note"><span class="task__importance" title="Насколько эта задача важна для освоения материала, от 1 до 5">важность: 5</span></div><div class="task__content"><div class="task__formatted"><p>У нас есть массив объектов, который нужно отсортировать:</p>
<div id="1lu1fgfj8r" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>let users = [
  { name: &quot;John&quot;, age: 20, surname: &quot;Johnson&quot; },
  { name: &quot;Pete&quot;, age: 18, surname: &quot;Peterson&quot; },
  { name: &quot;Ann&quot;, age: 19, surname: &quot;Hathaway&quot; }
];</code></pre>
        </div>
      </div>
      
      </div><p>Обычный способ был бы таким:</p>
<div id="4ll58nhwvx" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>// по имени (Ann, John, Pete)
users.sort((a, b) =&gt; a.name &gt; b.name ? 1 : -1);

// по возрасту (Pete, Ann, John)
users.sort((a, b) =&gt; a.age &gt; b.age ? 1 : -1);</code></pre>
        </div>
      </div>
      
      </div><p>Можем ли мы сделать его короче, скажем, вот таким?</p>
<div id="wff3erqfhm" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>users.sort(byField('name'));
users.sort(byField('age'));</code></pre>
        </div>
      </div>
      
      </div><p>То есть, чтобы вместо функции, мы просто писали <code>byField(fieldName)</code>.</p>
<p>Напишите функцию <code>byField</code>, которая может быть использована для этого.</p>
</div><button class="task__solution" type="button">решение</button><div class="task__answer"><div class="task__answer-content"><div class="formatted"><div id="e7n37hvkbc" data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:6,&quot;end&quot;:8}]">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="closure.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="closure.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>let users = [
  { name: &quot;John&quot;, age: 20, surname: &quot;Johnson&quot; },
  { name: &quot;Pete&quot;, age: 18, surname: &quot;Peterson&quot; },
  { name: &quot;Ann&quot;, age: 19, surname: &quot;Hathaway&quot; }
];

function byField(field) {
  return (a, b) =&gt; a[field] &gt; b[field] ? 1 : -1;
}

users.sort(byField('name'));
users.forEach(user =&gt; alert(user.name)); // Ann, John, Pete

users.sort(byField('age'));
users.forEach(user =&gt; alert(user.name)); // Pete, Ann, John</code></pre>
        </div>
      </div>
      
      </div></div></div><button class="close-button task__answer-close" type="button" title="закрыть"></button></div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap"><h3 class="task__title"><a class="main__anchor" href="closure.html#armiya-funktsiy" name="armiya-funktsiy">Армия функций</a></h3><a class="task__open-link" href="https://learn.javascript.ru/task/make-army" target="_blank"></a></div><div class="task__header-note"><span class="task__importance" title="Насколько эта задача важна для освоения материала, от 1 до 5">важность: 5</span></div><div class="task__content"><div class="task__formatted"><p>Следующий код создаёт массив из стрелков (<code>shooters</code>).</p>
<p>Каждая функция предназначена выводить их порядковые номера. Но что-то пошло не так…</p>
<div id="ijcfoeqte7" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="closure.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="closure.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>function makeArmy() {
  let shooters = [];

  let i = 0;
  while (i &lt; 10) {
    let shooter = function() { // функция shooter
      alert( i ); // должна выводить порядковый номер
    };
    shooters.push(shooter);
    i++;
  }

  return shooters;
}

let army = makeArmy();

army[0](); // у 0-го стрелка будет номер 10
army[5](); // и у 5-го стрелка тоже будет номер 10
// ... у всех стрелков будет номер 10, вместо 0, 1, 2, 3...</code></pre>
        </div>
      </div>
      
      </div><p>Почему у всех стрелков одинаковые номера? Почините код, чтобы он работал как задумано.</p>
<p><a href="https://plnkr.co/edit/s1Sjfo4h7Rm3wR70?p=preview" target="_blank" data-plunk-id="s1Sjfo4h7Rm3wR70">Открыть песочницу с тестами для задачи.</a></p></div><button class="task__solution" type="button">решение</button><div class="task__answer"><div class="task__answer-content"><div class="formatted"><p>Давайте посмотрим, что происходит внутри <code>makeArmy</code>, и решение станет очевидным.</p>
<ol>
<li>
<p>Она создаёт пустой массив <code>shooters</code>:</p>
<div id="nvola9b388" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>let shooters = [];</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>В цикле заполняет его <code>shooters.push(function...)</code>.</p>
<p>Каждый элемент – это функция, так что получится такой массив:</p>
<div id="erob0m3sjg" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>shooters = [
  function () { alert(i); },
  function () { alert(i); },
  function () { alert(i); },
  function () { alert(i); },
  function () { alert(i); },
  function () { alert(i); },
  function () { alert(i); },
  function () { alert(i); },
  function () { alert(i); },
  function () { alert(i); }
];</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>Функция возвращает массив.</p>
</li>
</ol>
<p>Позже вызов <code>army[5]()</code> получит элемент <code>army[5]</code> из массива (это будет функция) и вызовет её.</p>
<p>Теперь, почему все эти функции показывают одно и то же?</p>
<p>Всё потому, что внутри функций  <code>shooter</code> нет локальной переменной <code>i</code>. Когда вызывается такая функция, она берёт <code>i</code> из своего внешнего лексического окружения.</p>
<p>Какое будет значение у <code>i</code>?</p>
<p>Если мы посмотрим в исходный код:</p>
<div id="3xwr7fb07e" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>function makeArmy() {
  ...
  let i = 0;
  while (i &lt; 10) {
    let shooter = function() { // функция shooter
      alert( i ); // должна выводить порядковый номер
    };
    ...
  }
  ...
}</code></pre>
        </div>
      </div>
      
      </div><p>…Мы увидим, что оно живёт в лексическом окружении, связанном с текущим вызовом <code>makeArmy()</code>. Но, когда вызывается <code>army[5]()</code>, <code>makeArmy</code> уже завершила свою работу, и последнее значение <code>i</code>: 10 (конец цикла <code>while</code>).</p>
<p>Как результат, все функции <code>shooter</code> получат одно и то же из внешнего окружения: последнее значение <code>i=10</code>.</p>
<p>Мы можем это исправить, переместив определение переменной в цикл:</p>
<div id="b7toxeswda" data-trusted="1" class="code-example" data-demo="1" data-highlight="[{&quot;start&quot;:4,&quot;end&quot;:4}]">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="closure.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="closure.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>function makeArmy() {

  let shooters = [];

  for(let i = 0; i &lt; 10; i++) {
    let shooter = function() { // функция shooter
      alert( i ); // должна выводить порядковый номер
    };
    shooters.push(shooter);


  }

  return shooters;
}

let army = makeArmy();

army[0](); // 0
army[5](); // 5</code></pre>
        </div>
      </div>
      
      </div><p>Теперь она работает правильно, потому что каждый раз, когда выполняется блок кода <code>for (let i=0...) {...}</code>, для него создаётся новое лексическое окружение с соответствующей переменной <code>i</code>.</p>
<p>Так что значение <code>i</code> теперь живёт немного ближе. Не в лексическом окружении <code>makeArmy()</code>, а в лексическом окружении, которое соответствует текущей итерации цикла. Вот почему теперь она работает.</p>
<figure><div class="image" style="width:566px">
      <div class="image__ratio" style="padding-top:32.332155477031804%"></div>
      <object type="image/svg+xml" data="https://learn.javascript.ru/task/make-army/lexenv-makearmy.svg" width="566" height="183" class="image__image" data-use-theme>
        <img src="https://learn.javascript.ru/task/make-army/lexenv-makearmy.svg" alt="" width="566" height="183">
      </object>
      </div></figure><p>Здесь мы переписали <code>while</code> в <code>for</code>.</p>
<p>Можно использовать другой трюк, давайте рассмотрим его для лучшего понимания предмета:</p>
<div id="bxc3z8dlvo" data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:7,&quot;cols&quot;:[{&quot;start&quot;:13,&quot;end&quot;:14}]},{&quot;start&quot;:5,&quot;end&quot;:5}]">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="closure.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="closure.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>function makeArmy() {
  let shooters = [];

  let i = 0;
  while (i &lt; 10) {
    let j = i;
    let shooter = function() { // функция shooter
      alert( j ); // должна выводить порядковый номер
    };
    shooters.push(shooter);
    i++;
  }

  return shooters;
}

let army = makeArmy();

army[0](); // 0
army[5](); // 5</code></pre>
        </div>
      </div>
      
      </div><p>Цикл <code>while</code> так же, как и <code>for</code>, создаёт новое лексическое окружение для каждой итерации. Так что тут мы хотим убедиться, что он получит правильное значение для <code>shooter</code>.</p>
<p>Мы копируем <code>let j = i</code>. Это создаёт локальную для итерации переменную <code>j</code> и копирует в неё <code>i</code>. Примитивы копируются «по значению», поэтому мы получаем совершенно независимую копию <code>i</code>, принадлежащую текущей итерации цикла.</p>
<p><a href="https://plnkr.co/edit/TSzltIf5aRqMWr7e?p=preview" target="_blank" data-plunk-id="TSzltIf5aRqMWr7e">Открыть решение с тестами в песочнице.</a></p></div></div><button class="close-button task__answer-close" type="button" title="закрыть"></button></div></div></div></div></div></div><div class="page__nav-wrap"><a class="page__nav page__nav_prev" href="https://learn.javascript.ru/rest-parameters-spread-operator" data-tooltip="Остаточные параметры и оператор расширения"><span class="page__nav-text"><span class="page__nav-text-shortcut"></span></span><span class="page__nav-text-alternate">Предыдущий урок</span></a><a class="page__nav page__nav_next" href="https://learn.javascript.ru/var" data-tooltip="Устаревшее ключевое слово &quot;var&quot;"><span class="page__nav-text"><span class="page__nav-text-shortcut"></span></span><span class="page__nav-text-alternate">Следующий урок</span></a></div><div class="article-tablet-foot tablet-only"><div class="article-tablet-foot__layout"><div class="share-icons"><span class="share-icons__title">Поделиться</span><a class="share share_tw" href="https://twitter.com/share?url=https%3A%2F%2Flearn.javascript.ru%2Fclosure" rel="nofollow"></a><a class="share share_fb" href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=https%3A%2F%2Flearn.javascript.ru%2Fclosure" rel="nofollow"></a><a class="share share_vk" href="https://vkontakte.ru/share.php?url=https%3A%2F%2Flearn.javascript.ru%2Fclosure" rel="nofollow"></a></div><div class="article-tablet-foot__map"><a class="map" href="https://learn.javascript.ru/tutorial/map" data-action="tutorial-map"><span class="map__text">Карта учебника</span></a></div></div></div><div class="banner-bottom"><div class="banner-bottom__text">Проводим <a href="https://learn.javascript.ru/courses">курсы по JavaScript и фреймворкам</a>.</div><button class="banner-bottom__close" data-banner-close="Courses" data-banner-close-message="Эта информация больше не будет выводиться." title="не показывать"></button></div><script>!!1&&"hideBannerCourses"in localStorage||(document.querySelector(".banner-bottom").style.display="flex");</script><div class="comments formatted" id="comments"><div class="comments__header"><h2 class="comments__header-title"><a href="closure.html#comments" name="comments">Комментарии</a></h2><div class="comments__read-before"><span class="comments__read-before-link">перед тем как писать…</span><div class="comments__read-before-popup"><div class="comments__read-before-popup-i"><ul><li>Если вам кажется, что в статье что-то не так - вместо комментария напишите <a href="https://github.com/javascript-tutorial/ru.javascript.info/issues/new">на GitHub</a>.</li><li>Для одной строки кода используйте тег <code>&lt;code&gt;</code>, для нескольких строк кода&nbsp;&mdash; тег <code>&lt;pre&gt;</code>, если больше 10 строк&nbsp;&mdash; ссылку на песочницу (<a href='https://plnkr.co/edit/?p=preview'>plnkr</a>, <a href='http://jsbin.com'>JSBin</a>, <a href='http://codepen.io'>codepen</a>…)</li><li>Если что-то непонятно в статье&nbsp;&mdash; пишите, что именно и с какого места.</li></ul></div></div></div></div><div id="disqus_thread"></div><script>var disqus_config = function() { if (!this.page) this.page = {}; Object.assign(this.page, {"url":"https:\/\/learn.javascript.ru\/closure","identifier":"\/closure"}); };</script><script>var disqus_shortname = "learnjavascriptru";</script><script>var disqus_enabled = true;</script></div></main></div><div class="sidebar page__sidebar sidebar sidebar_sticky-footer"><button class="sidebar__toggle" data-sidebar-toggle></button><a class="map" href="https://learn.javascript.ru/tutorial/map" data-action="tutorial-map" data-tooltip="Карта учебника"></a><div class="sidebar__inner"><div class="sidebar__content"><div class="sidebar__section"><h4 class="sidebar__section-title">Раздел</h4><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a class="sidebar__link" href="https://learn.javascript.ru/advanced-functions">Продвинутая работа с функциями</a></li></ul></nav></div><div class="sidebar__section"><h4 class="sidebar__section-title">Навигация по уроку</h4><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a class="sidebar__link" href="closure.html#para-voprosov">Пара вопросов</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="closure.html#leksicheskoe-okruzhenie">Лексическое Окружение</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="closure.html#vlozhennye-funktsii">Вложенные функции</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="closure.html#okruzhenie-v-detalyah">Окружение в деталях</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="closure.html#bloki-koda-i-tsikly-iife">Блоки кода и циклы, IIFE</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="closure.html#sborka-musora">Сборка мусора</a></li></ul></nav></div><div class="sidebar__section"><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a class="sidebar__link" href="closure.html#tasks">Задачи (7)</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="closure.html#comments">Комментарии</a></li></ul></nav></div><div class="sidebar__section"><div class="sidebar__section-title">Поделиться</div><a class="share share_tw sidebar__share" href="https://twitter.com/share?url=https%3A%2F%2Flearn.javascript.ru%2Fclosure" rel="nofollow"></a><a class="share share_fb sidebar__share" href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p[url]=https%3A%2F%2Flearn.javascript.ru%2Fclosure" rel="nofollow"></a></div><div class="sidebar__section"><a class="sidebar__link" href="https://github.com/javascript-tutorial/ru.javascript.info/blob/master/1-js/06-advanced-functions/03-closure" rel="nofollow">Редактировать на GitHub</a></div></div></div></div></div></div><div class="page-footer"><ul class="page-footer__list"><li class="page-footer__item page-footer__item_copy">©&nbsp;2007—2022&nbsp; Илья Кантор</li><li class="page-footer__item page-footer__item_about"><a class="page-footer__link" href="https://learn.javascript.ru/about">о проекте</a></li><li class="page-footer__item page-footer__item_contact"><a class="page-footer__link" href="https://learn.javascript.ru/about#contact-us">связаться с нами</a></li><li class="page-footer__item page-footer__item_terms"><a class="page-footer__link" href="https://learn.javascript.ru/terms">пользовательское соглашение</a></li><li class="page-footer__item page-footer__item_privacy"><a class="page-footer__link" href="https://learn.javascript.ru/privacy">политика конфиденциальности</a></li><li class="page-footer__item page-footer__item_slack"><a class="page-footer__slack" href="http://slack.javascript.ru">slack-чат</a></li></ul></div></body></html>