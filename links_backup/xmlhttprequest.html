<!DOCTYPE html><html lang="ru" data-theme-enabled="1"><head><script>window.currentUser = null;</script><script>window.rateUsdToNative = 98.8745;</script><title itemprop="name">XMLHttpRequest</title><link href="https://learn.javascript.ru/pack/styles.151c2ad2b575d09af8f5.css" rel="stylesheet"><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes, minimum-scale=1.0"><meta name="apple-mobile-web-app-capable" content="yes"><!-- chrome autotranslate is enabled only for "en" main version--><meta name="google" content="notranslate"><script>if (window.devicePixelRatio > 1) document.cookie = 'pixelRatio=' + window.devicePixelRatio + ';path=/;expires=Tue, 19 Jan 2038 03:14:07 GMT';</script><link href="https://fonts.googleapis.com/css?family=Open+Sans:bold,italic,bolditalic" rel="stylesheet"><link rel="apple-touch-icon-precomposed" href="https://learn.javascript.ru/img/favicon/apple-touch-icon-precomposed.png"><link rel="canonical" href="xmlhttprequest.html"><meta name="msapplication-TileColor" content="#222A2C"><meta name="msapplication-TileImage" content="/img/favicon/tileicon.png"><link rel="icon" href="https://learn.javascript.ru/img/favicon/favicon.png"><meta itemprop="image" content="https://learn.javascript.ru/img/site_preview_ru_512x512.png"><meta property="og:title" content="XMLHttpRequest"><meta property="og:image" content="https://learn.javascript.ru/img/site_preview_ru_1200x630.png"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="fb:admins" content="100001562528165"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="XMLHttpRequest"><meta name="twitter:site" content="@iliakan"><meta name="twitter:creator" content="@iliakan"><meta name="twitter:image" content="https://learn.javascript.ru/img/site_preview_ru_512x512.png"><link rel="prev" href="https://learn.javascript.ru/url"><link rel="next" href="https://learn.javascript.ru/resume-upload"><script>window.GA_ID = "UA-2056213-16";</script><script>window.GTM_ID = 'GTM-WD2DZPG'</script><script>window.YANDEX_METRIKA_ID = 17649010;</script><script>window.GoogleAnalyticsObject="ga",window.ga=function(){window.ga.q.push(arguments)},window.ga.q=[],window.ga.l=Date.now(),ga("create",GA_ID,"auto"),window.GTM_ID&&ga("require",GTM_ID),window.currentUser?ga("set","&uid",currentUser.id):ga("set","anonymizeIp",!0),window.addEventListener("error",function(e){var r=(e.filename||e.errorUrl)+": "+(e.lineno||e.errorLine),n=e.stack||e.error&&e.error.stack;ga("send","exception",{exDescription:e.message+" "+r+" "+n,exFatal:!0})});</script><script src="https://www.google-analytics.com/analytics.js" async></script><script>ga('send', 'pageview');</script><script>window.metrika={reachGoal:function(){}},window.yandex_metrika_callbacks=[function(){try{window.metrika=new Ya.Metrika({id:YANDEX_METRIKA_ID,webvisor:!0,clickmap:!0,params:{user:window.currentUser&&window.currentUser.id}}),metrika.trackLinks({delay:150}),window.addEventListener("error",function(r){window.metrika.reachGoal("JSERROR",{src:(r.filename||r.errorUrl)+": "+(r.lineno||r.errorLine),stack:r.stack||r.error&&r.error.stack,message:r.message})})}catch(r){}}];</script><script src="https://mc.yandex.ru/metrika/watch.js" async></script><script>window.RECAPTCHA_ID = "6LfmLAEVAAAAAJMykMnf7aY8nkyTRmYi2ynx51R1";</script><script src="https://learn.javascript.ru/pack/init.f43ee4b37d6f76e4f838.js"></script><script src="https://learn.javascript.ru/pack/head.9546f64faccf13e736f6.js" defer></script><meta property="og:title" content="XMLHttpRequest"><meta property="og:type" content="article"><script src="https://learn.javascript.ru/pack/tutorial.f792acb067a354bc7904.js" defer></script><script src="https://learn.javascript.ru/pack/footer.440ca4f81c63a09affe0.js" defer></script></head><body class="no-icons"><script>window.fontTest();</script><div class="page-wrapper page-wrapper_sidebar_on"><!--[if IE]><div style="color:red;text-align:center">Извините, Internet Explorer не поддерживается, пожалуйста используйте более новый браузер.</div><![endif]--><div class="sitetoolbar sitetoolbar_tutorial"><script>window.langs = [{"code":"ar","name":"Arabic"},{"code":"az","name":"Azerbaijani"},{"code":"bg","name":"Bulgarian"},{"code":"bn","name":"Bengali"},{"code":"bs","name":"Bosnian"},{"code":"ca","name":"Catalan"},{"code":"cs","name":"Czech"},{"code":"da","name":"Danish"},{"code":"de","name":"German"},{"code":"el","name":"Greek"},{"code":"en","name":"English"},{"code":"es","name":"Spanish"},{"code":"fa","name":"Persian (Farsi)"},{"code":"fi","name":"Finnish"},{"code":"fr","name":"French"},{"code":"he","name":"Hebrew"},{"code":"hi","name":"Hindi"},{"code":"hr","name":"Croatian"},{"code":"hu","name":"Hungarian"},{"code":"hy","name":"Armenian"},{"code":"id","name":"Indonesian"},{"code":"it","name":"Italian"},{"code":"ja","name":"Japanese"},{"code":"ka","name":"Georgian"},{"code":"kk","name":"Kazakh"},{"code":"km","name":"Central Khmer"},{"code":"ko","name":"Korean"},{"code":"lt","name":"Lithuanian"},{"code":"me","name":"Montenegrin"},{"code":"ml","name":"Malayalam"},{"code":"my","name":"Burmese"},{"code":"nl","name":"Dutch"},{"code":"no","name":"Norvegian"},{"code":"pa","name":"Punjabi"},{"code":"pl","name":"Polish"},{"code":"pt","name":"Portuguese"},{"code":"ro","name":"Romanian"},{"code":"ru","name":"Russian"},{"code":"si","name":"Sinhala"},{"code":"sk","name":"Slovak"},{"code":"sl","name":"Slovenian"},{"code":"sq","name":"Albanian"},{"code":"sr","name":"Serbian"},{"code":"ta","name":"Tamil"},{"code":"te","name":"Telugu"},{"code":"test","name":"Test"},{"code":"th","name":"Thai"},{"code":"tk","name":"Turkmen"},{"code":"tr","name":"Turkish"},{"code":"uk","name":"Ukrainian"},{"code":"ur","name":"Urdu"},{"code":"uz","name":"Uzbek"},{"code":"v2","name":"v2"},{"code":"vi","name":"Vietnamese"},{"code":"zh-hant","name":"Chinese Traditional"},{"code":"zh","name":"Chinese"}];</script><script>window.lang = "ru";</script><script>{let t=navigator.languages||[];t=t.map(t=>t.toLowerCase());let o,i,n=[];for(let o of window.langs)for(let i of t)if(i===o.code||i.startsWith(o.code+"-")){n.push(o);break}if(!o&&"ru"!=lang&&"en"!=lang){n.find(t=>"en"==t.code)&&(o=`\n            According to your browser headers, you know English. Please help to <a href="https://github.com/javascript-tutorial/${lang}.javascript.info#readme">translate the tutorial</a>.\n            Thank you!\n          `,i="notify-translate-tutorial-local")}if(o){let t=`<div class="notification notification_top notification_info sitetoolbar__notification" style="display:none" id="${i}">\n          <div class="notification__content">${o}</div>\n          <button class="notification__close" title="Close"></button>\n        </div>`;document.write(t),showTopNotification()}}</script><div class="sitetoolbar__content"><div class="sitetoolbar__lang-switcher"><button class="sitetoolbar__dropdown-button" data-dropdown-toggler>RU</button><div class="sitetoolbar__dropdown-wrap"><div class="sitetoolbar__dropdown-body"><div class="sitetoolbar__lang-switcher-body"><div class="supported-langs supported-langs_toolbar"><div class="supported-langs__container"><ul class="supported-langs__list" style="height:200px"><li class="supported-langs__item"><a class="supported-langs__link" href="https://ar.javascript.info/"><span class="supported-langs__brief">AR</span><span class="supported-langs__title">عربي</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://javascript.info/xmlhttprequest"><span class="supported-langs__brief">EN</span><span class="supported-langs__title">English</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://es.javascript.info/xmlhttprequest"><span class="supported-langs__brief">ES</span><span class="supported-langs__title">Español</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://fr.javascript.info/xmlhttprequest"><span class="supported-langs__brief">FR</span><span class="supported-langs__title">Français</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://id.javascript.info/"><span class="supported-langs__brief">ID</span><span class="supported-langs__title">Indonesia</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://it.javascript.info/xmlhttprequest"><span class="supported-langs__brief">IT</span><span class="supported-langs__title">Italiano</span></a></li></ul><ul class="supported-langs__list" style="height:200px"><li class="supported-langs__item"><a class="supported-langs__link" href="https://ja.javascript.info/xmlhttprequest"><span class="supported-langs__brief">JA</span><span class="supported-langs__title">日本語</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://ko.javascript.info/"><span class="supported-langs__brief">KO</span><span class="supported-langs__title">한국어</span></a></li><li class="supported-langs__item supported-langs__item_current"><a class="supported-langs__link" href="xmlhttprequest.html"><span class="supported-langs__brief">RU</span><span class="supported-langs__title">Русский</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://tr.javascript.info/xmlhttprequest"><span class="supported-langs__brief">TR</span><span class="supported-langs__title">Türkçe</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://uk.javascript.info/xmlhttprequest"><span class="supported-langs__brief">UK</span><span class="supported-langs__title">Українська</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://zh.javascript.info/xmlhttprequest"><span class="supported-langs__brief">ZH</span><span class="supported-langs__title">简体中文</span></a></li></ul></div><div class="supported-langs__text">Мы хотим сделать этот проект с открытым исходным кодом доступным для людей во всем мире. Пожалуйста, <a href="https://github.com/javascript-tutorial/translate" rel="noopener noreferrer" target="_blank">помогите нам перевести</a> это руководство на свой язык</div></div></div></div></div></div><div class="sitetoolbar__logo-wrap"><a class="sitetoolbar__link sitetoolbar__link_logo" href="https://learn.javascript.ru/"><img class="sitetoolbar__logo sitetoolbar__logo_normal" src="https://learn.javascript.ru/img/sitetoolbar__logo_ru.svg" width="171" alt="" role="presentation"/><img class="sitetoolbar__logo sitetoolbar__logo_normal sitetoolbar__logo_dark" src="https://learn.javascript.ru/img/sitetoolbar__logo_ru-white.svg" width="171" alt="" role="presentation"/><img class="sitetoolbar__logo sitetoolbar__logo_small" src="https://learn.javascript.ru/img/sitetoolbar__logo_small_ru.svg" width="80" alt="" role="presentation"/><img class="sitetoolbar__logo sitetoolbar__logo_small sitetoolbar__logo_dark" src="https://learn.javascript.ru/img/sitetoolbar__logo_small_ru-white.svg" width="80" alt="" role="presentation"/><script>Array.prototype.forEach.call(document.querySelectorAll("img.sitetoolbar__logo"),function(e){let t=document.createElement("object");t.type="image/svg+xml",t.className=e.className,t.style.cssText="left:0;top:0;position:absolute",t.onload=function(){t.onload=null,e.style.visibility="hidden"},t.data=e.src,e.parentNode.insertBefore(t,e)});</script></a></div><div class="sitetoolbar__nav-toggle-wrap"><button class="sitetoolbar__nav-toggle" type="button"></button></div><nav class="sitetoolbar__sections"><ul class="sitetoolbar__sections-list"><li class="sitetoolbar__section sitetoolbar__section_current"><a class="sitetoolbar__link" href="https://learn.javascript.ru/">Учебник</a></li><li class="sitetoolbar__section"><a class="sitetoolbar__link" href="https://learn.javascript.ru/courses">Курсы</a></li><li class="sitetoolbar__section"><a class="sitetoolbar__link" href="https://javascript.ru/forum/">Форум</a></li><li class="sitetoolbar__section"><a class="sitetoolbar__link" href="https://learn.javascript.ru/quiz">Тесты знаний</a></li><li class="sitetoolbar__section sitetoolbar__section_dropdown"><button class="sitetoolbar__dropdown-button" data-dropdown-toggler>Скринкасты</button><div class="sitetoolbar__dropdown-wrap"><div class="sitetoolbar__dropdown-body"><ul class="sitetoolbar__dropdown-items"><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="https://learn.javascript.ru/screencast/nodejs">Node.js</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="https://learn.javascript.ru/screencast/webpack">Webpack</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="https://learn.javascript.ru/screencast/gulp">Gulp</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="https://learn.javascript.ru/screencast/react">React.js</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="https://learn.javascript.ru/screencast/angular">Angular</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="https://youtu.be/W4hoc24K93E?list=PLDyvV36pndZFHXjXuwA_NywNrVQO0aQqb">Git: курс</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="https://youtu.be/lHacJuru1bc?list=PLDyvV36pndZEB7kWWocU4QSn-G78LoaEE">Git: разное</a></li></ul></div></div></li></ul></nav><div class="sitetoolbar__book-wrap"><a class="buy-book-button" href="https://learn.javascript.ru/ebook"><span class="buy-book-button__extra-text">Купить</span>EPUB/PDF</a></div><div class="sitetoolbar__login-wrap"><button class="sitetoolbar__login sitetoolbar__login_unready" data-action-login></button></div><div class="sitetoolbar__theme-switcher"><div class="theme-changer"><label class="theme-changer__label" for="theme-changer-input" data-tooltip="Сменить тему оформления"><input class="theme-changer__input" type="checkbox" id="theme-changer-input" data-theme-changer="data-theme-changer"/><span class="theme-changer__icon theme-changer__icon_light-theme"></span><span class="theme-changer__icon theme-changer__icon_dark-theme"></span></label></div></div><div class="sitetoolbar__search-wrap"><div class="sitetoolbar__search-content"><button class="sitetoolbar__search-toggle" type="button"></button><form class="sitetoolbar__search" method="GET" action="https://learn.javascript.ru/search"><div class="sitetoolbar__search-input"><div class="text-input"><input class="text-input__control" name="query" placeholder="Искать на Javascript.ru" required="required" type="text"/></div><button class="sitetoolbar__find" type="submit">Найти</button></div></form></div></div></div><div class="tablet-menu"><div class="tablet-menu__line"><div class="tablet-menu__content"><select class="tablet-menu__nav input-select input-select input-select_small" onchange="if(this.value) window.location.href=this.value"><option value="/" selected>Учебник</option><option value="/courses">Курсы</option><option value="https://javascript.ru/forum/">Форум</option><option value="/quiz">Тесты знаний</option></select></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><form class="tablet-menu-search" action="https://learn.javascript.ru/search/"><input class="tablet-menu-search__input" type="search" name="query" placeholder="Поиск в учебнике" required="required"/><button class="tablet-menu-search__button" type="submit" name="type" value="articles">Поиск</button></form></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><a class="map" href="https://learn.javascript.ru/tutorial/map" data-action="tutorial-map"><span class="map__text">Карта учебника</span></a></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><div class="theme-changer theme-changer_tablet-menu theme-changer_has-label"><label class="theme-changer__label" for="theme-changer-input-tablet" data-tooltip="Сменить тему оформления"><input class="theme-changer__input" type="checkbox" id="theme-changer-input-tablet" data-theme-changer="data-theme-changer"/><span class="theme-changer__icon theme-changer__icon_light-theme"></span><span class="theme-changer__icon theme-changer__icon_dark-theme"></span><span class="theme-changer__label-text theme-changer__label-text_light-theme">Светлая тема</span><span class="theme-changer__label-text theme-changer__label-text_dark-theme">Тёмная тема</span></label></div></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><div class="share-icons"><span class="share-icons__title">Поделиться</span><a class="share share_tw" href="https://twitter.com/share?url=https%3A%2F%2Flearn.javascript.ru%2Fxmlhttprequest" rel="nofollow"></a><a class="share share_fb" href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=https%3A%2F%2Flearn.javascript.ru%2Fxmlhttprequest" rel="nofollow"></a><a class="share share_vk" href="https://vkontakte.ru/share.php?url=https%3A%2F%2Flearn.javascript.ru%2Fxmlhttprequest" rel="nofollow"></a></div></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><select class="tablet-menu__nav input-select input-select input-select_small" onchange="if(this.value) window.location.href=this.value"><option value="https://ar.javascript.info/">عربي</option><option value="https://javascript.info/xmlhttprequest">English</option><option value="https://es.javascript.info/xmlhttprequest">Español</option><option value="https://fr.javascript.info/xmlhttprequest">Français</option><option value="https://id.javascript.info/">Indonesia</option><option value="https://it.javascript.info/xmlhttprequest">Italiano</option><option value="https://ja.javascript.info/xmlhttprequest">日本語</option><option value="https://ko.javascript.info/">한국어</option><option value="https://learn.javascript.ru/xmlhttprequest" selected>Русский</option><option value="https://tr.javascript.info/xmlhttprequest">Türkçe</option><option value="https://uk.javascript.info/xmlhttprequest">Українська</option><option value="https://zh.javascript.info/xmlhttprequest">简体中文</option></select></div></div></div><progress class="tutorial-progress" data-sticky value="8" max="12" data-tooltip="Урок 8 из 12"></progress></div><div class="page page_sidebar_on page_inner_padding"><script>if(localStorage.noSidebar){document.querySelector(".page").classList.remove("page_sidebar_on");let e=document.querySelector(".page-wrapper");e&&e.classList.remove("page-wrapper_sidebar_on")}setTimeout(function(){document.querySelector(".page").classList.add("page_sidebar-animation-on")});</script><div class="page__inner"><main class="main main_width-limit"><header class="main__header"><div class="main__header-inner"><div class="main__header-group"><ol class="breadcrumbs"><li class="breadcrumbs__item breadcrumbs__item_home"><a class="breadcrumbs__link" href="https://learn.javascript.ru/"><span class="breadcrumbs__hidden-text">Учебник</span></a></li><li class="breadcrumbs__item" id="breadcrumb-1"><a class="breadcrumbs__link" href="https://learn.javascript.ru/network"><span>Сетевые запросы</span></a></li><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Учебник","item":"https://learn.javascript.ru/"},{"@type":"ListItem","position":2,"name":"Сетевые запросы","item":"https://learn.javascript.ru/network"}]}</script></ol><div class="updated-at" data-tooltip="Последнее обновление: 6-го сентября 2020"><div class="updated-at__content">6-го сентября 2020</div></div></div><h1 class="main__header-title">XMLHttpRequest</h1></div></header><div class="content"><article class="formatted" itemscope itemtype="http://schema.org/TechArticle"><meta itemprop="name" content="XMLHttpRequest"><div itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="email" content="iliakan@gmail.com"><meta itemprop="name" content="Ilya Kantor"></div><div itemprop="articleBody"><p><code>XMLHttpRequest</code> – это встроенный в браузер объект, который даёт возможность делать HTTP-запросы к серверу без перезагрузки страницы.</p>
<p>Несмотря на наличие слова «XML» в названии, XMLHttpRequest может работать с любыми данными, а не только с XML. Мы можем загружать/скачивать файлы, отслеживать прогресс и многое другое.</p>
<p>На сегодняшний день не обязательно использовать <code>XMLHttpRequest</code>, так как существует другой, более современный метод <code>fetch</code>.</p>
<p>В современной веб-разработке <code>XMLHttpRequest</code> используется по трём причинам:</p>
<ol>
<li>По историческим причинам: существует много кода, использующего <code>XMLHttpRequest</code>, который нужно поддерживать.</li>
<li>Необходимость поддерживать старые браузеры и нежелание использовать полифилы (например, чтобы уменьшить количество кода).</li>
<li>Потребность в функциональности, которую <code>fetch</code> пока что не может предоставить, к примеру, отслеживание прогресса отправки на сервер.</li>
</ol>
<p>Что-то из этого списка звучит знакомо? Если да, тогда вперёд, приятного знакомства с <code>XMLHttpRequest</code>. Если же нет, возможно, имеет смысл изучать сразу <a href="https://learn.javascript.ru/fetch">Fetch</a>.</p>
<h2><a class="main__anchor" name="osnovy" href="xmlhttprequest.html#osnovy">Основы</a></h2><p>XMLHttpRequest имеет два режима работы: синхронный и асинхронный.</p>
<p>Сначала рассмотрим асинхронный, так как в большинстве случаев используется именно он.</p>
<p>Чтобы сделать запрос, нам нужно выполнить три шага:</p>
<ol>
<li>
<p>Создать <code>XMLHttpRequest</code>.</p>
<div id="thoz79iolg" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>let xhr = new XMLHttpRequest(); // у конструктора нет аргументов</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>Инициализировать его.</p>
<div id="dk7kc9afgc" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>xhr.open(method, URL, [async, user, password])</code></pre>
        </div>
      </div>
      
      </div><p>Этот метод обычно вызывается сразу после <code>new XMLHttpRequest</code>. В него передаются основные параметры запроса:</p>
<ul>
<li><code>method</code> – HTTP-метод. Обычно это <code>&quot;GET&quot;</code> или <code>&quot;POST&quot;</code>.</li>
<li><code>URL</code> – URL, куда отправляется запрос: строка, может быть и объект <a href="https://learn.javascript.ru/url">URL</a>.</li>
<li><code>async</code> – если указать <code>false</code>, тогда запрос будет выполнен синхронно, это мы рассмотрим чуть позже.</li>
<li><code>user</code>, <code>password</code> – логин и пароль для базовой HTTP-авторизации (если требуется).</li>
</ul>
<p>Заметим, что вызов <code>open</code>, вопреки своему названию, не открывает соединение. Он лишь конфигурирует запрос, но непосредственно отсылается запрос только лишь после вызова <code>send</code>.</p>
</li>
<li>
<p>Послать запрос.</p>
<div id="stsovi3lbu" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>xhr.send([body])</code></pre>
        </div>
      </div>
      
      </div><p>Этот метод устанавливает соединение и отсылает запрос к серверу. Необязательный параметр <code>body</code> содержит тело запроса.</p>
<p>Некоторые типы запросов, такие как <code>GET</code>, не имеют тела. А некоторые, как, например, <code>POST</code>, используют <code>body</code>, чтобы отправлять данные на сервер. Мы позже увидим примеры.</p>
</li>
<li>
<p>Слушать события на <code>xhr</code>, чтобы получить ответ.</p>
<p>Три наиболее используемых события:</p>
<ul>
<li><code>load</code> – происходит, когда получен какой-либо ответ, включая ответы с HTTP-ошибкой, например 404.</li>
<li><code>error</code> – когда запрос не может быть выполнен, например, нет соединения или невалидный URL.</li>
<li><code>progress</code> – происходит периодически во время загрузки ответа, сообщает о прогрессе.</li>
</ul>
<div id="l9f5vub58q" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>xhr.onload = function() {
  alert(`Загружено: ${xhr.status} ${xhr.response}`);
};

xhr.onerror = function() { // происходит, только когда запрос совсем не получилось выполнить
  alert(`Ошибка соединения`);
};

xhr.onprogress = function(event) { // запускается периодически
  // event.loaded - количество загруженных байт
  // event.lengthComputable = равно true, если сервер присылает заголовок Content-Length
  // event.total - количество байт всего (только если lengthComputable равно true)
  alert(`Загружено ${event.loaded} из ${event.total}`);
};</code></pre>
        </div>
      </div>
      
      </div></li>
</ol>
<p>Вот полный пример. Код ниже загружает <code>/article/xmlhttprequest/example/load</code> с сервера и сообщает о прогрессе:</p>
<div id="xd06vwwh3y" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="xmlhttprequest.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="xmlhttprequest.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>// 1. Создаём новый XMLHttpRequest-объект
let xhr = new XMLHttpRequest();

// 2. Настраиваем его: GET-запрос по URL /article/.../load
xhr.open('GET', '/article/xmlhttprequest/example/load');

// 3. Отсылаем запрос
xhr.send();

// 4. Этот код сработает после того, как мы получим ответ сервера
xhr.onload = function() {
  if (xhr.status != 200) { // анализируем HTTP-статус ответа, если статус не 200, то произошла ошибка
    alert(`Ошибка ${xhr.status}: ${xhr.statusText}`); // Например, 404: Not Found
  } else { // если всё прошло гладко, выводим результат
    alert(`Готово, получили ${xhr.response.length} байт`); // response -- это ответ сервера
  }
};

xhr.onprogress = function(event) {
  if (event.lengthComputable) {
    alert(`Получено ${event.loaded} из ${event.total} байт`);
  } else {
    alert(`Получено ${event.loaded} байт`); // если в ответе нет заголовка Content-Length
  }

};

xhr.onerror = function() {
  alert(&quot;Запрос не удался&quot;);
};</code></pre>
        </div>
      </div>
      
      </div><p>После ответа сервера мы можем получить результат запроса в следующих свойствах <code>xhr</code>:</p>
<dl>
<dt><code>status</code></dt>
<dd>Код состояния HTTP (число): <code>200</code>, <code>404</code>, <code>403</code> и так далее, может быть <code>0</code> в случае, если ошибка не связана с HTTP.</dd>
<dt><code>statusText</code></dt>
<dd>Сообщение о состоянии ответа HTTP (строка): обычно <code>OK</code> для <code>200</code>, <code>Not Found</code> для <code>404</code>, <code>Forbidden</code> для <code>403</code>, и так далее.</dd>
<dt><code>response</code> (в старом коде может встречаться как <code>responseText</code>)</dt>
<dd>Тело ответа сервера.</dd>
</dl>
<p>Мы можем также указать таймаут – промежуток времени, который мы готовы ждать ответ:</p>
<div id="h4ifkqltgu" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>xhr.timeout = 10000; // таймаут указывается в миллисекундах, т.е. 10 секунд</code></pre>
        </div>
      </div>
      
      </div><p>Если запрос не успевает выполниться в установленное время, то он прерывается, и происходит событие <code>timeout</code>.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">URL с параметрами</span></div>
            <div class="important__content"><p>Чтобы добавить к URL параметры, вида <code>?name=value</code>, и корректно закодировать их, можно использовать объект <a href="https://learn.javascript.ru/url">URL</a>:</p>
<div id="o2o0hc82xa" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>let url = new URL('https://google.com/search');
url.searchParams.set('q', 'test me!');

// параметр 'q' закодирован
xhr.open('GET', url); // https://google.com/search?q=test+me%21</code></pre>
        </div>
      </div>
      
      </div></div></div>
<h2><a class="main__anchor" name="tip-otveta" href="xmlhttprequest.html#tip-otveta">Тип ответа</a></h2><p>Мы можем использовать свойство <code>xhr.responseType</code>, чтобы указать ожидаемый тип ответа:</p>
<ul>
<li><code>&quot;&quot;</code> (по умолчанию) – строка,</li>
<li><code>&quot;text&quot;</code> – строка,</li>
<li><code>&quot;arraybuffer&quot;</code> – <code>ArrayBuffer</code> (для бинарных данных, смотрите в <a href="https://learn.javascript.ru/arraybuffer-binary-arrays">ArrayBuffer, бинарные массивы</a>),</li>
<li><code>&quot;blob&quot;</code> – <code>Blob</code> (для бинарных данных, смотрите в <a href="https://learn.javascript.ru/blob">Blob</a>),</li>
<li><code>&quot;document&quot;</code> – XML-документ (может использовать XPath и другие XML-методы),</li>
<li><code>&quot;json&quot;</code> – JSON (парсится автоматически).</li>
</ul>
<p>К примеру, давайте получим ответ в формате JSON:</p>
<div id="c6evjlpoqb" data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:4,&quot;end&quot;:4}]">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="xmlhttprequest.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="xmlhttprequest.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>let xhr = new XMLHttpRequest();

xhr.open('GET', '/article/xmlhttprequest/example/json');

xhr.responseType = 'json';

xhr.send();

// тело ответа {&quot;сообщение&quot;: &quot;Привет, мир!&quot;}
xhr.onload = function() {
  let responseObj = xhr.response;
  alert(responseObj.message); // Привет, мир!
};</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">На заметку:</span></div>
            <div class="important__content"><p>В старом коде вы можете встретить свойства <code>xhr.responseText</code> и даже <code>xhr.responseXML</code>.</p>
<p>Они существуют по историческим причинам, раньше с их помощью получали строки или XML-документы. Сегодня следует устанавливать желаемый тип объекта в <code>xhr.responseType</code> и получать <code>xhr.response</code>, как показано выше.</p>
</div></div>
<h2><a class="main__anchor" name="sostoyaniya-zaprosa" href="xmlhttprequest.html#sostoyaniya-zaprosa">Состояния запроса</a></h2><p>У <code>XMLHttpRequest</code> есть состояния, которые меняются по мере выполнения запроса. Текущее состояние можно посмотреть в свойстве <code>xhr.readyState</code>.</p>
<p>Список всех состояний, указанных в <a href="https://xhr.spec.whatwg.org/#states">спецификации</a>:</p>
<div id="e7tb1w00fj" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>UNSENT = 0; // исходное состояние
OPENED = 1; // вызван метод open
HEADERS_RECEIVED = 2; // получены заголовки ответа
LOADING = 3; // ответ в процессе передачи (данные частично получены)
DONE = 4; // запрос завершён</code></pre>
        </div>
      </div>
      
      </div><p>Состояния объекта <code>XMLHttpRequest</code> меняются в таком порядке: <code>0</code> → <code>1</code> → <code>2</code> → <code>3</code> → … → <code>3</code> → <code>4</code>. Состояние <code>3</code> повторяется каждый раз, когда получена часть данных.</p>
<p>Изменения в состоянии объекта запроса генерируют событие <code>readystatechange</code>:</p>
<div id="bm4jv2ml33" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>xhr.onreadystatechange = function() {
  if (xhr.readyState == 3) {
    // загрузка
  }
  if (xhr.readyState == 4) {
    // запрос завершён
  }
};</code></pre>
        </div>
      </div>
      
      </div><p>Вы можете наткнуться на обработчики события <code>readystatechange</code> в очень старом коде, так уж сложилось исторически, когда-то не было событий <code>load</code> и других. Сегодня из-за существования событий <code>load/error/progress</code> можно сказать, что событие <code>readystatechange</code> «морально устарело».</p>
<h2><a class="main__anchor" name="otmena-zaprosa" href="xmlhttprequest.html#otmena-zaprosa">Отмена запроса</a></h2><p>Если мы передумали делать запрос, можно отменить его вызовом <code>xhr.abort()</code>:</p>
<div id="jqbhn1xmkc" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>xhr.abort(); // завершить запрос</code></pre>
        </div>
      </div>
      
      </div><p>При этом генерируется событие <code>abort</code>, а <code>xhr.status</code> устанавливается в <code>0</code>.</p>
<h2><a class="main__anchor" name="sinhronnye-zaprosy" href="xmlhttprequest.html#sinhronnye-zaprosy">Синхронные запросы</a></h2><p>Если в методе <code>open</code> третий параметр <code>async</code> установлен на <code>false</code>, запрос выполняется синхронно.</p>
<p>Другими словами, выполнение JavaScript останавливается на <code>send()</code> и возобновляется после получения ответа. Так ведут себя, например, функции <code>alert</code> или <code>prompt</code>.</p>
<p>Вот переписанный пример с параметром <code>async</code>, равным <code>false</code>:</p>
<div id="c7gla18xew" data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:2,&quot;cols&quot;:[{&quot;start&quot;:53,&quot;end&quot;:58}]}]">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>let xhr = new XMLHttpRequest();

xhr.open('GET', '/article/xmlhttprequest/hello.txt', false);

try {
  xhr.send();
  if (xhr.status != 200) {
    alert(`Ошибка ${xhr.status}: ${xhr.statusText}`);
  } else {
    alert(xhr.response);
  }
} catch(err) { // для отлова ошибок используем конструкцию try...catch вместо onerror
  alert(&quot;Запрос не удался&quot;);
}</code></pre>
        </div>
      </div>
      
      </div><p>Выглядит, может быть, и неплохо, но синхронные запросы используются редко, так как они блокируют выполнение JavaScript до тех пор, пока загрузка не завершена. В некоторых браузерах нельзя прокручивать страницу, пока идёт синхронный запрос. Ну а если же синхронный запрос по какой-то причине выполняется слишком долго, браузер предложит закрыть «зависшую» страницу.</p>
<p>Многие продвинутые возможности <code>XMLHttpRequest</code>, такие как выполнение запроса на другой домен или установка таймаута, недоступны для синхронных запросов. Также, как вы могли заметить, ни о какой индикации прогресса речь тут не идёт.</p>
<p>Из-за всего этого синхронные запросы используют очень редко. Мы более не будем рассматривать их.</p>
<h2><a class="main__anchor" name="http-zagolovki" href="xmlhttprequest.html#http-zagolovki">HTTP-заголовки</a></h2><p><code>XMLHttpRequest</code> умеет как указывать свои заголовки в запросе, так и читать присланные в ответ.</p>
<p>Для работы с HTTP-заголовками есть 3 метода:</p>
<dl>
<dt><code>setRequestHeader(name, value)</code></dt>
<dd>
<p>Устанавливает заголовок запроса с именем <code>name</code> и значением <code>value</code>.</p>
<p>Например:</p>
<div id="kyl1nr8hor" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>xhr.setRequestHeader('Content-Type', 'application/json');</code></pre>
        </div>
      </div>
      
      </div><div class="important important_warn">
            <div class="important__header"><span class="important__type">Ограничения на заголовки</span></div>
            <div class="important__content"><p>Некоторые заголовки управляются исключительно браузером, например <code>Referer</code> или <code>Host</code>, а также ряд других.
Полный список <a href="http://www.w3.org/TR/XMLHttpRequest/#the-setrequestheader-method">тут</a>.</p>
<p><code>XMLHttpRequest</code> не разрешено изменять их ради безопасности пользователей и для обеспечения корректности HTTP-запроса.</p>
</div></div>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">Поставленный заголовок нельзя снять</span></div>
            <div class="important__content"><p>Ещё одной особенностью <code>XMLHttpRequest</code> является то, что отменить <code>setRequestHeader</code> невозможно.</p>
<p>Если заголовок определён, то его нельзя снять. Повторные вызовы лишь добавляют информацию к заголовку, а не перезаписывают его.</p>
<p>Например:</p>
<div id="kfnlzro2rv" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>xhr.setRequestHeader('X-Auth', '123');
xhr.setRequestHeader('X-Auth', '456');

// заголовок получится такой:
// X-Auth: 123, 456</code></pre>
        </div>
      </div>
      
      </div></div></div>
</dd>
<dt><code>getResponseHeader(name)</code></dt>
<dd>
<p>Возвращает значение заголовка ответа <code>name</code> (кроме <code>Set-Cookie</code> и <code>Set-Cookie2</code>).</p>
<p>Например:</p>
<div id="k7klf70twb" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>xhr.getResponseHeader('Content-Type')</code></pre>
        </div>
      </div>
      
      </div></dd>
<dt><code>getAllResponseHeaders()</code></dt>
<dd>
<p>Возвращает все заголовки ответа, кроме <code>Set-Cookie</code> и <code>Set-Cookie2</code>.</p>
<p>Заголовки возвращаются в виде единой строки, например:</p>
<div id="fa93t5c2ze" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-http"><code>Cache-Control: max-age=31536000
Content-Length: 4260
Content-Type: image/png
Date: Sat, 08 Sep 2012 16:53:16 GMT</code></pre>
        </div>
      </div>
      
      </div><p>Между заголовками всегда стоит перевод строки в два символа <code>&quot;\r\n&quot;</code> (независимо от ОС), так что мы можем легко разделить их на отдельные заголовки. Значение заголовка всегда отделено двоеточием с пробелом <code>&quot;: &quot;</code>. Этот формат задан стандартом.</p>
<p>Таким образом, если хочется получить объект с парами заголовок-значение, нам нужно задействовать немного JS.</p>
<p>Вот так (предполагается, что если два заголовка имеют одинаковое имя, то последний перезаписывает предыдущий):</p>
<div id="1lz0bkt6z4" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>let headers = xhr
  .getAllResponseHeaders()
  .split('\r\n')
  .reduce((result, current) =&gt; {
    let [name, value] = current.split(': ');
    result[name] = value;
    return result;
  }, {});

// headers['Content-Type'] = 'image/png'</code></pre>
        </div>
      </div>
      
      </div></dd>
</dl>
<h2><a class="main__anchor" name="post-formdata" href="xmlhttprequest.html#post-formdata">POST, FormData</a></h2><p>Чтобы сделать POST-запрос, мы можем использовать встроенный объект <a href="https://developer.mozilla.org/ru/docs/Web/API/FormData">FormData</a>.</p>
<p>Синтаксис:</p>
<div id="kzh2358h0n" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>let formData = new FormData([form]); // создаём объект, по желанию берём данные формы &lt;form&gt;
formData.append(name, value); // добавляем поле</code></pre>
        </div>
      </div>
      
      </div><p>Мы создаём объект, при желании указываем, из какой формы <code>form</code> взять данные, затем, если нужно, с помощью метода <code>append</code> добавляем дополнительные поля, после чего:</p>
<ol>
<li><code>xhr.open('POST', ...)</code> – создаём <code>POST</code>-запрос.</li>
<li><code>xhr.send(formData)</code> – отсылаем форму серверу.</li>
</ol>
<p>Например:</p>
<div id="9j1ztrpblc" data-trusted="1" class="code-example" data-refresh="1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="xmlhttprequest.html#" title="показать" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="xmlhttprequest.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code>&lt;form name=&quot;person&quot;&gt;
  &lt;input name=&quot;name&quot; value=&quot;Петя&quot;&gt;
  &lt;input name=&quot;surname&quot; value=&quot;Васечкин&quot;&gt;
&lt;/form&gt;

&lt;script&gt;
  // заполним FormData данными из формы
  let formData = new FormData(document.forms.person);

  // добавим ещё одно поле
  formData.append(&quot;middle&quot;, &quot;Иванович&quot;);

  // отправим данные
  let xhr = new XMLHttpRequest();
  xhr.open(&quot;POST&quot;, &quot;/article/xmlhttprequest/post/user&quot;);
  xhr.send(formData);

  xhr.onload = () =&gt; alert(xhr.response);
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Обычно форма отсылается в кодировке <code>multipart/form-data</code>.</p>
<p>Если нам больше нравится формат JSON, то используем <code>JSON.stringify</code> и отправляем данные как строку.</p>
<p>Важно не забыть поставить соответствующий заголовок <code>Content-Type: application/json</code>, многие серверные фреймворки автоматически декодируют JSON при его наличии:</p>
<div id="qfsqr5ncch" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>let xhr = new XMLHttpRequest();

let json = JSON.stringify({
  name: &quot;Вася&quot;,
  surname: &quot;Петров&quot;
});

xhr.open(&quot;POST&quot;, '/submit')
xhr.setRequestHeader('Content-type', 'application/json; charset=utf-8');

xhr.send(json);</code></pre>
        </div>
      </div>
      
      </div><p>Метод <code>.send(body)</code> весьма всеяден. Он может отправить практически что угодно в <code>body</code>, включая объекты типа <code>Blob</code> и <code>BufferSource</code>.</p>
<h2><a class="main__anchor" name="progress-otpravki" href="xmlhttprequest.html#progress-otpravki">Прогресс отправки</a></h2><p>Событие <code>progress</code> срабатывает только на стадии загрузки ответа с сервера.</p>
<p>А именно: если мы отправляем что-то через <code>POST</code>-запрос, <code>XMLHttpRequest</code> сперва отправит наши данные (тело запроса) на сервер, а потом загрузит ответ сервера. И событие <code>progress</code> будет срабатывать только во время загрузки ответа.</p>
<p>Если мы отправляем что-то большое, то нас гораздо больше интересует прогресс отправки данных на сервер. Но <code>xhr.onprogress</code> тут не поможет.</p>
<p>Существует другой объект, без методов, только для отслеживания событий отправки: <code>xhr.upload</code>.</p>
<p>Он генерирует события, похожие на события <code>xhr</code>, но только во время отправки данных на сервер:</p>
<ul>
<li><code>loadstart</code> – начало загрузки данных.</li>
<li><code>progress</code> – генерируется периодически во время отправки на сервер.</li>
<li><code>abort</code> – загрузка прервана.</li>
<li><code>error</code> – ошибка, не связанная с HTTP.</li>
<li><code>load</code> – загрузка успешно завершена.</li>
<li><code>timeout</code> – вышло время, отведённое на загрузку (при установленном свойстве <code>timeout</code>).</li>
<li><code>loadend</code> – загрузка завершена, вне зависимости от того, как – успешно или нет.</li>
</ul>
<p>Примеры обработчиков для этих событий:</p>
<div id="2r71zcyhgt" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>xhr.upload.onprogress = function(event) {
  alert(`Отправлено ${event.loaded} из ${event.total} байт`);
};

xhr.upload.onload = function() {
  alert(`Данные успешно отправлены.`);
};

xhr.upload.onerror = function() {
  alert(`Произошла ошибка во время отправки: ${xhr.status}`);
};</code></pre>
        </div>
      </div>
      
      </div><p>Пример из реальной жизни: загрузка файла на сервер с индикацией прогресса:</p>
<div id="1jpzku87n2" data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:7,&quot;end&quot;:9}]">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="xmlhttprequest.html#" title="показать" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="xmlhttprequest.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code>&lt;input type=&quot;file&quot; onchange=&quot;upload(this.files[0])&quot;&gt;

&lt;script&gt;
function upload(file) {
  let xhr = new XMLHttpRequest();

  // отслеживаем процесс отправки
  xhr.upload.onprogress = function(event) {
    console.log(`Отправлено ${event.loaded} из ${event.total}`);
  };

  // Ждём завершения: неважно, успешного или нет
  xhr.onloadend = function() {
    if (xhr.status == 200) {
      console.log(&quot;Успех&quot;);
    } else {
      console.log(&quot;Ошибка &quot; + this.status);
    }
  };

  xhr.open(&quot;POST&quot;, &quot;/article/xmlhttprequest/post/upload&quot;);
  xhr.send(file);
}
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><h2><a class="main__anchor" name="zaprosy-na-drugoy-istochnik" href="xmlhttprequest.html#zaprosy-na-drugoy-istochnik">Запросы на другой источник</a></h2><p><code>XMLHttpRequest</code> может осуществлять запросы на другие сайты, используя ту же политику CORS, что и <a href="https://learn.javascript.ru/fetch-crossorigin">fetch</a>.</p>
<p>Точно так же, как и при работе с <code>fetch</code>, по умолчанию на другой источник не отсылаются куки и заголовки HTTP-авторизации. Чтобы это изменить, установите <code>xhr.withCredentials</code> в <code>true</code>:</p>
<div id="5nyjyzrtqs" data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:1,&quot;end&quot;:1}]">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>let xhr = new XMLHttpRequest();
xhr.withCredentials = true;

xhr.open('POST', 'http://anywhere.com/request');
...</code></pre>
        </div>
      </div>
      
      </div><p>Детали по заголовкам, которые при этом необходимы, смотрите в главе <a href="https://learn.javascript.ru/fetch-crossorigin">fetch</a>.</p>
<h2><a class="main__anchor" name="itogo" href="xmlhttprequest.html#itogo">Итого</a></h2><p>Типичный код GET-запроса с использованием <code>XMLHttpRequest</code>:</p>
<div id="178i8f4wd0" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>let xhr = new XMLHttpRequest();

xhr.open('GET', '/my/url');

xhr.send();

xhr.onload = function() {
  if (xhr.status != 200) { // HTTP ошибка?
    // обработаем ошибку
    alert( 'Ошибка: ' + xhr.status);
    return;
  }

  // получим ответ из xhr.response
};

xhr.onprogress = function(event) {
  // выведем прогресс
  alert(`Загружено ${event.loaded} из ${event.total}`);
};

xhr.onerror = function() {
  // обработаем ошибку, не связанную с HTTP (например, нет соединения)
};</code></pre>
        </div>
      </div>
      
      </div><p>Событий на самом деле больше, в <a href="http://www.w3.org/TR/XMLHttpRequest/#events">современной спецификации</a> они все перечислены в том порядке, в каком генерируются во время запроса:</p>
<ul>
<li><code>loadstart</code> – начало запроса.</li>
<li><code>progress</code> – прибыла часть данных ответа, тело ответа полностью на данный момент можно получить из свойства <code>responseText</code>.</li>
<li><code>abort</code> – запрос был прерван вызовом <code>xhr.abort()</code>.</li>
<li><code>error</code> – произошла ошибка соединения, например неправильное доменное имя. Событие не генерируется для HTTP-ошибок как, например, 404.</li>
<li><code>load</code> – запрос успешно завершён.</li>
<li><code>timeout</code> – запрос был отменён по причине истечения отведённого для него времени (происходит, только если был установлен таймаут).</li>
<li><code>loadend</code> – срабатывает после <code>load</code>, <code>error</code>, <code>timeout</code> или <code>abort</code>.</li>
</ul>
<p>События <code>error</code>, <code>abort</code>, <code>timeout</code> и <code>load</code> взаимно исключают друг друга – может произойти только одно из них.</p>
<p>Наиболее часто используют события завершения загрузки (<code>load</code>), ошибки загрузки (<code>error</code>), или мы можем использовать единый обработчик <code>loadend</code> для всего и смотреть в свойствах объекта запроса <code>xhr</code> детали произошедшего.</p>
<p>Также мы уже видели событие: <code>readystatechange</code>. Исторически оно появилось одним из первых, даже раньше, чем была составлена спецификация. Сегодня нет необходимости использовать его, так как оно может быть заменено современными событиями, но на него можно часто наткнуться в старом коде.</p>
<p>Если же нам нужно следить именно за процессом отправки данных на сервер, тогда можно использовать те же события, но для объекта <code>xhr.upload</code>.</p>
</div></article></div><div class="page__nav-wrap"><a class="page__nav page__nav_prev" href="https://learn.javascript.ru/url" data-tooltip="Объекты URL"><span class="page__nav-text"><span class="page__nav-text-shortcut"></span></span><span class="page__nav-text-alternate">Предыдущий урок</span></a><a class="page__nav page__nav_next" href="https://learn.javascript.ru/resume-upload" data-tooltip="Возобновляемая загрузка файлов"><span class="page__nav-text"><span class="page__nav-text-shortcut"></span></span><span class="page__nav-text-alternate">Следующий урок</span></a></div><div class="article-tablet-foot tablet-only"><div class="article-tablet-foot__layout"><div class="share-icons"><span class="share-icons__title">Поделиться</span><a class="share share_tw" href="https://twitter.com/share?url=https%3A%2F%2Flearn.javascript.ru%2Fxmlhttprequest" rel="nofollow"></a><a class="share share_fb" href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=https%3A%2F%2Flearn.javascript.ru%2Fxmlhttprequest" rel="nofollow"></a><a class="share share_vk" href="https://vkontakte.ru/share.php?url=https%3A%2F%2Flearn.javascript.ru%2Fxmlhttprequest" rel="nofollow"></a></div><div class="article-tablet-foot__map"><a class="map" href="https://learn.javascript.ru/tutorial/map" data-action="tutorial-map"><span class="map__text">Карта учебника</span></a></div></div></div><div class="banner-bottom"><div class="banner-bottom__text">Проводим <a href="https://learn.javascript.ru/courses">курсы по JavaScript и фреймворкам</a>.</div><button class="banner-bottom__close" data-banner-close="Courses" data-banner-close-message="Эта информация больше не будет выводиться." title="не показывать"></button></div><script>!!1&&"hideBannerCourses"in localStorage||(document.querySelector(".banner-bottom").style.display="flex");</script><div class="comments formatted" id="comments"><div class="comments__header"><h2 class="comments__header-title"><a href="xmlhttprequest.html#comments" name="comments">Комментарии</a></h2><div class="comments__read-before"><span class="comments__read-before-link">перед тем как писать…</span><div class="comments__read-before-popup"><div class="comments__read-before-popup-i"><ul><li>Если вам кажется, что в статье что-то не так - вместо комментария напишите <a href="https://github.com/javascript-tutorial/ru.javascript.info/issues/new">на GitHub</a>.</li><li>Для одной строки кода используйте тег <code>&lt;code&gt;</code>, для нескольких строк кода&nbsp;&mdash; тег <code>&lt;pre&gt;</code>, если больше 10 строк&nbsp;&mdash; ссылку на песочницу (<a href='https://plnkr.co/edit/?p=preview'>plnkr</a>, <a href='http://jsbin.com'>JSBin</a>, <a href='http://codepen.io'>codepen</a>…)</li><li>Если что-то непонятно в статье&nbsp;&mdash; пишите, что именно и с какого места.</li></ul></div></div></div></div><div id="disqus_thread"></div><script>var disqus_config = function() { if (!this.page) this.page = {}; Object.assign(this.page, {"url":"https:\/\/learn.javascript.ru\/xmlhttprequest","identifier":"\/xmlhttprequest"}); };</script><script>var disqus_shortname = "learnjavascriptru";</script><script>var disqus_enabled = true;</script></div></main></div><div class="sidebar page__sidebar sidebar sidebar_sticky-footer"><button class="sidebar__toggle" data-sidebar-toggle></button><a class="map" href="https://learn.javascript.ru/tutorial/map" data-action="tutorial-map" data-tooltip="Карта учебника"></a><div class="sidebar__inner"><div class="sidebar__content"><div class="sidebar__section"><h4 class="sidebar__section-title">Раздел</h4><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a class="sidebar__link" href="https://learn.javascript.ru/network">Сетевые запросы</a></li></ul></nav></div><div class="sidebar__section"><h4 class="sidebar__section-title">Навигация по уроку</h4><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a class="sidebar__link" href="xmlhttprequest.html#osnovy">Основы</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="xmlhttprequest.html#tip-otveta">Тип ответа</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="xmlhttprequest.html#sostoyaniya-zaprosa">Состояния запроса</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="xmlhttprequest.html#otmena-zaprosa">Отмена запроса</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="xmlhttprequest.html#sinhronnye-zaprosy">Синхронные запросы</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="xmlhttprequest.html#http-zagolovki">HTTP-заголовки</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="xmlhttprequest.html#post-formdata">POST, FormData</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="xmlhttprequest.html#progress-otpravki">Прогресс отправки</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="xmlhttprequest.html#zaprosy-na-drugoy-istochnik">Запросы на другой источник</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="xmlhttprequest.html#itogo">Итого</a></li></ul></nav></div><div class="sidebar__section"><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a class="sidebar__link" href="xmlhttprequest.html#comments">Комментарии</a></li></ul></nav></div><div class="sidebar__section"><div class="sidebar__section-title">Поделиться</div><a class="share share_tw sidebar__share" href="https://twitter.com/share?url=https%3A%2F%2Flearn.javascript.ru%2Fxmlhttprequest" rel="nofollow"></a><a class="share share_fb sidebar__share" href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p[url]=https%3A%2F%2Flearn.javascript.ru%2Fxmlhttprequest" rel="nofollow"></a></div><div class="sidebar__section"><a class="sidebar__link" href="https://github.com/javascript-tutorial/ru.javascript.info/blob/master/5-network/08-xmlhttprequest" rel="nofollow">Редактировать на GitHub</a></div></div></div></div></div></div><div class="page-footer"><ul class="page-footer__list"><li class="page-footer__item page-footer__item_copy">©&nbsp;2007—2022&nbsp; Илья Кантор</li><li class="page-footer__item page-footer__item_about"><a class="page-footer__link" href="https://learn.javascript.ru/about">о проекте</a></li><li class="page-footer__item page-footer__item_contact"><a class="page-footer__link" href="https://learn.javascript.ru/about#contact-us">связаться с нами</a></li><li class="page-footer__item page-footer__item_terms"><a class="page-footer__link" href="https://learn.javascript.ru/terms">пользовательское соглашение</a></li><li class="page-footer__item page-footer__item_privacy"><a class="page-footer__link" href="https://learn.javascript.ru/privacy">политика конфиденциальности</a></li><li class="page-footer__item page-footer__item_slack"><a class="page-footer__slack" href="http://slack.javascript.ru">slack-чат</a></li></ul></div></body></html>