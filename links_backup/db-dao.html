<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="x-ua-compatible" content="ie=edge">

        <link rel="apple-touch-icon" sizes="180x180" href="https://www.yiiframework.com/favico/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="https://www.yiiframework.com/favico/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="https://www.yiiframework.com/favico/favicon-16x16.png">
        <link rel="shortcut icon" href="https://www.yiiframework.com/favico/favicon.ico">
        <link rel="manifest" href="https://www.yiiframework.com/favico/manifest.json">
        <link rel="mask-icon" href="https://www.yiiframework.com/favico/safari-pinned-tab.svg" color="#1e6887">
        <meta name="msapplication-config" content="/favico/browserconfig.xml">
        <meta name="theme-color" content="#1e6887">

        <link href="https://www.yiiframework.com/rss.xml" type="application/rss+xml" rel="alternate" title="Lives News for Yii Framework">

        <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        <meta name="csrf-param" content="_csrf">
<meta name="csrf-token" content="14LDVCqvFRhsiKuiGZ8_Rx7SIUKDeO10CFeSAQ9OPufg0684HtVZeSb_x491_g8zR5RUOuFJvTNSIuFJfAJYpg==">
        
        <title>Работа с базами данных: Объекты доступа к данным (DAO) | Полное руководство по Yii 2.0 | Yii PHP Framework</title>

        <meta property="og:site_name" content="Yii Framework" />
        <meta property="og:title" content="Работа с базами данных: Объекты доступа к данным (DAO)" />
        <meta property="og:image" content="https://www.yiiframework.com/image/facebook_cover.png" />
        <meta property="og:url" content="/doc/guide/2.0/ru/db-dao" />
        <meta property="og:description" content="" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="yiiframework" />
        <meta name="twitter:title" content="Работа с базами данных: Объекты доступа к данным (DAO)" />
        <meta name="twitter:description" content="" />
        <meta name="twitter:image" content="https://www.yiiframework.com/image/twitter_cover.png" />
        <meta name="twitter:image:width" content="120" />
        <meta name="twitter:image:height" content="120" />

        <link type="application/opensearchdescription+xml" href="https://www.yiiframework.com/opensearch.xml" title="Yii Search" rel="search">
<link href="https://www.yiiframework.com/assets/85247087/css/all.min.css?v=1645275708" rel="stylesheet">
<script>yiiBaseUrl = ""
yiiSearchLanguage = "ru"
yiiSearchVersion = "2.0"</script>
        <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-707ZP35KCT"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-707ZP35KCT');
</script>
    </head>
    <body data-spy="scroll" data-target="#scrollnav" data-offset="1">
        
        <div id="page-wrapper" class="">

            <header class="navbar navbar-inverse navbar-static" id="top">
    <div class="container">
        <div id="main-nav-head" class="navbar-header">
            <a href="https://www.yiiframework.com/" class="navbar-brand">
                <img src="https://www.yiiframework.com/image/logo.svg"
                     alt="Yii PHP Framework"
                     width="165" height="35"/>
            </a>
            <button type="button" class="navbar-toggle" data-toggle="collapse" aria-label="Toggle navigation" data-target=".navbar-collapse"><i
                    class="fa fa-inverse fa-bars"></i></button>
        </div>

        <div class="navbar-collapse collapse navbar-right">
            <ul id="main-nav" class="nav navbar-nav navbar-main-menu nav"><li class="active" title="The Definitive Guide to Yii"><a href="https://www.yiiframework.com/doc/guide">Guide</a></li>
<li title="API Documentation"><a href="https://www.yiiframework.com/doc/api">API</a></li>
<li title="Community Wiki"><a href="https://www.yiiframework.com/wiki">Wiki</a></li>
<li title="Community Forum"><a href="https://www.yiiframework.com/forum">Forum</a></li>
<li class="dropdown"><a class="dropdown-toggle" href="db-dao.html#" data-toggle="dropdown">Community <span class="caret"></span></a><ul id="w16" class="dropdown-menu"><li><a href="https://www.yiiframework.com/chat" tabindex="-1">Live Chat</a></li>
<li title="Extensions"><a href="https://www.yiiframework.com/extensions" tabindex="-1">Extensions</a></li>
<li><a href="https://www.yiiframework.com/community" tabindex="-1">Resources</a></li>
<li title="Community Members"><a href="https://www.yiiframework.com/user" tabindex="-1">Members</a></li>
<li title="Community Hall of Fame"><a href="https://www.yiiframework.com/user/halloffame" tabindex="-1">Hall of Fame</a></li>
<li title="Community Badges"><a href="https://www.yiiframework.com/badges" tabindex="-1">Badges</a></li></ul></li>
<li class="dropdown"><a class="dropdown-toggle" href="db-dao.html#" data-toggle="dropdown">More <span class="caret"></span></a><ul id="w17" class="dropdown-menu"><li class="separator dropdown-header">Learn</li>
<li><a href="https://www.yiiframework.com/books" tabindex="-1">Books</a></li>
<li><a href="https://www.yiiframework.com/resources" tabindex="-1">Resources</a></li>
<li class="separator dropdown-header">Develop</li>
<li><a href="https://www.yiiframework.com/download" tabindex="-1">Download Yii</a></li>
<li><a href="https://www.yiiframework.com/report-issue" tabindex="-1">Report an Issue</a></li>
<li><a href="https://www.yiiframework.com/security" tabindex="-1">Report a Security Issue</a></li>
<li><a href="https://www.yiiframework.com/contribute" tabindex="-1">Contribute to Yii</a></li>
<li class="separator dropdown-header">About</li>
<li><a href="https://www.yiiframework.com/doc/guide/2.0/en/intro-yii" tabindex="-1">What is Yii?</a></li>
<li><a href="https://www.yiiframework.com/release-cycle" tabindex="-1">Release Cycle</a></li>
<li><a href="https://www.yiiframework.com/news" tabindex="-1">News</a></li>
<li><a href="https://www.yiiframework.com/license" tabindex="-1">License</a></li>
<li><a href="https://www.yiiframework.com/team" tabindex="-1">Team</a></li>
<li><a href="https://www.yiiframework.com/logo" tabindex="-1">Official Logos and Design</a></li></ul></li></ul>
            
            <div class="nav navbar-nav navbar-right">
                <ul id="login-nav" class="nav navbar-nav navbar-main-menu nav"><li><a href="https://www.yiiframework.com/login">Login</a></li></ul>            </div>

            <div class="nav navbar-nav navbar-right">
                        <form id="search-form" class="navbar-form" action="https://www.yiiframework.com/search" method="get">
<input type="hidden" name="language" value="ru">
<input type="hidden" name="version" value="2.0">
<input type="hidden" name="type" value="guide">        <div class="form-group nospace">
            <div class="input-group">
                <input type="text" class="form-control" id="search" name="q" placeholder="Search Guide&hellip;" autocomplete="off" value="">
            </div>
        </div>
        <div id="search-resultbox"></div>
        </form>            </div>

            
        </div>
    </div>
</header>

            <div class="section-header-wrap">
    <div class="container section-header lang-en">
        <div class="row headline-row">
            <div class="col-xs-12 col-md-12">
                <div class="section-headline">Полное руководство по Yii 2.0</div>
            </div>
                    </div>
                <div class="row content-selector-row">
            <div class="col-xs-12 col-md-offset-7 col-md-5">
                <nav class="version-selector">
        <div class="btn-group btn-group-justified btn-group-3-element">
        <div class="btn-group btn-group-sm"><button class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-expanded="false">Download <span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li role="presentation"><a href="https://www.yiiframework.com/doc/download/yii-guide-2.0-ru.pdf" role="menuitem" tabindex="-1">PDF</a></li>
<li role="presentation"><a href="https://www.yiiframework.com/doc/download/yii-docs-2.0-ru.tar.gz" role="menuitem" tabindex="-1">Offline HTML (tar.gz)</a></li>
<li role="presentation"><a href="https://www.yiiframework.com/doc/download/yii-docs-2.0-ru.tar.bz2" role="menuitem" tabindex="-1">Offline HTML (tar.bz2)</a></li></ul></div>                <div class="btn-group btn-group-sm"><button class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-expanded="false">Русский <span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li role="presentation"><a href="https://www.yiiframework.com/doc/guide/2.0/ar/db-dao" role="menuitem" tabindex="-1">العربية</a></li>
<li role="presentation"><a href="https://www.yiiframework.com/doc/guide/2.0/en/db-dao" role="menuitem" tabindex="-1">English</a></li>
<li role="presentation"><a href="https://www.yiiframework.com/doc/guide/2.0/es/db-dao" role="menuitem" tabindex="-1">Español</a></li>
<li role="presentation"><a href="https://www.yiiframework.com/doc/guide/2.0/fr/db-dao" role="menuitem" tabindex="-1">Français</a></li>
<li role="presentation"><a href="https://www.yiiframework.com/doc/guide/2.0/id/db-dao" role="menuitem" tabindex="-1">Bahasa Indonesia</a></li>
<li role="presentation"><a href="https://www.yiiframework.com/doc/guide/2.0/ja/db-dao" role="menuitem" tabindex="-1">日本語</a></li>
<li role="presentation"><a href="https://www.yiiframework.com/doc/guide/2.0/pl/db-dao" role="menuitem" tabindex="-1">Polski</a></li>
<li role="presentation"><a href="https://www.yiiframework.com/doc/guide/2.0/pt-br/db-dao" role="menuitem" tabindex="-1">Português brasileiro</a></li>
<li role="presentation"><a href="https://www.yiiframework.com/doc/guide/2.0/uk/db-dao" role="menuitem" tabindex="-1">Українська</a></li>
<li role="presentation"><a href="https://www.yiiframework.com/doc/guide/2.0/uz/db-dao" role="menuitem" tabindex="-1">Oʻzbekcha</a></li>
<li role="presentation"><a href="https://www.yiiframework.com/doc/guide/2.0/zh-cn/db-dao" role="menuitem" tabindex="-1">简体中文</a></li>
<li role="presentation"><a href="https://www.yiiframework.com/doc/guide/2.0/vi/db-dao" role="menuitem" tabindex="-1">Tiếng Việt</a></li></ul></div>
                <div class="btn-group btn-group-sm"><button class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-expanded="false">Version 2.0 <span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li role="presentation"><a href="https://www.yiiframework.com/doc/guide/1.1/ru" role="menuitem" tabindex="-1">1.1</a></li>
<li role="presentation"><a href="https://www.yiiframework.com/doc/guide/1.0/ru" role="menuitem" tabindex="-1">1.0</a></li></ul></div>    </div>
</nav>
            </div>
        </div>
            </div>
</div>

                        <div class="visible-huge fixed lang-ru">
    <nav id="scrollnav" data-spy="affix" data-offset-top="120">
        <ul class="nav hidden-xs hidden-sm">
            <li><a href="db-dao.html#obekty-dostupa-k-dannym-dao">Объекты доступа к данным (DAO)</a></li><li><a href="db-dao.html#creating-db-connections">Создание подключения к базе данных</a></li><li><a href="db-dao.html#executing-sql-queries">Выполнение SQL запросов</a><ul class="nav"><li class="subheading"><a href="db-dao.html#binding-parameters">Привязка параметров</a></li><li class="subheading"><a href="db-dao.html#non-select-queries">Выполнение Не-SELECT запросов</a></li></ul></li><li><a href="db-dao.html#quoting-table-and-column-names">Экранирование имён таблиц и столбцов</a><ul class="nav"><li class="subheading"><a href="db-dao.html#using-table-prefix">Использование префиксов таблиц</a></li></ul></li><li><a href="db-dao.html#performing-transactions">Исполнение транзакций</a><ul class="nav"><li class="subheading"><a href="db-dao.html#specifying-isolation-levels">Указание уровня изоляции</a></li><li class="subheading"><a href="db-dao.html#nesting-transactions">Вложенные транзакции</a></li></ul></li><li><a href="db-dao.html#read-write-splitting">Репликация и разделение запросов на чтение и запись</a></li><li><a href="db-dao.html#database-schema">Работа со схемой базы данных</a></li><li><a href="db-dao.html#user-notes">User Contributed Notes</a></li>        </ul>
    </nav>
</div>
<div class="container guide-view" xmlns="http://www.w3.org/1999/xhtml">
    <div class="row visible-xs">
        <div class="col-md-12">
            <p class="pull-right topmost">
                <button type="button" title="Toggle Side-Nav" class="btn btn-primary btn-xs" data-toggle="offcanvas">SideNav</button>
            </p>
        </div>
    </div>
    <div class="row row-offcanvas">
        <div class="col-sm-3 col-md-3 col-lg-3 lang-ru">
            <form class="mini-search-form" action="https://www.yiiframework.com/search" method="get">
<input type="hidden" name="language" value="ru">
<input type="hidden" name="version" value="2.0">
<input type="hidden" name="type" value="guide"><input type="text" class="form-control" name="q" placeholder="Search the Guide…" autocomplete="off" aria-label="Search box"> <button type="submit" class="btn btn-primary sr-only">Search</button></form>            <div id="guide-navigation" class="sidenav-offcanvas"><a class="list-group-item has-children" href="db-dao.html#" data-toggle="collapse" data-parent="#guide-navigation" data-target="#guide-navigation-0">Введение</a><div id="guide-navigation-0" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/intro-yii">О Yii</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/intro-upgrade-from-v1">Обновление с версии 1.1</a></div>
<a class="list-group-item has-children" href="db-dao.html#" data-toggle="collapse" data-parent="#guide-navigation" data-target="#guide-navigation-1">Первое знакомство</a><div id="guide-navigation-1" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/start-installation">Установка Yii</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/start-workflow">Запуск приложения</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/start-hello">Говорим «привет»</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/start-forms">Работа с формами</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/start-databases">Работа с базами данных</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/start-gii">Генерация кода при помощи Gii</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/start-looking-ahead">Что дальше?</a></div>
<a class="list-group-item has-children" href="db-dao.html#" data-toggle="collapse" data-parent="#guide-navigation" data-target="#guide-navigation-2">Структура приложения</a><div id="guide-navigation-2" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/structure-overview">Обзор</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/structure-entry-scripts">Входные скрипты</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/structure-applications">Приложения</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/structure-application-components">Компоненты приложения</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/structure-controllers">Контроллеры</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/structure-models">Модели</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/structure-views">Представления</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/structure-modules">Модули</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/structure-filters">Фильтры</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/structure-widgets">Виджеты</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/structure-assets">Ресурсы</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/structure-extensions">Расширения</a></div>
<a class="list-group-item has-children" href="db-dao.html#" data-toggle="collapse" data-parent="#guide-navigation" data-target="#guide-navigation-3">Обработка запросов</a><div id="guide-navigation-3" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/runtime-overview">Обзор</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/runtime-bootstrapping">Bootstrapping</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/runtime-routing">Разбор и генерация URL</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/runtime-requests">Запросы</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/runtime-responses">Ответы</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/runtime-sessions-cookies">Сессии и куки</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/runtime-handling-errors">Обработка ошибок</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/runtime-logging">Логирование</a></div>
<a class="list-group-item has-children" href="db-dao.html#" data-toggle="collapse" data-parent="#guide-navigation" data-target="#guide-navigation-4">Основные понятия</a><div id="guide-navigation-4" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/concept-components">Компоненты</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/concept-properties">Свойства</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/concept-events">События</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/concept-behaviors">Поведения</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/concept-configurations">Конфигурации</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/concept-aliases">Псевдонимы</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/concept-autoloading">Автозагрузка классов</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/concept-service-locator">Service Locator</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/concept-di-container">Dependency Injection Container</a></div>
<a class="list-group-item has-children active" href="db-dao.html#" data-toggle="collapse" data-parent="#guide-navigation" data-target="#guide-navigation-5">Работа с базами данных</a><div id="guide-navigation-5" class="submenu panel-collapse collapse in active-parent"><a class="list-group-item active" href="db-dao.html">Объекты доступа к данным (DAO)</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/db-query-builder">Построитель запросов</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/db-active-record">Active Record</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/db-migrations">Миграции</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-sphinx/blob/master/docs/guide-ru/README.md">Sphinx</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-redis/blob/master/docs/guide-ru/README.md">Redis</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-mongodb/blob/master/docs/guide-ru/README.md">MongoDB</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-elasticsearch/blob/master/docs/guide-ru/README.md">ElasticSearch</a></div>
<a class="list-group-item has-children" href="db-dao.html#" data-toggle="collapse" data-parent="#guide-navigation" data-target="#guide-navigation-6">Получение данных от пользователя</a><div id="guide-navigation-6" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/input-forms">Создание форм</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/input-validation">Валидация</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/input-file-upload">Загрузка файлов</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/input-tabular-input">Табличный ввод</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/input-multiple-models">Работа с несколькими моделями</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/input-form-javascript">Расширение ActiveForm на стороне клиента</a></div>
<a class="list-group-item has-children" href="db-dao.html#" data-toggle="collapse" data-parent="#guide-navigation" data-target="#guide-navigation-7">Отображение данных</a><div id="guide-navigation-7" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/output-formatting">Форматирование данных</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/output-pagination">Постраничная разбивка</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/output-sorting">Сортировка</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/output-data-providers">Провайдеры данных</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/output-data-widgets">Виджеты для данных</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/output-client-scripts">Работа с клиентскими скриптами</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/output-theming">Темизация</a></div>
<a class="list-group-item has-children" href="db-dao.html#" data-toggle="collapse" data-parent="#guide-navigation" data-target="#guide-navigation-8">Безопасность</a><div id="guide-navigation-8" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/security-overview">Обзор</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/security-authentication">Аутентификация</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/security-authorization">Авторизация</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/security-passwords">Работа с паролями</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/security-cryptography">Криптография</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-authclient/blob/master/docs/guide-ru/README.md">Клиенты авторизации</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/security-best-practices">Лучшие практики</a></div>
<a class="list-group-item has-children" href="db-dao.html#" data-toggle="collapse" data-parent="#guide-navigation" data-target="#guide-navigation-9">Кеширование</a><div id="guide-navigation-9" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/caching-overview">Обзор</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/caching-data">Кэширование данных</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/caching-fragment">Кэширование фрагментов</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/caching-page">Кэширование страниц</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/caching-http">HTTP кэширование</a></div>
<a class="list-group-item has-children" href="db-dao.html#" data-toggle="collapse" data-parent="#guide-navigation" data-target="#guide-navigation-10">Веб-сервисы REST</a><div id="guide-navigation-10" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/rest-quick-start">Быстрый старт</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/rest-resources">Ресурсы</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/rest-controllers">Контроллеры</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/rest-routing">Роутинг</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/rest-response-formatting">Форматирование ответа</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/rest-authentication">Аутентификация</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/rest-rate-limiting">Ограничение частоты запросов</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/rest-versioning">Версионирование</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/rest-error-handling">Обработка ошибок</a></div>
<a class="list-group-item has-children" href="db-dao.html#" data-toggle="collapse" data-parent="#guide-navigation" data-target="#guide-navigation-11">Инструменты разработчика</a><div id="guide-navigation-11" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://github.com/yiisoft/yii2-debug/blob/master/docs/guide/README.md">Отладочная панель и отладчик</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-gii/blob/master/docs/guide/README.md">Генерация кода с Gii</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-apidoc">Генератор документации API</a></div>
<a class="list-group-item has-children" href="db-dao.html#" data-toggle="collapse" data-parent="#guide-navigation" data-target="#guide-navigation-12">Тестирование</a><div id="guide-navigation-12" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/test-overview">Обзор</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/test-environment-setup">Настройка тестового окружения</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/test-unit">Модульные тесты</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/test-functional">Функциональные тесты</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/test-acceptance">Приёмочные тесты</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/test-fixtures">Фикстуры</a></div>
<a class="list-group-item has-children" href="db-dao.html#" data-toggle="collapse" data-parent="#guide-navigation" data-target="#guide-navigation-13">Специальные темы</a><div id="guide-navigation-13" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://github.com/yiisoft/yii2-app-advanced/blob/master/docs/guide/README.md">Шаблон приложения advanced</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/tutorial-start-from-scratch">Создание приложения с нуля</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/tutorial-console">Консольные команды</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/tutorial-core-validators">Встроенные валидаторы</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/tutorial-i18n">Интернационализация</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/tutorial-mailing">Отправка почты</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/tutorial-performance-tuning">Оптимизация производительности</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/tutorial-shared-hosting">Окружение виртуального хостинга</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/tutorial-template-engines">Шаблонизаторы</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/tutorial-yii-integration">Работа со сторонним кодом</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/tutorial-yii-as-micro-framework">Использование Yii в качестве микро-framework&#039;а</a></div>
<a class="list-group-item has-children" href="db-dao.html#" data-toggle="collapse" data-parent="#guide-navigation" data-target="#guide-navigation-14">Виджеты</a><div id="guide-navigation-14" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://www.yiiframework.com/doc-2.0/yii-grid-gridview.html">GridView</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc-2.0/yii-widgets-listview.html">ListView</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc-2.0/yii-widgets-detailview.html">DetailView</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc-2.0/guide-input-forms.html#activerecord-based-forms-activeform">ActiveForm</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc-2.0/yii-widgets-pjax.html">Pjax</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc-2.0/yii-widgets-menu.html">Menu</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc-2.0/yii-widgets-linkpager.html">LinkPager</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc-2.0/yii-widgets-linksorter.html">LinkSorter</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-bootstrap/blob/master/docs/guide-ru/README.md">Виджеты Bootstrap</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-jui/blob/master/docs/guide-ru/README.md">Виджеты Jquery UI</a></div>
<a class="list-group-item has-children" href="db-dao.html#" data-toggle="collapse" data-parent="#guide-navigation" data-target="#guide-navigation-15">Хелперы</a><div id="guide-navigation-15" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/helper-overview">Обзор</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/helper-array">ArrayHelper</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/helper-html">Html</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc/guide/2.0/ru/helper-url">Url хелпер</a></div></div>        </div>
        <div class="col-sm-9 col-md-9 col-lg-9" role="main">

            <div class="guide-content content lang-ru">

        <div class="pull-right">
        
<div class="star-wrapper">
    <span class="fa fa-star-o" data-star-url="/ajax/star?type=doc&amp;id=410"></span>            <span class="star-count">0</span> follower    </div>
    </div>

    <h1 id="obekty-dostupa-k-dannym-dao">Объекты доступа к данным (DAO) <a href="db-dao.html#obekty-dostupa-k-dannym-dao" class="hashlink">&para;</a></h1>
<div class="toc hidden-lg"><ol><li><a href="db-dao.html#creating-db-connections">Создание подключения к базе данных</a></li>
<li><a href="db-dao.html#executing-sql-queries">Выполнение SQL запросов</a></li>
<li><a href="db-dao.html#quoting-table-and-column-names">Экранирование имён таблиц и столбцов</a></li>
<li><a href="db-dao.html#performing-transactions">Исполнение транзакций</a></li>
<li><a href="db-dao.html#read-write-splitting">Репликация и разделение запросов на чтение и запись</a></li>
<li><a href="db-dao.html#database-schema">Работа со схемой базы данных</a></li></ol></div>
<p>Построенные поверх <a href="https://www.php.net/manual/ru/book.pdo.php">PDO</a>, Yii DAO (объекты доступа к данным) обеспечивают
объектно-ориентированный API для доступа к реляционным базам данных. Это основа для других, более продвинутых, методов
доступа к базам данных, включая <a href="https://www.yiiframework.com/doc/guide/2.0/ru/db-query-builder">построитель запросов</a> и <a href="https://www.yiiframework.com/doc/guide/2.0/ru/db-active-record">active record</a>.</p>
<p>При использовании Yii DAO вы в основном будете использовать чистый SQL и массивы PHP. Как результат, это самый
эффективный способ доступа к базам данных. Тем не менее, так как синтаксис SQL может отличаться для разных баз данных,
используя Yii DAO вам нужно будет приложить дополнительные усилия, чтобы сделать приложение не зависящим от конкретной
базы данных.</p>
<p>Yii DAO из коробки поддерживает следующие базы данных:</p>
<ul>
<li><a href="http://www.mysql.com/">MySQL</a></li>
<li><a href="https://mariadb.com/">MariaDB</a></li>
<li><a href="http://sqlite.org/">SQLite</a></li>
<li><a href="http://www.postgresql.org/">PostgreSQL</a>: версии 8.4 или выше.</li>
<li><a href="http://www.cubrid.org/">CUBRID</a>: версии 9.3 или выше.</li>
<li><a href="https://www.oracle.com/database/">Oracle</a></li>
<li><a href="https://www.microsoft.com/en-us/sqlserver/default.aspx">MSSQL</a>: версии 2008 или выше.</li>
</ul>
<blockquote class="note"><p><strong>Примечание: </strong>Новая версия pdo_oci для PHP 7 на данный момент существует только в форме исходного кода. Используйте
  <a href="https://github.com/yiisoft/yii2/issues/10975#issuecomment-248479268">инструкции сообщества по компиляции</a>.</p>
</blockquote>
<h2 id="creating-db-connections">Создание подключения к базе данных  <a href="db-dao.html#creating-db-connections" class="hashlink">&para;</a></h2><p>Для доступа к базе данных, вы сначала должны подключится к ней, создав экземпляр класса <a href="https://www.yiiframework.com/doc/api/2.0/yii-db-connection">yii\db\Connection</a>:</p>
<pre><code class="hljs php language-php">$db = <span class="hljs-keyword">new</span> yii\db\Connection([
    <span class="hljs-string">'dsn'</span> =&gt; <span class="hljs-string">'mysql:host=localhost;dbname=example'</span>,
    <span class="hljs-string">'username'</span> =&gt; <span class="hljs-string">'root'</span>,
    <span class="hljs-string">'password'</span> =&gt; <span class="hljs-string">''</span>,
    <span class="hljs-string">'charset'</span> =&gt; <span class="hljs-string">'utf8'</span>,
]);
</code></pre>
<p>Так как подключение к БД часто нужно в нескольких местах, распространённой практикой является его настройка как
<a href="https://www.yiiframework.com/doc/guide/2.0/ru/structure-application-components">компонента приложения</a>:</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">return</span> [
    <span class="hljs-comment">// ...</span>
    <span class="hljs-string">'components'</span> =&gt; [
        <span class="hljs-comment">// ...</span>
        <span class="hljs-string">'db'</span> =&gt; [
            <span class="hljs-string">'class'</span> =&gt; <span class="hljs-string">'yii\db\Connection'</span>,
            <span class="hljs-string">'dsn'</span> =&gt; <span class="hljs-string">'mysql:host=localhost;dbname=example'</span>,
            <span class="hljs-string">'username'</span> =&gt; <span class="hljs-string">'root'</span>,
            <span class="hljs-string">'password'</span> =&gt; <span class="hljs-string">''</span>,
            <span class="hljs-string">'charset'</span> =&gt; <span class="hljs-string">'utf8'</span>,
        ],
    ],
    <span class="hljs-comment">// ...</span>
];
</code></pre>
<p>Теперь вы можете получить доступ к подключению к БД с помощью выражения <code>Yii::$app-&gt;db</code>.</p>
<blockquote class="tip"><p><strong>Подсказка: </strong>Вы можете настроить несколько компонентов подключения, если в вашем приложении используется несколько баз данных.</p>
</blockquote>
<p>При настройке подключения, вы должны обязательно указывать Имя Источника Данных (DSN) через параметр <a href="https://www.yiiframework.com/doc/api/2.0/yii-db-connection#$dsn-detail">dsn</a>.
Формат DSN отличается для разных баз данных. Дополнительное описание смотрите в <a href="https://www.php.net/manual/ru/pdo.construct.php">справочнике PHP</a>.
Ниже представлены несколько примеров:</p>
<ul>
<li>MySQL, MariaDB: <code>mysql:host=localhost;dbname=mydatabase</code></li>
<li>SQLite: <code>sqlite:/path/to/database/file</code></li>
<li>PostgreSQL: <code>pgsql:host=localhost;port=5432;dbname=mydatabase</code></li>
<li>CUBRID: <code>cubrid:dbname=demodb;host=localhost;port=33000</code></li>
<li>MS SQL Server (via sqlsrv driver): <code>sqlsrv:Server=localhost;Database=mydatabase</code></li>
<li>MS SQL Server (via dblib driver): <code>dblib:host=localhost;dbname=mydatabase</code></li>
<li>MS SQL Server (via mssql driver): <code>mssql:host=localhost;dbname=mydatabase</code></li>
<li>Oracle: <code>oci:dbname=//localhost:1521/mydatabase</code></li>
</ul>
<p>Заметьте, что если вы подключаетесь к базе данных через ODBC, вам необходимо указать свойство <a href="https://www.yiiframework.com/doc/api/2.0/yii-db-connection#$driverName-detail">yii\db\Connection::$driverName</a>,
чтобы Yii знал какой тип базы данных используется. Например,</p>
<pre><code class="hljs php language-php"><span class="hljs-string">'db'</span> =&gt; [
    <span class="hljs-string">'class'</span> =&gt; <span class="hljs-string">'yii\db\Connection'</span>,
    <span class="hljs-string">'driverName'</span> =&gt; <span class="hljs-string">'mysql'</span>,
    <span class="hljs-string">'dsn'</span> =&gt; <span class="hljs-string">'odbc:Driver={MySQL};Server=localhost;Database=test'</span>,
    <span class="hljs-string">'username'</span> =&gt; <span class="hljs-string">'root'</span>,
    <span class="hljs-string">'password'</span> =&gt; <span class="hljs-string">''</span>,
],
</code></pre>
<p>Кроме свойства <a href="https://www.yiiframework.com/doc/api/2.0/yii-db-connection#$dsn-detail">dsn</a>, вам необходимо указать <a href="https://www.yiiframework.com/doc/api/2.0/yii-db-connection#$username-detail">username</a>
и <a href="https://www.yiiframework.com/doc/api/2.0/yii-db-connection#$password-detail">password</a>. Смотрите <a href="https://www.yiiframework.com/doc/api/2.0/yii-db-connection">yii\db\Connection</a> для того, чтоб посмотреть полный список свойств. </p>
<blockquote class="info"><p><strong>Информация: </strong>При создании экземпляра соединения к БД, фактическое соединение с базой данных будет установлено только
  при выполнении первого SQL запроса или при явном вызове метода <a href="https://www.yiiframework.com/doc/api/2.0/yii-db-connection#open()-detail">open()</a>.</p>
</blockquote>
<blockquote class="tip"><p><strong>Подсказка: </strong>Иногда может потребоваться выполнить некоторые запросы сразу после соединения с базой данных, для инициализации
переменных окружения. Например, чтобы задать часовой пояс или кодировку. Сделать это можно зарегистрировав обработчик
для события <a href="https://www.yiiframework.com/doc/api/2.0/yii-db-connection#EVENT_AFTER_OPEN-detail">afterOpen</a> в конфигурации приложения:</p>
<pre><code class="hljs php language-php"><span class="hljs-string">'db'</span> =&gt; [
    <span class="hljs-comment">// ...</span>
    <span class="hljs-string">'on afterOpen'</span> =&gt; <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($event)</span> </span>{
        <span class="hljs-comment">// $event-&gt;sender содержит соединение с базой данных</span>
        $event-&gt;sender-&gt;createCommand(<span class="hljs-string">"SET time_zone = 'UTC'"</span>)-&gt;execute();
    }
]
</code></pre>
</blockquote>
<h2 id="executing-sql-queries">Выполнение SQL запросов  <a href="db-dao.html#executing-sql-queries" class="hashlink">&para;</a></h2><p>После создания экземпляра соединения, вы можете выполнить SQL запрос, выполнив следующие шаги:</p>
<ol>
<li>Создать <a href="https://www.yiiframework.com/doc/api/2.0/yii-db-command">yii\db\Command</a> из запроса SQL;</li>
<li>Привязать параметры (не обязательно);</li>
<li>Вызвать один из методов выполнения SQL из <a href="https://www.yiiframework.com/doc/api/2.0/yii-db-command">yii\db\Command</a>.</li>
</ol>
<p>Следующий пример показывает различные способы получения данных из базы дынных:</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// возвращает набор строк. каждая строка - это ассоциативный массив с именами столбцов и значений.</span>
<span class="hljs-comment">// если выборка ничего не вернёт, то будет получен пустой массив.</span>
$posts = Yii::$app-&gt;db-&gt;createCommand(<span class="hljs-string">'SELECT * FROM post'</span>)
            -&gt;queryAll();

<span class="hljs-comment">// вернёт одну строку (первую строку)</span>
<span class="hljs-comment">// false, если ничего не будет выбрано</span>
$post = Yii::$app-&gt;db-&gt;createCommand(<span class="hljs-string">'SELECT * FROM post WHERE id=1'</span>)
           -&gt;queryOne();

<span class="hljs-comment">// вернёт один столбец (первый столбец)</span>
<span class="hljs-comment">// пустой массив, при отсутствии результата</span>
$titles = Yii::$app-&gt;db-&gt;createCommand(<span class="hljs-string">'SELECT title FROM post'</span>)
             -&gt;queryColumn();

<span class="hljs-comment">// вернёт скалярное значение</span>
<span class="hljs-comment">// или false, при отсутствии результата</span>
$count = Yii::$app-&gt;db-&gt;createCommand(<span class="hljs-string">'SELECT COUNT(*) FROM post'</span>)
             -&gt;queryScalar();
</code></pre>
<blockquote class="note"><p><strong>Примечание: </strong>Чтобы сохранить точность, данные извлекаются как строки, даже если тип поля в базе данных является числовым.</p>
</blockquote>
<h3 id="binding-parameters">Привязка параметров  <a href="db-dao.html#binding-parameters" class="hashlink">&para;</a></h3><p>При создании команды из SQL запроса с параметрами, вы почти всегда должны использовать привязку параметров для
предотвращения атак через SQL инъекции. Например,</p>
<pre><code class="hljs php language-php">$post = Yii::$app-&gt;db-&gt;createCommand(<span class="hljs-string">'SELECT * FROM post WHERE id=:id AND status=:status'</span>)
           -&gt;bindValue(<span class="hljs-string">':id'</span>, $_GET[<span class="hljs-string">'id'</span>])
           -&gt;bindValue(<span class="hljs-string">':status'</span>, <span class="hljs-number">1</span>)
           -&gt;queryOne();
</code></pre>
<p>В SQL запрос, вы можете встраивать один или несколько маркеров (например <code>:id</code> в примере выше). Маркеры должны быть 
строкой, начинающейся с двоеточия. Далее вам нужно вызвать один из следующих методов для привязки значений к параметрам:</p>
<ul>
<li><a href="https://www.yiiframework.com/doc/api/2.0/yii-db-command#bindValue()-detail">bindValue()</a>: привязка одного параметра по значению </li>
<li><a href="https://www.yiiframework.com/doc/api/2.0/yii-db-command#bindValues()-detail">bindValues()</a>: привязка нескольких параметров в одном вызове</li>
<li><a href="https://www.yiiframework.com/doc/api/2.0/yii-db-command#bindParam()-detail">bindParam()</a>: похоже на <a href="https://www.yiiframework.com/doc/api/2.0/yii-db-command#bindValue()-detail">bindValue()</a>, но привязка
происходит по ссылке.</li>
</ul>
<p>Следующий пример показывает альтернативный путь привязки параметров:</p>
<pre><code class="hljs php language-php">$params = [<span class="hljs-string">':id'</span> =&gt; $_GET[<span class="hljs-string">'id'</span>], <span class="hljs-string">':status'</span> =&gt; <span class="hljs-number">1</span>];

$post = Yii::$app-&gt;db-&gt;createCommand(<span class="hljs-string">'SELECT * FROM post WHERE id=:id AND status=:status'</span>)
           -&gt;bindValues($params)
           -&gt;queryOne();
           
$post = Yii::$app-&gt;db-&gt;createCommand(<span class="hljs-string">'SELECT * FROM post WHERE id=:id AND status=:status'</span>, $params)
           -&gt;queryOne();
</code></pre>
<p>Привязка переменных реализована через <a href="https://www.php.net/manual/ru/mysqli.quickstart.prepared-statements.php">подготавливаемые запросы</a>.
Помимо предотвращения атак путём SQL инъекций, это увеличивает производительность, так как запрос подготавливается
один раз, а потом выполняется много раз с разными параметрами. Например,</p>
<pre><code class="hljs php language-php">$command = Yii::$app-&gt;db-&gt;createCommand(<span class="hljs-string">'SELECT * FROM post WHERE id=:id'</span>);

$post1 = $command-&gt;bindValue(<span class="hljs-string">':id'</span>, <span class="hljs-number">1</span>)-&gt;queryOne();
$post2 = $command-&gt;bindValue(<span class="hljs-string">':id'</span>, <span class="hljs-number">2</span>)-&gt;queryOne();
<span class="hljs-comment">// ...</span>
</code></pre>
<p>Так как <a href="https://www.yiiframework.com/doc/api/2.0/yii-db-command#bindParam()-detail">bindParam()</a> поддерживает привязку параметров по ссылке, следующий код может
быть написан следующим образом:</p>
<pre><code class="hljs php language-php">$command = Yii::$app-&gt;db-&gt;createCommand(<span class="hljs-string">'SELECT * FROM post WHERE id=:id'</span>)
              -&gt;bindParam(<span class="hljs-string">':id'</span>, $id);

$id = <span class="hljs-number">1</span>;
$post1 = $command-&gt;queryOne();

$id = <span class="hljs-number">2</span>;
$post2 = $command-&gt;queryOne();
<span class="hljs-comment">// ...</span>
</code></pre>
<p>Обратите внимание что вы связываете маркер <code>$id</code> с переменной перед выполнением запроса, и затем меняете это значение
перед каждым последующим выполнением (часто это делается в цикле). Выполнение запросов таким образом может быть значительно
более эффективным, чем выполнение запроса для каждого значения параметра.</p>
<h3 id="non-select-queries">Выполнение Не-SELECT запросов  <a href="db-dao.html#non-select-queries" class="hashlink">&para;</a></h3><p>В методах <code>queryXyz()</code>, описанных в предыдущих разделах, вызываются SELECT запросы для извлечения данных из базы.
Для запросов не возвращающих данные, вы должны использовать метод <a href="https://www.yiiframework.com/doc/api/2.0/yii-db-command#execute()-detail">yii\db\Command::execute()</a>. Например,</p>
<pre><code class="hljs php language-php">Yii::$app-&gt;db-&gt;createCommand(<span class="hljs-string">'UPDATE post SET status=1 WHERE id=1'</span>)
   -&gt;execute();
</code></pre>
<p>Метод <a href="https://www.yiiframework.com/doc/api/2.0/yii-db-command#execute()-detail">yii\db\Command::execute()</a> возвращает количество строк обработанных SQL запросом.</p>
<p>Для запросов INSERT, UPDATE и DELETE, вместо написания чистого SQL, вы можете вызвать методы <a href="https://www.yiiframework.com/doc/api/2.0/yii-db-command#insert()-detail">insert()</a>,
<a href="https://www.yiiframework.com/doc/api/2.0/yii-db-command#update()-detail">update()</a>, <a href="https://www.yiiframework.com/doc/api/2.0/yii-db-command#delete()-detail">delete()</a>, соответственно, для создания указанных
SQL конструкций. Например,</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// INSERT (table name, column values)</span>
Yii::$app-&gt;db-&gt;createCommand()-&gt;insert(<span class="hljs-string">'user'</span>, [
    <span class="hljs-string">'name'</span> =&gt; <span class="hljs-string">'Sam'</span>,
    <span class="hljs-string">'age'</span> =&gt; <span class="hljs-number">30</span>,
])-&gt;execute();

<span class="hljs-comment">// UPDATE (table name, column values, condition)</span>
Yii::$app-&gt;db-&gt;createCommand()-&gt;update(<span class="hljs-string">'user'</span>, [<span class="hljs-string">'status'</span> =&gt; <span class="hljs-number">1</span>], <span class="hljs-string">'age &gt; 30'</span>)-&gt;execute();

<span class="hljs-comment">// DELETE (table name, condition)</span>
Yii::$app-&gt;db-&gt;createCommand()-&gt;delete(<span class="hljs-string">'user'</span>, <span class="hljs-string">'status = 0'</span>)-&gt;execute();
</code></pre>
<p>Вы можете также вызвать <a href="https://www.yiiframework.com/doc/api/2.0/yii-db-command#batchInsert()-detail">batchInsert()</a> для вставки множества строк за один вызов.
Это более эффективно чем вставлять записи по одной за раз:</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// table name, column names, column values</span>
Yii::$app-&gt;db-&gt;createCommand()-&gt;batchInsert(<span class="hljs-string">'user'</span>, [<span class="hljs-string">'name'</span>, <span class="hljs-string">'age'</span>], [
    [<span class="hljs-string">'Tom'</span>, <span class="hljs-number">30</span>],
    [<span class="hljs-string">'Jane'</span>, <span class="hljs-number">20</span>],
    [<span class="hljs-string">'Linda'</span>, <span class="hljs-number">25</span>],
])-&gt;execute();
</code></pre>
<p>Обратите внимание, что перечисленные методы лишь создают запрос. Чтобы его выполнить нужно вызывать
<a href="https://www.yiiframework.com/doc/api/2.0/yii-db-command#execute()-detail">execute()</a>.</p>
<h2 id="quoting-table-and-column-names">Экранирование имён таблиц и столбцов  <a href="db-dao.html#quoting-table-and-column-names" class="hashlink">&para;</a></h2><p>При написании независимого от базы данных кода, правильно экранировать имена таблиц и столбцов довольно трудно, так как
в разных базах данных правила экранирования разные. Чтоб преодолеть данную проблему вы можете использовать следующий
синтаксис экранирования используемый в Yii:</p>
<ul>
<li><code>[[column name]]</code>: заключайте имя столбца в двойные квадратные скобки; </li>
<li><code>{{table name}}</code>: заключайте имя таблицы в двойные фигурные скобки.</li>
</ul>
<p>Yii DAO будет автоматически преобразовывать подобные конструкции в SQL в правильно экранированные имена таблиц и столбцов.
Например,</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// executes this SQL for MySQL: SELECT COUNT(`id`) FROM `employee`</span>
$count = Yii::$app-&gt;db-&gt;createCommand(<span class="hljs-string">"SELECT COUNT([[id]]) FROM {{employee}}"</span>)
            -&gt;queryScalar();
</code></pre>
<h3 id="using-table-prefix">Использование префиксов таблиц  <a href="db-dao.html#using-table-prefix" class="hashlink">&para;</a></h3><p>Если большинство ваших таблиц использует общий префикс в имени, вы можете использовать свойство Yii DAO для указания префикса.</p>
<p>Сначала, укажите префикс таблиц через свойство <a href="https://www.yiiframework.com/doc/api/2.0/yii-db-connection#$tablePrefix-detail">yii\db\Connection::$tablePrefix</a>:</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">return</span> [
    <span class="hljs-comment">// ...</span>
    <span class="hljs-string">'components'</span> =&gt; [
        <span class="hljs-comment">// ...</span>
        <span class="hljs-string">'db'</span> =&gt; [
            <span class="hljs-comment">// ...</span>
            <span class="hljs-string">'tablePrefix'</span> =&gt; <span class="hljs-string">'tbl_'</span>,
        ],
    ],
];
</code></pre>
<p>Затем в коде, когда вам нужно ссылаться на таблицу, имя которой содержит такой префикс, используйте синтаксис <code>{{%table name}}</code>.
Символ процента будет автоматически заменён на префикс таблицы, который вы указали во время конфигурации соединения с
базой данных. Например,</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// для MySQL будет выполнен следующий SQL: SELECT COUNT(`id`) FROM `tbl_employee`</span>
$count = Yii::$app-&gt;db-&gt;createCommand(<span class="hljs-string">"SELECT COUNT([[id]]) FROM {{%employee}}"</span>)
            -&gt;queryScalar();
</code></pre>
<h2 id="performing-transactions">Исполнение транзакций  <a href="db-dao.html#performing-transactions" class="hashlink">&para;</a></h2><p>Когда вы выполняете несколько зависимых запросов последовательно, вам может потребоваться обернуть их в транзакцию
для обеспечения целостности вашей базы данных. Если в любом из запросов произойдёт ошибка, база данных откатится на
состояние, которое было до выполнения запросов.</p>
<p>Следующий код показывает типичное использование транзакций:</p>
<pre><code class="hljs php language-php">Yii::$app-&gt;db-&gt;transaction(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($db)</span> </span>{
    $db-&gt;createCommand($sql1)-&gt;execute();
    $db-&gt;createCommand($sql2)-&gt;execute();
    <span class="hljs-comment">// ... executing other SQL statements ...</span>
});
</code></pre>
<p>Код выше эквивалентен приведённому ниже. Разница в том, что в данном случае мы получаем больше контроля над обработкой
ошибок:</p>
<pre><code class="hljs php language-php">$db = Yii::$app-&gt;db;
$transaction = $db-&gt;beginTransaction();

<span class="hljs-keyword">try</span> {
    $db-&gt;createCommand($sql1)-&gt;execute();
    $db-&gt;createCommand($sql2)-&gt;execute();
    <span class="hljs-comment">// ... executing other SQL statements ...</span>
    
    $transaction-&gt;commit();
} <span class="hljs-keyword">catch</span>(\<span class="hljs-keyword">Exception</span> $e) {
    $transaction-&gt;rollBack();
    <span class="hljs-keyword">throw</span> $e;
} <span class="hljs-keyword">catch</span>(\Throwable $e) {
    $transaction-&gt;rollBack();
}
</code></pre>
<blockquote class="note"><p><strong>Примечание: </strong>в коде выше ради совместимости с PHP 5.x и PHP 7.x использованы два блока catch. 
<code>\Exception</code> реализует интерфейс <a href="https://www.php.net/manual/ru/class.throwable.php"><code>\Throwable</code> interface</a>
начиная с PHP 7.0. Если вы используете только PHP 7 и новее, можете пропустить блок с <code>\Exception</code>.</p>
</blockquote>
<p>При вызове метода <a href="https://www.yiiframework.com/doc/api/2.0/yii-db-connection#beginTransaction()-detail">beginTransaction()</a>, будет запущена новая транзакция.
Транзакция представлена объектом <a href="https://www.yiiframework.com/doc/api/2.0/yii-db-transaction">yii\db\Transaction</a> сохранённым в переменной <code>$transaction</code>. Потом, запросы будут
выполняться в блоке <code>try...catch...</code>. Если запросы будут выполнены удачно, будет выполнен метод <a href="https://www.yiiframework.com/doc/api/2.0/yii-db-transaction#commit()-detail">commit()</a>.
Иначе, будет вызвано исключение, и будет вызван метод <a href="https://www.yiiframework.com/doc/api/2.0/yii-db-transaction#rollBack()-detail">rollBack()</a> для отката
изменений сделанных до неудачно выполненного запроса внутри транзакции.</p>
<h3 id="specifying-isolation-levels">Указание уровня изоляции  <a href="db-dao.html#specifying-isolation-levels" class="hashlink">&para;</a></h3><p>Yii поддерживает настройку [уровня изоляции] для ваших транзакций. По умолчанию, при старте транзакции, будет использован
уровень изоляции настроенный в вашей базе данных. Вы можете переопределить уровень изоляции по умолчанию, как
указано ниже:</p>
<pre><code class="hljs php language-php">$isolationLevel = \yii\db\Transaction::REPEATABLE_READ;

Yii::$app-&gt;db-&gt;transaction(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">($db)</span> </span>{
    ....
}, $isolationLevel);
 
<span class="hljs-comment">// или</span>

$transaction = Yii::$app-&gt;db-&gt;beginTransaction($isolationLevel);
</code></pre>
<p>Yii предоставляет четыре константы для наиболее распространённых уровней изоляции:</p>
<ul>
<li><a href="https://www.yiiframework.com/doc/api/2.0/yii-db-transaction#READ_UNCOMMITTED-detail">yii\db\Transaction::READ_UNCOMMITTED</a> - низший уровень, «Грязное» чтение, не повторяющееся чтение и фантомное чтение.</li>
<li><a href="https://www.yiiframework.com/doc/api/2.0/yii-db-transaction#READ_COMMITTED-detail">yii\db\Transaction::READ_COMMITTED</a> - предотвращает «Грязное» чтение.</li>
<li><a href="https://www.yiiframework.com/doc/api/2.0/yii-db-transaction#REPEATABLE_READ-detail">yii\db\Transaction::REPEATABLE_READ</a> - предотвращает «Грязное» чтение и не повторяющееся чтение.</li>
<li><a href="https://www.yiiframework.com/doc/api/2.0/yii-db-transaction#SERIALIZABLE-detail">yii\db\Transaction::SERIALIZABLE</a> - высший уровень, предотвращает все вышеуказанные проблемы.</li>
</ul>
<p>Помимо использования приведённых выше констант для задания уровня изоляции, вы можете, также, использовать строки
поддерживаемые вашей СУБД. Например, в PostgreSQL, вы можете использовать <code>SERIALIZABLE READ ONLY DEFERRABLE</code>.</p>
<p>Заметьте что некоторые СУБД допускают настраивать уровень изоляции только для всего соединения. Следующие транзакции
будут получать тот же уровень изоляции, даже если вы его не укажете. При использовании этой функции может потребоваться
установить уровень изоляции для всех транзакций, чтоб избежать явно конфликтующих настроек.
На момент написания этой статьи страдали от этого ограничения только MSSQL и SQLite.</p>
<blockquote class="note"><p><strong>Примечание: </strong>SQLite поддерживает только два уровня изоляции, таким образом вы можете использовать только
<code>READ UNCOMMITTED</code> и <code>SERIALIZABLE</code>. Использование других уровней изоляции приведёт к генерации исключения.</p>
</blockquote>
<blockquote class="note"><p><strong>Примечание: </strong>PostgreSQL не допускает установки уровня изоляции до старта транзакции, так что вы не сможете установить
уровень изоляции прямо при старте транзакции. Вы можете использовать <a href="https://www.yiiframework.com/doc/api/2.0/yii-db-transaction#setIsolationLevel()-detail">yii\db\Transaction::setIsolationLevel()</a> в
таком случае после старта транзакции.</p>
</blockquote>
<h3 id="nesting-transactions">Вложенные транзакции  <a href="db-dao.html#nesting-transactions" class="hashlink">&para;</a></h3><p>Если ваша СУБД поддерживает Savepoint, вы можете вкладывать транзакции как показано ниже:</p>
<pre><code class="hljs php language-php">Yii::$app-&gt;db-&gt;transaction(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">($db)</span> </span>{
    <span class="hljs-comment">// внешняя транзакция</span>
    
    $db-&gt;transaction(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">($db)</span> </span>{
        <span class="hljs-comment">// внутренняя транзакция</span>
    });
});
</code></pre>
<p>Или так,</p>
<pre><code class="hljs php language-php">$db = Yii::$app-&gt;db;
$outerTransaction = $db-&gt;beginTransaction();
<span class="hljs-keyword">try</span> {
    $db-&gt;createCommand($sql1)-&gt;execute();

    $innerTransaction = $db-&gt;beginTransaction();
    <span class="hljs-keyword">try</span> {
        $db-&gt;createCommand($sql2)-&gt;execute();
        $innerTransaction-&gt;commit();
    } <span class="hljs-keyword">catch</span> (\<span class="hljs-keyword">Exception</span> $e) {
        $innerTransaction-&gt;rollBack();
    } <span class="hljs-keyword">catch</span> (\Throwable $e) {
        $innerTransaction-&gt;rollBack();
        <span class="hljs-keyword">throw</span> $e;
    }

    $outerTransaction-&gt;commit();
} <span class="hljs-keyword">catch</span> (\<span class="hljs-keyword">Exception</span> $e) {
    $outerTransaction-&gt;rollBack();
} <span class="hljs-keyword">catch</span> (\Throwable $e) {
    $innerTransaction-&gt;rollBack();
    <span class="hljs-keyword">throw</span> $e;
}
</code></pre>
<h2 id="read-write-splitting">Репликация и разделение запросов на чтение и запись  <a href="db-dao.html#read-write-splitting" class="hashlink">&para;</a></h2><p>Многие СУБД поддерживают <a href="http://en.wikipedia.org/wiki/Replication_(computing)#Database_replication">репликацию баз данных</a>
для лучшей доступности базы данных и уменьшения времени ответа сервера. С репликацией базы данных, данные копируются
из <em>master servers</em> на <em>slave servers</em>. Все вставки и обновления должны происходить на основном сервере, хотя чтение
может производится и с подчинённых серверов.</p>
<p>Чтоб воспользоваться преимуществами репликации и достичь разделения чтения и записи, вам необходимо настроить компонент
<a href="https://www.yiiframework.com/doc/api/2.0/yii-db-connection">yii\db\Connection</a> как указано ниже:</p>
<pre><code class="hljs php language-php">[
    <span class="hljs-string">'class'</span> =&gt; <span class="hljs-string">'yii\db\Connection'</span>,

    <span class="hljs-comment">// настройки для мастера</span>
    <span class="hljs-string">'dsn'</span> =&gt; <span class="hljs-string">'dsn for master server'</span>,
    <span class="hljs-string">'username'</span> =&gt; <span class="hljs-string">'master'</span>,
    <span class="hljs-string">'password'</span> =&gt; <span class="hljs-string">''</span>,

    <span class="hljs-comment">// общие настройки для подчинённых</span>
    <span class="hljs-string">'slaveConfig'</span> =&gt; [
        <span class="hljs-string">'username'</span> =&gt; <span class="hljs-string">'slave'</span>,
        <span class="hljs-string">'password'</span> =&gt; <span class="hljs-string">''</span>,
        <span class="hljs-string">'attributes'</span> =&gt; [
            <span class="hljs-comment">// используем небольшой таймаут для соединения</span>
            PDO::ATTR_TIMEOUT =&gt; <span class="hljs-number">10</span>,
        ],
    ],

    <span class="hljs-comment">// список настроек для подчинённых серверов</span>
    <span class="hljs-string">'slaves'</span> =&gt; [
        [<span class="hljs-string">'dsn'</span> =&gt; <span class="hljs-string">'dsn for slave server 1'</span>],
        [<span class="hljs-string">'dsn'</span> =&gt; <span class="hljs-string">'dsn for slave server 2'</span>],
        [<span class="hljs-string">'dsn'</span> =&gt; <span class="hljs-string">'dsn for slave server 3'</span>],
        [<span class="hljs-string">'dsn'</span> =&gt; <span class="hljs-string">'dsn for slave server 4'</span>],
    ],
]
</code></pre>
<p>Вышеуказанная конфигурация определяет систему с одним мастером и несколькими подчинёнными. Один из подчинённых
будет подключен и использован для чтения, в то время как мастер будет использоваться для запросов записи.
Такое разделение чтения и записи будет осуществлено автоматически с указанной конфигурацией. Например,</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// создание экземпляра соединения, использующего вышеуказанную конфигурацию</span>
Yii::$app-&gt;db = Yii::createObject($config);

<span class="hljs-comment">// запрос к одному из подчинённых</span>
$rows = Yii::$app-&gt;db-&gt;createCommand(<span class="hljs-string">'SELECT * FROM user LIMIT 10'</span>)-&gt;queryAll();

<span class="hljs-comment">// запрос к мастеру</span>
Yii::$app-&gt;db-&gt;createCommand(<span class="hljs-string">"UPDATE user SET username='demo' WHERE id=1"</span>)-&gt;execute();
</code></pre>
<blockquote class="info"><p><strong>Информация: </strong>Запросы выполненные через <a href="https://www.yiiframework.com/doc/api/2.0/yii-db-command#execute()-detail">yii\db\Command::execute()</a> определяются как запросы на запись, а все
  остальные запросы через один из "query" методов <a href="https://www.yiiframework.com/doc/api/2.0/yii-db-command">yii\db\Command</a> воспринимаются как запросы на чтение.
  Вы можете получить текущий статус соединения к подчинённому серверу через <code>$db-&gt;slave</code>.</p>
</blockquote>
<p>Компонент <code>Connection</code> поддерживает балансировку нагрузки и переключение при сбое для подчинённых серверов.
При выполнении первого запроса на чтение, компонент <code>Connection</code> будет случайным образом выбирать подчинённый сервер
и попытается подключиться к нему. Если сервер окажется "мёртвым", он попробует подключиться к другому. Если ни один
из подчинённых серверов не будет доступен, он подключится к мастеру. Если настроить
<a href="https://www.yiiframework.com/doc/api/2.0/yii-db-connection#$serverStatusCache-detail">кеш статуса серверов</a>, то недоступность серверов может быть запомнена, чтоб не
использоваться в течении <a href="https://www.yiiframework.com/doc/api/2.0/yii-db-connection#$serverRetryInterval-detail">заданного промежутка времени</a>.</p>
<blockquote class="info"><p><strong>Информация: </strong>В конфигурации выше, таймаут соединения к подчинённому серверу настроен на 10 секунд.
  Это означает, что если сервер не ответит за 10 секунд, он будет считаться "мёртвым". Вы можете отрегулировать
  этот параметр исходя из настроек вашей среды.</p>
</blockquote>
<p>Вы также можете настроить несколько основных и несколько подчинённых серверов. Например,</p>
<pre><code class="hljs php language-php">[
    <span class="hljs-string">'class'</span> =&gt; <span class="hljs-string">'yii\db\Connection'</span>,

    <span class="hljs-comment">// общая конфигурация для основных серверов</span>
    <span class="hljs-string">'masterConfig'</span> =&gt; [
        <span class="hljs-string">'username'</span> =&gt; <span class="hljs-string">'master'</span>,
        <span class="hljs-string">'password'</span> =&gt; <span class="hljs-string">''</span>,
        <span class="hljs-string">'attributes'</span> =&gt; [
            <span class="hljs-comment">// используем небольшой таймаут для соединения</span>
            PDO::ATTR_TIMEOUT =&gt; <span class="hljs-number">10</span>,
        ],
    ],

    <span class="hljs-comment">// список настроек для основных серверов</span>
    <span class="hljs-string">'masters'</span> =&gt; [
        [<span class="hljs-string">'dsn'</span> =&gt; <span class="hljs-string">'dsn for master server 1'</span>],
        [<span class="hljs-string">'dsn'</span> =&gt; <span class="hljs-string">'dsn for master server 2'</span>],
    ],

    <span class="hljs-comment">// общие настройки для подчинённых</span>
    <span class="hljs-string">'slaveConfig'</span> =&gt; [
        <span class="hljs-string">'username'</span> =&gt; <span class="hljs-string">'slave'</span>,
        <span class="hljs-string">'password'</span> =&gt; <span class="hljs-string">''</span>,
        <span class="hljs-string">'attributes'</span> =&gt; [
            <span class="hljs-comment">// используем небольшой таймаут для соединения</span>
            PDO::ATTR_TIMEOUT =&gt; <span class="hljs-number">10</span>,
        ],
    ],

    <span class="hljs-comment">// список настроек для подчинённых серверов</span>
    <span class="hljs-string">'slaves'</span> =&gt; [
        [<span class="hljs-string">'dsn'</span> =&gt; <span class="hljs-string">'dsn for slave server 1'</span>],
        [<span class="hljs-string">'dsn'</span> =&gt; <span class="hljs-string">'dsn for slave server 2'</span>],
        [<span class="hljs-string">'dsn'</span> =&gt; <span class="hljs-string">'dsn for slave server 3'</span>],
        [<span class="hljs-string">'dsn'</span> =&gt; <span class="hljs-string">'dsn for slave server 4'</span>],
    ],
]
</code></pre>
<p>Конфигурация выше, определяет два основных и четыре подчинённых серверов. Компонент <code>Connection</code> поддерживает 
балансировку нагрузки и переключение при сбое между основными серверами, так же как и между подчинёнными. Различие
заключается в том, что когда ни к одному из основных серверов не удастся подключиться будет выброшено исключение.</p>
<blockquote class="note"><p><strong>Примечание: </strong>Когда вы используете свойство <a href="https://www.yiiframework.com/doc/api/2.0/yii-db-connection#$masters-detail">masters</a> для настройки одного или нескольких
  основных серверов, все остальные свойства для настройки соединения с базой данных (такие как <code>dsn</code>, <code>username</code>, <code>password</code>)
  будут проигнорированы компонентом <code>Connection</code>.</p>
</blockquote>
<p>По умолчанию, транзакции используют соединение с основным сервером. И в рамках транзакции, все операции с БД будут
использовать соединение с основным сервером. Например,</p>
<pre><code class="hljs php language-php">$db = Yii::$app-&gt;db;
<span class="hljs-comment">// Транзакция запускается на основном сервере</span>
$transaction = $db-&gt;beginTransaction();

<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// оба запроса выполняются на основном сервере</span>
    $rows = $db-&gt;createCommand(<span class="hljs-string">'SELECT * FROM user LIMIT 10'</span>)-&gt;queryAll();
    $db-&gt;createCommand(<span class="hljs-string">"UPDATE user SET username='demo' WHERE id=1"</span>)-&gt;execute();

    $transaction-&gt;commit();
} <span class="hljs-keyword">catch</span>(\<span class="hljs-keyword">Exception</span> $e) {
    $transaction-&gt;rollBack();
    <span class="hljs-keyword">throw</span> $e;
} <span class="hljs-keyword">catch</span> (\Throwable $e) {
    $innerTransaction-&gt;rollBack();
    <span class="hljs-keyword">throw</span> $e;
}
</code></pre>
<p>Если вы хотите запустить транзакцию на подчинённом сервере, вы должны указать это явно, как показано ниже:</p>
<pre><code class="hljs php language-php">$transaction = Yii::$app-&gt;db-&gt;slave-&gt;beginTransaction();
</code></pre>
<p>Иногда может потребоваться выполнить запрос на чтение через подключение к основному серверу. Это может быть достигнуто
с использованием метода <code>useMaster()</code>:</p>
<pre><code class="hljs php language-php">$rows = Yii::$app-&gt;db-&gt;useMaster(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">($db)</span> </span>{
    <span class="hljs-keyword">return</span> $db-&gt;createCommand(<span class="hljs-string">'SELECT * FROM user LIMIT 10'</span>)-&gt;queryAll();
});
</code></pre>
<p>Вы также можете явно установить <code>$db-&gt;enableSlaves</code> в ложь, чтоб направлять все запросы к соединению с мастером.</p>
<h2 id="database-schema">Работа со схемой базы данных  <a href="db-dao.html#database-schema" class="hashlink">&para;</a></h2><p>Yii DAO предоставляет целый набор методов для управления схемой базы данных, таких как создание новых таблиц, удаление
столбцов из таблицы, и т.д. Эти методы описаны ниже:</p>
<ul>
<li><a href="https://www.yiiframework.com/doc/api/2.0/yii-db-command#createTable()-detail">createTable()</a>: создание таблицы</li>
<li><a href="https://www.yiiframework.com/doc/api/2.0/yii-db-command#renameTable()-detail">renameTable()</a>: переименование таблицы</li>
<li><a href="https://www.yiiframework.com/doc/api/2.0/yii-db-command#dropTable()-detail">dropTable()</a>: удаление таблицы</li>
<li><a href="https://www.yiiframework.com/doc/api/2.0/yii-db-command#truncateTable()-detail">truncateTable()</a>: удаление всех записей в таблице</li>
<li><a href="https://www.yiiframework.com/doc/api/2.0/yii-db-command#addColumn()-detail">addColumn()</a>: добавление столбца</li>
<li><a href="https://www.yiiframework.com/doc/api/2.0/yii-db-command#renameColumn()-detail">renameColumn()</a>: переименование столбца</li>
<li><a href="https://www.yiiframework.com/doc/api/2.0/yii-db-command#dropColumn()-detail">dropColumn()</a>: удаление столбца</li>
<li><a href="https://www.yiiframework.com/doc/api/2.0/yii-db-command#alterColumn()-detail">alterColumn()</a>: преобразование столбца</li>
<li><a href="https://www.yiiframework.com/doc/api/2.0/yii-db-command#addPrimaryKey()-detail">addPrimaryKey()</a>: добавление первичного ключа</li>
<li><a href="https://www.yiiframework.com/doc/api/2.0/yii-db-command#dropPrimaryKey()-detail">dropPrimaryKey()</a>: удаление первичного ключа</li>
<li><a href="https://www.yiiframework.com/doc/api/2.0/yii-db-command#addForeignKey()-detail">addForeignKey()</a>: добавление внешнего ключа</li>
<li><a href="https://www.yiiframework.com/doc/api/2.0/yii-db-command#dropForeignKey()-detail">dropForeignKey()</a>: удаление внешнего ключа</li>
<li><a href="https://www.yiiframework.com/doc/api/2.0/yii-db-command#createIndex()-detail">createIndex()</a>: создания индекса</li>
<li><a href="https://www.yiiframework.com/doc/api/2.0/yii-db-command#dropIndex()-detail">dropIndex()</a>: удаление индекса</li>
</ul>
<p>Эти методы могут быть использованы, как указано ниже:</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// CREATE TABLE</span>
Yii::$app-&gt;db-&gt;createCommand()-&gt;createTable(<span class="hljs-string">'post'</span>, [
    <span class="hljs-string">'id'</span> =&gt; <span class="hljs-string">'pk'</span>,
    <span class="hljs-string">'title'</span> =&gt; <span class="hljs-string">'string'</span>,
    <span class="hljs-string">'text'</span> =&gt; <span class="hljs-string">'text'</span>,
]);
</code></pre>
<p>Вы также сможете получить описание схемы таблицы через вызов метода <a href="https://www.yiiframework.com/doc/api/2.0/yii-db-connection#getTableSchema()-detail">getTableSchema()</a>.
Например,</p>
<pre><code class="hljs php language-php">$table = Yii::$app-&gt;db-&gt;getTableSchema(<span class="hljs-string">'post'</span>);
</code></pre>
<p>Метод вернёт объект <a href="https://www.yiiframework.com/doc/api/2.0/yii-db-tableschema">yii\db\TableSchema</a>, который содержит информацию о столбцах таблицы, первичных ключах, внешних
ключах, и т.д. Вся эта информация используется главным образом для <a href="https://www.yiiframework.com/doc/guide/2.0/ru/db-query-builder">построителя запросов</a> и
<a href="https://www.yiiframework.com/doc/guide/2.0/ru/db-active-record">active record</a>, чтоб помочь вам писать независимый от базы данных код.</p>

    <div class="prev-next">
        <div class="prev-next__left"><a href="https://www.yiiframework.com/doc/guide/2.0/ru/concept-di-container"><span class="chevron-left" aria-hidden="true"></span> Основные понятия: Dependency Injection Container</a></div><div class="prev-next__center"><a href="db-dao.html#top">Go to Top <span class="chevron-up" aria-hidden="true"></span></a></div><div class="prev-next__right"><a href="https://www.yiiframework.com/doc/guide/2.0/ru/db-query-builder">Построитель запросов <span class="chevron-right" aria-hidden="true"></span></a></div>    </div>

        <div class="edit-box">
        <div class="edit-icon"><i class="fa fa-github"></i></div>
        <p class="lang-en">
            Found a typo or you think this page needs improvement?<br />
                <a href="https://github.com/yiisoft/yii2/edit/master/docs/guide-ru/db-dao.md">Edit it on github</a> !
        </p>
    </div>
    
</div>
        </div>
    </div>
</div>

    <div class="comments-wrapper">
        <div class="container comments">
            
<div class="row" id="user-notes">
    <div class="col-md-offset-2 col-md-9">
                    <span class="heading">User Contributed Notes</span>
            </div>
</div>
<div class="row">
    <div class="col-md-offset-2 col-md-9">
        <div class="component-comments lang-en" id="comments">
                    </div>
    </div>
</div>
<div class="row">
    <div class="col-md-offset-2 col-md-9">
        <span class="heading">Leave a comment</span>
    </div>
</div>
<div class="row">
    <div class="col-md-offset-2 col-md-9">
                    <p><a href="https://www.yiiframework.com/signup">Signup</a> or <a href="https://www.yiiframework.com/login">Login</a> in order to comment.</p>
            </div>
</div>
        </div>
    </div>

            <div class="footer-wrapper">
    <footer>
        <div class="container">
            <div class="footer-inner">
                <div class="row">
                    <div class="col-md-2 col-sm-4 hidden-xs">
                        <ul class="footerList">
  <li class="footerList_item">
    <div>About</div>
  </li>
  <li class="footerList_item">
    <a href="https://www.yiiframework.com/doc/guide/2.0/en/intro-yii">About Yii</a>  </li>
  <li class="footerList_item">
    <a href="https://www.yiiframework.com/news">News</a>  </li>
  <li class="footerList_item">
    <a href="https://www.yiiframework.com/license">License</a>  </li>
  <li class="footerList_item">
    <a href="https://www.yiiframework.com/contact">Contact Us</a>  </li>
</ul>
                    </div>
                    <div class="col-md-2 col-sm-4 hidden-xs">
                        <ul class="footerList">
  <li class="footerList_item">
    <div>Downloads</div>
  </li>
  <li class="footerList_item">
    <a href="https://www.yiiframework.com/download">Framework</a>  </li>
  <li class="footerList_item">
    <a href="https://www.yiiframework.com/download#offline-documentation">Documentation</a>  </li>
  <li class="footerList_item">
    <a href="https://www.yiiframework.com/extensions">Extensions</a>  </li>
  <li class="footerList_item">
    <a href="https://www.yiiframework.com/logo">Logo</a>  </li>
</ul>
                    </div>
                    <div class="col-md-2 col-sm-4 hidden-xs">
                        <ul class="footerList">
  <li class="footerList_item">
    <div>Documentation</div>
  </li>
  <li class="footerList_item">
    <a href="https://www.yiiframework.com/doc/guide">Guide</a>  </li>
  <li class="footerList_item">
    <a href="https://www.yiiframework.com/doc/api">API</a>  </li>
  <li class="footerList_item">
    <a href="https://www.yiiframework.com/wiki">Wiki</a>  </li>
  <li class="footerList_item">
    <a href="https://www.yiiframework.com/resources">Resources</a>  </li>
</ul>
                    </div>
                    <div class="col-md-2 col-sm-4 hidden-xs">
                        <ul class="footerList">
  <li class="footerList_item">
    <div>Development</div>
  </li>
  <li class="footerList_item">
    <a href="https://www.yiiframework.com/contribute">Contribute</a>  </li>
  <li class="footerList_item">
    <a href="https://github.com/yiisoft/yii2/commits/master" rel="noopener noreferrer" target="_blank">Latest Updates</a>  </li>
  <li class="footerList_item">
    <a href="https://www.yiiframework.com/report-issue">Report a Bug</a>  </li>
  <li class="footerList_item">
    <a href="https://www.yiiframework.com/security">Report Security Issue</a>  </li>
</ul>
                    </div>
                    <div class="col-md-2 col-sm-4 hidden-xs">
                        <ul class="footerList">
    <li class="footerList_item">
        <div>Community</div>
    </li>
    <li class="footerList_item">
        <a href="https://www.yiiframework.com/forum">Forum</a>    </li>
    <li class="footerList_item">
        <a href="https://www.yiiframework.com/chat">Live Chat</a>    </li>
    <li class="footerList_item">
        <a href="https://www.facebook.com/groups/yiitalk/" target="_blank" rel="noopener noreferrer">Facebook Group</a>
    </li>
    <li class="footerList_item">
        <a href="https://www.yiiframework.com/user/halloffame">Hall of Fame</a>    </li>
    <li class="footerList_item">
        <a href="https://www.yiiframework.com/badges">Badges</a>    </li>
</ul>
                    </div>
                    <div class="col-md-2 col-sm-4 hidden-xs">
                        <ul class="footerList">
  <li class="footerList_item">
      <span class="social">
          <a href="https://github.com/yiisoft" aria-label="GitHub Account" target="_blank" rel="noopener noreferrer"><i class="fa fa-github"></i></a>
          <a href="https://twitter.com/yiiframework" aria-label="Twitter Account" target="_blank" rel="noopener noreferrer"><i class="fa fa-twitter"></i></a>
          <a href="https://www.facebook.com/groups/yiitalk/" aria-label="Facebook Group" target="_blank" rel="noopener noreferrer"><i class="fa fa-facebook"></i></a>
          <a href="https://www.yiiframework.com/rss.xml" aria-label="RSS Feed"><i class="fa fa-rss"></i></a>      </span>
  </li>
  <li class="footerList_item">
    <a href="https://www.yiiframework.com/tos">Terms of service</a>  </li>
  <li class="footerList_item">
      <a href="https://www.yiiframework.com/license">License</a>  </li>
  <li class="footerList_item">
      <a href="https://github.com/yiisoft-contrib/yiiframework.com" target="_blank" rel="noopener noreferrer">Website Source Code</a>
  </li>
  <li class="footerList_item">
      &nbsp;
  </li>
  <li class="footerList_item">
    &copy; 2008 - 2022 Yii
  </li>
  <li class="footerList_item">
      Design: <a href="https://www.eshill.ru/" target="_blank" rel="noopener noreferrer">Eshill</a>
  </li>
</ul>
                    </div>
                    <div class="col-xs-12 hidden-sm hidden-md hidden-lg">
                        <div class="center-block">
                            <div>
                                <ul class="footerList">
  <li class="footerList_item">
      <span class="social">
          <a href="https://github.com/yiisoft" aria-label="GitHub Account" target="_blank" rel="noopener noreferrer"><i class="fa fa-github"></i></a>
          <a href="https://twitter.com/yiiframework" aria-label="Twitter Account" target="_blank" rel="noopener noreferrer"><i class="fa fa-twitter"></i></a>
          <a href="https://www.facebook.com/groups/yiitalk/" aria-label="Facebook Group" target="_blank" rel="noopener noreferrer"><i class="fa fa-facebook"></i></a>
          <a href="https://www.yiiframework.com/rss.xml" aria-label="RSS Feed"><i class="fa fa-rss"></i></a>      </span>
  </li>
  <li class="footerList_item">
    <a href="https://www.yiiframework.com/tos">Terms of service</a>  </li>
  <li class="footerList_item">
      <a href="https://www.yiiframework.com/license">License</a>  </li>
  <li class="footerList_item">
      <a href="https://github.com/yiisoft-contrib/yiiframework.com" target="_blank" rel="noopener noreferrer">Website Source Code</a>
  </li>
  <li class="footerList_item">
      &nbsp;
  </li>
  <li class="footerList_item">
    &copy; 2008 - 2022 Yii
  </li>
  <li class="footerList_item">
      Design: <a href="https://www.eshill.ru/" target="_blank" rel="noopener noreferrer">Eshill</a>
  </li>
</ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-12 text-center">
                        <ul class="footerList">
    <li class="footerList_item">
        <div>Supported by</div>
    </li>
    <li class="footerList_item">
            <a href="https://opencollective.com/yiisoft" aria-label="OpenCollective" target="_blank" rel="noopener
            noreferrer"><img
                    alt="OpenCollective" height="40" src="https://www.yiiframework.com/image/collective.png"/></a>
    </li>
    <li class="footerList_item">
        <a href="https://www.jetbrains.com/?from=yii" aria-label="JetBrains website" target="_blank" rel="noopener
        noreferrer"><img
                alt="JetBrains logo" width="80" src="https://www.yiiframework.com/image/jetbrains.svg"/></a>
    </li>
</ul>




                    </div>
                </div>
            </div>
        </div>
    </footer>
</div>

        </div> <!-- close the id="page-wrapper" -->

        <script src="https://www.yiiframework.com/assets/85247087/js/all.min.js?v=1645275708"></script>
<script>jQuery(function ($) {

  $('[data-toggle="offcanvas"]').click(function () {
    $('.row-offcanvas').toggleClass('active')
  });

});</script>    </body>
</html>
