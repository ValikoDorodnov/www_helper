<!DOCTYPE html>

	









<html lang="ru">
<head>
    <title>Postgres Pro Standard : Документация: 9.5: 38.4. Правила для INSERT, UPDATE и DELETE : Компания Postgres Professional</title>
	
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="msapplication-TileColor" content="#2d89ef">
    <meta name="msapplication-TileImage" content="/img/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
	<meta name="p:domain_verify" content="26bcf8b79467031bea9a8631dd6f0b11"/>
	<meta name="google-site-verification" content="Vy_P_vr-Jp6rfy_wQpPSplaU1p3wfEPSwtHOQBFZU7Q" />
    <meta name="csrf-token" content="">

	<meta property="og:url"             content="https://postgrespro.ru/docs/postgrespro/9.5/rules-update" >
	<meta property="fb:app_id"          content="546521955527856" >
	<meta property="og:type"            content="website" >
	<meta property="og:title"       content="Postgres Pro Standard : Документация: 9.5: 38.4. Правила для INSERT, UPDATE и DELETE" >
	<meta property="og:image"       content="https://postgrespro.ru/img/v3/logo2.png" >
	
	
	<link rel="alternate" type="application/rss+xml" title="RSS" href="https://postgrespro.ru/rss">
	<link rel="apple-touch-icon" sizes="57x57" href="https://postgrespro.ru/img/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="https://postgrespro.ru/img/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="https://postgrespro.ru/img/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="https://postgrespro.ru/img/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="https://postgrespro.ru/img/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="https://postgrespro.ru/img/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="https://postgrespro.ru/img/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="https://postgrespro.ru/img/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://postgrespro.ru/img/apple-touch-icon-180x180.png">
    <link rel="apple-touch-icon" href="https://postgrespro.ru/img/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="https://postgrespro.ru/img/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://postgrespro.ru/img/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="https://postgrespro.ru/img/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="https://postgrespro.ru/img/favicon-16x16.png" sizes="16x16">
    <link rel="manifest"  href="https://postgrespro.ru/img/manifest.json">
    <link rel="mask-icon" href="https://postgrespro.ru/img/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="https://postgrespro.ru/img/favicon.ico">


	<link rel="stylesheet" href="https://postgrespro.ru/j/v3.css/bootstrap.min.css">
	<link rel="stylesheet" href="https://postgrespro.ru/j/v3.css/style_v3.css">
	<link rel="stylesheet" href="https://postgrespro.ru/j/v3.css/hljs.css">
	<link rel="stylesheet" href="https://postgrespro.ru/j/v3.css/docs.css">

	<script src="https://postgrespro.ru/j/all.js?1"></script>
	



	
<style>
.main > section {
	padding-top: 0;
}

.doc-list h3 {
	margin-bottom: 25px;
}

.doc-nav-versions li > a.disabled { 
	pointer-events: none;
	color: #525f62;
	text-decoration: none;
}
.doc-list { list-style: none; color: #343a3d; }
.doc-list ul { margin: 2px 0 2px -26px }
.doc-list li { display: inline; padding-right: 4px; }
.doc-list li.separator { padding-right: 10px; }
.doc-list a.disabled {
	color: #343a3d;
	pointer-events: none;
}
.doc-list a::before {
	position:relative; 
	left: -2px; 
	top: 2px; 
} 

.menu-docs { 
	font-weight: 500; 
    margin: 0 auto 0 auto ;
    
    padding-top: 3em;
    padding-bottom: 0;
    width: 100%;
}
.menu-docs a.disabled {
	pointer-events: none;
}
.menu-product-wrapper {
	margin-bottom: 1em;
	display: inline-block; text-align: left; padding-left:2em;vertical-align: top;
}
.menu-product-wrapper a.active{
	font-weight: 700;
}
.menu-product-wrapper a.active.disabled{
	color: black !important;
}
.menu-versions-wrapper {
	margin-top: 0.5em;
}

#toggle-lang input[type="radio"] {
	position: absolute;clip: 
	rect(0, 0, 0, 0);
	pointer-events: none;
}


.menu-doc-files-group {
	position: absolute;
	right: 0;
	margin-right: 1em; 
}

.toggle-lang-group {
	top: 96px; 
	position:sticky;
	display: block; 
	float:right; 
	margin-top: 42px;
}

nav.menu-docs .btn-group {
	vertical-align: inherit;
	
}

.autolink:before {
	content: '\e80f'; 
	font-family: "fontello";
	font-size: 2em;
	float: left;
	margin-top: -0.4em;
	margin-left: -1.5em;
	color: black;
	opacity: 0;
	transition: opacity 1s ;
}

dt:hover > .autolink:before,
div:hover > .autolink:before {
	opacity: 0.4;
	transition: opacity 0.5s ;
}

</style>

	
	
	<script type="text/javascript">
		var LANG = 'ru';
	</script>
	

</head>
<body>
	
<div class="modal fade" id="loginForm" style="display: none;">
	<form onSubmit="return false;">
	<div class="modal-dialog"><div class="modal-content"><div class="modal-header">
		<h5 class="modal-title">Вход в личный кабинет</h5>
	</div><div class="modal-body">
			<input type="text"     required name="email"    class="primary" placeholder="введите e-mail"  >
			<input type="password" required name="password" class="primary" placeholder="введите пароль">
	</div>
	<div class="modal-footer" >
		<button type="submit" class="btn btn-primary ">Войти</button>
		<div class="text-center" style="display: block;width: 100%; margin-left:0; margin-top:0.5em;">
			<button type="button" class="btn btn-psevdo btn-restore float-left">Забыли пароль?</button>
			<button type="button" class="btn btn-outline-primary btn-reg float-right">Регистрация</button><hr style="clear: both;margin-top:4em;">
			<button type="button" class="btn btn-outline-success " onClick="document.location.href = '/';">Спасибо, потом</button>
		</div>
	</div>
	</div></div>
	</form>
</div>

<div class="modal fade" id="regForm" role="dialog" style="display: none;">
	<form onSubmit="return false;">
	<div class="modal-dialog" ><div class="modal-content"><div class="modal-header">
		<h5 class="modal-title">Регистрация пользователя</h5>
	</div>
	<div class="modal-body">		
		<input type="text"     required name="email"          placeholder="E-mail" >
		<input type="password" required name="password"       placeholder="Пароль" >
		<input type="password" required name="passw2"         placeholder="Пароль повторно"  >
		<input type="text"     required name="last_name_ru"   placeholder="Фамилия">
		<input type="text"     required name="first_name_ru"  placeholder="Имя"    >
		<!-- input type="text"              name="middle_name_ru" placeholder="Отчество">
		<input type="text"              name="phone"          placeholder="Телефон" -->
		<label><input id="agree" name="agree" type="checkbox"/> Подтверждаю</label>
	 		<span class="toggler" style="display:inline"  onClick="loadAgreement();">согласие с обработкой персональных данных</span>
	</div>
	<div class="modal-footer">
		<button type="submit" class="btn btn-primary ">Зарегистрироваться</button>
		<button class="btn btn-psevdo btn-back">назад</button>
	</div></div></div>
	</form>
</div>

<style>
	.cabinet-modal .modal-dialog{
		margin: 5em 2em auto auto;
	}
	.cabinet-modal .icon-cabinet {
		display:block;
		margin:auto;
		font-size: 2em;
	}
</style>


<div class="modal fade cabinet-modal" id="cabinet-modal-info" tabindex="-1" role="dialog" aria-labelledby="cabinet-modal-infoLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
         <span class="fa fa-sign-in fa-lg icon-cabinet cabinet-button btn btn-primary xs-none text-center invisible"></span>
      </div>
      <div class="modal-body">
	      <p id="name" class="text-center text-muted"></p>
	      <p id="e-mail" class="text-center font-weight-light"></p>
	      <p class="text-center"><a href="https://postgrespro.ru/user">Личный кабинет</a></p>
      </div>
      <div class="modal-footer" style="width: 85%;margin: auto;">
	      <button class="text-center btn btn-warning" id="cabinet-action-button" style="width: 100%;" onClick="logout();">Выйти</button>
      </div>
    </div>
  </div>
</div>



<div id="warp-agreement" style="z-index: 10000;">
<div class="pop-up-agreement" style="display: none;z-index: 10000;"  onClick="$(this).slideToggle(150);" >
<div class="agreement" >
<div class="pop-up-close">&#10006;</div>
<div id="agreement">
</div>
</div>
</div>
</div>



<div class="modal fade" id="restoreForm" style="display: none;">
	<form onSubmit="return false;">
	<div class="modal-dialog" ><div class="modal-content"><div class="modal-header">
		<h5 class="modal-title">Восстановление пароля</h5>
	</div>
	<div class="modal-body">
		<p>Укажите e-mail, на который будет выслан код восстановления пароля.</p>
		<input type="text" name="email" required placeholder="введите e-mail">
	</div>
	<div class="modal-footer">
		<button type="submit" class="btn btn-primary ">Продолжить</button>
		<button type="button" class="btn btn-psevdo btn-back">назад</button>
	</div></div></div>
	</form>
</div>

<div class="modal fade" id="confirmForm" style="display: none;">
	<form onSubmit="return false;">
	<div class="modal-dialog" ><div class="modal-content"><div class="modal-header">
		<h4 class="modal-title">Подтверждение аккаунта</h4>
	</div>
	<div class="modal-body">
		<p>На указанный вами адрес e-mail был выслан код подтверждения аккаунта. Введите полученный код для продолжения:</p>
		<input type="text" name="key" required placeholder="введите код">
	</div>
	<div class="modal-footer">
		<button type="submit" class="btn btn-primary ">Продолжить</button>
		<button type="button" class="btn btn-psevdo btn-back">назад</button>
	</div></div></div>
	</form>
</div>

<div class="modal fade" id="newPasswordForm" style="display: none;">
	<form onSubmit="return false;">
	<div class="modal-dialog" ><div class="modal-content"><div class="modal-header">
		<h4 class="modal-title">Изменение пароля</h4>
	</div><div class="modal-body">
		<p>Введите новый пароль два раза:</p>
		<input required type="password" name="password"><br>
		<input required type="password" name="pass2">
	</div><div class="modal-footer">
		<div class="row">
			<div class="col-sm-12"><button type="submit" class="btn btn-success ">Продолжить</button></div>
		</div>
	</div></div></div>
	</form>
</div>

	
	
		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/ru_RU/sdk.js#xfbml=1&version=v2.7";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
		
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/ru_RU/sdk.js#xfbml=1&version=v2.5&appId=860619283960577";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));
		</script>
		<script src="https://apis.google.com/js/platform.js" async defer>
		  {lang: 'ru'}
		</script>
		

	
	

	
    <header>
	<nav class="navbar navbar-expand-xl navbar-light bg-light justify-content-between">
		<!-- div class="mr-2">
			<span class=" d-none d-xl-inline">{XL}</span>
			<span class=" d-none d-lg-inline d-xl-none">{LG}</span>
			<span class=" d-none d-md-inline d-lg-none">{MD}</span>
			<span class=" d-none d-sm-inline d-md-none">{SM}</span>
			<span class=" d-block d-sm-none">{XS}</span>
		</div -->
		
		<a class="navbar-brand" href="https://postgrespro.ru/">
			<img src="https://postgrespro.ru/img/v3/PostgresPro_logo.svg" alt="Postgres Pro" title="Postgres Pro">			
		</a>
		
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>
		  
		
		<div class="collapse navbar-collapse" id="navbarNavDropdown">			
			
	<ul class="nav navbar-nav float-left">
		
			<li class="nav-item dropdown">
				<a 
					class="nav-link " 
					href="rules-update.html#" id="" data-toggle="" aria-haspopup="false" aria-expanded="true" > Компания</a>				
				<a class="nav-link dropdown-toggle dropdown-toggle-split" href="rules-update.html#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="false" aria-expanded="true" ></a>
				<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
				
					<a href="https://postgrespro.ru/about" class="dropdown-item
						">О компании</a>
				
					<a href="https://postgrespro.ru/about/team" class="dropdown-item
						">Руководство</a>
				
					<a href="https://postgrespro.ru/about/license" class="dropdown-item
						">Документы</a>
				
					<a href="https://postgrespro.ru/partners" class="dropdown-item
						">Партнёры</a>
				
					<a href="https://postgrespro.ru/vacancies" class="dropdown-item
						">Вакансии</a>
				
					<a href="https://postgrespro.ru/contacts" class="dropdown-item
						">Контакты</a>
				
				</div>
			</li>
		
			<li class="nav-item dropdown">
				<a 
					class="nav-link " 
					href="rules-update.html#" id="" data-toggle="" aria-haspopup="false" aria-expanded="true" >Продукты</a>				
				<a class="nav-link dropdown-toggle dropdown-toggle-split" href="rules-update.html#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="false" aria-expanded="true" ></a>
				<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
				
					<a href="https://postgrespro.ru/products/postgrespro/enterprise" class="dropdown-item
						">СУБД POSTGRES PRO ENTERPRISE</a>
				
					<a href="https://postgrespro.ru/products/postgrespro/enterprisecertified" class="dropdown-item
						">СУБД POSTGRES PRO ENTERPRISE CERTIFIED</a>
				
					<a href="https://postgrespro.ru/products/postgrespro/certified" class="dropdown-item
						">СУБД POSTGRES PRO CERTIFIED</a>
				
					<a href="https://postgrespro.ru/products/postgrespro/standard" class="dropdown-item
						">СУБД POSTGRES PRO STANDARD</a>
				
					<a href="https://postgrespro.ru/windows" class="dropdown-item
						">СУБД PostgreSQL для Windows</a>
				
					<a href="https://postgrespro.ru/roadmap" class="dropdown-item
						">План разработок</a>
				
				</div>
			</li>
		
			<li class="nav-item dropdown">
				<a 
					class="nav-link " 
					href="rules-update.html#" id="" data-toggle="" aria-haspopup="false" aria-expanded="true" >Услуги</a>				
				<a class="nav-link dropdown-toggle dropdown-toggle-split" href="rules-update.html#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="false" aria-expanded="true" ></a>
				<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
				
					<a href="https://postgrespro.ru/services/support" class="dropdown-item
						">Техподдержка СУБД</a>
				
					<a href="https://postgrespro.ru/services/audit" class="dropdown-item
						">Аудит СУБД</a>
				
					<a href="https://postgrespro.ru/services/migration" class="dropdown-item
						">Миграция СУБД</a>
				
				</div>
			</li>
		
			<li class="nav-item dropdown">
				<a 
					class="nav-link " 
					href="rules-update.html#" id="" data-toggle="" aria-haspopup="false" aria-expanded="true" > Клиенты</a>				
				<a class="nav-link dropdown-toggle dropdown-toggle-split" href="rules-update.html#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="false" aria-expanded="true" ></a>
				<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
				
					<a href="https://postgrespro.ru/trusted" class="dropdown-item
						">Нам доверяют</a>
				
					<a href="https://postgrespro.ru/reviews" class="dropdown-item
						">Отзывы</a>
				
				</div>
			</li>
		
			<li class="nav-item dropdown">
				<a 
					class="nav-link " 
					href="https://postgrespro.ru/education" id="" data-toggle="" aria-haspopup="false" aria-expanded="true" >Образование</a>				
				<a class="nav-link dropdown-toggle dropdown-toggle-split" href="rules-update.html#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="false" aria-expanded="true" ></a>
				<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
				
					<a href="https://postgrespro.ru/docs" class="dropdown-item
						">Документация</a>
				
					<a href="https://postgrespro.ru/education/books" class="dropdown-item
						">Книги</a>
				
					<a href="https://postgrespro.ru/education/courses" class="dropdown-item
						">Учебные курсы</a>
				
					<a href="https://postgrespro.ru/education/cert" class="dropdown-item
						">Сертификация</a>
				
					<a href="https://postgrespro.ru/education/university" class="dropdown-item
						">Курсы для ВУЗов</a>
				
					<a href="https://postgrespro.ru/education/glossary" class="dropdown-item
						">Глоссарий</a>
				
					<a href="https://postgrespro.ru/education/demodb" class="dropdown-item
						">Демо-база</a>
				
					<a href="https://postgrespro.ru/list" class="dropdown-item
						">Списки рассылки</a>
				
				</div>
			</li>
		
			<li class="nav-item dropdown">
				<a 
					class="nav-link " 
					href="rules-update.html#" id="" data-toggle="" aria-haspopup="false" aria-expanded="true" >Новости</a>				
				<a class="nav-link dropdown-toggle dropdown-toggle-split" href="rules-update.html#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="false" aria-expanded="true" ></a>
				<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
				
					<a href="https://postgrespro.ru/blog" class="dropdown-item
						">Блог</a>
				
					<a href="https://postgrespro.ru/blog/media" class="dropdown-item
						">СМИ  о нас</a>
				
					<a href="https://postgrespro.ru/blog/postgresso" class="dropdown-item
						">Дайджест Postgresso</a>
				
					<a href="https://postgrespro.ru/events" class="dropdown-item
						">Мероприятия</a>
				
					<a href="https://postgrespro.ru/about/press" class="dropdown-item
						">Контакты для СМИ</a>
				
				</div>
			</li>
		
	</ul>
	
<script type="text/template" id="menu-tmpl">
</script>
		<ul class="navbar-nav d-xl-none" style="display: inline-block; float: right;">
			<li class="nav-item " style="display: inline-block !important; padding-right: 1em;"><a href="https://postgrespro.ru/search" class="nav-item nav-link icon-search text-primary"></a></li>
			
			<li class="nav-item "       style="display: inline-block !important;"><a class="nav-item nav-link " href="rules-update.html#">RU</a></li>
			<li class="nav-item active" style="display: inline-block !important;"><a class="nav-item nav-link active" href="https://postgrespro.com/docs/postgrespro/9.5/rules-update">EN</a></li>
			
			<div style="display: inline-block;">
				
<style>
	.account-menu { 
		display: inline-block; 
		white-space: nowrap;
	}
	.cabinet-button  {
		margin: 0 0 0 1em;
		padding: 0.5em 0.5em;
		border-radius: 50%;		
	}
	.cabinet-info {
		font-weight: 700;
		cursor: pointer;		
	}
	.cabinet-info:hover {
		color: green;		
	}
</style>
	<li class="nav-item ">
		<div class="account-menu" data-action="info" id="cabinet-buttons" >
			<a class="fa fa-sign-in  fa-lg btn btn-primary cabinet-button invisible" onClick="showLoginLogout(this); return false;" href="https://postgrespro.ru/user" title="Личный кабинет"></a>
			<span class="nav-item cabinet-info invisible" onClick="return showAccountInfo();"  title="Дополнительно…">⋮</span>
		</div>
	</li>

			</div>
		</ul>
	


		</div>

		
<script type="text/template" id="menu-tmpl">
</script>
	<div class=" d-none d-xl-flex">
		<ul class="navbar-nav float-right">
			<li id="li-search"><a class="nav-item nav-link icon-search text-primary" id="search-button" data-action="null" style="font-size: 1.6em;top: -6px;position: relative;" onClick="showSearch(this);"></a></li>
			
			<li class="nav-item "><a class="nav-item nav-link " href="rules-update.html#">RU</a></li>
			<li class="nav-item active"><a class="nav-item nav-link active" href="https://postgrespro.com/docs/postgrespro/9.5/rules-update">EN</a></li>
			
			
<style>
	.account-menu { 
		display: inline-block; 
		white-space: nowrap;
	}
	.cabinet-button  {
		margin: 0 0 0 1em;
		padding: 0.5em 0.5em;
		border-radius: 50%;		
	}
	.cabinet-info {
		font-weight: 700;
		cursor: pointer;		
	}
	.cabinet-info:hover {
		color: green;		
	}
</style>
	<li class="nav-item ">
		<div class="account-menu" data-action="info" id="cabinet-buttons" >
			<a class="fa fa-sign-in  fa-lg btn btn-primary cabinet-button invisible" onClick="showLoginLogout(this); return false;" href="https://postgrespro.ru/user" title="Личный кабинет"></a>
			<span class="nav-item cabinet-info invisible" onClick="return showAccountInfo();"  title="Дополнительно…">⋮</span>
		</div>
	</li>

		</ul>
	</div>
	

		
	</nav>
    </header>
    
    <main name="main">
    <div class="main" name="main">
		

<script>
$(function() {
	if ("" != "")
		toggleLang('', 'postgrespro', '9.5', 'rules-update');
		
$('div.sect2').each(function(i,r){
	var _id = $(r).attr('id');
	if (_id !== undefined) {
		if ($(r).find('h3:first').length > 0) {
			$(r).html('<a href="rules-update.html#'+_id+'" class="autolink"></a>'+$(r).html());
		}
	} 
});		

$('dt').each(function(i,r){
	var _id = $(r).attr('id');
	if (_id !== undefined) {
		$(r).html('<a href="rules-update.html#'+_id+'" class="autolink"></a>'+$(r).html());
	}
});		
	

	
})
</script>


<nav class="menu-docs text-center">
	<div  class="--d-none --d-sm-inline" style="float: right;">
		
			<div id="menu-doc-files" class="menu-doc-files-group d-none d-xl-inline" >
				
					<a href="https://postgrespro.ru/media/docs/postgrespro/9.5/ru/postgres.epub" class="epub btn btn-outline-primary" title="epub"></a><br>
				
					<a href="https://postgrespro.ru/media/docs/postgrespro/9.5/ru/postgres-A4-fop.pdf" class="pdf btn btn-outline-primary" title="pdf"></a><br>
				
			</div>
		
	
	</div>
	
	
		
	<div class="doc-menu-wrapper doc-menu-wrapper-ru  ">
	
		
			<div class="menu-product-wrapper">
				<a  href="https://postgrespro.ru/docs/postgrespro" class="active" style="font-weight: 700;">Postgres Pro Standard</a><br>
		
				<div class="menu-versions-wrapper btn-group" >
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgrespro/14/rules-update" 
							 
							class=" btn btn-outline-primary">
							14										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgrespro/13/rules-update" 
							 
							class=" btn btn-outline-primary">
							13										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgrespro/12/rules-update" 
							 
							class=" btn btn-outline-primary">
							12										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgrespro/11/rules-update" 
							 
							class=" btn btn-outline-primary">
							11										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgrespro/10/rules-update" 
							 
							class=" btn btn-outline-primary">
							10										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgrespro/9.6/rules-update" 
							 
							class=" btn btn-outline-primary">
							9.6										
						</a>	
					    	
		    	
					
						<a href=
							
								"rules-update.html" 
							 
							class="disabled active btn btn-outline-primary">
							9.5										
						</a>	
					    	
		    	
				</div>
			</div>
		
	
		
			<div class="menu-product-wrapper">
				<a  href="https://postgrespro.ru/docs/enterprise" >Postgres Pro Enterprise</a><br>
		
				<div class="menu-versions-wrapper btn-group" >
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/enterprise/13/rules-update" 
							 
							class=" btn btn-outline-primary">
							13										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/enterprise/12/rules-update" 
							 
							class=" btn btn-outline-primary">
							12										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/enterprise/11/rules-update" 
							 
							class=" btn btn-outline-primary">
							11										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/enterprise/10/rules-update" 
							 
							class=" btn btn-outline-primary">
							10										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/enterprise/9.6/rules-update" 
							 
							class=" btn btn-outline-primary">
							9.6										
						</a>	
					    	
		    	
				</div>
			</div>
		
	
		
			<div class="menu-product-wrapper">
				<a  href="https://postgrespro.ru/docs/postgresql" >PostgreSQL</a><br>
		
				<div class="menu-versions-wrapper btn-group" >
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgresql/14/rules-update" 
							 
							class=" btn btn-outline-primary">
							14										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgresql/13/rules-update" 
							 
							class=" btn btn-outline-primary">
							13										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgresql/12/rules-update" 
							 
							class=" btn btn-outline-primary">
							12										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgresql/11/rules-update" 
							 
							class=" btn btn-outline-primary">
							11										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgresql/10/rules-update" 
							 
							class=" btn btn-outline-primary">
							10										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgresql/9.6/rules-update" 
							 
							class=" btn btn-outline-primary">
							9.6										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgresql/9.5/rules-update" 
							 
							class=" btn btn-outline-primary">
							9.5										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgresql/9.4/rules-update" 
							 
							class=" btn btn-outline-primary">
							9.4										
						</a>	
					    	
		    	
				</div>
			</div>
		
		
	</div>

		
	<div class="doc-menu-wrapper doc-menu-wrapper-en  d-none">
	
		
			<div class="menu-product-wrapper">
				<a  href="https://postgrespro.ru/docs/postgrespro" class="active" style="font-weight: 700;">Postgres Pro Standard</a><br>
		
				<div class="menu-versions-wrapper btn-group" >
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgrespro/14/rules-update?lang=en"
							 
							class=" btn btn-outline-primary">
							14										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgrespro/13/rules-update?lang=en"
							 
							class=" btn btn-outline-primary">
							13										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgrespro/12/rules-update?lang=en"
							 
							class=" btn btn-outline-primary">
							12										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgrespro/11/rules-update?lang=en"
							 
							class=" btn btn-outline-primary">
							11										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgrespro/10/rules-update?lang=en"
							 
							class=" btn btn-outline-primary">
							10										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgrespro/9.6/rules-update?lang=en"
							 
							class=" btn btn-outline-primary">
							9.6										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgrespro/9.5/rules-update?lang=en"
							 
							class="disabled active btn btn-outline-primary">
							9.5										
						</a>	
					    	
		    	
				</div>
			</div>
		
	
		
			<div class="menu-product-wrapper">
				<a  href="https://postgrespro.ru/docs/enterprise" >Postgres Pro Enterprise</a><br>
		
				<div class="menu-versions-wrapper btn-group" >
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/enterprise/13/rules-update?lang=en"
							 
							class=" btn btn-outline-primary">
							13										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/enterprise/12/rules-update?lang=en"
							 
							class=" btn btn-outline-primary">
							12										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/enterprise/11/rules-update?lang=en"
							 
							class=" btn btn-outline-primary">
							11										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/enterprise/10/rules-update?lang=en"
							 
							class=" btn btn-outline-primary">
							10										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/enterprise/9.6/rules-update?lang=en"
							 
							class=" btn btn-outline-primary">
							9.6										
						</a>	
					    	
		    	
				</div>
			</div>
		
	
		
			<div class="menu-product-wrapper">
				<a  href="https://postgrespro.ru/docs/postgresql" >PostgreSQL</a><br>
		
				<div class="menu-versions-wrapper btn-group" >
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgresql/14/rules-update?lang=en"
							 
							class=" btn btn-outline-primary">
							14										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgresql/13/rules-update?lang=en"
							 
							class=" btn btn-outline-primary">
							13										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgresql/12/rules-update?lang=en"
							 
							class=" btn btn-outline-primary">
							12										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgresql/11/rules-update?lang=en"
							 
							class=" btn btn-outline-primary">
							11										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgresql/10/rules-update?lang=en"
							 
							class=" btn btn-outline-primary">
							10										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgresql/9.6/rules-update?lang=en"
							 
							class=" btn btn-outline-primary">
							9.6										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgresql/9.5/rules-update?lang=en"
							 
							class=" btn btn-outline-primary">
							9.5										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgresql/9.4/rules-update?lang=en"
							 
							class=" btn btn-outline-primary">
							9.4										
						</a>	
					    	
		    	
				</div>
			</div>
		
		
	</div>

		
	<div class="doc-menu-wrapper doc-menu-wrapper-ru-en  d-none">
	
		
			<div class="menu-product-wrapper">
				<a  href="https://postgrespro.ru/docs/postgrespro" class="active" style="font-weight: 700;">Postgres Pro Standard</a><br>
		
				<div class="menu-versions-wrapper btn-group" >
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgrespro/14/rules-update?lang=ru-en"
							 
							class=" btn btn-outline-primary">
							14										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgrespro/13/rules-update?lang=ru-en"
							 
							class=" btn btn-outline-primary">
							13										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgrespro/12/rules-update?lang=ru-en"
							 
							class=" btn btn-outline-primary">
							12										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgrespro/11/rules-update?lang=ru-en"
							 
							class=" btn btn-outline-primary">
							11										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgrespro/10/rules-update?lang=ru-en"
							 
							class=" btn btn-outline-primary">
							10										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgrespro/9.6/rules-update?lang=ru-en"
							 
							class=" btn btn-outline-primary">
							9.6										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgrespro/9.5/rules-update?lang=ru-en"
							 
							class="disabled active btn btn-outline-primary">
							9.5										
						</a>	
					    	
		    	
				</div>
			</div>
		
	
		
			<div class="menu-product-wrapper">
				<a  href="https://postgrespro.ru/docs/enterprise" >Postgres Pro Enterprise</a><br>
		
				<div class="menu-versions-wrapper btn-group" >
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/enterprise/13/rules-update?lang=ru-en"
							 
							class=" btn btn-outline-primary">
							13										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/enterprise/12/rules-update?lang=ru-en"
							 
							class=" btn btn-outline-primary">
							12										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/enterprise/11/rules-update?lang=ru-en"
							 
							class=" btn btn-outline-primary">
							11										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/enterprise/10/rules-update?lang=ru-en"
							 
							class=" btn btn-outline-primary">
							10										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/enterprise/9.6/rules-update?lang=ru-en"
							 
							class=" btn btn-outline-primary">
							9.6										
						</a>	
					    	
		    	
				</div>
			</div>
		
	
		
			<div class="menu-product-wrapper">
				<a  href="https://postgrespro.ru/docs/postgresql" >PostgreSQL</a><br>
		
				<div class="menu-versions-wrapper btn-group" >
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgresql/14/rules-update?lang=ru-en"
							 
							class=" btn btn-outline-primary">
							14										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgresql/13/rules-update?lang=ru-en"
							 
							class=" btn btn-outline-primary">
							13										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgresql/12/rules-update?lang=ru-en"
							 
							class=" btn btn-outline-primary">
							12										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgresql/11/rules-update?lang=ru-en"
							 
							class=" btn btn-outline-primary">
							11										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgresql/10/rules-update?lang=ru-en"
							 
							class=" btn btn-outline-primary">
							10										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgresql/9.6/rules-update?lang=ru-en"
							 
							class=" btn btn-outline-primary">
							9.6										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgresql/9.5/rules-update?lang=ru-en"
							 
							class=" btn btn-outline-primary">
							9.5										
						</a>	
					    	
		    	
					
						<a href=
							
								"https://postgrespro.ru/docs/postgresql/9.4/rules-update?lang=ru-en"
							 
							class=" btn btn-outline-primary">
							9.4										
						</a>	
					    	
		    	
				</div>
			</div>
		
		
	</div>


	

</nav>

				
<section class="container-fluid">
		<div id="toggle-lang" class="btn-group toggle-lang-group  " style="
		">
			<label class="btn btn-outline-success active" name="ru" style="cursor: pointer; margin: 0; width: 100%;">
				<input type="radio" autocomplete="off" name="ru" value="ru" checked onChange="toggleLang(this.value, 'postgrespro', '9.5', 'rules-update'); return false;"> RU
			</label><br>
			<label class="btn btn-outline-success" name="en" style="cursor: pointer; margin: 0; width: 100%;">
				<input type="radio" autocomplete="off" name="en" value="en"  onChange="toggleLang(this.value, 'postgrespro', '9.5', 'rules-update'); return false;"> EN
			</label><br>
			<label class="btn btn-outline-success" name="ru-en" style="cursor: pointer; margin: 0; width: 100%;">
				<input type="radio" autocomplete="off" name="ru-en" value="ru-en" onChange="toggleLang(this.value, 'postgrespro', '9.5', 'rules-update'); return false;" > RU EN
			</label>
		</div>
<div class="container">
<div class="row docs content" id="docContent-wrapper-ppg">
    <div class="col-md-12" id="divDocRu">
    	
			<div><div class="navheader" xmlns="http://www.w3.org/TR/xhtml1/transitional"><table summary="Navigation header" width="100%"><tr><th align="center" colspan="5">38.4. Правила для <code class="command" xmlns="http://www.w3.org/1999/xhtml">INSERT</code>, <code class="command" xmlns="http://www.w3.org/1999/xhtml">UPDATE</code> и <code class="command" xmlns="http://www.w3.org/1999/xhtml">DELETE</code></th></tr><tr><td align="left" width="10%"><a accesskey="p" href="https://postgrespro.ru/docs/postgrespro/9.5/rules-materializedviews" title="38.3. Материализованные представления">Пред.</a> </td><td align="left" width="10%"><a accesskey="u" href="https://postgrespro.ru/docs/postgrespro/9.5/rules" title="Глава 38. Система правил">Наверх</a></td><th align="center" width="60%">Глава 38. Система правил</th><td align="right" width="10%"><a accesskey="h" href="https://postgrespro.ru/docs/postgrespro/9.5/index" title="Документация к Postgres Pro 9.5.20.1">Начало</a></td><td align="right" width="10%"> <a accesskey="n" href="https://postgrespro.ru/docs/postgrespro/9.5/rules-privileges" title="38.5. Правила и права">След.</a></td></tr></table><hr /></div><div class="sect1" id="rules-update"><div class="titlepage"><div><div><h2 class="title" style="clear: both">38.4. Правила для <code class="command">INSERT</code>, <code class="command">UPDATE</code> и <code class="command">DELETE</code></h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="rules-update.html#idp128">38.4.1. Как работают правила для изменения</a></span><dt><span class="sect2"><a href="rules-update.html#rules-update-views">38.4.2. Сочетание с представлениями</a></span></dl></div><a class="indexterm" id="idp62436"></a><a class="indexterm" id="idp62439"></a><a class="indexterm" id="idp62442"></a><p>Правила, определяемые для команд <code class="command">INSERT</code>, <code class="command">UPDATE</code> и <code class="command">DELETE</code>, значительно отличаются от правил представлений, описанных в предыдущем разделе. Во-первых, команда <code class="command">CREATE RULE</code> позволяет создавать правила со следующими особенностями: <div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Они могут не определять действия.<li class="listitem"><p>Они могут определять несколько действий.<li class="listitem"><p>Они могут действовать в режиме <code class="literal">INSTEAD</code> или <code class="literal">ALSO</code> (по умолчанию).<li class="listitem"><p>Становятся полезными псевдоотношения <code class="literal">NEW</code> и <code class="literal">OLD</code>.<li class="listitem"><p>Они могут иметь условия применения.</ul></div><p> Во-вторых, они не модифицируют само исходное дерево запроса. Вместо этого они создают несколько новых деревьев запросов и могут заменить исходное.<div class="caution"><h3 class="title">Внимание</h3><p>Во многих случаях для задач, выполнимых с использованием правил для <code class="command">INSERT</code>/<code class="command">UPDATE</code>/<code class="command">DELETE</code>, лучше применять триггеры. Оформляются триггеры чуть сложнее, но понять их смысл гораздо проще. К тому же с правилами могут быть получены неожиданные результаты, когда исходный запрос содержит изменчивые функции: в процессе исполнения правил эти функции могут вызываться большее число раз, чем ожидается.<p>Кроме того, в некоторых случаях эти типы правил вообще нельзя применять; а именно, с предложениями <code class="literal">WITH</code> в исходном запросе и с вложенными подзапросами <code class="literal">SELECT</code> с множественным присваиванием в списке <code class="literal">SET</code> запросов <code class="command">UPDATE</code>. Это объясняется тем, что копирование этих конструкций в запрос правила привело бы к многократному вычислению вложенного запроса, что пошло бы в разрез с выраженными намерениями автора запроса.</div><div class="sect2" id="idp128"><div class="titlepage"><div><div><h3 class="title">38.4.1. Как работают правила для изменения</h3></div></div></div><p>Запомните синтаксис: <pre class="programlisting">CREATE [ OR REPLACE ] RULE <em class="replaceable"><code>имя</code></em> AS ON <em class="replaceable"><code>событие</code></em>
    TO <em class="replaceable"><code>таблица</code></em> [ WHERE <em class="replaceable"><code>условие</code></em> ]
    DO [ ALSO | INSTEAD ] { NOTHING | <em class="replaceable"><code>команда</code></em> | ( <em class="replaceable"><code>команда</code></em> ; <em class="replaceable"><code>команда</code></em> ... ) }</pre><p> В дальнейшем, под <em class="firstterm">правилами для изменения</em> подразумеваются правила, определяемые для команд <code class="command">INSERT</code>, <code class="command">UPDATE</code> или <code class="command">DELETE</code>.<p>Правила для изменения применяются системой правил, когда результирующее отношение и тип команды в дереве запроса совпадает с объектом и событием, заданным в команде <code class="command">CREATE RULE</code>. Для такого правила система правил создаёт список деревьев запросов. Изначально этот список пуст. С правилом может быть связано ноль (ключевое слово <code class="literal">NOTHING</code>), одно или несколько действий. Простоты ради мы рассмотрим правило с одним действием. Правило может иметь, а может не иметь условия применения, и действует в режиме <code class="literal">INSTEAD</code> или <code class="literal">ALSO</code> (по умолчанию).<p>Что такое условие применения правила? Это условие, которое говорит, когда нужно, а когда не нужно применять действия правила. В этом условии можно обращаться к псевдоотношениям <code class="literal">NEW</code> и/или <code class="literal">OLD</code>, которые представляют целевое отношение (но с особым значением).<p>Всего есть три варианта формирования деревьев запросов для правила с одним действием. <div class="variablelist"><dl class="variablelist"><dt><span class="term">Без условия применения в режиме <code class="literal">ALSO</code> или <code class="literal">INSTEAD</code></span><dd><p>дерево запроса из действия правила с добавленным условием исходного дерева<dt><span class="term">С условием применения в режиме <code class="literal">ALSO</code></span><dd><p>дерево запроса из действия правила с условием применения правила и условием, добавленным из исходного дерева<dt><span class="term">С условием применения в режиме <code class="literal">INSTEAD</code></span><dd><p>дерево запроса из действия правила с условием применения правила и условием из исходного дерева; также добавляется исходное дерево запроса с условием, обратным условию применения правила</dl></div><p> Наконец, для правил <code class="literal">ALSO</code> в список добавляется исходное дерево запроса без изменений. Так как исходное дерево запроса также добавляют только правила <code class="literal">INSTEAD</code> с условиями применения, в итоге для правила с одним действием мы можем получить только одно или два дерева запросов.<p>Для правил <code class="literal">ON INSERT</code> исходный запрос (если он не перекрывается режимом <code class="literal">INSTEAD</code>) выполняется перед действиями, добавленными правилами. Поэтому эти действия могут видеть вставленные строки. Но для правил <code class="literal">ON UPDATE</code> и <code class="literal">ON DELETE</code> исходный запрос выполняется после действий, добавленных правилами. При таком порядке эти действия будут видеть строки, подлежащие изменению или удалению; иначе бы действия не работали, не найдя строк, соответствующих их условиям применения (эти строки уже будут изменены или удалены).<p>Деревья запросов, полученные из действий правил, снова попадают в систему перезаписи, где могут примениться дополнительные правила, добавляющие или убирающие деревья запроса. Поэтому действия правила должны выполнять команды другого типа или работать с другим результирующим отношением, иначе возникнет бесконечная рекурсия. (Система выявляет подобное рекурсивное разворачивание правил и выдаёт ошибку.)<p>Деревья запросов, заданные для действий в системном каталоге <code class="structname">pg_rewrite</code>, представляют собой только шаблоны. Так как они могут обращаться к элементам <code class="literal">NEW</code> и <code class="literal">OLD</code> в списке отношений, их можно будет использовать только после некоторых подстановок. В случае ссылки на <code class="literal">NEW</code> соответствующий элемент ищется в целевом списке исходного запроса. Если он найден, ссылка заменяется выражением этого элемента. В противном случае <code class="literal">NEW</code> означает то же самое, что и <code class="literal">OLD</code> (для команды <code class="command">UPDATE</code>) или заменяется значением NULL (для команды <code class="command">INSERT</code>). Любые ссылки на <code class="literal">OLD</code> заменяются ссылкой на элемент результирующего отношения в списке отношений.<p>После того как система применит все правила для изменения, она применяет правила представления к полученному дереву (или деревьям) запроса. Представления не могут добавлять новые действия для изменения, поэтому нет необходимости применять такие правила к результату перезаписи представления.<div class="sect3" id="idp127"><div class="titlepage"><div><div><h4 class="title">38.4.1.1. Пошаговый разбор первого правила</h4></div></div></div><p>Предположим, что нам нужно отслеживать изменения в столбце <code class="literal">sl_avail</code> таблицы <code class="literal">shoelace_data</code>. Мы можем создать таблицу для ведения журнала и правило, которое будет добавлять в неё записи по условию, когда для <code class="literal">shoelace_data</code> выполняется <code class="command">UPDATE</code>. <pre class="programlisting">CREATE TABLE shoelace_log (
    sl_name    text,          -- шнурки, количество которых изменилось
    sl_avail   integer,       -- новое количество
    log_who    text,          -- кто изменил
    log_when   timestamp      -- когда
);

CREATE RULE log_shoelace AS ON UPDATE TO shoelace_data
    WHERE NEW.sl_avail &lt;&gt; OLD.sl_avail
    DO INSERT INTO shoelace_log VALUES (
                                    NEW.sl_name,
                                    NEW.sl_avail,
                                    current_user,
                                    current_timestamp
                                );</pre><p>Теперь, если кто-то выполнит: <pre class="programlisting">UPDATE shoelace_data SET sl_avail = 6 WHERE sl_name = 'sl7';</pre><p> мы увидим в таблице журнала: <pre class="programlisting">SELECT * FROM shoelace_log;

 sl_name | sl_avail | log_who | log_when                        
---------+----------+---------+----------------------------------
 sl7     |        6 | Al      | Tue Oct 20 16:14:45 1998 MET DST
(1 row)</pre><p>Именно это нам и нужно. При этом внутри происходит следующее. Анализатор запроса создаёт дерево: <pre class="programlisting">UPDATE shoelace_data SET sl_avail = 6
  FROM shoelace_data shoelace_data
 WHERE shoelace_data.sl_name = 'sl7';</pre><p> В системном каталоге находится правило <code class="literal">log_shoelace</code>, настроенное на изменение (<code class="literal">ON UPDATE</code>) с условием применения: <pre class="programlisting">NEW.sl_avail &lt;&gt; OLD.sl_avail</pre><p> и действием: <pre class="programlisting">INSERT INTO shoelace_log VALUES (
       new.sl_name, new.sl_avail,
       current_user, current_timestamp )
  FROM shoelace_data new, shoelace_data old;</pre><p> (Это выглядит несколько странно, так как обычно нельзя написать <code class="literal">INSERT ... VALUES ... FROM</code>. Предложение <code class="literal">FROM</code> здесь добавлено, просто чтобы показать, что в дереве запроса для ссылок <code class="literal">new</code> и <code class="literal">old</code> есть элементы в списке отношений. Они необходимы для того, чтобы к ним могли обращаться переменные в дереве запроса команды <code class="command">INSERT</code>.)<p>Так как это правило <code class="literal">ALSO</code> с условием применения, система правил должна выдать два дерева запросов: изменённое действие правила и исходное дерево запроса. На первом шаге список отношений исходного запроса вставляется в дерево действия правила и получается: <pre class="programlisting">INSERT INTO shoelace_log VALUES (
       new.sl_name, new.sl_avail,
       current_user, current_timestamp )
  FROM shoelace_data new, shoelace_data old,
       <span class="emphasis"><strong>shoelace_data shoelace_data</strong></span>;</pre><p> На втором шаге в это дерево добавляется условие применения правила, так что результирующий набор ограничивается строками, в которых меняется <code class="literal">sl_avail</code>: <pre class="programlisting">INSERT INTO shoelace_log VALUES (
       new.sl_name, new.sl_avail,
       current_user, current_timestamp )
  FROM shoelace_data new, shoelace_data old,
       shoelace_data shoelace_data
 <span class="emphasis"><strong>WHERE new.sl_avail &lt;&gt; old.sl_avail</strong></span>;</pre><p> (Это выглядит ещё более странно, ведь в <code class="literal">INSERT ... VALUES</code> не записывается и предложение <code class="literal">WHERE</code>, но планировщик и исполнитель не испытывают затруднений с этим. Они всё равно должны поддерживать эту функциональность для <code class="literal">INSERT ... SELECT</code>.)<p>На третьем шаге добавляется условие исходного дерева, что ещё больше ограничивает результирующий набор, оставляя в нём только строки, которые затронул бы исходный запрос: <pre class="programlisting">INSERT INTO shoelace_log VALUES (
       new.sl_name, new.sl_avail,
       current_user, current_timestamp )
  FROM shoelace_data new, shoelace_data old,
       shoelace_data shoelace_data
 WHERE new.sl_avail &lt;&gt; old.sl_avail
   <span class="emphasis"><strong>AND shoelace_data.sl_name = 'sl7'</strong></span>;</pre><p>На четвёртом шаге ссылки на <code class="literal">NEW</code> заменяются элементами выходного списка из исходного дерева запроса или переменными из результирующего отношения: <pre class="programlisting">INSERT INTO shoelace_log VALUES (
       <span class="emphasis"><strong>shoelace_data.sl_name</strong></span>, <span class="emphasis"><strong>6</strong></span>,
       current_user, current_timestamp )
  FROM shoelace_data new, shoelace_data old,
       shoelace_data shoelace_data
 WHERE <span class="emphasis"><strong>6</strong></span> &lt;&gt; old.sl_avail
   AND shoelace_data.sl_name = 'sl7';</pre><p>На последнем, пятом шаге ссылки на <code class="literal">OLD</code> заменяются ссылками на результирующее отношение: <pre class="programlisting">INSERT INTO shoelace_log VALUES (
       shoelace_data.sl_name, 6,
       current_user, current_timestamp )
  FROM shoelace_data new, shoelace_data old,
       shoelace_data shoelace_data
 WHERE 6 &lt;&gt; <span class="emphasis"><strong>shoelace_data.sl_avail</strong></span>
   AND shoelace_data.sl_name = 'sl7';</pre><p>Вот и всё. Так как правило действует в режиме <code class="literal">ALSO</code>, мы также выводим исходное дерево запроса. Таким образом, система правил выдаёт список с двумя деревьями запросов, соответствующими этим операторам: <pre class="programlisting">INSERT INTO shoelace_log VALUES (
       shoelace_data.sl_name, 6,
       current_user, current_timestamp )
  FROM shoelace_data
 WHERE 6 &lt;&gt; shoelace_data.sl_avail
   AND shoelace_data.sl_name = 'sl7';

UPDATE shoelace_data SET sl_avail = 6
 WHERE sl_name = 'sl7';</pre><p> Они выполняются в показанном порядке и именно это должно делать данное правило.<p>Благодаря заменам и добавленным условиям в журнал не добавится запись, например, при таком исходном запросе: <pre class="programlisting">UPDATE shoelace_data SET sl_color = 'green'
 WHERE sl_name = 'sl7';</pre><p> В этом случае исходное дерево запроса не содержит элемент выходного списка для <code class="literal">sl_avail</code>, так что <code class="literal">NEW.sl_avail</code> будет заменено переменной <code class="literal">shoelace_data.sl_avail</code>. Таким образом, дополнительная команда, созданная правилом, будет такой: <pre class="programlisting">INSERT INTO shoelace_log VALUES (
       shoelace_data.sl_name, <span class="emphasis"><strong>shoelace_data.sl_avail</strong></span>,
       current_user, current_timestamp )
  FROM shoelace_data
 WHERE <span class="emphasis"><strong>shoelace_data.sl_avail</strong></span> &lt;&gt; shoelace_data.sl_avail
   AND shoelace_data.sl_name = 'sl7';</pre><p> Это условие применения не будет выполняться никогда.<p>Это также будет работать, если исходный запрос изменяет несколько строк. Так, если кто-то выполнит команду: <pre class="programlisting">UPDATE shoelace_data SET sl_avail = 0
 WHERE sl_color = 'black';</pre><p> фактически будут изменены четыре строки (<code class="literal">sl1</code>, <code class="literal">sl2</code>, <code class="literal">sl3</code> и <code class="literal">sl4</code>). Но для <code class="literal">sl3</code> значение <code class="literal">sl_avail = 0</code>. В этом случае условие исходного дерева другое, так что это правило выдаёт такое дополнительное дерево запроса: <pre class="programlisting">INSERT INTO shoelace_log
SELECT shoelace_data.sl_name, 0,
       current_user, current_timestamp
  FROM shoelace_data
 WHERE 0 &lt;&gt; shoelace_data.sl_avail
   AND <span class="emphasis"><strong>shoelace_data.sl_color = 'black'</strong></span>;</pre><p>. С таким деревом запроса в журнал определённо будут добавлены три записи. И это абсолютно правильно.<p>Здесь мы видим, почему важно, чтобы исходное дерево запроса выполнялось в конце. Если бы оператор <code class="command">UPDATE</code> выполнился сначала, все строки уже получили бы нулевые значения, так что записывающий в журнал <code class="command">INSERT</code> не нашёл бы строк, в которых <code class="literal">0 &lt;&gt; shoelace_data.sl_avail</code>.</div></div><div class="sect2" id="rules-update-views"><div class="titlepage"><div><div><h3 class="title">38.4.2. Сочетание с представлениями</h3></div></div></div><a class="indexterm" id="idp62605"></a><p>Есть один простой вариант защититься от ранее упомянутой возможности выполнять <code class="command">INSERT</code>, <code class="command">UPDATE</code> или <code class="command">DELETE</code> для представлений, когда это нежелательно — создать правила, просто отбрасывающие деревья этих запросов. В нашем случае они будут выглядеть так: <pre class="programlisting">CREATE RULE shoe_ins_protect AS ON INSERT TO shoe
    DO INSTEAD NOTHING;
CREATE RULE shoe_upd_protect AS ON UPDATE TO shoe
    DO INSTEAD NOTHING;
CREATE RULE shoe_del_protect AS ON DELETE TO shoe
    DO INSTEAD NOTHING;</pre><p> Если теперь кто-то попытается выполнить одну из этих операций с представлением <code class="literal">shoe</code>, система правил применит эти правила. Так как это правила без действий в режиме <code class="literal">INSTEAD</code>, результирующий список деревьев запроса будет пуст и весь запрос аннулируется, так что после работы системы правил будет нечего оптимизировать и выполнять.<p>Более сложный вариант — использовать систему правил для создания правил, преобразующих дерево запроса в выполняющее нужную операцию с реальными таблицами. Чтобы реализовать это с представлением <code class="literal">shoelace</code>, мы создадим следующие правила: <pre class="programlisting">CREATE RULE shoelace_ins AS ON INSERT TO shoelace
    DO INSTEAD
    INSERT INTO shoelace_data VALUES (
           NEW.sl_name,
           NEW.sl_avail,
           NEW.sl_color,
           NEW.sl_len,
           NEW.sl_unit
    );

CREATE RULE shoelace_upd AS ON UPDATE TO shoelace
    DO INSTEAD
    UPDATE shoelace_data
       SET sl_name = NEW.sl_name,
           sl_avail = NEW.sl_avail,
           sl_color = NEW.sl_color,
           sl_len = NEW.sl_len,
           sl_unit = NEW.sl_unit
     WHERE sl_name = OLD.sl_name;

CREATE RULE shoelace_del AS ON DELETE TO shoelace
    DO INSTEAD
    DELETE FROM shoelace_data
     WHERE sl_name = OLD.sl_name;</pre><p>Если вы хотите поддерживать также запросы к представлению с <code class="literal">RETURNING</code>, вам надо создать правила с предложениями <code class="literal">RETURNING</code>, которые будут вычислять строки представления. Это обычно довольно тривиально для представлений с одной нижележащей таблицей, но несколько затруднительно для представлений с соединением, таких как <code class="literal">shoelace</code>. Например, для <code class="command">INSERT</code> это будет выглядеть так: <pre class="programlisting">CREATE RULE shoelace_ins AS ON INSERT TO shoelace
    DO INSTEAD
    INSERT INTO shoelace_data VALUES (
           NEW.sl_name,
           NEW.sl_avail,
           NEW.sl_color,
           NEW.sl_len,
           NEW.sl_unit
    )
    RETURNING
           shoelace_data.*,
           (SELECT shoelace_data.sl_len * u.un_fact
            FROM unit u WHERE shoelace_data.sl_unit = u.un_name);</pre><p> Заметьте, что это одно правило поддерживает запросы и <code class="command">INSERT</code>, и <code class="command">INSERT RETURNING</code> к этому представлению — предложение <code class="literal">RETURNING</code> просто игнорируется при обычном <code class="command">INSERT</code>.<p>Теперь предположим, что на фабрику прибывает партия шнурков с объёмной сопроводительной накладной. Но вы не хотите вручную вносить по одной записи в представление <code class="literal">shoelace</code>. Вместо этого можно создать две маленькие таблицы: в первую вы будете вставлять записи из накладной, а вторая пригодится для специального приёма. Для этого мы выполним следующие команды: <pre class="programlisting">CREATE TABLE shoelace_arrive (
    arr_name    text,
    arr_quant   integer
);

CREATE TABLE shoelace_ok (
    ok_name     text,
    ok_quant    integer
);

CREATE RULE shoelace_ok_ins AS ON INSERT TO shoelace_ok
    DO INSTEAD
    UPDATE shoelace
       SET sl_avail = sl_avail + NEW.ok_quant
     WHERE sl_name = NEW.ok_name;</pre><p> Теперь вы можете наполнить таблицу <code class="literal">shoelace_arrive</code> данными о поступивших шнурках из накладной: <pre class="programlisting">SELECT * FROM shoelace_arrive;

 arr_name | arr_quant
----------+-----------
 sl3      |        10
 sl6      |        20
 sl8      |        20
(3 rows)</pre><p> Взгляните на текущие данные: <pre class="programlisting">SELECT * FROM shoelace;

 sl_name  | sl_avail | sl_color | sl_len | sl_unit | sl_len_cm
----------+----------+----------+--------+---------+-----------
 sl1      |        5 | black    |     80 | cm      |        80
 sl2      |        6 | black    |    100 | cm      |       100
 sl7      |        6 | brown    |     60 | cm      |        60
 sl3      |        0 | black    |     35 | inch    |      88.9
 sl4      |        8 | black    |     40 | inch    |     101.6
 sl8      |        1 | brown    |     40 | inch    |     101.6
 sl5      |        4 | brown    |      1 | m       |       100
 sl6      |        0 | brown    |    0.9 | m       |        90
(8 rows)</pre><p> Теперь переместите прибывшие шнурки во вторую таблицу: <pre class="programlisting">INSERT INTO shoelace_ok SELECT * FROM shoelace_arrive;</pre><p> Проверьте, что получилось: <pre class="programlisting">SELECT * FROM shoelace ORDER BY sl_name;

 sl_name  | sl_avail | sl_color | sl_len | sl_unit | sl_len_cm
----------+----------+----------+--------+---------+-----------
 sl1      |        5 | black    |     80 | cm      |        80
 sl2      |        6 | black    |    100 | cm      |       100
 sl7      |        6 | brown    |     60 | cm      |        60
 sl4      |        8 | black    |     40 | inch    |     101.6
 sl3      |       10 | black    |     35 | inch    |      88.9
 sl8      |       21 | brown    |     40 | inch    |     101.6
 sl5      |        4 | brown    |      1 | m       |       100
 sl6      |       20 | brown    |    0.9 | m       |        90
(8 rows)

SELECT * FROM shoelace_log;

 sl_name | sl_avail | log_who| log_when                        
---------+----------+--------+----------------------------------
 sl7     |        6 | Al     | Tue Oct 20 19:14:45 1998 MET DST
 sl3     |       10 | Al     | Tue Oct 20 19:25:16 1998 MET DST
 sl6     |       20 | Al     | Tue Oct 20 19:25:16 1998 MET DST
 sl8     |       21 | Al     | Tue Oct 20 19:25:16 1998 MET DST
(4 rows)</pre><p>Чтобы получить эти результаты из одного <code class="literal">INSERT ... SELECT</code>, была проделана большая работа. Мы подробно опишем всё преобразование дерева запросов в продолжении этой главы. Начнём с дерева, выданного анализатором запроса: <pre class="programlisting">INSERT INTO shoelace_ok
SELECT shoelace_arrive.arr_name, shoelace_arrive.arr_quant
  FROM shoelace_arrive shoelace_arrive, shoelace_ok shoelace_ok;</pre><p> Теперь применяется первое правило <code class="literal">shoelace_ok_ins</code>, создающее такое дерево: <pre class="programlisting">UPDATE shoelace
   SET sl_avail = shoelace.sl_avail + shoelace_arrive.arr_quant
  FROM shoelace_arrive shoelace_arrive, shoelace_ok shoelace_ok,
       shoelace_ok old, shoelace_ok new,
       shoelace shoelace
 WHERE shoelace.sl_name = shoelace_arrive.arr_name;</pre><p> и отбрасывающее исходный <code class="command">INSERT</code> в <code class="literal">shoelace_ok</code>. Этот переписанный запрос снова поступает в систему правил и второе применяемое правило <code class="literal">shoelace_upd</code> выдаёт: <pre class="programlisting">UPDATE shoelace_data
   SET sl_name = shoelace.sl_name,
       sl_avail = shoelace.sl_avail + shoelace_arrive.arr_quant,
       sl_color = shoelace.sl_color,
       sl_len = shoelace.sl_len,
       sl_unit = shoelace.sl_unit
  FROM shoelace_arrive shoelace_arrive, shoelace_ok shoelace_ok,
       shoelace_ok old, shoelace_ok new,
       shoelace shoelace, shoelace old,
       shoelace new, shoelace_data shoelace_data
 WHERE shoelace.sl_name = shoelace_arrive.arr_name
   AND shoelace_data.sl_name = shoelace.sl_name;</pre><p> Это тоже правило <code class="literal">INSTEAD</code>, так что предыдущее дерево запроса отбрасывается. Заметьте, что этот запрос по-прежнему использует представление <code class="literal">shoelace</code>. Но система правил ещё не закончила свою работу, она продолжает и применяет правило <code class="literal">_RETURN</code>, так что мы получаем: <pre class="programlisting">UPDATE shoelace_data
   SET sl_name = s.sl_name,
       sl_avail = s.sl_avail + shoelace_arrive.arr_quant,
       sl_color = s.sl_color,
       sl_len = s.sl_len,
       sl_unit = s.sl_unit
  FROM shoelace_arrive shoelace_arrive, shoelace_ok shoelace_ok,
       shoelace_ok old, shoelace_ok new,
       shoelace shoelace, shoelace old,
       shoelace new, shoelace_data shoelace_data,
       shoelace old, shoelace new,
       shoelace_data s, unit u
 WHERE s.sl_name = shoelace_arrive.arr_name
   AND shoelace_data.sl_name = s.sl_name;</pre><p> Наконец, применяется правило <code class="literal">log_shoelace</code> и выдаётся дополнительное дерево запроса: <pre class="programlisting">INSERT INTO shoelace_log
SELECT s.sl_name,
       s.sl_avail + shoelace_arrive.arr_quant,
       current_user,
       current_timestamp
  FROM shoelace_arrive shoelace_arrive, shoelace_ok shoelace_ok,
       shoelace_ok old, shoelace_ok new,
       shoelace shoelace, shoelace old,
       shoelace new, shoelace_data shoelace_data,
       shoelace old, shoelace new,
       shoelace_data s, unit u,
       shoelace_data old, shoelace_data new
       shoelace_log shoelace_log
 WHERE s.sl_name = shoelace_arrive.arr_name
   AND shoelace_data.sl_name = s.sl_name
   AND (s.sl_avail + shoelace_arrive.arr_quant) &lt;&gt; s.sl_avail;</pre><p> Теперь, обработав все правила, система правил выдаёт построенные деревья запросов.<p>В итоге мы получаем два дерева запросов, равнозначные следующим операторам <acronym class="acronym">SQL</acronym>: <pre class="programlisting">INSERT INTO shoelace_log
SELECT s.sl_name,
       s.sl_avail + shoelace_arrive.arr_quant,
       current_user,
       current_timestamp
  FROM shoelace_arrive shoelace_arrive, shoelace_data shoelace_data,
       shoelace_data s
 WHERE s.sl_name = shoelace_arrive.arr_name
   AND shoelace_data.sl_name = s.sl_name
   AND s.sl_avail + shoelace_arrive.arr_quant &lt;&gt; s.sl_avail;

UPDATE shoelace_data
   SET sl_avail = shoelace_data.sl_avail + shoelace_arrive.arr_quant
  FROM shoelace_arrive shoelace_arrive,
       shoelace_data shoelace_data,
       shoelace_data s
 WHERE s.sl_name = shoelace_arrive.sl_name
   AND shoelace_data.sl_name = s.sl_name;</pre><p> В результате вся операция, в ходе которой данные, поступающие из одного отношения, вставляются в другое, вставка преобразуется в изменение третьего, что затем становится изменением четвёртого, и запись об этом изменении добавляется в пятое, сводится к двум запросам.<p>Здесь можно заметить маленькую не очень красивую деталь. Как видно, в этих двух запросах таблица <code class="literal">shoelace_data</code> фигурирует в списке отношений дважды, тогда как определённо достаточно и одного вхождения. Планировщик не понимает этого и поэтому для дерева запроса <code class="command">INSERT</code>, выданного системой правил, будет получен такой план: <pre class="literallayout">
Nested Loop
  -&gt;  Merge Join
        -&gt;  Seq Scan
              -&gt;  Sort
                    -&gt;  Seq Scan on s
        -&gt;  Seq Scan
              -&gt;  Sort
                    -&gt;  Seq Scan on shoelace_arrive
  -&gt;  Seq Scan on shoelace_data
</pre><p> Тогда как без лишнего элемента в списке отношений мы получили бы: <pre class="literallayout">
Merge Join
  -&gt;  Seq Scan
        -&gt;  Sort
              -&gt;  Seq Scan on s
  -&gt;  Seq Scan
        -&gt;  Sort
              -&gt;  Seq Scan on shoelace_arrive
</pre><p> При этом в журнале оказались бы точно такие же записи. Таким образом, применение правил повлекло дополнительное сканирование таблицы <code class="literal">shoelace_data</code>, в котором не было никакой необходимости. И такое же избыточное сканирование выполняется ещё раз в <code class="command">UPDATE</code>. Отнеситесь к этому с пониманием, ведь сделать всё это возможным в принципе было действительно сложно.<p>И наконец, ещё одна, завершающая демонстрация системы правил <span class="productname">Postgres Pro</span> и всей её мощи. Предположим, что вы добавили в базу данных шнурки с экстраординарными цветами: <pre class="programlisting">INSERT INTO shoelace VALUES ('sl9', 0, 'pink', 35.0, 'inch', 0.0);
INSERT INTO shoelace VALUES ('sl10', 1000, 'magenta', 40.0, 'inch', 0.0);</pre><p> Давайте создадим представление, чтобы убедиться, что шнурки (записи в <code class="literal">shoelace</code>) не подходят ни к каким туфлям. Оно будет определено так: <pre class="programlisting">CREATE VIEW shoelace_mismatch AS
    SELECT * FROM shoelace WHERE NOT EXISTS
        (SELECT shoename FROM shoe WHERE slcolor = sl_color);</pre><p> Через него мы получаем наши записи: <pre class="programlisting">SELECT * FROM shoelace_mismatch;

 sl_name | sl_avail | sl_color | sl_len | sl_unit | sl_len_cm
---------+----------+----------+--------+---------+-----------
 sl9     |        0 | pink     |     35 | inch    |      88.9
 sl10    |     1000 | magenta  |     40 | inch    |     101.6</pre><p>Теперь мы хотим, чтобы шнурки, которые ни к чему не подходят, удалялись из базы данных. Чтобы немного усложнить задачу для <span class="productname">Postgres Pro</span>, мы не будем удалять их непосредственно из таблицы. Вместо этого мы создадим ещё одно представление: <pre class="programlisting">CREATE VIEW shoelace_can_delete AS
    SELECT * FROM shoelace_mismatch WHERE sl_avail = 0;</pre><p> И удалим их так: <pre class="programlisting">DELETE FROM shoelace WHERE EXISTS
    (SELECT * FROM shoelace_can_delete
             WHERE sl_name = shoelace.sl_name);</pre><p> Вуаля: <pre class="programlisting">SELECT * FROM shoelace;

 sl_name | sl_avail | sl_color | sl_len | sl_unit | sl_len_cm
---------+----------+----------+--------+---------+-----------
 sl1     |        5 | black    |     80 | cm      |        80
 sl2     |        6 | black    |    100 | cm      |       100
 sl7     |        6 | brown    |     60 | cm      |        60
 sl4     |        8 | black    |     40 | inch    |     101.6
 sl3     |       10 | black    |     35 | inch    |      88.9
 sl8     |       21 | brown    |     40 | inch    |     101.6
 sl10    |     1000 | magenta  |     40 | inch    |     101.6
 sl5     |        4 | brown    |      1 | m       |       100
 sl6     |       20 | brown    |    0.9 | m       |        90
(9 rows)</pre><p>Так запрос <code class="command">DELETE</code> для представления с ограничивающим условием-подзапросом, использующим в совокупности 4 вложенных/соединённых представления, с одним из которых тоже связано условие с подзапросом, задействующим представление, и где используются вычисляемые столбцы представлений, переписывается и преобразуется в одно дерево запроса, которое удаляет требуемые данные из реальной таблицы.<p>На практике ситуации, когда необходима такая сложная конструкция, встречаются довольно редко, но, тем не менее, приятно осознавать, что всё это возможно и работает.</div></div><div class="navfooter"><hr /><table summary="Navigation footer" width="100%"><tr><td align="left" width="40%"><a accesskey="p" href="https://postgrespro.ru/docs/postgrespro/9.5/rules-materializedviews">Пред.</a> </td><td align="center" width="20%"><a accesskey="u" href="https://postgrespro.ru/docs/postgrespro/9.5/rules">Наверх</a></td><td align="right" width="40%"> <a accesskey="n" href="https://postgrespro.ru/docs/postgrespro/9.5/rules-privileges">След.</a></td></tr><tr><td align="left" valign="top" width="40%">38.3. Материализованные представления </td><td align="center" width="20%"><a accesskey="h" href="https://postgrespro.ru/docs/postgrespro/9.5/index">Начало</a></td><td align="right" valign="top" width="40%"> 38.5. Правила и права</td></tr></table></div></div>
		
    </div>
    <div class="col-md-12 d-none" id="divDocEn"></div>
</div>
</div>
</section>


	</div>
    </main>

	
<div class="modal fade" id="feedback" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" >Есть&nbsp;вопросы? Напишите&nbsp;нам!</h5>
      </div>
      <div class="modal-body">
			<input type="text" id="feedback-email" name="email" placeholder='E-mail'
				required        msg-empty="Введите e-mail"
				min-length="3"  msg-short="Слишком короткий e-mail"
				max-length="60" msg-long="Слишком длинный e-mail"
				regexp="\w+([\-+.']\w+)*@\w+([\-.]\w+)*\.\w+([\-.]\w+)*" 
				                msg-regexp="Некорректный адрес e-mail"
			><div class="input-error"></div>
			
			<input type="text" id="feedback-name" name="name" placeholder="Имя" 
				required        msg-empty="Введите имя"
				min-length="3"  msg-short="Слишком короткое имя"
				max-length="60" msg-long ="Слишком длинное имя"
			><div class="input-error"></div>
			 
			<textarea id="feedback-message" name="message"  placeholder="Ваше сообщение" 
                required          msg-empty="Введите сообщение"
				max-length="6000" msg-long="Слишком длинное сообщение"
				min-length="10"   msg-short="Слишком короткое сообщение"
			></textarea>
			<div id="feedback-message-length" class="input-error"></div> 
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" style="width: 100%;" onClick="sendFeedback('feedback', 'message', '', '', 'production')">Отправить</button>
      </div>
        <p class="text-center" style="font-size: 14px;font-weight: 300;"><span class="dotted" onClick="loadAgreement();">Соглашаюсь с условиями обработки персональных данных</span></p>
    </div>
  </div>
</div>

<div class="modal fade" id="popup-message" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-sm" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"></h5>
      </div>
      <div class="modal-body lead  text-center" ></div>
      <div class="modal-footer"></div>
    </div>
  </div>
</div>

<div class="modal fade" id="popup-flash" tabindex="-1" role="dialog" aria-hidden="true"  style="cursor:wait;">
  <div class="modal-dialog modal-dialog-centered modal-sm" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"></h5>
      </div>
      <div class="modal-body text-center"></div>
      <div class="modal-footer"></div>
    </div>
  </div>
</div>

<div class="modal fade" id="popup-window" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
    <div class="modal-content">
		<div class="pop-up-close" onClick="closePopupWindow();">&#10006;</div>
      <div class="modal-header">
        <h5 class="modal-title"></h5>
      </div>
      <div class="modal-body "></div>
      <div class="modal-footer"></div>
    </div>
  </div>
</div>

	
	<form action="https://postgrespro.ru/search/" method="get" role="form" name="search-window" id="search-window" onSubmit="document.body.style.cursor='progress';return true;">
		<input id="qid" name="q">
		
			
				<input type="hidden" id="area-version" name="area" value="version" checked >
				<input type="hidden" id="area-product" name="product" value="postgrespro" >
				<input type="hidden" id="area-version" name="version" value="9.5" >
			
		
	</form>


<!-- FOOTER -->
    <footer class="container-fluid">
 		<div class="container">
 		<div class="row">
			<div  class="about col-lg-3 row" style="margin-bottom:2em;">
				<div class="col-sm-6 col-lg-12"> 
					<a href="https://postgrespro.ru/" ><img src="https://postgrespro.ru/img/PostgresPro_logo_white.svg" class="logo" alt="Postgres Pro"></a> 
	
					<div class="sociallinks" style="margin-bottom:0.6em;margin-top:2em;"> 
						<div class="sociallinks-item"> 
							<a href="https://www.facebook.com/PostgresProfessional" target="_blank"> 
							<svg class="t-sociallinks__svg" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="25px" height="25px" viewBox="0 0 48 48" enable-background="new 0 0 48 48" xml:space="preserve"><desc>Facebook</desc><path style="fill:#ffffff;" d="M47.761,24c0,13.121-10.638,23.76-23.758,23.76C10.877,47.76,0.239,37.121,0.239,24c0-13.124,10.638-23.76,23.764-23.76C37.123,0.24,47.761,10.876,47.761,24 M20.033,38.85H26.2V24.01h4.163l0.539-5.242H26.2v-3.083c0-1.156,0.769-1.427,1.308-1.427h3.318V9.168L26.258,9.15c-5.072,0-6.225,3.796-6.225,6.224v3.394H17.1v5.242h2.933V38.85z"></path></svg> </a> </div> 
						<div class="sociallinks-item"> 
							<a href="https://twitter.com/PostgresPro" target="_blank"> 
							<svg class="t-sociallinks__svg" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="25px" height="25px" viewBox="0 0 48 48" enable-background="new 0 0 48 48" xml:space="preserve"><desc>Twitter</desc><path style="fill:#ffffff;" d="M47.762,24c0,13.121-10.639,23.76-23.761,23.76S0.24,37.121,0.24,24c0-13.124,10.639-23.76,23.761-23.76 S47.762,10.876,47.762,24 M38.031,12.375c-1.177,0.7-2.481,1.208-3.87,1.481c-1.11-1.186-2.694-1.926-4.455-1.926 c-3.364,0-6.093,2.729-6.093,6.095c0,0.478,0.054,0.941,0.156,1.388c-5.063-0.255-9.554-2.68-12.559-6.367 c-0.524,0.898-0.825,1.947-0.825,3.064c0,2.113,1.076,3.978,2.711,5.07c-0.998-0.031-1.939-0.306-2.761-0.762v0.077 c0,2.951,2.1,5.414,4.889,5.975c-0.512,0.14-1.05,0.215-1.606,0.215c-0.393,0-0.775-0.039-1.146-0.109 c0.777,2.42,3.026,4.182,5.692,4.232c-2.086,1.634-4.712,2.607-7.567,2.607c-0.492,0-0.977-0.027-1.453-0.084 c2.696,1.729,5.899,2.736,9.34,2.736c11.209,0,17.337-9.283,17.337-17.337c0-0.263-0.004-0.527-0.017-0.789 c1.19-0.858,2.224-1.932,3.039-3.152c-1.091,0.485-2.266,0.811-3.498,0.958C36.609,14.994,37.576,13.8,38.031,12.375"></path></svg> </a> </div> 
						<div class="sociallinks-item"> 
							<a href="https://vk.com/public101507899" target="_blank"> 
							<svg class="t-sociallinks__svg" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="25px" height="25px" viewBox="0 0 48 48" enable-background="new 0 0 48 48" xml:space="preserve"><desc>VK</desc><path style="fill:#ffffff;" d="M47.761,24c0,13.121-10.639,23.76-23.76,23.76C10.878,47.76,0.239,37.121,0.239,24c0-13.123,10.639-23.76,23.762-23.76C37.122,0.24,47.761,10.877,47.761,24 M35.259,28.999c-2.621-2.433-2.271-2.041,0.89-6.25c1.923-2.562,2.696-4.126,2.45-4.796c-0.227-0.639-1.64-0.469-1.64-0.469l-4.71,0.029c0,0-0.351-0.048-0.609,0.106c-0.249,0.151-0.414,0.505-0.414,0.505s-0.742,1.982-1.734,3.669c-2.094,3.559-2.935,3.747-3.277,3.524c-0.796-0.516-0.597-2.068-0.597-3.171c0-3.449,0.522-4.887-1.02-5.259c-0.511-0.124-0.887-0.205-2.195-0.219c-1.678-0.016-3.101,0.007-3.904,0.398c-0.536,0.263-0.949,0.847-0.697,0.88c0.31,0.041,1.016,0.192,1.388,0.699c0.484,0.656,0.464,2.131,0.464,2.131s0.282,4.056-0.646,4.561c-0.632,0.347-1.503-0.36-3.37-3.588c-0.958-1.652-1.68-3.481-1.68-3.481s-0.14-0.344-0.392-0.527c-0.299-0.222-0.722-0.298-0.722-0.298l-4.469,0.018c0,0-0.674-0.003-0.919,0.289c-0.219,0.259-0.018,0.752-0.018,0.752s3.499,8.104,7.573,12.23c3.638,3.784,7.764,3.36,7.764,3.36h1.867c0,0,0.566,0.113,0.854-0.189c0.265-0.288,0.256-0.646,0.256-0.646s-0.034-2.512,1.129-2.883c1.15-0.36,2.624,2.429,4.188,3.497c1.182,0.812,2.079,0.633,2.079,0.633l4.181-0.056c0,0,2.186-0.136,1.149-1.858C38.281,32.451,37.763,31.321,35.259,28.999"></path></svg> </a> </div> 
						<div class="sociallinks-item"> 
							<a href="https://www.youtube.com/channel/UCawnwMqZ6JeoSiEhrS6X69A/videos" target="_blank"> 
							<svg class="t-sociallinks__svg" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="25px" height="25px" viewBox="0 0 48 48" enable-background="new 0 0 48 48" xml:space="preserve"><desc>Youtube</desc><path style="fill:#ffffff;" d="M24 0.0130005C37.248 0.0130005 47.987 10.753 47.987 24C47.987 37.247 37.247 47.987 24 47.987C10.753 47.987 0.0130005 37.247 0.0130005 24C0.0130005 10.753 10.752 0.0130005 24 0.0130005ZM35.815 18.093C35.565 16.756 34.452 15.758 33.173 15.635C30.119 15.439 27.054 15.28 23.995 15.278C20.936 15.276 17.882 15.432 14.828 15.625C13.544 15.749 12.431 16.742 12.182 18.084C11.898 20.017 11.756 21.969 11.756 23.92C11.756 25.871 11.898 27.823 12.182 29.756C12.431 31.098 13.544 32.21 14.828 32.333C17.883 32.526 20.935 32.723 23.995 32.723C27.053 32.723 30.121 32.551 33.173 32.353C34.452 32.229 35.565 31.084 35.815 29.747C36.101 27.817 36.244 25.868 36.244 23.919C36.244 21.971 36.101 20.023 35.815 18.093ZM21.224 27.435V20.32L27.851 23.878L21.224 27.435Z"></path></svg> </a> </div> 
					</div>
					<span class="copyright">©  Postgres Pro</span>
				</div>
				
				<div  class="col-sm-6 col-lg-12" style="margin-top:2em;">
					<a href="https://postgrespro.ru/privacy">Политика кофиденциальности</a><br>
					<a href="https://postgrespro.ru/useragreement">Пользовательское соглашение</a><br>
					<a href="https://postgrespro.ru/products/postgrespro/eula">Лицензионное соглашение</a><br>
					<a href="https://postgrespro.ru/media/RUS_EULA_for_cloud_Postgres_Pro_Standard_Postgres_Pro_Enterprise.pdf" target="_blank">Лицензионное соглашение (при использовании в составе облачных сервисов)</a><br>
					<a href="https://postgrespro.ru/CoC">Кодекс поведения сообщества PostgreSQL</a>
				</div>
			</div>

			<nav class="col-lg-9 bottom-menu"> 
				
<nav>
<ul class="row">
<li class="col-sm-4">
	<h6>
	
		Продукты
	
	</h6>

	
		<ul><li>
					
						<a href="https://postgrespro.ru/products/postgrespro/standard" >Postgres Pro Standard</a>
					
				</li><li>
					
						<a href="https://postgrespro.ru/products/postgrespro/certified" >Postgres Pro Certified</a>
					
				</li><li>
					
						<a href="https://postgrespro.ru/products/postgrespro/enterprise" >Postgres Pro Enterprise</a>
					
				</li><li>
					
						<a href="https://postgrespro.ru/products/postgrespro/enterprisecertified" >Postgres Pro Enterprise Certified</a>
					
				</li><li>
					
						<a href="https://postgrespro.ru/products/1c" >Postgres Pro для 1С</a>
					
				</li><li>
					
						<a href="https://postgrespro.ru/windows" >PostgreSQL для Windows</a>
					
				</li></ul>
	
</li><li class="col-sm-4">
	<h6>
	
		Образование
	
	</h6>

	
		<ul><li>
					
						<a href="https://postgrespro.ru/docs" >Документация</a>
					
				</li><li>
					
						<a href="https://postgrespro.ru/education/courses" >Учебные курсы</a>
					
				</li><li>
					
						<a href="https://postgrespro.ru/education/books" >Книги</a>
					
				</li><li>
					
						<a href="https://postgrespro.ru/education/cert" >Сертификация специалистов</a>
					
				</li><li>
					
						<a href="https://postgrespro.ru/education/university" >Курсы для вузов</a>
					
				</li><li>
					
						<a href="https://postgrespro.ru/education" >Обучение PostgreSQL</a>
					
				</li><li>
					
						<a href="https://postgrespro.ru/education/glossary" >Глоссарий</a>
					
				</li></ul>
	
</li><li class="col-sm-4">
	<h6>
	
		Услуги
	
	</h6>

	
		<ul><li>
					
						<a href="https://postgrespro.ru/services/support" >Техподдержка СУБД</a>
					
				</li><li>
					
						<a href="https://postgrespro.ru/services/migration" >Миграция СУБД</a>
					
				</li><li>
					
						<a href="https://postgrespro.ru/services/audit" >Аудит СУБД</a>
					
				</li></ul>
	
</li></ul>
</nav>


			</nav>
		</div> 
    	</div>

		<div id="bottom-bar">
			<div id="to-top-button" class="float-left" onClick="$('html, body').animate({scrollTop: 0});return false;">
				<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="50px" height="50px" viewBox="0 0 48 48" enable-background="new 0 0 48 48" xml:space="preserve"> <path style="fill:#0aa7f5;" d="M43.006,47.529H4.964c-2.635,0-4.791-2.156-4.791-4.791V4.697c0-2.635,2.156-4.791,4.791-4.791h38.042 c2.635,0,4.791,2.156,4.791,4.791v38.042C47.797,45.373,45.641,47.529,43.006,47.529z M25.503,16.881l6.994,7.049 c0.583,0.588,1.532,0.592,2.121,0.008c0.588-0.583,0.592-1.533,0.008-2.122l-9.562-9.637c-0.281-0.283-0.664-0.443-1.063-0.443 c0,0,0,0-0.001,0c-0.399,0-0.782,0.159-1.063,0.442l-9.591,9.637c-0.584,0.587-0.583,1.537,0.005,2.121 c0.292,0.292,0.675,0.437,1.058,0.437c0.385,0,0.77-0.147,1.063-0.442L22.5,16.87v19.163c0,0.828,0.671,1.5,1.5,1.5 s1.5-0.672,1.5-1.5L25.503,16.881z"></path> </svg>
			</div>
	
			<div class="pulsate float-right" id="bell">
				<div class="pulsate-circle"  id="bell-run"  onClick="$('#feedback').modal('toggle'); return false;"></div>
				<svg class="icon" width="28px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18.6 17.5" id="tip"    onClick="$('#feedback').modal('toggle'); return false;"><desc>Write</desc><path d="M3.7 17.5v-4.8H2c-1.1 0-2-.9-2-2V2C0 .9.9 0 2 0h14.6c1.1 0 2 .9 2 2v8.8c0 1.1-.9 2-2 2H9l-5.3 4.7zM2 1c-.6 0-1 .4-1 1v8.8c0 .5.4 1 1 1h2.8v3.5l3.8-3.5h8c.5 0 1-.4 1-1V2c0-.5-.4-1-1-1H2z"></path></svg> 
				<svg class="icon" width="16px" height="16px" viewBox="0 0 23 23" version="1.1"            id="close"  onClick="$('#feedback').modal('toggle'); return false;" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <desc>Close</desc> <g stroke="none" stroke-width="1" fill="#000" fill-rule="evenodd"> <rect transform="translate(11.313708, 11.313708) rotate(-45.000000) translate(-11.313708, -11.313708) " x="10.3137085" y="-3.6862915" width="2" height="30"></rect> <rect transform="translate(11.313708, 11.313708) rotate(-315.000000) translate(-11.313708, -11.313708) " x="10.3137085" y="-3.6862915" width="2" height="30"></rect> </g> </svg> 
			</div>

		</div>
    </footer>
	
<script>
checkJQuery();

$(document).ready( function(){
	window.lang = 'ru';
	
	$(".toggler").click(function(){
	    $(this).next().slideToggle(150);
	});

	$("#feedback").on('hide.bs.modal', function (e) {triggerBell(e);});
	$("#feedback").on('show.bs.modal', function (e) {triggerBell(e);});

	

	whoIam();

	$('ul.nav li.dropdown').hover(function() {
	  $(this).find('.dropdown-menu').stop(true, true).delay(100).fadeIn(300);
	}, function() {
	  $(this).find('.dropdown-menu').stop(true, true).delay(100).fadeOut(300);
	});

	var input = $('#search-window input')
	input.focusout(function(e){
		if (!$.trim($(this).val()).length) {
			$('#search-window').fadeOut();
		}
	});
	input.keydown(function(eventObject){
		if( eventObject.which == 27 ){
			if ($.trim($(this).val()).length) {
				$(this).val('');
			} else {
				$('#search-window').fadeOut();
			}
		};
	});
	$(document).scroll(function () {
		if (!$.trim(input.val()).length) {
			$('#search-window').fadeOut();
		}
	});
	
	setTimeout(function(){
		$("#to-top-button").addClass("animation-opacity");
		$("#bell").addClass("animation-opacity");
	} , 2000);
});

function triggerBell(e) {
	var bell = $('#bell');
	var bell2 = $('#bell-run');

	bell.toggleClass('active pulsate');
	bell2.toggleClass('active pulsate-circle');
	bell.find('#close').toggle();
}

var formatDate_month=["января","февраля","марта", "апреля", "мая", "июня", "июля", "августа", "сентября", "октября", "ноября", "декабря"];
var formatDate_weekday=["воскресенье","понедельник","вторник","среда","четверг", "пятница","суббота"];

function formatTime(i) {
	if (i<10) {	i="0" + i; }
	return i;
}

function formatDate(s, format) {
	var d = qwx.iso2time(s);
	
	return d.getDate() + " " + formatDate_month[d.getMonth()] + " " + d.getFullYear() + 
		(format == 'date' ? "" : ", " + formatDate_weekday[d.getDay()] + ", " + 
		formatTime(d.getHours()) + ":" + formatTime(d.getMinutes()));
}
	


</script>	

	

	<script type="text/javascript">
		var m500 = 'Произошла ошибка на сервере';
		var incorrectFormMessage = 'Форма заполнена неправильно';
	</script>
	
	

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55152600-2', 'auto');


  ga('send', 'pageview');
</script>
<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function (d, w, c) {
        (w[c] = w[c] || []).push(function() {
            try {
                w.yaCounter32485545 = new Ya.Metrika({
                    id:32485545,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true
                });
            } catch(e) { }
        });

        var n = d.getElementsByTagName("script")[0],
            s = d.createElement("script"),
            f = function () { n.parentNode.insertBefore(s, n); };
        s.type = "text/javascript";
        s.async = true;
        s.src = "https://mc.yandex.ru/metrika/watch.js";

        if (w.opera == "[object Opera]") {
            d.addEventListener("DOMContentLoaded", f, false);
        } else { f(); }
    })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/32485545" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
	

	
</html>

















