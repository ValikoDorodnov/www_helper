<!DOCTYPE html>
<html lang="ru">
<head>
    <link rel="apple-touch-icon" sizes="57x57" href="https://yiiframework.com.ua/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="https://yiiframework.com.ua/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="https://yiiframework.com.ua/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="https://yiiframework.com.ua/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="https://yiiframework.com.ua/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="https://yiiframework.com.ua/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="https://yiiframework.com.ua/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="https://yiiframework.com.ua/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://yiiframework.com.ua/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="https://yiiframework.com.ua/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://yiiframework.com.ua/favicon-194x194.png" sizes="194x194">
    <link rel="icon" type="image/png" href="https://yiiframework.com.ua/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="https://yiiframework.com.ua/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="https://yiiframework.com.ua/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="https://yiiframework.com.ua/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#1185c7">

    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="csrf-param" content="_csrf">
    <meta name="csrf-token" content="cUZTRHJDSzg8DWAmCHs5e0YcI3UYdiMOFgQ5L0p6E1IrfgABHyk5Ww==">
    <title>Полное руководство (v2): Построитель запросов - Украинское сообщество Yii Framework</title>
    <meta property="og:image" content="https://yiiframework.com.ua/css/img/logo-square.png">
<meta property="og:site_name" content="Украинское сообщество Yii Framework">
<meta property="og:title" content="Полное руководство (v2): Построитель запросов">
<link href="https://yiiframework.com.ua/assets/70587f1e/image.css" rel="stylesheet">
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-social/4.12.0/bootstrap-social.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/awesome-bootstrap-checkbox/0.3.7/awesome-bootstrap-checkbox.min.css" rel="stylesheet">
<link href="https://yiiframework.com.ua/css/compiled.min.css?v=1469914490" rel="stylesheet">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<![endif]-->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head>
<body>

    <nav id="nav" class="navbar-inverse navbar-custom navbar-fixed-top navbar"><div class="container"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#nav-collapse"><span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span></button><a class="navbar-brand" href="https://yiiframework.com.ua/ru/"><img src="https://yiiframework.com.ua/css/img/logo-small.png" alt=""></a></div><div id="nav-collapse" class="collapse navbar-collapse"><ul id="w2" class="navbar-nav navbar-right nav"><li class="dropdown"><a class="dropdown-toggle" href="index.html.1.81.html#" data-toggle="dropdown"><i class="fa fa-indent fa-fw"></i>&nbsp; Разделы <span class="caret"></span></a><ul id="w3" class="dropdown-menu"><li><a href="https://yiiframework.com.ua/ru/posts/" tabindex="-1">Статьи</a></li>
<li class="divider"></li>
<li><a href="https://yiiframework.com.ua/ru/contact/" tabindex="-1">Обратная связь</a></li>
<li><a href="https://yiiframework.com.ua/ru/updates/" tabindex="-1">Обновления cайта</a></li></ul></li>
<li class="dropdown active"><a class="dropdown-toggle" href="index.html.1.81.html#" data-toggle="dropdown"><i class="fa fa-book fa-fw"></i>&nbsp; Документация <span class="caret"></span></a><ul id="w4" class="dropdown-menu"><li class="dropdown-header first">Yii 1.1</li>
<li><a href="https://yiiframework.com.ua/ru/doc/guide/" tabindex="-1">Полное руководство</a></li>
<li><a href="https://yiiframework.com.ua/ru/doc/blog/" tabindex="-1">Создание блога</a></li>
<li><a href="http://www.yiiframework.com/doc/api/" target="_blank" tabindex="-1">Yii API</a></li>
<li><a href="http://yiiapi.com" target="_blank" tabindex="-1">yiiapi.com</a></li>
<li class="divider"></li>
<li class="dropdown-header">Yii 2.*</li>
<li class="active"><a href="https://yiiframework.com.ua/ru/doc/guide/2/" tabindex="-1">Полное руководство</a></li>
<li><a href="http://www.yiiframework.com/doc-2.0/" rel="nofollow" target="_blank" tabindex="-1">Yii 2 API</a></li>
<li class="divider visible-xs"></li></ul></li>
<li class="dropdown"><a class="dropdown-toggle" href="index.html.1.81.html#" data-toggle="dropdown"><i class="fa fa-user fa-fw"></i>&nbsp; Профиль <span class="caret"></span></a><ul id="w5" class="dropdown-menu"><li><a href="https://yiiframework.com.ua/ru/sign-in/" tabindex="-1">Вход</a></li>
<li><a href="https://yiiframework.com.ua/ru/sign-up/" tabindex="-1">Регистрация</a></li></ul></li>
<li class="lang uk"><a href="https://yiiframework.com.ua/uk/" title="Перейти на українську мову">Перейти на <i></i></a></li></ul></div></div></nav>    <div class="container">
        <img src="https://yiiframework.com.ua/css/img/logo.png" alt="Украинское сообщество Yii Framework" title="Украинское сообщество Yii Framework" class="center-block logo"/>
            <div class="row">
        <div class="col-md-4 col-md-push-8">
            <div class="card">
                <div class="card-content">
                    
<div id="doc_toc" class="list-group panel panel-default">
    <div class="panel-heading"><h3 class="panel-title">Оглавление</h3></div>
    <div class="panel-body">
        <a class="list-group-item" href="index.html.1.81.html#chapter2" data-toggle="collapse" data-parent="#doc_toc">Введение <b class="caret"></b></a><div id="chapter2" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/"><i class="fa fa-angle-right fa-fw"></i>О Yii</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/intro-upgrade-from-v1/"><i class="fa fa-angle-right fa-fw"></i>Обновление с версии 1.1</a></div><a class="list-group-item" href="index.html.1.81.html#chapter3" data-toggle="collapse" data-parent="#doc_toc">Первое знакомство <b class="caret"></b></a><div id="chapter3" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/start-installation/"><i class="fa fa-angle-right fa-fw"></i>Установка Yii</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/start-workflow/"><i class="fa fa-angle-right fa-fw"></i>Запуск приложения</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/start-hello/"><i class="fa fa-angle-right fa-fw"></i>Говорим «привет»</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/start-forms/"><i class="fa fa-angle-right fa-fw"></i>Работа с формами</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/start-databases/"><i class="fa fa-angle-right fa-fw"></i>Работа с базами данных</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/start-gii/"><i class="fa fa-angle-right fa-fw"></i>Генерация кода при помощи Gii</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/start-looking-ahead/"><i class="fa fa-angle-right fa-fw"></i>Что дальше?</a></div><a class="list-group-item" href="index.html.1.81.html#chapter4" data-toggle="collapse" data-parent="#doc_toc">Структура приложения <b class="caret"></b></a><div id="chapter4" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/structure-overview/"><i class="fa fa-angle-right fa-fw"></i>Обзор</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/structure-entry-scripts/"><i class="fa fa-angle-right fa-fw"></i>Входные скрипты</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/structure-applications/"><i class="fa fa-angle-right fa-fw"></i>Приложения</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/structure-application-components/"><i class="fa fa-angle-right fa-fw"></i>Компоненты приложения</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/structure-controllers/"><i class="fa fa-angle-right fa-fw"></i>Контроллеры</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/structure-models/"><i class="fa fa-angle-right fa-fw"></i>Модели</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/structure-views/"><i class="fa fa-angle-right fa-fw"></i>Представления</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/structure-modules/"><i class="fa fa-angle-right fa-fw"></i>Модули</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/structure-filters/"><i class="fa fa-angle-right fa-fw"></i>Фильтры</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/structure-widgets/"><i class="fa fa-angle-right fa-fw"></i>Виджеты</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/structure-assets/"><i class="fa fa-angle-right fa-fw"></i>Ресурсы</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/structure-extensions/"><i class="fa fa-angle-right fa-fw"></i>Расширения</a></div><a class="list-group-item" href="index.html.1.81.html#chapter5" data-toggle="collapse" data-parent="#doc_toc">Обработка запросов <b class="caret"></b></a><div id="chapter5" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/runtime-overview/"><i class="fa fa-angle-right fa-fw"></i>Обзор</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/runtime-bootstrapping/"><i class="fa fa-angle-right fa-fw"></i>Bootstrapping</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/runtime-routing/"><i class="fa fa-angle-right fa-fw"></i>Разбор и генерация URL</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/runtime-requests/"><i class="fa fa-angle-right fa-fw"></i>Запросы</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/runtime-responses/"><i class="fa fa-angle-right fa-fw"></i>Ответы</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/runtime-sessions-cookies/"><i class="fa fa-angle-right fa-fw"></i>Сессии и куки</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/runtime-handling-errors/"><i class="fa fa-angle-right fa-fw"></i>Обработка ошибок</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/runtime-logging/"><i class="fa fa-angle-right fa-fw"></i>Логирование</a></div><a class="list-group-item" href="index.html.1.81.html#chapter6" data-toggle="collapse" data-parent="#doc_toc">Основные понятия <b class="caret"></b></a><div id="chapter6" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/concept-components/"><i class="fa fa-angle-right fa-fw"></i>Компоненты</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/concept-properties/"><i class="fa fa-angle-right fa-fw"></i>Свойства</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/concept-events/"><i class="fa fa-angle-right fa-fw"></i>События</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/concept-behaviors/"><i class="fa fa-angle-right fa-fw"></i>Поведения</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/concept-configurations/"><i class="fa fa-angle-right fa-fw"></i>Конфигурации</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/concept-aliases/"><i class="fa fa-angle-right fa-fw"></i>Псевдонимы</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/concept-autoloading/"><i class="fa fa-angle-right fa-fw"></i>Автозагрузка классов</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/concept-service-locator/"><i class="fa fa-angle-right fa-fw"></i>Service Locator</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/concept-di-container/"><i class="fa fa-angle-right fa-fw"></i>Dependency Injection Container</a></div><a class="list-group-item active" href="index.html.1.81.html#chapter7" data-toggle="collapse" data-parent="#doc_toc">Работа с базами данных <b class="caret"></b></a><div id="chapter7" class="submenu panel-collapse collapse in"><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/db-dao/"><i class="fa fa-angle-right fa-fw"></i>Объекты доступа к данным (DAO)</a><a class="list-group-item active" href="index.html.1.81.html"><i class="fa fa-angle-right fa-fw"></i>Построитель запросов</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/db-active-record/"><i class="fa fa-angle-right fa-fw"></i>Active Record</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/db-migrations/"><i class="fa fa-angle-right fa-fw"></i>Миграции</a></div><a class="list-group-item" href="index.html.1.81.html#chapter8" data-toggle="collapse" data-parent="#doc_toc">Получение данных от пользователя <b class="caret"></b></a><div id="chapter8" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/input-forms/"><i class="fa fa-angle-right fa-fw"></i>Создание форм</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/input-validation/"><i class="fa fa-angle-right fa-fw"></i>Валидация</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/input-file-upload/"><i class="fa fa-angle-right fa-fw"></i>Загрузка файлов</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/input-tabular-input/"><i class="fa fa-angle-right fa-fw"></i>Табличный ввод</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/input-multiple-models/"><i class="fa fa-angle-right fa-fw"></i>Работа с несколькими моделями</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/input-form-javascript/"><i class="fa fa-angle-right fa-fw"></i>Расширение ActiveForm на стороне клиента</a></div><a class="list-group-item" href="index.html.1.81.html#chapter9" data-toggle="collapse" data-parent="#doc_toc">Отображение данных <b class="caret"></b></a><div id="chapter9" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/output-formatting/"><i class="fa fa-angle-right fa-fw"></i>Форматирование данных</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/output-pagination/"><i class="fa fa-angle-right fa-fw"></i>Постраничная разбивка</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/output-sorting/"><i class="fa fa-angle-right fa-fw"></i>Сортировка</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/output-data-providers/"><i class="fa fa-angle-right fa-fw"></i>Провайдеры данных</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/output-data-widgets/"><i class="fa fa-angle-right fa-fw"></i>Виджеты для данных</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/output-client-scripts/"><i class="fa fa-angle-right fa-fw"></i>Работа с клиентскими скриптами</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/output-theming/"><i class="fa fa-angle-right fa-fw"></i>Темизация</a></div><a class="list-group-item" href="index.html.1.81.html#chapter10" data-toggle="collapse" data-parent="#doc_toc">Безопасность <b class="caret"></b></a><div id="chapter10" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/security-overview/"><i class="fa fa-angle-right fa-fw"></i>Обзор</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/security-authentication/"><i class="fa fa-angle-right fa-fw"></i>Аутентификация</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/security-authorization/"><i class="fa fa-angle-right fa-fw"></i>Авторизация</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/security-passwords/"><i class="fa fa-angle-right fa-fw"></i>Работа с паролями</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/security-cryptography/"><i class="fa fa-angle-right fa-fw"></i>Криптография</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/security-best-practices/"><i class="fa fa-angle-right fa-fw"></i>Лучшие практики</a></div><a class="list-group-item" href="index.html.1.81.html#chapter11" data-toggle="collapse" data-parent="#doc_toc">Кеширование <b class="caret"></b></a><div id="chapter11" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/caching-overview/"><i class="fa fa-angle-right fa-fw"></i>Обзор</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/caching-data/"><i class="fa fa-angle-right fa-fw"></i>Кэширование данных</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/caching-fragment/"><i class="fa fa-angle-right fa-fw"></i>Кэширование фрагментов</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/caching-page/"><i class="fa fa-angle-right fa-fw"></i>Кэширование страниц</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/caching-http/"><i class="fa fa-angle-right fa-fw"></i>HTTP кэширование</a></div><a class="list-group-item" href="index.html.1.81.html#chapter12" data-toggle="collapse" data-parent="#doc_toc">Веб-сервисы REST <b class="caret"></b></a><div id="chapter12" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/rest-quick-start/"><i class="fa fa-angle-right fa-fw"></i>Быстрый старт</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/rest-resources/"><i class="fa fa-angle-right fa-fw"></i>Ресурсы</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/rest-controllers/"><i class="fa fa-angle-right fa-fw"></i>Контроллеры</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/rest-routing/"><i class="fa fa-angle-right fa-fw"></i>Роутинг</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/rest-response-formatting/"><i class="fa fa-angle-right fa-fw"></i>Форматирование ответа</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/rest-authentication/"><i class="fa fa-angle-right fa-fw"></i>Аутентификация</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/rest-rate-limiting/"><i class="fa fa-angle-right fa-fw"></i>Ограничение частоты запросов</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/rest-versioning/"><i class="fa fa-angle-right fa-fw"></i>Версионирование</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/rest-error-handling/"><i class="fa fa-angle-right fa-fw"></i>Обработка ошибок</a></div><a class="list-group-item" href="index.html.1.81.html#chapter14" data-toggle="collapse" data-parent="#doc_toc">Тестирование <b class="caret"></b></a><div id="chapter14" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/test-overview/"><i class="fa fa-angle-right fa-fw"></i>Обзор</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/test-environment-setup/"><i class="fa fa-angle-right fa-fw"></i>Настройка тестового окружения</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/test-unit/"><i class="fa fa-angle-right fa-fw"></i>Модульные тесты</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/test-functional/"><i class="fa fa-angle-right fa-fw"></i>Функциональные тесты</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/test-acceptance/"><i class="fa fa-angle-right fa-fw"></i>Приёмочные тесты</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/test-fixtures/"><i class="fa fa-angle-right fa-fw"></i>Фикстуры</a></div><a class="list-group-item" href="index.html.1.81.html#chapter15" data-toggle="collapse" data-parent="#doc_toc">Специальные темы <b class="caret"></b></a><div id="chapter15" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/tutorial-start-from-scratch/"><i class="fa fa-angle-right fa-fw"></i>Создание приложения с нуля</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/tutorial-console/"><i class="fa fa-angle-right fa-fw"></i>Консольные команды</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/tutorial-core-validators/"><i class="fa fa-angle-right fa-fw"></i>Встроенные валидаторы</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/tutorial-i18n/"><i class="fa fa-angle-right fa-fw"></i>Интернационализация</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/tutorial-mailing/"><i class="fa fa-angle-right fa-fw"></i>Отправка почты</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/tutorial-performance-tuning/"><i class="fa fa-angle-right fa-fw"></i>Оптимизация производительности</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/tutorial-shared-hosting/"><i class="fa fa-angle-right fa-fw"></i>Окружение виртуального хостинга</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/tutorial-template-engines/"><i class="fa fa-angle-right fa-fw"></i>Шаблонизаторы</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/tutorial-yii-integration/"><i class="fa fa-angle-right fa-fw"></i>Работа со сторонним кодом</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/tutorial-yii-as-micro-framework/"><i class="fa fa-angle-right fa-fw"></i>Использование Yii в качестве микро-framework'а</a></div><a class="list-group-item" href="index.html.1.81.html#chapter16" data-toggle="collapse" data-parent="#doc_toc">Виджеты <b class="caret"></b></a><div id="chapter16" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/yii-grid-gridview/"><i class="fa fa-angle-right fa-fw"></i>GridView</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/yii-widgets-listview/"><i class="fa fa-angle-right fa-fw"></i>ListView</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/yii-widgets-detailview/"><i class="fa fa-angle-right fa-fw"></i>DetailView</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/guide-input-forms/"><i class="fa fa-angle-right fa-fw"></i>ActiveForm</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/yii-widgets-pjax/"><i class="fa fa-angle-right fa-fw"></i>Pjax</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/yii-widgets-menu/"><i class="fa fa-angle-right fa-fw"></i>Menu</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/yii-widgets-linkpager/"><i class="fa fa-angle-right fa-fw"></i>LinkPager</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/yii-widgets-linksorter/"><i class="fa fa-angle-right fa-fw"></i>LinkSorter</a></div><a class="list-group-item" href="index.html.1.81.html#chapter17" data-toggle="collapse" data-parent="#doc_toc">Хелперы <b class="caret"></b></a><div id="chapter17" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/helper-overview/"><i class="fa fa-angle-right fa-fw"></i>Обзор</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/helper-array/"><i class="fa fa-angle-right fa-fw"></i>ArrayHelper</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/helper-html/"><i class="fa fa-angle-right fa-fw"></i>Html</a><a class="list-group-item" href="https://yiiframework.com.ua/ru/doc/guide/2/helper-url/"><i class="fa fa-angle-right fa-fw"></i>Url хелпер</a></div>    </div>
</div>                </div>
            </div>

            <div class="card">
                <div class="card-content">
                    <script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script><!-- Documentation --><ins class="adsbygoogle" style="display: block;" data-ad-client="ca-pub-8275858625830540" data-ad-slot="7690380517" data-ad-format="auto"></ins><small style="margin-top: 10px; display: block;"><a href="https://yiiframework.com.ua/ru/adv/" rel="nofollow" target="_blank">Зачем реклама?</a></small><script>(adsbygoogle = window.adsbygoogle || []).push({})</script>                </div>
            </div>
        </div>
        <div class="col-md-8 col-md-pull-4">
            <div class="card">
                <div class="card-content">
                    <ul class="breadcrumb breadcrumb_doc"><li><a href="https://yiiframework.com.ua/ru/doc/guide/2/">Полное руководство (v2)</a></li>
<li class="active">Работа с базами данных</li>
<li class="active">Построитель запросов</li>
</ul>                                        
<div class="documentation-content section-guide version-2">
    <h1>Построитель запросов</h1>
<p>Построенный поверх <a href="https://yiiframework.com.ua/ru/doc/guide/2/db-dao/">DAO</a>, построитель запросов позволяет конструировать SQL выражения в программируемом и
независимом от СУБД виде. В сравнении с написанием чистого SQL выражения, использование построителя помогает 
вам писать более читаемый связанный с SQL код и генерировать более безопасные SQL выражения.</p>
<p>Использование построителя запросов, как правило, включает два этапа:</p>
<ol>
<li>Создание объекта <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html" title="yii\db\Query" target="_blank">yii\db\Query</a> представляющего различные части (такие как <code>SELECT</code>, <code>FROM</code>) SQL выражения SELECT.</li>
<li>Выполнить запрос методом <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html" title="yii\db\Query" target="_blank">yii\db\Query</a> (таким как <code>all()</code>) для извлечения данных из базы данных.</li>
</ol>
<p>Следующий код показывает обычное использование построителя запросов:</p>
<pre><code class="language-php"><span style="color: #0000BB">$rows&nbsp;</span><span style="color: #007700">=&nbsp;(new&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">Query</span><span style="color: #007700">())<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">([</span><span style="color: #DD0000">'id'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'email'</span><span style="color: #007700">])<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'user'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">([</span><span style="color: #DD0000">'last_name'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'Smith'</span><span style="color: #007700">])<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">limit</span><span style="color: #007700">(</span><span style="color: #0000BB">10</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();</span>
</code></pre>
<p>Приведённый выше код создаёт и выполняет следующее SQL выражение, где параметр <code>:last_name</code> привязывается к строке <code>'Smith'</code>.</p>
<pre><code class="language-sql">SELECT `id`, `email` 
FROM `user`
WHERE `last_name` = :last_name
LIMIT 10
</code></pre>
<blockquote><p><strong>Info:</strong> В основном вы будете работать с <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html" title="yii\db\Query" target="_blank">yii\db\Query</a> вместо <a href="http://www.yiiframework.com/doc-2.0/yii-db-querybuilder.html" title="yii\db\QueryBuilder" target="_blank">yii\db\QueryBuilder</a>. Последний вызывается
  неявно при вызове одного из методов запроса. <a href="http://www.yiiframework.com/doc-2.0/yii-db-querybuilder.html" title="yii\db\QueryBuilder" target="_blank">yii\db\QueryBuilder</a> это класс, отвечающий за генерацию зависимого
  от СУБД SQL выражения (такие как экранирование имён таблиц/столбцов) из независимых от СУБД объектов <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html" title="yii\db\Query" target="_blank">yii\db\Query</a>. </p>
</blockquote>
<h2>Построение запросов<span id="building-queries"></span> <a href="index.html.1.81.html#building-queries" class="hashlink">#</a></h2><p>Создав объект <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html" title="yii\db\Query" target="_blank">yii\db\Query</a>, вы можете вызвать различные методы для создания различных частей SQL выражения.
Имена методов напоминают ключевые слова SQL, используемые в соответствующих частях SQL запроса. Например,
чтобы указать <code>FROM</code> часть запроса, вам нужно вызвать метод <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#from()-detail" title="from()" target="_blank">from()</a>. Все методы построителя
запросов возвращают свой объект, который позволяет объединять несколько вызовов в цепочку.</p>
<p>Далее будет описание каждого метода построителя запросов.</p>
<h3><a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#select()-detail" title="select()" target="_blank">select()</a><span id="select"></span> <a href="index.html.1.81.html#select" class="hashlink">#</a></h3><p>Метод <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#select()-detail" title="select()" target="_blank">select()</a> определяет фрагмент <code>SELECT</code> SQL запроса. Вы можете указать столбцы, которые
должны быть выбраны, они должны быть указаны в виде массива или строки. Имена столбцов автоматически экранируются
при создании SQL-запроса при его генерации из объекта <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html" title="yii\db\Query" target="_blank">yii\db\Query</a>.</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">([</span><span style="color: #DD0000">'id'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'email'</span><span style="color: #007700">]);<br /><br /></span><span style="color: #FF8000">//&nbsp;эквивалентно:<br /><br /></span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">(</span><span style="color: #DD0000">'id,&nbsp;email'</span><span style="color: #007700">);</span>
</code></pre>
<p>Имена столбцов могут быть выбраны вместе с префиксами таблиц и/или алиасами столбцов, также как при записи обычного SQL выражения.
Например,</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">([</span><span style="color: #DD0000">'user.id&nbsp;AS&nbsp;user_id'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'email'</span><span style="color: #007700">]);<br /><br /></span><span style="color: #FF8000">//&nbsp;эквивалентно:<br /><br /></span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">(</span><span style="color: #DD0000">'user.id&nbsp;AS&nbsp;user_id,&nbsp;email'</span><span style="color: #007700">);</span>
</code></pre>
<p>Если вы используете формат массива для указания столбцов, вы можете также указать ключи массива для указания алиасов столбцов.
Например, приведённый выше код может быть переписан:</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">([</span><span style="color: #DD0000">'user_id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'user.id'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'email'</span><span style="color: #007700">]);</span>
</code></pre>
<p>Если вы не вызываете метод <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#select()-detail" title="select()" target="_blank">select()</a> при создании запроса, будет использована <code>*</code>, что означает
выбрать <em>все</em> столбцы.</p>
<p>Кроме имён столбцов, вы можете также использовать SQL выражения. Вы должны использовать формат массива для использования
выражений, которые содержат запятые для предотвращения некорректного автоматического экранирования. Например,</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">([</span><span style="color: #DD0000">"CONCAT(first_name,&nbsp;'&nbsp;',&nbsp;last_name)&nbsp;AS&nbsp;full_name"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'email'</span><span style="color: #007700">]);</span>
</code></pre>
<p>Начиная с версии 2.0.1, вы также можете использовать подзапросы. Вы должны указывать каждый подзапрос в выражении как
объект <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html" title="yii\db\Query" target="_blank">yii\db\Query</a>. Например,</p>
<pre><code class="language-php"><span style="color: #0000BB">$subQuery&nbsp;</span><span style="color: #007700">=&nbsp;(new&nbsp;</span><span style="color: #0000BB">Query</span><span style="color: #007700">())-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">(</span><span style="color: #DD0000">'COUNT(*)'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'user'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;SELECT&nbsp;`id`,&nbsp;(SELECT&nbsp;COUNT(*)&nbsp;FROM&nbsp;`user`)&nbsp;AS&nbsp;`count`&nbsp;FROM&nbsp;`post`<br /></span><span style="color: #0000BB">$query&nbsp;</span><span style="color: #007700">=&nbsp;(new&nbsp;</span><span style="color: #0000BB">Query</span><span style="color: #007700">())-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">([</span><span style="color: #DD0000">'id'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'count'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$subQuery</span><span style="color: #007700">])-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'post'</span><span style="color: #007700">);</span>
</code></pre>
<p>Чтоб выбрать конкретные строки, вы можете вызвать метод <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#distinct()-detail" title="distinct()" target="_blank">distinct()</a>:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;SELECT&nbsp;DISTINCT&nbsp;`user_id`&nbsp;...<br /></span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">(</span><span style="color: #DD0000">'user_id'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">distinct</span><span style="color: #007700">();</span>
</code></pre>
<p>Вы можете вызвать <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#addSelect()-detail" title="addSelect()" target="_blank">addSelect()</a> для добавления полей. Например,</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">([</span><span style="color: #DD0000">'id'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'username'</span><span style="color: #007700">])<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">addSelect</span><span style="color: #007700">([</span><span style="color: #DD0000">'email'</span><span style="color: #007700">]);</span>
</code></pre>
<h3><a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#from()-detail" title="from()" target="_blank">from()</a><span id="from"></span> <a href="index.html.1.81.html#from" class="hashlink">#</a></h3><p>Метод <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#from()-detail" title="from()" target="_blank">from()</a> указывает фрагмент <code>FROM</code> SQL запроса. Например,</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`user`<br /></span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'user'</span><span style="color: #007700">);</span>
</code></pre>
<p>Вы можете указать имена таблиц в виде строки или массива. Имена таблиц могут содержать префикс схемы и/или алиасы
таблиц, как при написании обычного SQL выражения. Например,</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">([</span><span style="color: #DD0000">'public.user&nbsp;u'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'public.post&nbsp;p'</span><span style="color: #007700">]);<br /><br /></span><span style="color: #FF8000">//&nbsp;эквивалентно:<br /><br /></span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'public.user&nbsp;u,&nbsp;public.post&nbsp;p'</span><span style="color: #007700">);</span>
</code></pre>
<p>Если вы используете формат массива, вы можете использовать ключи массива для указания алиасов:</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">([</span><span style="color: #DD0000">'u'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'public.user'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'p'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'public.post'</span><span style="color: #007700">]);</span>
</code></pre>
<p>Кроме имён таблиц, вы можете так же, как и в select, указывать подзапросы в виде объекта <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html" title="yii\db\Query" target="_blank">yii\db\Query</a>.</p>
<pre><code class="language-php"><span style="color: #0000BB">$subQuery&nbsp;</span><span style="color: #007700">=&nbsp;(new&nbsp;</span><span style="color: #0000BB">Query</span><span style="color: #007700">())-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">(</span><span style="color: #DD0000">'id'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'user'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">(</span><span style="color: #DD0000">'status=1'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;(SELECT&nbsp;`id`&nbsp;FROM&nbsp;`user`&nbsp;WHERE&nbsp;status=1)&nbsp;u&nbsp;<br /></span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">([</span><span style="color: #DD0000">'u'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$subQuery</span><span style="color: #007700">]);</span>
</code></pre>
<h4>Префиксы<span id="prefiksy"></span> <a href="index.html.1.81.html#prefiksy" class="hashlink">#</a></h4><p>Также может применяться <a href="http://www.yiiframework.com/doc-2.0/yii-db-connection.html#$tablePrefix-detail" title="tablePrefix" target="_blank">tablePrefix</a> по умолчанию. Подробное описание смотрите
в подразделе <a href="https://yiiframework.com.ua/ru/doc/guide/2/db-dao/#quoting-table-and-column-names">«Экранирование имён таблиц и столбцов» раздела «Объекты доступа к данным (DAO)»</a>.</p>
<h3><a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#where()-detail" title="where()" target="_blank">where()</a><span id="where"></span> <a href="index.html.1.81.html#where" class="hashlink">#</a></h3><p>Метод <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#where()-detail" title="where()" target="_blank">where()</a> определяет фрагмент <code>WHERE</code> SQL выражения. Вы можете использовать один из
трёх форматов:</p>
<ul>
<li>строковый формат, Например, <code>'status=1'</code></li>
<li>формат массива, Например, <code>['status' =&gt; 1, 'type' =&gt; 2]</code></li>
<li>формат операторов, Например, <code>['like', 'name', 'test']</code></li>
</ul>
<h4>Строковый формат<span id="string-format"></span> <a href="index.html.1.81.html#string-format" class="hashlink">#</a></h4><p>Строковый формат - это лучший выбор для простых условий. Он работает так, будто вы просто пишете SQL запрос. Например,</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">(</span><span style="color: #DD0000">'status=1'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;или&nbsp;используя&nbsp;привязку&nbsp;параметров<br /></span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">(</span><span style="color: #DD0000">'status=:status'</span><span style="color: #007700">,&nbsp;[</span><span style="color: #DD0000">':status'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$status</span><span style="color: #007700">]);</span>
</code></pre>
<p>Не встраивайте переменные непосредственно в условие, особенно если значение переменной получено от пользователя,
потому что это делает ваше приложение подверженным атакам через SQL инъекции.</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;Опасность!&nbsp;Не&nbsp;делайте&nbsp;так&nbsp;если&nbsp;вы&nbsp;не&nbsp;уверены,&nbsp;что&nbsp;$status&nbsp;это&nbsp;действительно&nbsp;число.<br /></span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">(</span><span style="color: #DD0000">"status=</span><span style="color: #0000BB">$status</span><span style="color: #DD0000">"</span><span style="color: #007700">);</span>
</code></pre>
<p>При использовании привязки параметров, вы можете вызывать <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#params()-detail" title="params()" target="_blank">params()</a> или
<a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#addParams()-detail" title="addParams()" target="_blank">addParams()</a> для раздельного указания параметров.</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">(</span><span style="color: #DD0000">'status=:status'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">addParams</span><span style="color: #007700">([</span><span style="color: #DD0000">':status'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$status</span><span style="color: #007700">]);</span>
</code></pre>
<h4>Формат массива<span id="hash-format"></span> <a href="index.html.1.81.html#hash-format" class="hashlink">#</a></h4><p>Формат массива лучше всего использовать для указания нескольких объединяемых через <code>AND</code> условий, каждое из которых
является простым равенством. Он описывается в виде массива, ключами которого являются имена столбцов, а значения
соответствуют значениям столбцов.</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;...WHERE&nbsp;(`status`&nbsp;=&nbsp;10)&nbsp;AND&nbsp;(`type`&nbsp;IS&nbsp;NULL)&nbsp;AND&nbsp;(`id`&nbsp;IN&nbsp;(4,&nbsp;8,&nbsp;15))<br /></span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">([<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'status'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">10</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'type'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[</span><span style="color: #0000BB">4</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">8</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">15</span><span style="color: #007700">],<br />]);</span>
</code></pre>
<p>Как вы можете видеть, построитель запросов достаточно умен, чтобы правильно обрабатывать значения <code>null</code> или массивов.</p>
<p>Вы также можете использовать подзапросы:</p>
<pre><code class="language-php"><span style="color: #0000BB">$userQuery&nbsp;</span><span style="color: #007700">=&nbsp;(new&nbsp;</span><span style="color: #0000BB">Query</span><span style="color: #007700">())-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">(</span><span style="color: #DD0000">'id'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'user'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;...WHERE&nbsp;`id`&nbsp;IN&nbsp;(SELECT&nbsp;`id`&nbsp;FROM&nbsp;`user`)<br /></span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">([</span><span style="color: #DD0000">'id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$userQuery</span><span style="color: #007700">]);</span>
</code></pre>
<p>Используя формат массива, Yii автоматически привязывает значения массива как параметры, потому в отличие от <a href="index.html.1.81.html#string-format">строкового формата</a>,
привязывать параметры вручную не требуется. Обратите внимание, что Yii никогда НЕ экранирует имена столбцов (ключи массива),
потому если вы используете как ключ массива переменную, полученную от пользователя без дополнительной проверки, ваше приложение
становится подверженным атаке через SQL инъекцию. Чтобы избежать этого, используйте для имён столбцов только проверененные данные,
предпочитая фильтрацию по «белому списку». Если вам нужно использовать имя столбца, полученное от пользователя,
вам может быть полезным раздел <a href="https://yiiframework.com.ua/ru/doc/guide/2/output-data-widgets/#filtering-data">Фильтрация данных</a>. Ниже приведён пример уязвимого кода:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;Уязвимый&nbsp;код:<br /></span><span style="color: #0000BB">$column&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$request</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">get</span><span style="color: #007700">(</span><span style="color: #DD0000">'column'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$value&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$request</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">get</span><span style="color: #007700">(</span><span style="color: #DD0000">'value'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">([</span><span style="color: #0000BB">$column&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">]);<br /></span><span style="color: #FF8000">//&nbsp;$value&nbsp;будет&nbsp;безопасно&nbsp;привязано&nbsp;как&nbsp;параметр,&nbsp;но&nbsp;$column&nbsp;–&nbsp;нет!</span>
</code></pre>
<h4>Формат операторов<span id="operator-format"></span> <a href="index.html.1.81.html#operator-format" class="hashlink">#</a></h4><p>Формат оператора позволяет задавать произвольные условия в программном стиле. Он имеет следующий вид:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">[</span><span style="color: #0000BB">operator</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">operand1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">operand2</span><span style="color: #007700">,&nbsp;...]</span>
</code></pre>
<p>Операнды могут быть заданы в виде строкового формата, формата массива или формата операторов рекурсивно, в то время
как оператор может быть одним из следующих:</p>
<ul>
<li><p><code>and</code>: операнды должны быть объединены с помощью оператора <code>AND</code>. Например,
<code>['and', 'id=1', 'id=2']</code> сгенерирует <code>id=1 AND id=2</code>. Если операнд массив,
он будет сконвертирован в строку по правилам описанным ниже. Например,
<code>['and', 'type=1', ['or', 'id=1', 'id=2']]</code> сгенерирует <code>type=1 AND (id=1 OR id=2)</code>.
Этот метод не производит никакого экранирования.</p>
</li>
<li><p><code>or</code>: похож на оператор <code>and</code> за исключением того, что будет использоваться оператор <code>OR</code>.</p>
</li>
<li><p><code>between</code>: первый операнд должен быть именем столбца, а второй и третий оператор должны быть начальным и конечным
 значением диапазона. Например, <code>['between', 'id', 1, 10]</code> сгенерирует <code>id BETWEEN 1 AND 10</code>.</p>
</li>
<li><p><code>not between</code>: похож на <code>between</code> за исключением того, что <code>BETWEEN</code> заменяется на <code>NOT BETWEEN</code>
в сгенерированном условии.</p>
</li>
<li><p><code>in</code>: первый операнд должен быть столбцом или выражением БД. Второй операнд может быть либо массивом, либо объектом <code>Query</code>.
Будет сгенерировано условие <code>IN</code>. Если второй операнд массив, он будет представлять набор значений, которым может быть
равен столбец или выражение БД; Если второй операнд объект <code>Query</code>, будет сформирован подзапрос, который будет использован
как диапазон для столбца или выражения БД. Например, <code>['in', 'id', [1, 2, 3]]</code> сформирует <code>id IN (1, 2, 3)</code>.
Метод будет правильно экранировать имя столбца и значения диапазона. Оператор <code>in</code> также поддерживает составные столбцы.
В этом случае, первый операнд должен быть массивом названий столбцов, в то время как операнд 2 должен быть массивом
массивов или объектом <code>Query</code> представляющим диапазоны для столбцов.</p>
</li>
<li><p><code>not in</code>: похож на оператор <code>in</code>, кроме того что <code>IN</code> будет заменён на <code>NOT IN</code> в сформированном условии.</p>
</li>
<li><p><code>like</code>: первый операнд должен быть столбцом или выражением БД, а второй операнд будет строкой или массивом представляющим
значения, на которые должны быть похожи столбцы или выражения БД. Например, <code>['like', 'name', 'tester']</code>
сформирует <code>name LIKE '%tester%'</code>. 
Когда диапазон значений задан в виде массива, несколько <code>LIKE</code> утверждений будут сформированы и соединены с помощью <code>AND</code>.
Например, <code>['like', 'name', ['test', 'sample']]</code> сформирует <code>name LIKE '%test%' AND name LIKE '%sample%'</code>.
Вы также можете передать третий необязательный операнд, для указания способа экранирования специальных символов в значениях.
Операнд должен быть представлен массивом соответствия специальных символов их экранированным аналогам. Если этот
операнд не задан, то будет использовано соответствие по умолчанию. Вы можете также использовать значение <code>false</code>
или пустой массив, чтоб указать что значения уже экранированы. Обратите внимание, что при использовании массива соответствия
экранирования (или если третий операнд не передан), значения будут автоматически заключены в символы процентов.</p>
<blockquote><p><strong>Note:</strong> При использовании PostgreSQL вы можете использовать также <a href="http://www.postgresql.org/docs/8.3/static/functions-matching.html#FUNCTIONS-LIKE" target="_blank"><code>ilike</code></a>
вместо <code>like</code> для регистронезависимого поиска.</p>
</blockquote>
</li>
<li><p><code>or like</code>: похож на оператор <code>like</code>, только утверждения <code>LIKE</code> будут объединяться с помощью оператора <code>OR</code>, если
второй операнд будет представлен массивом.</p>
</li>
<li><p><code>not like</code>: похож на оператор <code>like</code>, только <code>LIKE</code> будет заменён на <code>NOT LIKE</code> в сгенерированном условии.</p>
</li>
<li><p><code>or not like</code>: похож на оператор <code>not like</code>, только утверждения <code>NOT LIKE</code> будут объединены с помощью <code>OR</code>.</p>
</li>
<li><p><code>exists</code>: требует один операнд, который должен быть экземпляром <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html" title="yii\db\Query" target="_blank">yii\db\Query</a> представляющим подзапрос. Будет
сгенерировано выражение <code>EXISTS (sub-query)</code>.</p>
</li>
<li><p><code>not exists</code>: похож на оператор <code>exists</code> и сформирует выражение <code>NOT EXISTS (sub-query)</code>.</p>
</li>
<li><p><code>&gt;</code>, <code>&lt;=</code>, или другие валидные операторы БД, которые требуют двух операндов: первый операнд должен быть именем
столбца, второй операнд это значение. Например, <code>['&gt;', 'age', 10]</code> сформирует <code>age&gt;10</code>.</p>
</li>
</ul>
<p>Используя формат операторов, Yii автоматически привязывает значения для сравнения как параметры, потому в отличие от <a href="index.html.1.81.html#string-format">строкового формата</a>,
привязывать параметры вручную не требуется. Обратите внимание, что Yii никогда НЕ экранирует имена столбцов,
потому если вы используете как имя столбца переменную, полученную от пользователя без дополнительной проверки, ваше приложение
становится подверженным атаке через SQL инъекцию. Чтобы избежать этого, используйте для имён столбцов только проверененные данные,
предпочитая фильтрацию по «белому списку». Если вам нужно использовать имя столбца, полученное от пользователя,
вам может быть полезным раздел <a href="https://yiiframework.com.ua/ru/doc/guide/2/output-data-widgets/#filtering-data">Фильтрация данных</a>. Ниже приведён пример уязвимого кода:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;Уязвимый&nbsp;код:<br /></span><span style="color: #0000BB">$column&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$request</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">get</span><span style="color: #007700">(</span><span style="color: #DD0000">'column'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$value&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$request</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">get</span><span style="color: #007700">(</span><span style="color: #DD0000">'value'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">([</span><span style="color: #DD0000">'='</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$column</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">]);<br /></span><span style="color: #FF8000">//&nbsp;$value&nbsp;будет&nbsp;безопасно&nbsp;привязано&nbsp;как&nbsp;параметр,&nbsp;но&nbsp;$column&nbsp;–&nbsp;нет!</span>
</code></pre>
<h4>Добавление условий<span id="appending-conditions"></span> <a href="index.html.1.81.html#appending-conditions" class="hashlink">#</a></h4><p>Вы можете использовать <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#andWhere()-detail" title="andWhere()" target="_blank">andWhere()</a> или <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#orWhere()-detail" title="orWhere()" target="_blank">orWhere()</a> для добавления
дополнительных условий. Вы можете использовать эти вызовы несколько раз для добавления нескольких условий.
Например,</p>
<pre><code class="language-php"><span style="color: #0000BB">$status&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">10</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$search&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'yii'</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">([</span><span style="color: #DD0000">'status'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$status</span><span style="color: #007700">]);<br /><br />if&nbsp;(!empty(</span><span style="color: #0000BB">$search</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">([</span><span style="color: #DD0000">'like'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'title'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$search</span><span style="color: #007700">]);<br />}</span>
</code></pre>
<p>Если <code>$search</code> не пустое, то будет сформировано следующее условие WHERE:</p>
<pre><code class="language-sql">WHERE (`status` = 10) AND (`title` LIKE '%yii%')
</code></pre>
<h4>Условия для фильтров<span id="filter-conditions"></span> <a href="index.html.1.81.html#filter-conditions" class="hashlink">#</a></h4><p>Когда условие <code>WHERE</code> формируется на основе пользовательского ввода, обычно, хочется проигнорировать не заданные значения.
Например, в форме поиска, которая позволяет осуществлять поиск по имени пользователя или email, вы хотели бы игнорировать
username/email условие, если пользователь ничего не ввёл в поле ввода. Вы можете достичь этого используя метод
<a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#filterWhere()-detail" title="filterWhere()" target="_blank">filterWhere()</a>.</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;$username&nbsp;и&nbsp;$email&nbsp;вводит&nbsp;пользователь<br /></span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">filterWhere</span><span style="color: #007700">([<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'username'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$username</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'email'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$email</span><span style="color: #007700">,<br />]);</span>
</code></pre>
<p>Единственное отличие между <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#filterWhere()-detail" title="filterWhere()" target="_blank">filterWhere()</a> и <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#where()-detail" title="where()" target="_blank">where()</a> 
заключается в игнорировании пустых значений, переданных в условие в <a href="index.html.1.81.html#hash-format">форме массива</a>. Таким образом
если <code>$email</code> будет пустым, а <code>$username</code> нет, то приведённый выше код сформирует условие <code>WHERE username=:username</code>.</p>
<blockquote><p><strong>Info:</strong> значение признаётся пустым, если это <code>null</code>, пустой массив, пустая строка или строка состоящая из одних пробельных символов.</p>
</blockquote>
<p>Также вместо <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#andWhere()-detail" title="andWhere()" target="_blank">andWhere()</a> и <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#orWhere()-detail" title="orWhere()" target="_blank">orWhere()</a>, вы можете использовать
<a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#andFilterWhere()-detail" title="andFilterWhere()" target="_blank">andFilterWhere()</a> и <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#orFilterWhere()-detail" title="orFilterWhere()" target="_blank">orFilterWhere()</a>
для добавления дополнительных условий фильтрации.</p>
<h3><a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#orderBy()-detail" title="orderBy()" target="_blank">orderBy()</a><span id="order-by"></span> <a href="index.html.1.81.html#order-by" class="hashlink">#</a></h3><p>Метод <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#orderBy()-detail" title="orderBy()" target="_blank">orderBy()</a> определяет фрагмент <code>ORDER BY</code> SQL выражения. Например,</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;...&nbsp;ORDER&nbsp;BY&nbsp;`id`&nbsp;ASC,&nbsp;`name`&nbsp;DESC<br /></span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">orderBy</span><span style="color: #007700">([<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">SORT_ASC</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'name'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">SORT_DESC</span><span style="color: #007700">,<br />]);</span>
</code></pre>
<p>В данном коде, ключи массива - это имена столбцов, а значения массива - это соответствующее направление сортировки.
PHP константа <code>SORT_ASC</code> определяет сортировку по возрастанию и <code>SORT_DESC</code> сортировка по умолчанию.</p>
<p>Если <code>ORDER BY</code> содержит только простые имена столбцов, вы можете определить их с помощью столбцов, также
как и при написании обычного SQL. Например,</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">orderBy</span><span style="color: #007700">(</span><span style="color: #DD0000">'id&nbsp;ASC,&nbsp;name&nbsp;DESC'</span><span style="color: #007700">);</span>
</code></pre>
<blockquote><p><strong>Note:</strong> Вы должны использовать массив для указания <code>ORDER BY</code> содержащих выражения БД.</p>
</blockquote>
<p>Вы можете вызывать <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#addOrderBy()-detail" title="addOrderBy()" target="_blank">addOrderBy()</a> для добавления столбцов во фрагмент <code>ORDER BY</code>.</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">orderBy</span><span style="color: #007700">(</span><span style="color: #DD0000">'id&nbsp;ASC'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">addOrderBy</span><span style="color: #007700">(</span><span style="color: #DD0000">'name&nbsp;DESC'</span><span style="color: #007700">);</span>
</code></pre>
<h3><a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#groupBy()-detail" title="groupBy()" target="_blank">groupBy()</a><span id="group-by"></span> <a href="index.html.1.81.html#group-by" class="hashlink">#</a></h3><p>Метод <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#groupBy()-detail" title="groupBy()" target="_blank">groupBy()</a> определяет фрагмент <code>GROUP BY</code> SQL запроса.</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;...&nbsp;GROUP&nbsp;BY&nbsp;`id`,&nbsp;`status`<br /></span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">groupBy</span><span style="color: #007700">([</span><span style="color: #DD0000">'id'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'status'</span><span style="color: #007700">]);</span>
</code></pre>
<p>Если фрагмент <code>GROUP BY</code> содержит только простые имена столбцов, вы можете указать их используя строку, также как в
обычном SQL выражении.</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">groupBy</span><span style="color: #007700">(</span><span style="color: #DD0000">'id,&nbsp;status'</span><span style="color: #007700">);</span>
</code></pre>
<blockquote><p><strong>Note:</strong> Вы должны использовать массив для указания <code>GROUP BY</code> содержащих выражения БД.</p>
</blockquote>
<p>Вы можете вызывать <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#addGroupBy()-detail" title="addGroupBy()" target="_blank">addGroupBy()</a> для добавления имён столбцов во фрагмент <code>GROUP BY</code>.
Например,</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">groupBy</span><span style="color: #007700">([</span><span style="color: #DD0000">'id'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'status'</span><span style="color: #007700">])<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">addGroupBy</span><span style="color: #007700">(</span><span style="color: #DD0000">'age'</span><span style="color: #007700">);</span>
</code></pre>
<h3><a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#having()-detail" title="having()" target="_blank">having()</a><span id="having"></span> <a href="index.html.1.81.html#having" class="hashlink">#</a></h3><p>Метод <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#having()-detail" title="having()" target="_blank">having()</a> определяет фрагмент <code>HAVING</code> SQL запроса. Он принимает условия, которое
может быть определено тем же способом, что и для <a href="index.html.1.81.html#where">where()</a>.</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;...&nbsp;HAVING&nbsp;`status`&nbsp;=&nbsp;1<br /></span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">having</span><span style="color: #007700">([</span><span style="color: #DD0000">'status'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">]);</span>
</code></pre>
<p>Пожалуйста, обратитесь к документации для <a href="index.html.1.81.html#where">where()</a> для более подробной информации об определении условий.</p>
<p>Вы можете вызывать <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#andHaving()-detail" title="andHaving()" target="_blank">andHaving()</a> или <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#orHaving()-detail" title="orHaving()" target="_blank">orHaving()</a> для добавления
дополнительных условий во фрагмент <code>HAVING</code>.</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;...&nbsp;HAVING&nbsp;(`status`&nbsp;=&nbsp;1)&nbsp;AND&nbsp;(`age`&nbsp;&gt;&nbsp;30)<br /></span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">having</span><span style="color: #007700">([</span><span style="color: #DD0000">'status'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">])<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">andHaving</span><span style="color: #007700">([</span><span style="color: #DD0000">'&gt;'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'age'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">30</span><span style="color: #007700">]);</span>
</code></pre>
<h3><a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#limit()-detail" title="limit()" target="_blank">limit()</a> и<a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#offset()-detail" title="offset()" target="_blank">offset()</a><span id="limit-offset"></span> <a href="index.html.1.81.html#limit-offset" class="hashlink">#</a></h3><p>Методы <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#limit()-detail" title="limit()" target="_blank">limit()</a> и <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#offset()-detail" title="offset()" target="_blank">offset()</a> определяют фрагменты <code>LIMIT</code>
и <code>OFFSET</code> SQL запроса.</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;...&nbsp;LIMIT&nbsp;10&nbsp;OFFSET&nbsp;20<br /></span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">limit</span><span style="color: #007700">(</span><span style="color: #0000BB">10</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">offset</span><span style="color: #007700">(</span><span style="color: #0000BB">20</span><span style="color: #007700">);</span>
</code></pre>
<p>Если вы определяете неправильный limit или offset (например отрицательное значение), они будут проигнорированы.</p>
<blockquote><p><strong>Info:</strong> Для СУБД, которые не поддерживают <code>LIMIT</code> и <code>OFFSET</code> (такие как MSSQL), построитель запросов будет
  генерировать SQL выражения, которые эмулирует поведение <code>LIMIT</code>/<code>OFFSET</code>.</p>
</blockquote>
<h3><a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#join()-detail" title="join()" target="_blank">join()</a><span id="join"></span> <a href="index.html.1.81.html#join" class="hashlink">#</a></h3><p>Метод <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#join()-detail" title="join()" target="_blank">join()</a> определяет фрагмент <code>JOIN</code> SQL запроса.</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;...&nbsp;LEFT&nbsp;JOIN&nbsp;`post`&nbsp;ON&nbsp;`post`.`user_id`&nbsp;=&nbsp;`user`.`id`<br /></span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">join</span><span style="color: #007700">(</span><span style="color: #DD0000">'LEFT&nbsp;JOIN'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'post'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'post.user_id&nbsp;=&nbsp;user.id'</span><span style="color: #007700">);</span>
</code></pre>
<p>Метод <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#join()-detail" title="join()" target="_blank">join()</a> принимает четыре параметра:</p>
<ul>
<li><code>$type</code>: тип объединения, например, <code>'INNER JOIN'</code>, <code>'LEFT JOIN'</code>.</li>
<li><code>$table</code>: имя таблицы, которая должна быть присоединена.</li>
<li><code>$on</code>: необязательное условие объединения, то есть фрагмент <code>ON</code>. Пожалуйста, обратитесь к документации для
<a href="index.html.1.81.html#where">where()</a> для более подробной информации об определении условий. Отметим, что синтаксис массивов <strong>не работает</strong>
для задания условий для столбцов, то есть <code>['user.id' =&gt; 'comment.userId']</code> будет означать условие, где ID пользователя
должен быть равен строке <code>'comment.userId'</code>. Вместо этого стоит указывать условие в виде строки <code>'user.id = comment.userId'</code>.</li>
<li><code>$params</code>: необязательные параметры присоединяемые к условию объединения.</li>
</ul>
<p>Вы можете использовать следующие сокращающие методы для указания <code>INNER JOIN</code>, <code>LEFT JOIN</code> и <code>RIGHT JOIN</code>, в указанном порядке.</p>
<ul>
<li><a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#innerJoin()-detail" title="innerJoin()" target="_blank">innerJoin()</a></li>
<li><a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#leftJoin()-detail" title="leftJoin()" target="_blank">leftJoin()</a></li>
<li><a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#rightJoin()-detail" title="rightJoin()" target="_blank">rightJoin()</a></li>
</ul>
<p>Например,</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">leftJoin</span><span style="color: #007700">(</span><span style="color: #DD0000">'post'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'post.user_id&nbsp;=&nbsp;user.id'</span><span style="color: #007700">);</span>
</code></pre>
<p>Для соединения с несколькими таблицами, вызовите вышеуказанные методы несколько раз.</p>
<p>Кроме соединения с таблицами, вы можете также присоединять подзапросы. Чтобы это сделать, укажите объединяемый подзапрос
как объект <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html" title="yii\db\Query" target="_blank">yii\db\Query</a>.</p>
<pre><code class="language-php"><span style="color: #0000BB">$subQuery&nbsp;</span><span style="color: #007700">=&nbsp;(new&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">Query</span><span style="color: #007700">())-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'post'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">leftJoin</span><span style="color: #007700">([</span><span style="color: #DD0000">'u'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$subQuery</span><span style="color: #007700">],&nbsp;</span><span style="color: #DD0000">'u.id&nbsp;=&nbsp;author_id'</span><span style="color: #007700">);</span>
</code></pre>
<p>В этом случае вы должны передать подзапросы в массиве и использовать ключи для определения алиасов.</p>
<h3><a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#union()-detail" title="union()" target="_blank">union()</a><span id="union"></span> <a href="index.html.1.81.html#union" class="hashlink">#</a></h3><p>Метод <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#union()-detail" title="union()" target="_blank">union()</a> определяет фрагмент <code>UNION</code> SQL запроса.</p>
<pre><code class="language-php"><span style="color: #0000BB">$query1&nbsp;</span><span style="color: #007700">=&nbsp;(new&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">Query</span><span style="color: #007700">())<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">(</span><span style="color: #DD0000">"id,&nbsp;category_id&nbsp;AS&nbsp;type,&nbsp;name"</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'post'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">limit</span><span style="color: #007700">(</span><span style="color: #0000BB">10</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$query2&nbsp;</span><span style="color: #007700">=&nbsp;(new&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">Query</span><span style="color: #007700">())<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">(</span><span style="color: #DD0000">'id,&nbsp;type,&nbsp;name'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'user'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">limit</span><span style="color: #007700">(</span><span style="color: #0000BB">10</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$query1</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">union</span><span style="color: #007700">(</span><span style="color: #0000BB">$query2</span><span style="color: #007700">);</span>
</code></pre>
<p>Вы можете вызвать <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#union()-detail" title="union()" target="_blank">union()</a> несколько раз для присоединения фрагментов <code>UNION</code>. </p>
<h2>Методы выборки<span id="query-methods"></span> <a href="index.html.1.81.html#query-methods" class="hashlink">#</a></h2><p><a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html" title="yii\db\Query" target="_blank">yii\db\Query</a> предоставляет целый набор методов для разных вариантов выборки:</p>
<ul>
<li><a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#all()-detail" title="all()" target="_blank">all()</a>: возвращает массив строк, каждая из которых это ассоциативный массив пар ключ-значение.</li>
<li><a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#one()-detail" title="one()" target="_blank">one()</a>: возвращает первую строку запроса.</li>
<li><a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#column()-detail" title="column()" target="_blank">column()</a>: возвращает первый столбец результата.</li>
<li><a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#scalar()-detail" title="scalar()" target="_blank">scalar()</a>: возвращает скалярное значение первого столбца первой строки результата.</li>
<li><a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#exists()-detail" title="exists()" target="_blank">exists()</a>: возвращает значение указывающее, что выборка содержит результат.</li>
<li><a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#count()-detail" title="count()" target="_blank">count()</a>: возвращает результат <code>COUNT</code> запроса.</li>
<li>Другие методы агрегирования запросов, включая <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#sum()-detail" title="sum($q)" target="_blank">sum($q)</a>, <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#average()-detail" title="average($q)" target="_blank">average($q)</a>,
<a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#max()-detail" title="max($q)" target="_blank">max($q)</a>, <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#min()-detail" title="min($q)" target="_blank">min($q)</a>. Параметр <code>$q</code> обязателен для этих методов и могут
содержать либо имя столбца, либо выражение БД.</li>
</ul>
<p>Например,</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;SELECT&nbsp;`id`,&nbsp;`email`&nbsp;FROM&nbsp;`user`<br /></span><span style="color: #0000BB">$rows&nbsp;</span><span style="color: #007700">=&nbsp;(new&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">Query</span><span style="color: #007700">())<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">([</span><span style="color: #DD0000">'id'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'email'</span><span style="color: #007700">])<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'user'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;<br /></span><span style="color: #FF8000">//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`user`&nbsp;WHERE&nbsp;`username`&nbsp;LIKE&nbsp;`%test%`<br /></span><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">=&nbsp;(new&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">Query</span><span style="color: #007700">())<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'user'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">([</span><span style="color: #DD0000">'like'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'username'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'test'</span><span style="color: #007700">])<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">one</span><span style="color: #007700">();</span>
</code></pre>
<blockquote><p><strong>Note:</strong> метод <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#one()-detail" title="one()" target="_blank">one()</a> вернёт только первую строку результата запроса. Он НЕ добавляет
  <code>LIMIT 1</code> в генерируемый SQL. Это хорошо и предпочтительно если вы знаете, что запрос вернёт только одну или несколько
  строк данных (например, при запросе по первичному ключу). Однако если запрос потенциально может вернут много
  строк данных, вы должны вызвать <code>limit(1)</code> для повышения производительности, Например, 
  <code>(new \yii\db\Query())-&gt;from('user')-&gt;limit(1)-&gt;one()</code>.</p>
</blockquote>
<p>Все методы выборки могут получать необязательный параметр <code>$db</code>, представляющий <a href="http://www.yiiframework.com/doc-2.0/yii-db-connection.html" title="соединение с БД" target="_blank">соединение с БД</a>,
которое должно использоваться, чтобы выполнить запрос к БД. Если вы упускаете этот параметр, будет использоваться
<a href="https://yiiframework.com.ua/ru/doc/guide/2/structure-application-components/">компонент приложения</a> <code>$db</code>. Ниже приведён ещё один пример использования метода
<a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#count()-detail" title="count()" target="_blank">count()</a>:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;executes&nbsp;SQL:&nbsp;SELECT&nbsp;COUNT(*)&nbsp;FROM&nbsp;`user`&nbsp;WHERE&nbsp;`last_name`=:last_name<br /></span><span style="color: #0000BB">$count&nbsp;</span><span style="color: #007700">=&nbsp;(new&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">Query</span><span style="color: #007700">())<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'user'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">([</span><span style="color: #DD0000">'last_name'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'Smith'</span><span style="color: #007700">])<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">count</span><span style="color: #007700">();</span>
</code></pre>
<p>При вызове методов выборки <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html" title="yii\db\Query" target="_blank">yii\db\Query</a>, внутри на самом деле проводится следующая работа:</p>
<ul>
<li>Вызывается <a href="http://www.yiiframework.com/doc-2.0/yii-db-querybuilder.html" title="yii\db\QueryBuilder" target="_blank">yii\db\QueryBuilder</a> для генерации SQL запроса на основе текущего <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html" title="yii\db\Query" target="_blank">yii\db\Query</a>;</li>
<li>Создаёт объект <a href="http://www.yiiframework.com/doc-2.0/yii-db-command.html" title="yii\db\Command" target="_blank">yii\db\Command</a> со сгенерированным SQL запросом;</li>
<li>Вызывается выбирающий метод (например <a href="http://www.yiiframework.com/doc-2.0/yii-db-command.html#queryAll()-detail" title="queryAll()" target="_blank">queryAll()</a>) из <a href="http://www.yiiframework.com/doc-2.0/yii-db-command.html" title="yii\db\Command" target="_blank">yii\db\Command</a> для выполнения SQL запроса и извлечения данных.</li>
</ul>
<p>Иногда вы можете захотеть увидеть или использовать SQL запрос построенный из объекта <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html" title="yii\db\Query" target="_blank">yii\db\Query</a>. Этой цели можно
добиться с помощью следующего кода: </p>
<pre><code class="language-php"><span style="color: #0000BB">$command&nbsp;</span><span style="color: #007700">=&nbsp;(new&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">Query</span><span style="color: #007700">())<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">([</span><span style="color: #DD0000">'id'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'email'</span><span style="color: #007700">])<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'user'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">([</span><span style="color: #DD0000">'last_name'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'Smith'</span><span style="color: #007700">])<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">limit</span><span style="color: #007700">(</span><span style="color: #0000BB">10</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;<br /></span><span style="color: #FF8000">//&nbsp;показать&nbsp;SQL&nbsp;запрос<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">sql</span><span style="color: #007700">;<br /></span><span style="color: #FF8000">//&nbsp;показать&nbsp;привязываемые&nbsp;параметры<br /></span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">params</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;возвращает&nbsp;все&nbsp;строки&nbsp;запроса<br /></span><span style="color: #0000BB">$rows&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">queryAll</span><span style="color: #007700">();</span>
</code></pre>
<h3>Индексация результатов запроса<span id="indexing-query-results"></span> <a href="index.html.1.81.html#indexing-query-results" class="hashlink">#</a></h3><p>При вызове <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#all()-detail" title="all()" target="_blank">all()</a> возвращается массив строк индексированный последовательными целыми числами.
Иногда вам может потребоваться индексировать его по-другому, например, сделать индекс по указанному столбцу или
значением выражения. Вы можете реализовать такое поведение через вызов <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#indexBy()-detail" title="indexBy()" target="_blank">indexBy()</a> перед
вызовом <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#all()-detail" title="all()" target="_blank">all()</a>.</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;возвращает&nbsp;[100&nbsp;=&gt;&nbsp;['id'&nbsp;=&gt;&nbsp;100,&nbsp;'username'&nbsp;=&gt;&nbsp;'...',&nbsp;...],&nbsp;101&nbsp;=&gt;&nbsp;[...],&nbsp;103&nbsp;=&gt;&nbsp;[...],&nbsp;...]<br /></span><span style="color: #0000BB">$query&nbsp;</span><span style="color: #007700">=&nbsp;(new&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">Query</span><span style="color: #007700">())<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'user'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">limit</span><span style="color: #007700">(</span><span style="color: #0000BB">10</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">indexBy</span><span style="color: #007700">(</span><span style="color: #DD0000">'id'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();</span>
</code></pre>
<p>Для индексации по значению выражения, передайте анонимную функцию в метод <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#indexBy()-detail" title="indexBy()" target="_blank">indexBy()</a>:</p>
<pre><code class="language-php"><span style="color: #0000BB">$query&nbsp;</span><span style="color: #007700">=&nbsp;(new&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">Query</span><span style="color: #007700">())<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'user'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">indexBy</span><span style="color: #007700">(function&nbsp;(</span><span style="color: #0000BB">$row</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'id'</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'username'</span><span style="color: #007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;})-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();</span>
</code></pre>
<p>Анонимная функция должна принимать параметр <code>$row</code>, который содержит текущую строку запроса и должна вернуть скалярное
значение, которое будет использоваться как значение индекса для текущей строки.</p>
<h3>Пакетная выборка<span id="batch-query"></span> <a href="index.html.1.81.html#batch-query" class="hashlink">#</a></h3><p>При работе с большими объемами данных, методы наподобие <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#all()-detail" title="yii\db\Query::all()" target="_blank">yii\db\Query::all()</a> не подходят, потому что они требуют
загрузки всех данных в память. Чтобы сохранить требования к памяти минимальными, Yii предоставляет поддержку
так называемых пакетных выборок. Пакетная выборка делает возможным курсоры данных и выборку данных пакетами.</p>
<p>Пакетная выборка может использоваться следующим образом:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">Query</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$query&nbsp;</span><span style="color: #007700">=&nbsp;(new&nbsp;</span><span style="color: #0000BB">Query</span><span style="color: #007700">())<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'user'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">orderBy</span><span style="color: #007700">(</span><span style="color: #DD0000">'id'</span><span style="color: #007700">);<br /><br />foreach&nbsp;(</span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">batch</span><span style="color: #007700">()&nbsp;as&nbsp;</span><span style="color: #0000BB">$users</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;$users&nbsp;это&nbsp;массив&nbsp;из&nbsp;100&nbsp;или&nbsp;менее&nbsp;строк&nbsp;из&nbsp;таблицы&nbsp;пользователей<br /></span><span style="color: #007700">}<br /><br /></span><span style="color: #FF8000">//&nbsp;или&nbsp;если&nbsp;вы&nbsp;хотите&nbsp;перебрать&nbsp;все&nbsp;строки&nbsp;по&nbsp;одной<br /></span><span style="color: #007700">foreach&nbsp;(</span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">each</span><span style="color: #007700">()&nbsp;as&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;$user&nbsp;представляет&nbsp;одну&nbsp;строку&nbsp;из&nbsp;выборки<br /></span><span style="color: #007700">}</span>
</code></pre>
<p>Метод <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#batch()-detail" title="yii\db\Query::batch()" target="_blank">yii\db\Query::batch()</a> и <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#each()-detail" title="yii\db\Query::each()" target="_blank">yii\db\Query::each()</a> возвращает объект <a href="http://www.yiiframework.com/doc-2.0/yii-db-batchqueryresult.html" title="yii\db\BatchQueryResult" target="_blank">yii\db\BatchQueryResult</a>, который
реализует интерфейс <code>Iterator</code> и может использоваться в конструкции <code>foreach</code>. Во время первой итерации будет выполнен
SQL запрос к базе данных. Данные будут выбираться пакетами в следующих итерациях. По умолчанию, размер пакета имеет
размер 100, то есть при каждой выборке будет выбираться по 100 строк. Вы можете изменить размер пакета, передав
первый параметр в метод <code>batch()</code> или <code>each()</code>.</p>
<p>По сравнению с <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#all()-detail" title="yii\db\Query::all()" target="_blank">yii\db\Query::all()</a>, пакетная выборка загружает только по 100 строк данных за раз в память.
Если вы обрабатываете данные и затем сразу выбрасываете их, пакетная выборка может помочь уменьшить использование памяти.</p>
<p>Если указать индексный столбец через <a href="http://www.yiiframework.com/doc-2.0/yii-db-query.html#indexBy()-detail" title="yii\db\Query::indexBy()" target="_blank">yii\db\Query::indexBy()</a>, в пакетной выборке индекс будет сохраняться.
Например,</p>
<pre><code class="language-php"><span style="color: #0000BB">$query&nbsp;</span><span style="color: #007700">=&nbsp;(new&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">Query</span><span style="color: #007700">())<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'user'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">indexBy</span><span style="color: #007700">(</span><span style="color: #DD0000">'username'</span><span style="color: #007700">);<br /><br />foreach&nbsp;(</span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">batch</span><span style="color: #007700">()&nbsp;as&nbsp;</span><span style="color: #0000BB">$users</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;$users&nbsp;индексируется&nbsp;по&nbsp;столбцу&nbsp;"username"<br /></span><span style="color: #007700">}<br /><br />foreach&nbsp;(</span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">each</span><span style="color: #007700">()&nbsp;as&nbsp;</span><span style="color: #0000BB">$username&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;...<br /></span><span style="color: #007700">}</span>
</code></pre>
</div>
<hr><script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script><!-- Documentation (footer) --><ins class="adsbygoogle" style="display: block;" data-ad-client="ca-pub-8275858625830540" data-ad-slot="4067432912" data-ad-format="auto"></ins><small style="margin-top: 10px; display: block;"><a href="https://yiiframework.com.ua/ru/adv/" rel="nofollow" target="_blank">Зачем реклама?</a></small><script>(adsbygoogle = window.adsbygoogle || []).push({})</script>                </div>
            </div>
        </div>
    </div>
    <div class="row footer">
    <div class="col-sm-6">
        <small class="text-left center-block">
            <img src="https://img.shields.io/badge/Украинское сообщество Yii Framework-v16.4-brightgreen.svg?style=flat-square" alt="">            <img src="https://img.shields.io/badge/©-2012%20--%202022-lightgrey.svg?style=flat-square" alt="">            <br>
            <img src="https://img.shields.io/badge/Docker-1.11.1-0296C9.svg?style=flat-square" alt="">            <img src="https://img.shields.io/badge/Yii-2.0.10--dev-red.svg?style=flat-square" alt="">            <img src="https://img.shields.io/badge/PHP-7.0.9-8892BF.svg?style=flat-square" alt="">        </small>
    </div>
    <div class="col-sm-6 text-right">
        <small class="text-muted">
            <span>&copy; 2012 — 2022 <a href="https://github.com/yiiframework-ua">Borales</a></span>
            <br/>
            <span>
                &copy; 2008 — 2022 <a href="http://www.yiisoft.com/" target="_blank" rel="nofollow">Yii Software LLC</a>
                | <a href="http://www.yiiframework.com/license/" target="_blank" rel="nofollow">Лицензия</a>
            </span>
        </small>
    </div>
</div>
            </div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-timeago/1.5.2/jquery.timeago.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://yiiframework.com.ua/js/compiled.min.js?v=1469914490"></script>
<script src="https://yiiframework.com.ua/assets/aea75a06/js/jquery.scrollUp.js?v=1469914548"></script>
<script type="text/javascript">jQuery(document).ready(function () {
$.scrollUp({"scrollText":"","scrollName":"scrollUp","topDistance":400,"topSpeed":2000,"animation":"slide","animationInSpeed":200,"animationOutSpeed":200,"activeOverlay":false});
});</script>
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-8920748-5', 'auto');
    ga('send', 'pageview');
</script>
</body>
</html>
