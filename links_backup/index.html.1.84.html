<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <meta name="referrer" content="unsafe-url">
  <title>С чего начинается Elasticsearch / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }

    /* non-breaking hyphen */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/l/font?kit=KFOlCnqEu92Fr1MmEU9vBh0_IsHAlmrO6g&skey=ee881451c540fdec&v=v29) format('woff2');
      unicode-range: U+02011;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.da6c6b36.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.4de4e95a.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.92df6f6d.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.4de4e95a.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.2822d469ec31a56409ac330bbcf7fcbf.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/489924\/"},"headline":"С чего начинается Elasticsearch","datePublished":"2020-02-25T19:10:30+03:00","dateModified":"2020-02-26T18:01:59+03:00","author":{"@type":"Person","name":"Роман"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"Elasticsearch, вероятно, самая популярная поисковая система на данный момент с развитым сообществом, поддержкой и горой информации в сети. Однако эта информация...","url":"https:\/\/habr.com\/ru\/post\/489924\/#post-content-body","about":["h_search_technologies","h_it-infrastructure","h_distributed_systems","f_develop","f_admin"],"image":["https:\/\/habrastorage.org\/webt\/u9\/vi\/oe\/u9vioev9akwzaj1c8hrbmbdjfqm.jpeg","https:\/\/habrastorage.org\/webt\/yk\/cq\/xq\/ykcqxq59u93tthdeynsgzl3co-k.png","https:\/\/habrastorage.org\/webt\/br\/vx\/dc\/brvxdcp5k7p1lswgx7msvnhpx70.png","https:\/\/habrastorage.org\/webt\/pq\/a1\/sr\/pqa1sr_yawfjzqz5g8mntcl1dim.png","https:\/\/habrastorage.org\/webt\/al\/ja\/fv\/aljafvzws50myp43grmy4hvhbrk.png","https:\/\/habrastorage.org\/webt\/ji\/0m\/sg\/ji0msg-kjfmmmolxt8dp0zgkiti.png","https:\/\/habrastorage.org\/webt\/oa\/hw\/_q\/oahw_qp3sc19wwnhn8vl5k0wsm0.png","https:\/\/habrastorage.org\/webt\/je\/dx\/_b\/jedx_bbsqdrbemksh0oithdxezi.png","https:\/\/habrastorage.org\/webt\/z1\/af\/ag\/z1afagq-1veviaor8clhvru7rfm.png","https:\/\/habrastorage.org\/webt\/ua\/az\/-w\/uaaz-wypkw1_v7c76yfyyjoso7c.png","https:\/\/habrastorage.org\/webt\/di\/hw\/wj\/dihwwjwbd2wsvmwy_ucbsjundzu.png"]}</script>
  <script src="https://www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.64.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_com"><meta data-vue-meta="ssr" property="og:site_name" content="Хабр" data-vmid="og:site_name"><meta data-vue-meta="ssr" property="og:title" content="С чего начинается Elasticsearch" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="С чего начинается Elasticsearch" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="С чего начинается Elasticsearch" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="Elasticsearch, вероятно, самая популярная поисковая система на данный момент с развитым сообществом, поддержкой и горой информации в сети. Однако эта информация поступает непоследовательно и..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="Elasticsearch, вероятно, самая популярная поисковая система на данный момент с развитым сообществом, поддержкой и горой информации в сети. Однако эта информация поступает непоследовательно и..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="Elasticsearch, вероятно, самая популярная поисковая система на данный момент с развитым сообществом, поддержкой и горой информации в сети. Однако эта информация поступает непоследовательно и..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="Elasticsearch, вероятно, самая популярная поисковая система на данный момент с развитым сообществом, поддержкой и горой информации в сети. Однако эта информация поступает непоследовательно и..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="Elasticsearch, вероятно, самая популярная поисковая система на данный момент с развитым сообществом, поддержкой и горой информации в сети. Однако эта информация поступает непоследовательно и..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habr.com/share/publication/489924/44f9e29f53a8fac34f27ab6a099294f0/" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habr.com/share/publication/489924/44f9e29f53a8fac34f27ab6a099294f0/" data-vmid="og:image"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habr.com/share/publication/489924/44f9e29f53a8fac34f27ab6a099294f0/" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habr.com/share/publication/489924/44f9e29f53a8fac34f27ab6a099294f0/" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habr.com/share/publication/489924/44f9e29f53a8fac34f27ab6a099294f0/?format=vk" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="489924" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2020-02-25T16:10:30.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" content="https://habr.com/ru/post/489924/" property="og:url" data-vmid="og:url"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" name="keywords" content="elasticsearch, big data, поисковые системы, распределенные системы">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/489924/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="index.html.1.84.html" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habr.com/share/publication/489924/44f9e29f53a8fac34f27ab6a099294f0/" data-vmid="image:href">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="https://habr.com/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="https://habr.com/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v25.4b679db1.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="https://habr.com/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="https://habr.com/ru/flows/all" class="tm-main-menu__item">
        Все потоки
      </a> <a href="https://habr.com/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="https://habr.com/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="https://habr.com/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="https://habr.com/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="https://habr.com/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="https://habr.com/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="https://habr.com/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v25.4b679db1.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v25.4b679db1.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v25.4b679db1.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="https://habr.com/ru/users/nordwind2013/" title="nordwind2013" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="" height="24" src="https://habrastorage.org/r/w32/getpro/habr/avatars/b90/40a/ab9/b9040aab988d79081e839fa79e87be5e.jpg" width="24" class="tm-entity-image__pic"></div></a> <span class="tm-user-info__user"><a href="https://habr.com/ru/users/nordwind2013/" class="tm-user-info__username">
      nordwind2013
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2020-02-25T16:10:30.000Z" title="2020-02-25, 19:10">25  февраля  2020 в 19:10</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>С чего начинается Elasticsearch</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="https://habr.com/ru/hub/search_technologies/" class="tm-article-snippet__hubs-item-link"><span>Поисковые технологии</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="https://habr.com/ru/hub/it-infrastructure/" class="tm-article-snippet__hubs-item-link"><span>IT-инфраструктура</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="https://habr.com/ru/hub/distributed_systems/" class="tm-article-snippet__hubs-item-link"><span>Распределённые системы</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <div class="tm-article-snippet__labels"><div class="tm-article-snippet__label tm-article-snippet__label_variant-sandbox"><span>
        Из песочницы
      </span></div><div class="tm-article-snippet__label tm-article-snippet__label_variant-technotext2020"><a href="https://habr.com/ru/technotext/">
        🔥 Технотекст 2020
      </a></div></div> <!----> <!----></div></div> <!----> <div data-gallery-root="" lang="ru" class="tm-article-body"><div></div> <div id="post-content-body"><div><div class="article-formatted-body article-formatted-body_version-1"><div xmlns="http://www.w3.org/1999/xhtml"><p><img src="https://habrastorage.org/r/w780q1/webt/u9/vi/oe/u9vioev9akwzaj1c8hrbmbdjfqm.jpeg" width="400" align="left" data-src="https://habrastorage.org/webt/u9/vi/oe/u9vioev9akwzaj1c8hrbmbdjfqm.jpeg" data-blurred="true"/> Elasticsearch, вероятно, самая популярная поисковая система на данный момент с развитым сообществом, поддержкой и горой информации в сети. Однако эта информация поступает непоследовательно и дробно.</p><br/>
<p>Самое первое и главное заблуждение — "нужен поиск, так бери эластик!". Но в действительности, если вам нужен шустрый поиск для небольшого или даже вполне себе крупного проекта, вам стоит разобраться в теме поподробней и вы откажетесь от использования именно этой системы.</p><a name="habracut"></a><br/>
<p>Вторая проблема заключается в том, что пытаясь разобраться с начала, получить общую картину окажется непросто. Да инфы навалом, но последовательность в ее изучении выстраивается постфактум. Придется из книг бежать в документацию, а из документации обратно в книги, параллельно разгугливая тонкости, только чтобы понять, что такое Elasticsearch, почему он работает именно так и для чего же его вообще использовать, а где стоит выбрать что-то попроще.</p><br/>
<p>В этой статье я попытался последовательно объяснить то что мне кажется главным в Elasticsearch, то для чего он был придуман и как он устроен.</p><br/>
<p>Для наглядности выдумаем себе задачу. Реализация поиска в коллективном блоге по всем материалам и пользователям. Система позволяет создавать теги, сообщества, геометки и все остальные штуки, которые нам помогают категоризировать огромное количество информации.</p><br/>
<h2 id="shema-hraneniya-dannyh">Схема хранения данных</h2><br/>
<p>То, какие действия с данными мы будем производить определит схему их хранения:</p><br/>
<ul>
<li>скорее всего поисковая система должна будет быстро производить поиск</li>
<li>запись и удаление могут не отличаться высокой скоростью, в системах поиска, полагаю, этим можно пренебречь</li>
<li>структура данных будет интенсивно изменяться и хранилище может заполняться из нескольких независимых источников( различных баз, в том числе внешних для нашей системы )</li>
</ul><br/>
<p>Представьте еще раз сколько атрибутов может иметь публикация и сколько связанных с ней объектов. Автор, категория, сообщество, геометки, медиафайлы, теги, связанные публикации. Этот список можно продолжать до исчерпания фантазии. Если мы храним это в привычной реляционной базе то имеем миллион связей и миллиард атрибутов. Это прекрасно подходит для структурированного хранения долгие годы, но не очень вяжется с требованиями быстрого поиска. </p><br/>
<p>А что если мы захотим добавить пару интеграций с внешними системами? Придется реализовать дополнительные таблицы или даже базы. Нам всегда будет нужно что-то добавить или изменить в объектах доступных для поиска. Вы понимаете к чему я клоню.</p><br/>
<p>Намного быстрее читать из объектов, содержащих все необходимое здесь и сейчас. И намного проще вносить изменения в неструктурированную схему данных.</p><br/>
<div style="text-align:center;"><img src="https://habrastorage.org/r/w1560/webt/yk/cq/xq/ykcqxq59u93tthdeynsgzl3co-k.png" width="600" data-src="https://habrastorage.org/webt/yk/cq/xq/ykcqxq59u93tthdeynsgzl3co-k.png"/></div><br/>
<pre><code class="json">{
    "title" : "С чего начинается Elasticsearch",
    "author" : {
        "name": "Roman"
    },
    "content" : "Elasticsearch, вероятно, самая популярная поисковая система...",
    "tags":[
        "elasticsearch"
    ],
    "ps": "Да, проще всего представить это как JSON, BSON или XML"
}</code></pre><br/>
<p>К тому же такие структуры данных проще делить, разносить по разным физическим хранилищам, распределять, ведь объекты уже содержат все необходимое.</p><br/>
<p>Эти объекты мы можем воспринимать как отдельные страницы, файлы, карточки, все это можно назвать некими <em>документами</em>. Поэтому такая модель хранения данных называется <em>документоориентированной</em>.</p><br/>
<blockquote><strong>Elasticsearch</strong> это документоориентированная база данных</blockquote><br/>
<h2 id="poisk">Поиск</h2><br/>
<p>Теперь необходимо определиться с механизмами поиска. Данные организованы в виде документов. Как мы привыкли осуществлять поиск по документу? </p><br/>
<p>Типичным примером документа будет веб-страница. Если мы попытаемся поискать по всей странице в браузере, поиск будет осуществляться по всему содержащемуся тексту. И это удобно для большинства кейсов.</p><br/>
<p>Примерно так же работают многие поисковые системы, поиск происходит по всему тексту проиндексированных страниц, а не по отдельным полям, тегам или заголовкам. Это называется <em>полнотекстовым</em> поиском.</p><br/>
<p>Искать предстоит по огромному количеству документов и было бы разумно запомнить что в каком документе лежит. В реляционных СУБД мы привыкли оптимизировать подобный поиск индексами. </p><br/>
<p>Что такое индекс на самом деле? Если не вдаваться в детали, индекс это сбалансированное дерево, то есть дерево, в котором длина путей(количество шагов межу узлами) не будет отличаться больше чем на один шаг.</p><br/>
<div style="text-align:center;"><img src="https://habrastorage.org/r/w1560/webt/br/vx/dc/brvxdcp5k7p1lswgx7msvnhpx70.png" width="700" data-src="https://habrastorage.org/webt/br/vx/dc/brvxdcp5k7p1lswgx7msvnhpx70.png"/></div><br/>
<p>Например если бы мы проиндексировали наш пост, то у нас бы получилось дерево, листьями которого, являлись бы используемые в нем слова. Простыми словами, мы будем знать заранее, какие слова находятся в документе и как их быстро в нем найти. Не смотря на такую удобную структуризацию данных, обход дерева звучит как не самое лучшее решение для максимально быстрого поиска.</p><br/>
<p>А что если сделать все наоборот — собрать список всех используемых слов и узнать, в каких документах они встречаются. Да, индексация займет больше времени, но нас в первую очередь интересует именно скорость поиска, а не индексации.</p><br/>
<div style="text-align:center;"><img src="https://habrastorage.org/r/w1560/webt/pq/a1/sr/pqa1sr_yawfjzqz5g8mntcl1dim.png" width="250" data-src="https://habrastorage.org/webt/pq/a1/sr/pqa1sr_yawfjzqz5g8mntcl1dim.png"/></div><br/>
<p>Такой индекс называется <em>обратным индексом</em> и используется для полнотекстового поиска.</p><br/>
<p>Хороший пример — популярная open-source библиотека полнотекстового поиска, конечно же, с обратным индексом, <a href="https://lucene.apache.org/core/" rel="nofollow">Apache Lucene</a>.</p><br/>
<blockquote><strong>Elasticsearch</strong> использует индексы Lucene для хранения данных и поиска</blockquote><br/>
<h2 id="masshtabirovanie">Масштабирование</h2><br/>
<p>Как бы мы не пытались оптимизировать структуры данных и алгоритмы поиска, когда речь заходит о действительно больших массивах данных и действительно большом количестве запросов, необходимо задуматься о возможности повлиять на производительность системы путем увеличения аппаратного ресурса. Проще говоря, мы хотим иметь возможность накинуть немного памяти, ЦП и дискового пространства, чтобы все ехало быстрее. Мы можем назвать это <em>масштабируемостью</em>.</p><br/>
<p>Самый простой вариант — накинуть железа на сервер. Если представить каждую условную единицу вычислительной мощности как деревянный кубик, то сейчас мы сложим кубики в одно место или один на другой, строя башню <em>вертикально</em>. Такое масштабирование и называется <em>вертикальным</em>.</p><br/>
<p>Второй вариант — разделить наши задачи на группу машин. В этом случае мы тоже увеличиваем аппаратный ресурс, но сейчас кубики мы можем расположить на воображаемом столе как угодно на его плоскости, то есть <em>горизонтально</em>. Угадайте, как называется такое масштабирование?</p><br/>
<p>Первый способ гарантирует нам быстрый результат без боли, но конечно не все так гладко. Как долго мы сможем увеличивать ресурс отдельной машины? Во-первых дешевым способом это будет только в самом начале, дальше оплата одного сервера будет стоить как несколько машин попроще. Во-вторых вы рано или поздно упретесь в потолок — железо, драйверы, пропускная способность и еще куча логических и физических ограничений. А самое главное, критический сбой в одной машине повлечет сбой всей системы, закономерно.</p><br/>
<p>В отличии от первого способа второй не накладывает таких явных ограничений, мы можем добавлять машины сколько угодно, связывая их сетью. Конечно, это повлечет сетевые издержки — низкая скорость передачи в сети(в сравнении с обработкой на одной машине), сетевой оверхед. Но вместе с тем сеть имеет одно очень важное свойство — большую <em>отказоустойчивость</em>.</p><br/>
<h3 id="raspredelennyy-indeks">Распределенный индекс</h3><br/>
<p>Ок, для хранения данных и поиска мы будем использовать инстанс Lucene. Но ранее мы решили, что для обеспечения горизонтального масштабирования нам необходимо иметь возможность размещать данные на разных машинах. В действительности, какая разница как данные хранятся физически? Важно чтобы мы имели единое логическое хранилище. Каждый инстанс Lucene должен стать частью одного большого индекса, или осколком(<strong>shard</strong>) разбитого индекса. Шард будет выполнять непосредственно операции по поиску и записи данных.</p><br/>
<div style="text-align:center;"><img src="https://habrastorage.org/r/w1560/webt/al/ja/fv/aljafvzws50myp43grmy4hvhbrk.png" width="500" data-src="https://habrastorage.org/webt/al/ja/fv/aljafvzws50myp43grmy4hvhbrk.png"/></div><br/>
<blockquote><strong>Shard</strong> в <strong>Elasticsearch</strong> — это логическая единица хранения данных на уровне базы, которая является отдельным экземпляром Lucene.<br/>
<br/>
<a href="https://www.elastic.co/blog/what-is-an-elasticsearch-index" rel="nofollow"><strong>Index</strong></a> — это одновременно и распределенная база и механизм управления и организации данных, это именно логическое пространство. Индекс содержит один или более шардов, их совокупность и является хранилищем.<br/>
<br/>
Классическое сравнение индекса с другими базами выглядит примерно так.<br/>
<div class="scrollable-table"><table>
<thead>
<tr>
<th><strong>Elasticsearch</strong></th>
<th><strong>SQL</strong></th>
<th><strong>MongoDB</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Index</td>
<td>Database</td>
<td>Database</td>
</tr>
<tr>
<td>Mapping/Type</td>
<td>Table</td>
<td>Collection</td>
</tr>
<tr>
<td>Field</td>
<td>Column</td>
<td>Field</td>
</tr>
<tr>
<td>Object(JSON)</td>
<td>Tuple</td>
<td>Object(BSON)</td>
</tr>
</tbody>
</table></div><br/>
<br/>
Но существуют отличия в использовании этих абстракций. Рассмотрим еще один классический пример. У пользователя системы может храниться очень много информации, и мы решаем создавать новую базу для каждого пользователя. Это звучит дико! Но на самом деле в Elasticsearch это распространенная и даже хорошая практика. Индекс это довольно легкий механизм и лучше разделять большие данные, тем более, когда это логически оправдано. Системе проще работать с небольшими индексами чем с разросшейся базой для всего. Например, так вы можете создавать отдельный индекс для логов на каждый день и это широко используется.<br/>
<br/>
По умолчанию количество шардов для индекса будет равным 5, но его всегда возможно изменить в настройках <code>index.number_of_shards: 1</code> или с помощью запроса шаблонов индекса.<br/>
<pre><code class="json">PUT _template/all
{
  "template": "*",
      "settings": {
        "number_of_shards": 1
      }
}</code></pre><br/>
<br/>
Важно управлять этим значением. Всегда принимайте решения с точки зрения параллельной обработки. <br/>
<br/>
Каждый шард способен хранить примерно 2<sup>32</sup> или 4294967296 записей, это значит, что скорее всего вы упретесь в лимит вашего диска. Однако стоит понимать, все шарды будут участвовать в поиске и если мы будем искать по сотне пустых, потратим время впустую. Если шарды будут слишком большими мы так же будем тратить лишнее время на поиск, а так же операций перемещения и индексации станут очень тяжелыми.<br/>
<br/>
Забегая вперед. Со временем Elasticsearch двигает и изменяет шарды, объединяя дробные и мелкие в большие. Следите за размером ваших шардов, при достижении 10ГБ производительность значительно падает.</blockquote><br/>
<h3 id="klaster">Кластер</h3><br/>
<p>Мы определились с базовой концепцией распределенного индекса. Сейчас необходимо решить, как в действительности будет осуществляться управление отдельными базами.</p><br/>
<p>Ранее мы решили, что за операции поиска и индексации отвечает отдельный инстанс Lucene(<em>шард</em>). Для того, чтобы обращаться к распределенной системе шардов, нам необходимо иметь некий координирующий узел, именно он будет принимать запросы и давать задания на запись или получение данных. То есть помимо хранения данных мы выделяем еще один вариант поведения программы — координирование.</p><br/>
<p>Таким образом мы изначально ориентируемся на два вида узлов — CRUD-узлы и координирующие узлы. Назовем их <strong>data node</strong> и <strong>coordinating node</strong>. У нас есть куча машин объединенных в сеть и все это очень напоминает кластер.</p><br/>
<div style="text-align:center;"><img src="https://habrastorage.org/r/w1560/webt/ji/0m/sg/ji0msg-kjfmmmolxt8dp0zgkiti.png" width="500" data-src="https://habrastorage.org/webt/ji/0m/sg/ji0msg-kjfmmmolxt8dp0zgkiti.png"/></div><br/>
<blockquote>Каждый запущенный экземпляр <strong>Elasticsearch</strong> является отдельным узлом(<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-node.html" rel="nofollow"><strong>node</strong></a>). <strong>Cluster</strong> — это совокупность определенных нод. Когда вы запускаете один экземпляр ваш кластер будет состоять из одной ноды.<br/>
<br/>
Для того чтобы объединить узлы в кластер они должны соответствовать ряду требований:<br/>
<ul>
<li>Ноды должны иметь одинаковую версию</li>
<li>Имя кластера <code>cluster.name</code> в конфигурации должно быть одинаковым</li>
</ul><br/>
<br/>
Конфигурация читается из файла <strong>elasticsearch.yml</strong> и переменных среды. Здесь мы можете настроить почти все, что касается неизменных в рантайме свойств ноды.<br/>
<br/>
Вы можете поднимать несколько узлов на одной машине, для этого необходимо запускать инстансы из разных директорий файловой системы и в конфигурации указать разные порты <code>http.port</code>, по умолчанию порт 9200 для внешнего доступа и 9300 для внутрикластерного соединения. Это может понадобиться для тестирования и проектирования кластера, однако в проде подразумевается использование отдельных машин.</blockquote><p>Каждый тип ответственности узлов налагает определенные системные требования. Очевидно, что data-ноды будут часто обращаться к диску и использовать значительные объемы памяти в процессе работы.</p><br/>
<p>Мы так же можем утверждать, что не все данные будут запрашиваться одинаково часто. Данные постепенно "остывают" по мере снижения запросов. Мы можем назвать это жизненным циклом хранения данных. Хорошей идеей было бы держать хайповые публикации там, откуда их можно быстро достать, а забытые мемы 2007 можно положить подальше.</p><br/>
<blockquote>Начиная с версии 6.7 <strong>Elasticsearch</strong> предлагает механизм <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-node.html" rel="nofollow">управления жизненным циклом</a>. Для этого доступны три типа нод — hot, warm и cold.<br/>
<br/>
Существует рекомендация по выбору аппаратных конфигураций для каждого из типов. Например hot-ноды должны иметь быстрые SSD, для warm и cold достаточно HDD-диска. Оптимальные соотношения память/диск будут следующими:<br/>
<ul>
<li>hot — 1:30</li>
<li>warm — 1:100</li>
<li>cold — 1:500</li>
</ul><br/>
<br/>
Для того чтобы определить тип ноды как data node необходимо установить значение в конфигурации <code>node.data: true</code>, при этом рекомендуется выделять ноду под один конкретный тип, для повышения стабильности и производительности кластера.</blockquote><p>Важнейшим аспектом в использовании распределенных систем является параллельное выполнение задач. Существует популярная модель распределенных вычислений, которая имеет лаконичное название <strong>MapReduce</strong>. И заключается она разделении выполнения задачи на два больших шага: </p><br/>
<ul>
<li><strong>Map</strong> — предварительная обработка данных, формулировка задачи и последующая ее передача выполняющим узлам</li>
<li><strong>Reduce</strong> — свертка множества результатов worker-нод в один финальный ответ</li>
</ul><br/>
<div style="text-align:center;"><img src="https://habrastorage.org/r/w1560/webt/oa/hw/_q/oahw_qp3sc19wwnhn8vl5k0wsm0.png" width="700" data-src="https://habrastorage.org/webt/oa/hw/_q/oahw_qp3sc19wwnhn8vl5k0wsm0.png"/></div><br/>
<p>Именно такой механизм поможет нам выполнять операции с шардами. Координирующий узел получит запрос, предварительно переформулирует его для внутрикластерного взаимодействия и выполнит запросы к нашим worker-нодам(в данном случае к data-нодам).</p><br/>
<p>Следовательно, <strong>coordinating-ноды</strong> должны иметь достаточный ресурс памяти, ЦП и быструю сеть, но при этом могут иметь скромный диск, ведь не осуществляют хранения данных. </p><br/>
<p>Однако при большой частоте запросов, такие ноды могут стать узким местом системы. Мы можем пойти привычным путем и превратить точку внешнего доступа в плоскость. Пусть координирующих нод будет множество. </p><br/>
<p>Такой подход позволит нам применять балансировку запросов, это можно сделать прямо в клиентском коде либо использовать любые существующие балансировщики.</p><br/>
<blockquote>В <strong>Elasticsearch</strong> все узлы неявно являются координирующими. Однако, стоит выделять отдельные coordinating-ноды, не выполняющие других операций. Забегая вперед, такие ноды можно определить, установив значения всех типов в <code>false</code>.</blockquote><br/>
<h3 id="upravlenie-klasterom">Управление кластером</h3><br/>
<p>На данном этапе мы имеем возможность доступа к данным из множества точек — <strong>coordinating-нод</strong>. В этом нет проблем, если мы говорим о простых операциях чтения/записи в существующий индекс. Но если говорить о выделении новых шардов или их перемещении, может начаться путаница.</p><br/>
<p>Предположим, возможность <strong>coordinating-нодам</strong> управления состоянием кластера. Один узел примет решение о перемещении шарда на одну <strong>data-ноду</strong>, а второй о перемещении того же на другую. Список возможных общекластерных действий может быть довольно широким, а список возможных конфликтов еще шире.</p><br/>
<p>Очевидно такие важные решения должен принимать один центральный узел. Мы определили, что для каждого типа действий необходимо выделять отдельную роль, чтобы избежать потерь производительности на ноде. И "главный в кластере" звучит как отдельная ответственность.</p><br/>
<p>Назовем такие ноды <strong>master-node</strong>. Активный мастер всегда должен быть один, он будет управлять топологией кластера: создавать новый индекс, выделять и распределять шарды, перемещать их и объединять в случае необходимости. Мастер всегда знает все о состоянии кластера.</p><br/>
<blockquote>В кластере <strong>Elasticsearch</strong> обязательно должен быть как минимум один узел отвечающий требованиям <strong>master node</strong>. Для этого в конфигурации ноды необходимо установить значение <code>node.master: true</code>.<br/>
<br/>
<strong>Master-ноды</strong> отвечают за важные, но довольно легкие общекластерные действия. Это означает, что они требуют большого ресурса и высокой стабильности от физической ноды. В кластерах от 10 нод необходимо всегда выделять отдельные only-master узлы.</blockquote><br/>
<h3 id="replikaciya-dannyh">Репликация данных</h3><br/>
<p>Сейчас каждая запись в нашем индексе существует только в одном месте, и потеря хранящего ее узла приведет к потере данных на неопределенный срок. Для того, чтобы этого избежать существует механизм репликации. Важно не путать понятия реплики и бэкапа, если бэкап позволяет восстановить данные в случае утери, то реплика является полной копией базы.</p><br/>
<p>Если мы потеряем одну из <strong>data-нод</strong>, то всегда сможем продолжить работу с репликами шардов в другом узле и тем временем вернуть потерянный.</p><br/>
<p>То есть для каждого шарда должна быть как минимум одна копия на другой ноде. Можно конечно выделять по отдельной машине для каждой реплики, но это очень расточительно. Нужно разместить копии данных на разных узлах, но это не значит, что эти узлы должны хранить только шарды реплик.</p><br/>
<div style="text-align:center;"><img src="https://habrastorage.org/r/w1560/webt/je/dx/_b/jedx_bbsqdrbemksh0oithdxezi.png" width="500" data-src="https://habrastorage.org/webt/je/dx/_b/jedx_bbsqdrbemksh0oithdxezi.png"/></div><br/>
<blockquote>Чтобы жестко установить количество реплик индекса используется параметр <code>number_of_replicas</code>. Так же мы можем изменить это значение в рантайме выполнив запрос:<br/>
<pre><code class="json">PUT / _settings {
  "index": {
      "number_of_replicas": someVal
  }
}</code></pre><br/>
</blockquote><p>Таким образом мы всегда имеем реплики всех шардов и не поднимаем неэффективно простаивающие ноды.</p><br/>
<p>Основной шард назовем первичным или <strong>primary shard</strong>, а любую из его копий реплицирующим шардом или <strong>replica shard</strong>, первичный шард и его реплики это группа репликации.</p><br/>
<p>С учетом реплик запись данных будет происходить в два этапа, в первом запись затронет только первичный шард и только после того, как произойдет операция <strong>flush</strong> слияния изменений и операция <strong>commit</strong> фиксации в индексе Lucene, будет отправлен внутренний запрос на изменение всех реплик.</p><br/>
<div style="text-align:center;"><img src="https://habrastorage.org/r/w1560/webt/z1/af/ag/z1afagq-1veviaor8clhvru7rfm.png" width="600" data-src="https://habrastorage.org/webt/z1/af/ag/z1afagq-1veviaor8clhvru7rfm.png"/></div><br/>
<blockquote>Для мониторинга состояния кластера в <strong>Elasticsearch</strong> существует <strong>cluster health status</strong>. Статус может иметь три значения: <br/>
<ul>
<li><code>green</code> — все ок</li>
<li><code>yellow</code> — есть утраченные шарды, кластер полностью работоспособен, но едет на репликах</li>
<li><code>red</code> — есть утраченные шарды, кластер неработоспособен или часть данных недоступна</li>
</ul><br/>
</blockquote><p>Для максимальной стабильности кластера необходимо, чтобы количество дата-нод было больше или равно количества реплик.</p><br/>
<h3 id="otkazoustoychivost">Отказоустойчивость</h3><br/>
<p>Сейчас данные будут доступны даже в случае сбоя одного из хранящих узлов. Но что если кластер потеряет мастера? Потеря единственного мастера равноценна потере кластера.</p><br/>
<p>Тут все по привычной схеме — поднимаем несколько мастеров.</p><br/>
<p>Но если у нас есть, например, два управляющих узла, как понять, какой из них в данный момент должен управлять кластером? Как они смогут договориться о своих решениях? Очевидно, что в каждый момент времени должен быть только один управляющий кластером узел.</p><br/>
<p>То есть при потере мастера его место должен занять один из кандидатов.</p><br/>
<blockquote>В <strong>Elasticsearch</strong> настройка <code>node.master: true</code> не будет означать, что данный узел является мастером, это всего лишь скажет о том, что он может быть выбран в качестве главного узла. По умолчанию настройки будут установлены следующим образом:<br/>
<ul>
<li><code>node.master: true</code></li>
<li><code>node.data: true</code></li>
</ul><br/>
</blockquote><p>Представим. Главный управляющий узел стал недоступен для кластера, кластер берет первого кандидата и устанавливает его на вакантное место. Спустя определенное время первый мастер возвращается в кластер и ничего не знает о том, что его место уже занято. Мастер-ноды являются своего рода его <em>мозгом</em>, и теперь мозг кластера становится разделен. Это классическая проблема распределенных систем и она так и называется <em>split-brain problem</em>.</p><br/>
<div style="text-align:center;"><img src="https://habrastorage.org/r/w1560/webt/ua/az/-w/uaaz-wypkw1_v7c76yfyyjoso7c.png" width="600" data-src="https://habrastorage.org/webt/ua/az/-w/uaaz-wypkw1_v7c76yfyyjoso7c.png"/></div><br/>
<p>В обществе подобные проблемы зачастую решаются путем голосования. Подобный механизм используется и в распределенных системах. Как только кластер теряет управляющий узел, должен быть запущен процесс голосования.</p><br/>
<p>Важно определить какой из кандидатов больше всего подходит на роль главного узла. Такой кандидат должен обладать самой актуально информацией о кластере. Для краткого описания актуальности информации о кластере может использоваться версионирование. При каждом изменении кластера главный узел будет обновлять некую служебную информацию и повышать номер версии, далее то же самое будет параллельно происходить в нодах-кандидатах.</p><br/>
<p>Сравнив номера версий мы можем определить наиболее подходящих кандидатов на роль мастера. Теперь если отпавшая мастер-нода вернется в кластер, то процесс голосования запустится снова и будет выбран единственный управляющий узел.</p><br/>
<div style="text-align:center;"><img src="https://habrastorage.org/r/w1560/webt/di/hw/wj/dihwwjwbd2wsvmwy_ucbsjundzu.png" width="800" data-src="https://habrastorage.org/webt/di/hw/wj/dihwwjwbd2wsvmwy_ucbsjundzu.png"/></div><br/>
<p>Теперь важно понять когда можно считать, что голосование прошло успешно? Если проголосовали все участники? Или половина? Или другое любое другое магическое количество?</p><br/>
<p>Решение этой проблемы заключается в определении <em>кворума</em>. Это умное название для контрольного количества голосующих.</p><br/>
<p>Очевидно, что такое важное решение как выбор мастера должно приниматься на основе большинства, то есть 50%+один голос. Справедливо, надежно. Это значение и станет кворумом.</p><br/>
<p>Таким образом, количество кандидатов на мастера должно быть нечетным и не меньше трех. Рекомендуется использовать простую формулу для расчета оптимально количества таких нод:<br/>
<code>КОЛИЧЕСТВО_КАНДИДАТОВ = ОБЩЕЕ_КОЛИЧЕСТВО_НОД/2 + 1</code></p><br/>
<p>Решения для любых общекластерных действий принимаются путем голосования, и вся необходимая для голосования информация содержится в <em>конфигурации голосования</em>. Право голоса определяет еще одну роль, ведь право голоса не означает, что узел может быть кандидатом.</p><br/>
<blockquote>В <strong>Elasticsearch</strong> узлы, которые могут участвовать в голосовании можно определить в конфигурации: <code>node.voting_only: true</code>.<br/>
<br/>
Elasticsearch автоматически изменяет конфигурацию голосования при изменении кластера. Поэтому нельзя одновременно отключать половину или более голосующих нод. Например, если в вашей конфигурации в данный момент 7 голосующих нод и вы отключили сразу 4, кластер станет недоступным, потому что останется 3 ноды, а в конфигурации голосования кворумом является значение 4.</blockquote><p>Теперь, если кластер разделится на две части, узлы меньшей, пропинговав доступные в ней узлы и сравнив их количество со значением кворума, будут знать, что именно они отпали от кластера и не могут участвовать в принятии решений.</p><br/>
<h3 id="transport">Транспорт</h3><br/>
<p>Пришло время поговорить о том, как общаться с кластером из внешних систем, и как будут общаться узлы внутри кластера. Есть ряд плюсов и минусов использования и <em>традиционных</em>, и специальных протоколов. Для краткого сравнения существует таблица.</p><br/>
<div class="scrollable-table"><table>
<thead>
<tr>
<th><strong>Протокол</strong></th>
<th><strong>Достоинства</strong></th>
<th><strong>Недостатки</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>HTTP</td>
<td>Низкий порог вхождения, в сравнении с нативным протоколом. Для использования нужен только HTTP клиент и погнали. HTTP API никогда не ломает совместимость, при обновлении версии ES, ваше приложение продолжит работать так же. Возможно проксировать и использовать балансировщики нагрузки. JSON.</td>
<td>Клиент не знает топологию кластера, поэтому может потребовать большее количество запросов для получения данных. Оверхед.</td>
</tr>
<tr>
<td>ES Native</td>
<td>Лучший выбор для ОЧЕНЬ больших данных. Если необходимо выполнить большое количество операций с индексом, нативный протокол значительно ускорит.</td>
<td>Используется под JVM. Использование влечет жесткую связность с ES. Обновления требуют перекомпиляции и повторного развертывания пользовательских клиентов. Возможны обновления ломающие совместимость.</td>
</tr>
</tbody>
</table></div><br/>
<blockquote>Для внутренней коммуникации в кластере <strong>Elsaticsearch</strong> использует нативный протокол.</blockquote><br/>
<h3 id="zaklyuchenie">Заключение</h3><br/>
<p>Хочется верить, что прочитав эту статью вы поняли основы распределенных поисковых систем. Возможности масштабирования и отказоустойчивости — это то для чего был создан Elasticsearch и то, почему он приобрел популярность. </p><br/>
<p>Я постарался кратко и последовательно рассказать о том, как и почему именно так это устроено. В этой статье я намеренно не стал упоминать об экосистеме Elastic, плагинах, запросах, токенизации, маппинге и остальном. Так же я не сказал об Ingest и machine learning нодах, на мой взгляд, они дают дополнительные возможности и не являются базовыми.</p><br/>
<h3 id="dopolnitelnye-materialy">Дополнительные материалы</h3><br/>
<p><a href="https://www.elastic.co/guide/index.html" rel="nofollow">Elastic Stack and Product Documentation</a></p><br/>
<p><a href="https://habr.com/ru/company/galssoftware/blog/470640/">Сайзинг Elasticsearch</a></p><br/>
<p>Книга Elasticsearch 5.x Cookbook, Third Edition</p></div></div></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="https://habr.com/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Belasticsearch%5D" class="tm-tags-list__link">elasticsearch</a></li><li class="tm-separated-list__item"><a href="https://habr.com/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bbig%20data%5D" class="tm-tags-list__link">big data</a></li><li class="tm-separated-list__item"><a href="https://habr.com/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%BF%D0%BE%D0%B8%D1%81%D0%BA%D0%BE%D0%B2%D1%8B%D0%B5%20%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B%5D" class="tm-tags-list__link">поисковые системы</a></li><li class="tm-separated-list__item"><a href="https://habr.com/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D1%80%D0%B0%D1%81%D0%BF%D1%80%D0%B5%D0%B4%D0%B5%D0%BB%D0%B5%D0%BD%D0%BD%D1%8B%D0%B5%20%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B%5D" class="tm-tags-list__link">распределенные системы</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="https://habr.com/ru/hub/search_technologies/" class="tm-hubs-list__link">
    Поисковые технологии
  </a></li><li class="tm-separated-list__item"><a href="https://habr.com/ru/hub/it-infrastructure/" class="tm-hubs-list__link">
    IT-инфраструктура
  </a></li><li class="tm-separated-list__item"><a href="https://habr.com/ru/hub/distributed_systems/" class="tm-hubs-list__link">
    Распределённые системы
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="24" width="24" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_appearance-article"><title>Всего голосов 51: ↑50 и ↓1</title> <use xlink:href="/img/megazord-v25.4b679db1.svg#counter-rating"></use></svg> <span title="Всего голосов 51: ↑50 и ↓1" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_appearance-article tm-votes-meter__value_rating">+49</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="24" width="24" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v25.4b679db1.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">82K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="24" width="24" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v25.4b679db1.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    423
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="tm-sharing__icon"><path fill="currentColor" d="M13.8 13.8V18l7.2-6.6L13.8 5v3.9C5 8.9 3 18.6 3 18.6c2.5-4.4 6-4.8 10.8-4.8z"></path></svg></button> <DIV class="v-portal" style="display:none;"></DIV></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <DIV class="v-portal" style="display:none;"></DIV> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="https://habr.com/ru/users/nordwind2013/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><img alt="" src="https://habrastorage.org/getpro/habr/avatars/b90/40a/ab9/b9040aab988d79081e839fa79e87be5e.jpg" class="tm-entity-image__pic"></div></a> <div class="tm-user-card__meta"><div title=" 13 голосов " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    13
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">0</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><span class="tm-user-card__name tm-user-card__name_variant-article">Роман</span> <a href="https://habr.com/ru/users/nordwind2013/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @nordwind2013
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">Разработчик</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <!----> <!----> <!----></div></div> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="https://habr.com/ru/post/489924/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="24" width="24" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v25.4b679db1.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 44 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner23877" class="tm-ad-banner"></div></div> <!----> <!----> <!----> <!----> </div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner23878" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <section data-async-called="true" class="tm-block tm-block_spacing-bottom"><header class="tm-block__header"><h2 class="tm-block__title">Работа</h2> <!----></header> <div class="tm-block__body"><div class="tm-vacancies-block__item"><a href="https://career.habr.com/vacancies/blockchain_developer" target="_blank" class="tm-vacancies-block__vacancy-title">
        Blockchain разработчик
      </a> <div class="tm-vacancies-block__vacancies-count">
        16
    вакансий
      </div></div><div class="tm-vacancies-block__item"><a href="https://career.habr.com/vacancies/sistemnij_administrator" target="_blank" class="tm-vacancies-block__vacancy-title">
        Системный администратор
      </a> <div class="tm-vacancies-block__vacancies-count">
        130
    вакансий
      </div></div></div> <footer class="tm-block__footer"><a href="https://career.habr.com/catalog" class="tm-block-extralink">
      Все вакансии
    </a></footer></section></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://habr.com/kek/v1/auth/habrahabr/?back=/ru/post/489924/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habr.com/kek/v1/auth/habrahabr-register/?back=/ru/post/489924/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://habr.com/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habr.com/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habr.com/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habr.com/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habr.com/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habr.com/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://habr.com/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habr.com/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habr.com/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habr.com/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habr.com/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="https://habr.com/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="https://habr.com/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="https://habr.com/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2022 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"489924":{"id":"489924","timePublished":"2020-02-25T16:10:30+00:00","isCorporative":false,"lang":"ru","titleHtml":"С чего начинается Elasticsearch","leadData":{"textHtml":"\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fu9\u002Fvi\u002Foe\u002Fu9vioev9akwzaj1c8hrbmbdjfqm.jpeg\" width=\"400\" align=\"left\"\u003E Elasticsearch, вероятно, самая популярная поисковая система на данный момент с развитым сообществом, поддержкой и горой информации в сети. Однако эта информация поступает непоследовательно и дробно.\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cp\u003EСамое первое и главное заблуждение — &quot;нужен поиск, так бери эластик!&quot;. Но в действительности, если вам нужен шустрый поиск для небольшого или даже вполне себе крупного проекта, вам стоит разобраться в теме поподробней и вы откажетесь от использования именно этой системы.\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"editorVersion":"1.0","postType":"article","postLabels":[{"type":"sandbox","data":null},{"type":"technotext2020","data":{"url":"https:\u002F\u002Fcontenting.io\u002Fchallenge.html"}}],"author":{"scoreStats":{"score":13,"votesCount":13},"rating":0,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"1609279","alias":"nordwind2013","fullname":"Роман","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fb90\u002F40a\u002Fab9\u002Fb9040aab988d79081e839fa79e87be5e.jpg","speciality":"Разработчик"},"statistics":{"commentsCount":44,"favoritesCount":423,"readingCount":81524,"score":49,"votesCount":51},"hubs":[{"relatedData":null,"id":"126","alias":"search_technologies","type":"collective","title":"Поисковые технологии","titleHtml":"Поисковые технологии","isProfiled":true},{"relatedData":null,"id":"6398","alias":"it-infrastructure","type":"collective","title":"IT-инфраструктура","titleHtml":"IT-инфраструктура","isProfiled":true},{"relatedData":null,"id":"21482","alias":"distributed_systems","type":"collective","title":"Распределённые системы","titleHtml":"Распределённые системы","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"6","alias":"admin","title":"Администрирование"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fu9\u002Fvi\u002Foe\u002Fu9vioev9akwzaj1c8hrbmbdjfqm.jpeg\" width=\"400\" align=\"left\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fu9\u002Fvi\u002Foe\u002Fu9vioev9akwzaj1c8hrbmbdjfqm.jpeg\" data-blurred=\"true\"\u002F\u003E Elasticsearch, вероятно, самая популярная поисковая система на данный момент с развитым сообществом, поддержкой и горой информации в сети. Однако эта информация поступает непоследовательно и дробно.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EСамое первое и главное заблуждение — \"нужен поиск, так бери эластик!\". Но в действительности, если вам нужен шустрый поиск для небольшого или даже вполне себе крупного проекта, вам стоит разобраться в теме поподробней и вы откажетесь от использования именно этой системы.\u003C\u002Fp\u003E\u003Ca name=\"habracut\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВторая проблема заключается в том, что пытаясь разобраться с начала, получить общую картину окажется непросто. Да инфы навалом, но последовательность в ее изучении выстраивается постфактум. Придется из книг бежать в документацию, а из документации обратно в книги, параллельно разгугливая тонкости, только чтобы понять, что такое Elasticsearch, почему он работает именно так и для чего же его вообще использовать, а где стоит выбрать что-то попроще.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВ этой статье я попытался последовательно объяснить то что мне кажется главным в Elasticsearch, то для чего он был придуман и как он устроен.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EДля наглядности выдумаем себе задачу. Реализация поиска в коллективном блоге по всем материалам и пользователям. Система позволяет создавать теги, сообщества, геометки и все остальные штуки, которые нам помогают категоризировать огромное количество информации.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2 id=\"shema-hraneniya-dannyh\"\u003EСхема хранения данных\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТо, какие действия с данными мы будем производить определит схему их хранения:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003Eскорее всего поисковая система должна будет быстро производить поиск\u003C\u002Fli\u003E\r\n\u003Cli\u003Eзапись и удаление могут не отличаться высокой скоростью, в системах поиска, полагаю, этим можно пренебречь\u003C\u002Fli\u003E\r\n\u003Cli\u003Eструктура данных будет интенсивно изменяться и хранилище может заполняться из нескольких независимых источников( различных баз, в том числе внешних для нашей системы )\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПредставьте еще раз сколько атрибутов может иметь публикация и сколько связанных с ней объектов. Автор, категория, сообщество, геометки, медиафайлы, теги, связанные публикации. Этот список можно продолжать до исчерпания фантазии. Если мы храним это в привычной реляционной базе то имеем миллион связей и миллиард атрибутов. Это прекрасно подходит для структурированного хранения долгие годы, но не очень вяжется с требованиями быстрого поиска. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EА что если мы захотим добавить пару интеграций с внешними системами? Придется реализовать дополнительные таблицы или даже базы. Нам всегда будет нужно что-то добавить или изменить в объектах доступных для поиска. Вы понимаете к чему я клоню.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНамного быстрее читать из объектов, содержащих все необходимое здесь и сейчас. И намного проще вносить изменения в неструктурированную схему данных.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fwebt\u002Fyk\u002Fcq\u002Fxq\u002Fykcqxq59u93tthdeynsgzl3co-k.png\" width=\"600\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fyk\u002Fcq\u002Fxq\u002Fykcqxq59u93tthdeynsgzl3co-k.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"json\"\u003E{\n    \"title\" : \"С чего начинается Elasticsearch\",\n    \"author\" : {\n        \"name\": \"Roman\"\n    },\n    \"content\" : \"Elasticsearch, вероятно, самая популярная поисковая система...\",\n    \"tags\":[\n        \"elasticsearch\"\n    ],\n    \"ps\": \"Да, проще всего представить это как JSON, BSON или XML\"\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EК тому же такие структуры данных проще делить, разносить по разным физическим хранилищам, распределять, ведь объекты уже содержат все необходимое.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЭти объекты мы можем воспринимать как отдельные страницы, файлы, карточки, все это можно назвать некими \u003Cem\u003Eдокументами\u003C\u002Fem\u003E. Поэтому такая модель хранения данных называется \u003Cem\u003Eдокументоориентированной\u003C\u002Fem\u003E.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cstrong\u003EElasticsearch\u003C\u002Fstrong\u003E это документоориентированная база данных\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2 id=\"poisk\"\u003EПоиск\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТеперь необходимо определиться с механизмами поиска. Данные организованы в виде документов. Как мы привыкли осуществлять поиск по документу? \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТипичным примером документа будет веб-страница. Если мы попытаемся поискать по всей странице в браузере, поиск будет осуществляться по всему содержащемуся тексту. И это удобно для большинства кейсов.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПримерно так же работают многие поисковые системы, поиск происходит по всему тексту проиндексированных страниц, а не по отдельным полям, тегам или заголовкам. Это называется \u003Cem\u003Eполнотекстовым\u003C\u002Fem\u003E поиском.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИскать предстоит по огромному количеству документов и было бы разумно запомнить что в каком документе лежит. В реляционных СУБД мы привыкли оптимизировать подобный поиск индексами. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЧто такое индекс на самом деле? Если не вдаваться в детали, индекс это сбалансированное дерево, то есть дерево, в котором длина путей(количество шагов межу узлами) не будет отличаться больше чем на один шаг.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fwebt\u002Fbr\u002Fvx\u002Fdc\u002Fbrvxdcp5k7p1lswgx7msvnhpx70.png\" width=\"700\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fbr\u002Fvx\u002Fdc\u002Fbrvxdcp5k7p1lswgx7msvnhpx70.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНапример если бы мы проиндексировали наш пост, то у нас бы получилось дерево, листьями которого, являлись бы используемые в нем слова. Простыми словами, мы будем знать заранее, какие слова находятся в документе и как их быстро в нем найти. Не смотря на такую удобную структуризацию данных, обход дерева звучит как не самое лучшее решение для максимально быстрого поиска.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EА что если сделать все наоборот — собрать список всех используемых слов и узнать, в каких документах они встречаются. Да, индексация займет больше времени, но нас в первую очередь интересует именно скорость поиска, а не индексации.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fwebt\u002Fpq\u002Fa1\u002Fsr\u002Fpqa1sr_yawfjzqz5g8mntcl1dim.png\" width=\"250\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fpq\u002Fa1\u002Fsr\u002Fpqa1sr_yawfjzqz5g8mntcl1dim.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТакой индекс называется \u003Cem\u003Eобратным индексом\u003C\u002Fem\u003E и используется для полнотекстового поиска.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EХороший пример — популярная open-source библиотека полнотекстового поиска, конечно же, с обратным индексом, \u003Ca href=\"https:\u002F\u002Flucene.apache.org\u002Fcore\u002F\" rel=\"nofollow\"\u003EApache Lucene\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cstrong\u003EElasticsearch\u003C\u002Fstrong\u003E использует индексы Lucene для хранения данных и поиска\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2 id=\"masshtabirovanie\"\u003EМасштабирование\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКак бы мы не пытались оптимизировать структуры данных и алгоритмы поиска, когда речь заходит о действительно больших массивах данных и действительно большом количестве запросов, необходимо задуматься о возможности повлиять на производительность системы путем увеличения аппаратного ресурса. Проще говоря, мы хотим иметь возможность накинуть немного памяти, ЦП и дискового пространства, чтобы все ехало быстрее. Мы можем назвать это \u003Cem\u003Eмасштабируемостью\u003C\u002Fem\u003E.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EСамый простой вариант — накинуть железа на сервер. Если представить каждую условную единицу вычислительной мощности как деревянный кубик, то сейчас мы сложим кубики в одно место или один на другой, строя башню \u003Cem\u003Eвертикально\u003C\u002Fem\u003E. Такое масштабирование и называется \u003Cem\u003Eвертикальным\u003C\u002Fem\u003E.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВторой вариант — разделить наши задачи на группу машин. В этом случае мы тоже увеличиваем аппаратный ресурс, но сейчас кубики мы можем расположить на воображаемом столе как угодно на его плоскости, то есть \u003Cem\u003Eгоризонтально\u003C\u002Fem\u003E. Угадайте, как называется такое масштабирование?\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПервый способ гарантирует нам быстрый результат без боли, но конечно не все так гладко. Как долго мы сможем увеличивать ресурс отдельной машины? Во-первых дешевым способом это будет только в самом начале, дальше оплата одного сервера будет стоить как несколько машин попроще. Во-вторых вы рано или поздно упретесь в потолок — железо, драйверы, пропускная способность и еще куча логических и физических ограничений. А самое главное, критический сбой в одной машине повлечет сбой всей системы, закономерно.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВ отличии от первого способа второй не накладывает таких явных ограничений, мы можем добавлять машины сколько угодно, связывая их сетью. Конечно, это повлечет сетевые издержки — низкая скорость передачи в сети(в сравнении с обработкой на одной машине), сетевой оверхед. Но вместе с тем сеть имеет одно очень важное свойство — большую \u003Cem\u003Eотказоустойчивость\u003C\u002Fem\u003E.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Ch3 id=\"raspredelennyy-indeks\"\u003EРаспределенный индекс\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EОк, для хранения данных и поиска мы будем использовать инстанс Lucene. Но ранее мы решили, что для обеспечения горизонтального масштабирования нам необходимо иметь возможность размещать данные на разных машинах. В действительности, какая разница как данные хранятся физически? Важно чтобы мы имели единое логическое хранилище. Каждый инстанс Lucene должен стать частью одного большого индекса, или осколком(\u003Cstrong\u003Eshard\u003C\u002Fstrong\u003E) разбитого индекса. Шард будет выполнять непосредственно операции по поиску и записи данных.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fwebt\u002Fal\u002Fja\u002Ffv\u002Faljafvzws50myp43grmy4hvhbrk.png\" width=\"500\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fal\u002Fja\u002Ffv\u002Faljafvzws50myp43grmy4hvhbrk.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cstrong\u003EShard\u003C\u002Fstrong\u003E в \u003Cstrong\u003EElasticsearch\u003C\u002Fstrong\u003E — это логическая единица хранения данных на уровне базы, которая является отдельным экземпляром Lucene.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ca href=\"https:\u002F\u002Fwww.elastic.co\u002Fblog\u002Fwhat-is-an-elasticsearch-index\" rel=\"nofollow\"\u003E\u003Cstrong\u003EIndex\u003C\u002Fstrong\u003E\u003C\u002Fa\u003E — это одновременно и распределенная база и механизм управления и организации данных, это именно логическое пространство. Индекс содержит один или более шардов, их совокупность и является хранилищем.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКлассическое сравнение индекса с другими базами выглядит примерно так.\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"scrollable-table\"\u003E\u003Ctable\u003E\r\n\u003Cthead\u003E\r\n\u003Ctr\u003E\r\n\u003Cth\u003E\u003Cstrong\u003EElasticsearch\u003C\u002Fstrong\u003E\u003C\u002Fth\u003E\r\n\u003Cth\u003E\u003Cstrong\u003ESQL\u003C\u002Fstrong\u003E\u003C\u002Fth\u003E\r\n\u003Cth\u003E\u003Cstrong\u003EMongoDB\u003C\u002Fstrong\u003E\u003C\u002Fth\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003C\u002Fthead\u003E\r\n\u003Ctbody\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003EIndex\u003C\u002Ftd\u003E\r\n\u003Ctd\u003EDatabase\u003C\u002Ftd\u003E\r\n\u003Ctd\u003EDatabase\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003EMapping\u002FType\u003C\u002Ftd\u003E\r\n\u003Ctd\u003ETable\u003C\u002Ftd\u003E\r\n\u003Ctd\u003ECollection\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003EField\u003C\u002Ftd\u003E\r\n\u003Ctd\u003EColumn\u003C\u002Ftd\u003E\r\n\u003Ctd\u003EField\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003EObject(JSON)\u003C\u002Ftd\u003E\r\n\u003Ctd\u003ETuple\u003C\u002Ftd\u003E\r\n\u003Ctd\u003EObject(BSON)\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003C\u002Ftbody\u003E\r\n\u003C\u002Ftable\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНо существуют отличия в использовании этих абстракций. Рассмотрим еще один классический пример. У пользователя системы может храниться очень много информации, и мы решаем создавать новую базу для каждого пользователя. Это звучит дико! Но на самом деле в Elasticsearch это распространенная и даже хорошая практика. Индекс это довольно легкий механизм и лучше разделять большие данные, тем более, когда это логически оправдано. Системе проще работать с небольшими индексами чем с разросшейся базой для всего. Например, так вы можете создавать отдельный индекс для логов на каждый день и это широко используется.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПо умолчанию количество шардов для индекса будет равным 5, но его всегда возможно изменить в настройках \u003Ccode\u003Eindex.number_of_shards: 1\u003C\u002Fcode\u003E или с помощью запроса шаблонов индекса.\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"json\"\u003EPUT _template\u002Fall\n{\n  \"template\": \"*\",\n      \"settings\": {\n        \"number_of_shards\": 1\n      }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВажно управлять этим значением. Всегда принимайте решения с точки зрения параллельной обработки. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКаждый шард способен хранить примерно 2\u003Csup\u003E32\u003C\u002Fsup\u003E или 4294967296 записей, это значит, что скорее всего вы упретесь в лимит вашего диска. Однако стоит понимать, все шарды будут участвовать в поиске и если мы будем искать по сотне пустых, потратим время впустую. Если шарды будут слишком большими мы так же будем тратить лишнее время на поиск, а так же операций перемещения и индексации станут очень тяжелыми.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗабегая вперед. Со временем Elasticsearch двигает и изменяет шарды, объединяя дробные и мелкие в большие. Следите за размером ваших шардов, при достижении 10ГБ производительность значительно падает.\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Ch3 id=\"klaster\"\u003EКластер\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EМы определились с базовой концепцией распределенного индекса. Сейчас необходимо решить, как в действительности будет осуществляться управление отдельными базами.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EРанее мы решили, что за операции поиска и индексации отвечает отдельный инстанс Lucene(\u003Cem\u003Eшард\u003C\u002Fem\u003E). Для того, чтобы обращаться к распределенной системе шардов, нам необходимо иметь некий координирующий узел, именно он будет принимать запросы и давать задания на запись или получение данных. То есть помимо хранения данных мы выделяем еще один вариант поведения программы — координирование.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТаким образом мы изначально ориентируемся на два вида узлов — CRUD-узлы и координирующие узлы. Назовем их \u003Cstrong\u003Edata node\u003C\u002Fstrong\u003E и \u003Cstrong\u003Ecoordinating node\u003C\u002Fstrong\u003E. У нас есть куча машин объединенных в сеть и все это очень напоминает кластер.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fwebt\u002Fji\u002F0m\u002Fsg\u002Fji0msg-kjfmmmolxt8dp0zgkiti.png\" width=\"500\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fji\u002F0m\u002Fsg\u002Fji0msg-kjfmmmolxt8dp0zgkiti.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003EКаждый запущенный экземпляр \u003Cstrong\u003EElasticsearch\u003C\u002Fstrong\u003E является отдельным узлом(\u003Ca href=\"https:\u002F\u002Fwww.elastic.co\u002Fguide\u002Fen\u002Felasticsearch\u002Freference\u002Fcurrent\u002Fmodules-node.html\" rel=\"nofollow\"\u003E\u003Cstrong\u003Enode\u003C\u002Fstrong\u003E\u003C\u002Fa\u003E). \u003Cstrong\u003ECluster\u003C\u002Fstrong\u003E — это совокупность определенных нод. Когда вы запускаете один экземпляр ваш кластер будет состоять из одной ноды.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДля того чтобы объединить узлы в кластер они должны соответствовать ряду требований:\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EНоды должны иметь одинаковую версию\u003C\u002Fli\u003E\r\n\u003Cli\u003EИмя кластера \u003Ccode\u003Ecluster.name\u003C\u002Fcode\u003E в конфигурации должно быть одинаковым\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКонфигурация читается из файла \u003Cstrong\u003Eelasticsearch.yml\u003C\u002Fstrong\u003E и переменных среды. Здесь мы можете настроить почти все, что касается неизменных в рантайме свойств ноды.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВы можете поднимать несколько узлов на одной машине, для этого необходимо запускать инстансы из разных директорий файловой системы и в конфигурации указать разные порты \u003Ccode\u003Ehttp.port\u003C\u002Fcode\u003E, по умолчанию порт 9200 для внешнего доступа и 9300 для внутрикластерного соединения. Это может понадобиться для тестирования и проектирования кластера, однако в проде подразумевается использование отдельных машин.\u003C\u002Fblockquote\u003E\u003Cp\u003EКаждый тип ответственности узлов налагает определенные системные требования. Очевидно, что data-ноды будут часто обращаться к диску и использовать значительные объемы памяти в процессе работы.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EМы так же можем утверждать, что не все данные будут запрашиваться одинаково часто. Данные постепенно \"остывают\" по мере снижения запросов. Мы можем назвать это жизненным циклом хранения данных. Хорошей идеей было бы держать хайповые публикации там, откуда их можно быстро достать, а забытые мемы 2007 можно положить подальше.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003EНачиная с версии 6.7 \u003Cstrong\u003EElasticsearch\u003C\u002Fstrong\u003E предлагает механизм \u003Ca href=\"https:\u002F\u002Fwww.elastic.co\u002Fguide\u002Fen\u002Felasticsearch\u002Freference\u002Fcurrent\u002Fmodules-node.html\" rel=\"nofollow\"\u003Eуправления жизненным циклом\u003C\u002Fa\u003E. Для этого доступны три типа нод — hot, warm и cold.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСуществует рекомендация по выбору аппаратных конфигураций для каждого из типов. Например hot-ноды должны иметь быстрые SSD, для warm и cold достаточно HDD-диска. Оптимальные соотношения память\u002Fдиск будут следующими:\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003Ehot — 1:30\u003C\u002Fli\u003E\r\n\u003Cli\u003Ewarm — 1:100\u003C\u002Fli\u003E\r\n\u003Cli\u003Ecold — 1:500\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДля того чтобы определить тип ноды как data node необходимо установить значение в конфигурации \u003Ccode\u003Enode.data: true\u003C\u002Fcode\u003E, при этом рекомендуется выделять ноду под один конкретный тип, для повышения стабильности и производительности кластера.\u003C\u002Fblockquote\u003E\u003Cp\u003EВажнейшим аспектом в использовании распределенных систем является параллельное выполнение задач. Существует популярная модель распределенных вычислений, которая имеет лаконичное название \u003Cstrong\u003EMapReduce\u003C\u002Fstrong\u003E. И заключается она разделении выполнения задачи на два больших шага: \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003E\u003Cstrong\u003EMap\u003C\u002Fstrong\u003E — предварительная обработка данных, формулировка задачи и последующая ее передача выполняющим узлам\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cstrong\u003EReduce\u003C\u002Fstrong\u003E — свертка множества результатов worker-нод в один финальный ответ\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fwebt\u002Foa\u002Fhw\u002F_q\u002Foahw_qp3sc19wwnhn8vl5k0wsm0.png\" width=\"700\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Foa\u002Fhw\u002F_q\u002Foahw_qp3sc19wwnhn8vl5k0wsm0.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИменно такой механизм поможет нам выполнять операции с шардами. Координирующий узел получит запрос, предварительно переформулирует его для внутрикластерного взаимодействия и выполнит запросы к нашим worker-нодам(в данном случае к data-нодам).\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EСледовательно, \u003Cstrong\u003Ecoordinating-ноды\u003C\u002Fstrong\u003E должны иметь достаточный ресурс памяти, ЦП и быструю сеть, но при этом могут иметь скромный диск, ведь не осуществляют хранения данных. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EОднако при большой частоте запросов, такие ноды могут стать узким местом системы. Мы можем пойти привычным путем и превратить точку внешнего доступа в плоскость. Пусть координирующих нод будет множество. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТакой подход позволит нам применять балансировку запросов, это можно сделать прямо в клиентском коде либо использовать любые существующие балансировщики.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003EВ \u003Cstrong\u003EElasticsearch\u003C\u002Fstrong\u003E все узлы неявно являются координирующими. Однако, стоит выделять отдельные coordinating-ноды, не выполняющие других операций. Забегая вперед, такие ноды можно определить, установив значения всех типов в \u003Ccode\u003Efalse\u003C\u002Fcode\u003E.\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Ch3 id=\"upravlenie-klasterom\"\u003EУправление кластером\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНа данном этапе мы имеем возможность доступа к данным из множества точек — \u003Cstrong\u003Ecoordinating-нод\u003C\u002Fstrong\u003E. В этом нет проблем, если мы говорим о простых операциях чтения\u002Fзаписи в существующий индекс. Но если говорить о выделении новых шардов или их перемещении, может начаться путаница.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПредположим, возможность \u003Cstrong\u003Ecoordinating-нодам\u003C\u002Fstrong\u003E управления состоянием кластера. Один узел примет решение о перемещении шарда на одну \u003Cstrong\u003Edata-ноду\u003C\u002Fstrong\u003E, а второй о перемещении того же на другую. Список возможных общекластерных действий может быть довольно широким, а список возможных конфликтов еще шире.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EОчевидно такие важные решения должен принимать один центральный узел. Мы определили, что для каждого типа действий необходимо выделять отдельную роль, чтобы избежать потерь производительности на ноде. И \"главный в кластере\" звучит как отдельная ответственность.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНазовем такие ноды \u003Cstrong\u003Emaster-node\u003C\u002Fstrong\u003E. Активный мастер всегда должен быть один, он будет управлять топологией кластера: создавать новый индекс, выделять и распределять шарды, перемещать их и объединять в случае необходимости. Мастер всегда знает все о состоянии кластера.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003EВ кластере \u003Cstrong\u003EElasticsearch\u003C\u002Fstrong\u003E обязательно должен быть как минимум один узел отвечающий требованиям \u003Cstrong\u003Emaster node\u003C\u002Fstrong\u003E. Для этого в конфигурации ноды необходимо установить значение \u003Ccode\u003Enode.master: true\u003C\u002Fcode\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cstrong\u003EMaster-ноды\u003C\u002Fstrong\u003E отвечают за важные, но довольно легкие общекластерные действия. Это означает, что они требуют большого ресурса и высокой стабильности от физической ноды. В кластерах от 10 нод необходимо всегда выделять отдельные only-master узлы.\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Ch3 id=\"replikaciya-dannyh\"\u003EРепликация данных\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EСейчас каждая запись в нашем индексе существует только в одном месте, и потеря хранящего ее узла приведет к потере данных на неопределенный срок. Для того, чтобы этого избежать существует механизм репликации. Важно не путать понятия реплики и бэкапа, если бэкап позволяет восстановить данные в случае утери, то реплика является полной копией базы.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли мы потеряем одну из \u003Cstrong\u003Edata-нод\u003C\u002Fstrong\u003E, то всегда сможем продолжить работу с репликами шардов в другом узле и тем временем вернуть потерянный.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТо есть для каждого шарда должна быть как минимум одна копия на другой ноде. Можно конечно выделять по отдельной машине для каждой реплики, но это очень расточительно. Нужно разместить копии данных на разных узлах, но это не значит, что эти узлы должны хранить только шарды реплик.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fwebt\u002Fje\u002Fdx\u002F_b\u002Fjedx_bbsqdrbemksh0oithdxezi.png\" width=\"500\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fje\u002Fdx\u002F_b\u002Fjedx_bbsqdrbemksh0oithdxezi.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003EЧтобы жестко установить количество реплик индекса используется параметр \u003Ccode\u003Enumber_of_replicas\u003C\u002Fcode\u003E. Так же мы можем изменить это значение в рантайме выполнив запрос:\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"json\"\u003EPUT \u002F _settings {\n  \"index\": {\n      \"number_of_replicas\": someVal\n  }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fblockquote\u003E\u003Cp\u003EТаким образом мы всегда имеем реплики всех шардов и не поднимаем неэффективно простаивающие ноды.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EОсновной шард назовем первичным или \u003Cstrong\u003Eprimary shard\u003C\u002Fstrong\u003E, а любую из его копий реплицирующим шардом или \u003Cstrong\u003Ereplica shard\u003C\u002Fstrong\u003E, первичный шард и его реплики это группа репликации.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EС учетом реплик запись данных будет происходить в два этапа, в первом запись затронет только первичный шард и только после того, как произойдет операция \u003Cstrong\u003Eflush\u003C\u002Fstrong\u003E слияния изменений и операция \u003Cstrong\u003Ecommit\u003C\u002Fstrong\u003E фиксации в индексе Lucene, будет отправлен внутренний запрос на изменение всех реплик.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fwebt\u002Fz1\u002Faf\u002Fag\u002Fz1afagq-1veviaor8clhvru7rfm.png\" width=\"600\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fz1\u002Faf\u002Fag\u002Fz1afagq-1veviaor8clhvru7rfm.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003EДля мониторинга состояния кластера в \u003Cstrong\u003EElasticsearch\u003C\u002Fstrong\u003E существует \u003Cstrong\u003Ecluster health status\u003C\u002Fstrong\u003E. Статус может иметь три значения: \u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003E\u003Ccode\u003Egreen\u003C\u002Fcode\u003E — все ок\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ccode\u003Eyellow\u003C\u002Fcode\u003E — есть утраченные шарды, кластер полностью работоспособен, но едет на репликах\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ccode\u003Ered\u003C\u002Fcode\u003E — есть утраченные шарды, кластер неработоспособен или часть данных недоступна\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fblockquote\u003E\u003Cp\u003EДля максимальной стабильности кластера необходимо, чтобы количество дата-нод было больше или равно количества реплик.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Ch3 id=\"otkazoustoychivost\"\u003EОтказоустойчивость\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EСейчас данные будут доступны даже в случае сбоя одного из хранящих узлов. Но что если кластер потеряет мастера? Потеря единственного мастера равноценна потере кластера.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТут все по привычной схеме — поднимаем несколько мастеров.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНо если у нас есть, например, два управляющих узла, как понять, какой из них в данный момент должен управлять кластером? Как они смогут договориться о своих решениях? Очевидно, что в каждый момент времени должен быть только один управляющий кластером узел.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТо есть при потере мастера его место должен занять один из кандидатов.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003EВ \u003Cstrong\u003EElasticsearch\u003C\u002Fstrong\u003E настройка \u003Ccode\u003Enode.master: true\u003C\u002Fcode\u003E не будет означать, что данный узел является мастером, это всего лишь скажет о том, что он может быть выбран в качестве главного узла. По умолчанию настройки будут установлены следующим образом:\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003E\u003Ccode\u003Enode.master: true\u003C\u002Fcode\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ccode\u003Enode.data: true\u003C\u002Fcode\u003E\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fblockquote\u003E\u003Cp\u003EПредставим. Главный управляющий узел стал недоступен для кластера, кластер берет первого кандидата и устанавливает его на вакантное место. Спустя определенное время первый мастер возвращается в кластер и ничего не знает о том, что его место уже занято. Мастер-ноды являются своего рода его \u003Cem\u003Eмозгом\u003C\u002Fem\u003E, и теперь мозг кластера становится разделен. Это классическая проблема распределенных систем и она так и называется \u003Cem\u003Esplit-brain problem\u003C\u002Fem\u003E.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fwebt\u002Fua\u002Faz\u002F-w\u002Fuaaz-wypkw1_v7c76yfyyjoso7c.png\" width=\"600\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fua\u002Faz\u002F-w\u002Fuaaz-wypkw1_v7c76yfyyjoso7c.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВ обществе подобные проблемы зачастую решаются путем голосования. Подобный механизм используется и в распределенных системах. Как только кластер теряет управляющий узел, должен быть запущен процесс голосования.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВажно определить какой из кандидатов больше всего подходит на роль главного узла. Такой кандидат должен обладать самой актуально информацией о кластере. Для краткого описания актуальности информации о кластере может использоваться версионирование. При каждом изменении кластера главный узел будет обновлять некую служебную информацию и повышать номер версии, далее то же самое будет параллельно происходить в нодах-кандидатах.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EСравнив номера версий мы можем определить наиболее подходящих кандидатов на роль мастера. Теперь если отпавшая мастер-нода вернется в кластер, то процесс голосования запустится снова и будет выбран единственный управляющий узел.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fwebt\u002Fdi\u002Fhw\u002Fwj\u002Fdihwwjwbd2wsvmwy_ucbsjundzu.png\" width=\"800\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fdi\u002Fhw\u002Fwj\u002Fdihwwjwbd2wsvmwy_ucbsjundzu.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТеперь важно понять когда можно считать, что голосование прошло успешно? Если проголосовали все участники? Или половина? Или другое любое другое магическое количество?\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EРешение этой проблемы заключается в определении \u003Cem\u003Eкворума\u003C\u002Fem\u003E. Это умное название для контрольного количества голосующих.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EОчевидно, что такое важное решение как выбор мастера должно приниматься на основе большинства, то есть 50%+один голос. Справедливо, надежно. Это значение и станет кворумом.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТаким образом, количество кандидатов на мастера должно быть нечетным и не меньше трех. Рекомендуется использовать простую формулу для расчета оптимально количества таких нод:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003EКОЛИЧЕСТВО_КАНДИДАТОВ = ОБЩЕЕ_КОЛИЧЕСТВО_НОД\u002F2 + 1\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EРешения для любых общекластерных действий принимаются путем голосования, и вся необходимая для голосования информация содержится в \u003Cem\u003Eконфигурации голосования\u003C\u002Fem\u003E. Право голоса определяет еще одну роль, ведь право голоса не означает, что узел может быть кандидатом.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003EВ \u003Cstrong\u003EElasticsearch\u003C\u002Fstrong\u003E узлы, которые могут участвовать в голосовании можно определить в конфигурации: \u003Ccode\u003Enode.voting_only: true\u003C\u002Fcode\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nElasticsearch автоматически изменяет конфигурацию голосования при изменении кластера. Поэтому нельзя одновременно отключать половину или более голосующих нод. Например, если в вашей конфигурации в данный момент 7 голосующих нод и вы отключили сразу 4, кластер станет недоступным, потому что останется 3 ноды, а в конфигурации голосования кворумом является значение 4.\u003C\u002Fblockquote\u003E\u003Cp\u003EТеперь, если кластер разделится на две части, узлы меньшей, пропинговав доступные в ней узлы и сравнив их количество со значением кворума, будут знать, что именно они отпали от кластера и не могут участвовать в принятии решений.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Ch3 id=\"transport\"\u003EТранспорт\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПришло время поговорить о том, как общаться с кластером из внешних систем, и как будут общаться узлы внутри кластера. Есть ряд плюсов и минусов использования и \u003Cem\u003Eтрадиционных\u003C\u002Fem\u003E, и специальных протоколов. Для краткого сравнения существует таблица.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"scrollable-table\"\u003E\u003Ctable\u003E\r\n\u003Cthead\u003E\r\n\u003Ctr\u003E\r\n\u003Cth\u003E\u003Cstrong\u003EПротокол\u003C\u002Fstrong\u003E\u003C\u002Fth\u003E\r\n\u003Cth\u003E\u003Cstrong\u003EДостоинства\u003C\u002Fstrong\u003E\u003C\u002Fth\u003E\r\n\u003Cth\u003E\u003Cstrong\u003EНедостатки\u003C\u002Fstrong\u003E\u003C\u002Fth\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003C\u002Fthead\u003E\r\n\u003Ctbody\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003EHTTP\u003C\u002Ftd\u003E\r\n\u003Ctd\u003EНизкий порог вхождения, в сравнении с нативным протоколом. Для использования нужен только HTTP клиент и погнали. HTTP API никогда не ломает совместимость, при обновлении версии ES, ваше приложение продолжит работать так же. Возможно проксировать и использовать балансировщики нагрузки. JSON.\u003C\u002Ftd\u003E\r\n\u003Ctd\u003EКлиент не знает топологию кластера, поэтому может потребовать большее количество запросов для получения данных. Оверхед.\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003EES Native\u003C\u002Ftd\u003E\r\n\u003Ctd\u003EЛучший выбор для ОЧЕНЬ больших данных. Если необходимо выполнить большое количество операций с индексом, нативный протокол значительно ускорит.\u003C\u002Ftd\u003E\r\n\u003Ctd\u003EИспользуется под JVM. Использование влечет жесткую связность с ES. Обновления требуют перекомпиляции и повторного развертывания пользовательских клиентов. Возможны обновления ломающие совместимость.\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003C\u002Ftbody\u003E\r\n\u003C\u002Ftable\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003EДля внутренней коммуникации в кластере \u003Cstrong\u003EElsaticsearch\u003C\u002Fstrong\u003E использует нативный протокол.\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Ch3 id=\"zaklyuchenie\"\u003EЗаключение\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EХочется верить, что прочитав эту статью вы поняли основы распределенных поисковых систем. Возможности масштабирования и отказоустойчивости — это то для чего был создан Elasticsearch и то, почему он приобрел популярность. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЯ постарался кратко и последовательно рассказать о том, как и почему именно так это устроено. В этой статье я намеренно не стал упоминать об экосистеме Elastic, плагинах, запросах, токенизации, маппинге и остальном. Так же я не сказал об Ingest и machine learning нодах, на мой взгляд, они дают дополнительные возможности и не являются базовыми.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Ch3 id=\"dopolnitelnye-materialy\"\u003EДополнительные материалы\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fwww.elastic.co\u002Fguide\u002Findex.html\" rel=\"nofollow\"\u003EElastic Stack and Product Documentation\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fgalssoftware\u002Fblog\u002F470640\u002F\"\u003EСайзинг Elasticsearch\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКнига Elasticsearch 5.x Cookbook, Third Edition\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"elasticsearch"},{"titleHtml":"big data"},{"titleHtml":"поисковые системы"},{"titleHtml":"распределенные системы"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F489924\u002F44f9e29f53a8fac34f27ab6a099294f0\u002F","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F489924\u002F44f9e29f53a8fac34f27ab6a099294f0\u002F?format=vk","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F489924\\\u002F\"},\"headline\":\"С чего начинается Elasticsearch\",\"datePublished\":\"2020-02-25T19:10:30+03:00\",\"dateModified\":\"2020-02-26T18:01:59+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Роман\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Elasticsearch, вероятно, самая популярная поисковая система на данный момент с развитым сообществом, поддержкой и горой информации в сети. Однако эта информация...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F489924\\\u002F#post-content-body\",\"about\":[\"h_search_technologies\",\"h_it-infrastructure\",\"h_distributed_systems\",\"f_develop\",\"f_admin\"],\"image\":[\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fu9\\\u002Fvi\\\u002Foe\\\u002Fu9vioev9akwzaj1c8hrbmbdjfqm.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fyk\\\u002Fcq\\\u002Fxq\\\u002Fykcqxq59u93tthdeynsgzl3co-k.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fbr\\\u002Fvx\\\u002Fdc\\\u002Fbrvxdcp5k7p1lswgx7msvnhpx70.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fpq\\\u002Fa1\\\u002Fsr\\\u002Fpqa1sr_yawfjzqz5g8mntcl1dim.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fal\\\u002Fja\\\u002Ffv\\\u002Faljafvzws50myp43grmy4hvhbrk.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fji\\\u002F0m\\\u002Fsg\\\u002Fji0msg-kjfmmmolxt8dp0zgkiti.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Foa\\\u002Fhw\\\u002F_q\\\u002Foahw_qp3sc19wwnhn8vl5k0wsm0.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fje\\\u002Fdx\\\u002F_b\\\u002Fjedx_bbsqdrbemksh0oithdxezi.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fz1\\\u002Faf\\\u002Fag\\\u002Fz1afagq-1veviaor8clhvru7rfm.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fua\\\u002Faz\\\u002F-w\\\u002Fuaaz-wypkw1_v7c76yfyyjoso7c.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fdi\\\u002Fhw\\\u002Fwj\\\u002Fdihwwjwbd2wsvmwy_ucbsjundzu.png\"]}","metaDescription":"Elasticsearch, вероятно, самая популярная поисковая система на данный момент с развитым сообществом, поддержкой и горой информации в сети. Однако эта информация поступает непоследовательно и...","mainImageUrl":null,"amp":false,"customTrackerLinks":[]},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[{"title":"Blockchain разработчик","vacanciesCount":16,"itemUrl":"https:\u002F\u002Fcareer.habr.com\u002Fvacancies\u002Fblockchain_developer","itemHubs":["distributed_systems","cryptocurrency","solidity"]},{"title":"Системный администратор","vacanciesCount":130,"itemUrl":"https:\u002F\u002Fcareer.habr.com\u002Fvacancies\u002Fsistemnij_administrator","itemHubs":["it-infrastructure","s_admin","server_side_optimization","sys_admin"]}],"hubs":"search_technologies,it-infrastructure,distributed_systems"},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{},"workplaceInfo":null},"companyAdmin":{"companyInfo":null,"companyInfoLoading":false,"faqArticles":null,"brandingPreviewImageUrl":null},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"promoData":{"isLoading":false,"hasLoaded":false,"featurer":null,"megaposts":null,"promoLinks":null,"promoPosts":null},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"search":{"searchQueryError":null},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"technotext":{"nominationsList":[]},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"userSpecialization":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.da6c6b36.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.92df6f6d.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
<script src="https://habr.com/js/ads.js" onload="window['zhY4i4nJ9K'] = true"></script>
</body>
</html>
